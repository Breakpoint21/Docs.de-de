---
uid: web-forms/overview/data-access/introduction/creating-a-business-logic-layer-cs
title: "Erstellen eine Geschäftslogikschicht (c#) | Microsoft Docs"
author: rick-anderson
description: "In diesem Lernprogramm erfahren wir, wie Sie Ihre Geschäftsregeln in einem Business Logic Layer (BLL) zentralisieren, die dient als Mittler für den Datenaustausch zwischen t..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 03/31/2010
ms.topic: article
ms.assetid: 85554606-47cb-4e4f-9848-eed9da579056
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/data-access/introduction/creating-a-business-logic-layer-cs
msc.type: authoredcontent
ms.openlocfilehash: d117456521442972f1bfcfc15a4e8e7253e07e53
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 11/10/2017
---
<a name="creating-a-business-logic-layer-c"></a><span data-ttu-id="2dc5c-103">Erstellen eine Geschäftslogikschicht (c#)</span><span class="sxs-lookup"><span data-stu-id="2dc5c-103">Creating a Business Logic Layer (C#)</span></span>
====================
<span data-ttu-id="2dc5c-104">durch [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="2dc5c-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="2dc5c-105">[Beispiel-App herunterladen](http://download.microsoft.com/download/4/6/3/463cf87c-4724-4cbc-b7b5-3f866f43ba50/ASPNET_Data_Tutorial_2_CS.exe) oder [PDF herunterladen](creating-a-business-logic-layer-cs/_static/datatutorial02cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="2dc5c-105">[Download Sample App](http://download.microsoft.com/download/4/6/3/463cf87c-4724-4cbc-b7b5-3f866f43ba50/ASPNET_Data_Tutorial_2_CS.exe) or [Download PDF](creating-a-business-logic-layer-cs/_static/datatutorial02cs1.pdf)</span></span>

> <span data-ttu-id="2dc5c-106">In diesem Lernprogramm erfahren wir, wie Sie Ihre Geschäftsregeln in einem Business Logic Layer (BLL) zentralisieren, die als Vermittler für den Datenaustausch zwischen der Präsentationsschicht und der DAL dient.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-106">In this tutorial we'll see how to centralize your business rules into a Business Logic Layer (BLL) that serves as an intermediary for data exchange between the presentation layer and the DAL.</span></span>


## <a name="introduction"></a><span data-ttu-id="2dc5c-107">Einführung</span><span class="sxs-lookup"><span data-stu-id="2dc5c-107">Introduction</span></span>

<span data-ttu-id="2dc5c-108">(Data Access Layer, DAL) erstellt, der [ersten Lernprogramm](creating-a-data-access-layer-cs.md) ordnungsgemäß trennt die Daten die Präsentationslogik Logik zugreifen.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-108">The Data Access Layer (DAL) created in the [first tutorial](creating-a-data-access-layer-cs.md) cleanly separates the data access logic from the presentation logic.</span></span> <span data-ttu-id="2dc5c-109">Jedoch während die DAL saubersten die Zugriffsdetails Daten aus der Darstellungsschicht trennt, werden sie keine Geschäftsregeln erzwungen, die gelten können.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-109">However, while the DAL cleanly separates the data access details from the presentation layer, it does not enforce any business rules that may apply.</span></span> <span data-ttu-id="2dc5c-110">Beispielsweise sollten wir für unsere Anwendung zu unterbinden, die `CategoryID` oder `SupplierID` Felder von der `Products` Tabelle geändert werden, wenn die `Discontinued` Feld auf 1 festgelegt ist, oder wir können Betriebszugehörigkeit-Regeln erzwungen Verbot Situationen, in denen ein Mitarbeiter wird von einer Person verwaltet, nachdem sie eingestellt wurde.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-110">For example, for our application we may want to disallow the `CategoryID` or `SupplierID` fields of the `Products` table to be modified when the `Discontinued` field is set to 1, or we might want to enforce seniority rules, prohibiting situations in which an employee is managed by someone who was hired after them.</span></span> <span data-ttu-id="2dc5c-111">Ein weiteres gängiges Szenario ist Autorisierung vielleicht nur Benutzer in einer bestimmten Rolle Löschen von Produkten oder ändern, können die `UnitPrice` Wert.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-111">Another common scenario is authorization perhaps only users in a particular role can delete products or can change the `UnitPrice` value.</span></span>

<span data-ttu-id="2dc5c-112">In diesem Lernprogramm sehen wir, wie diese Geschäftsregeln in einem Business Logic Layer (BLL) zentralisieren, die als Vermittler für den Datenaustausch zwischen der Präsentationsschicht und der DAL dient.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-112">In this tutorial we'll see how to centralize these business rules into a Business Logic Layer (BLL) that serves as an intermediary for data exchange between the presentation layer and the DAL.</span></span> <span data-ttu-id="2dc5c-113">In einer realen Anwendung sollte die BLL als ein separates Klassenbibliotheksprojekt implementiert werden. allerdings für diese Lernprogramme implementieren wir die BLL als eine Reihe von Klassen in unserer `App_Code` Ordner, um die Projektstruktur zu vereinfachen.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-113">In a real-world application, the BLL should be implemented as a separate Class Library project; however, for these tutorials we'll implement the BLL as a series of classes in our `App_Code` folder in order to simplify the project structure.</span></span> <span data-ttu-id="2dc5c-114">Abbildung 1 zeigt die Architektur Beziehungen zwischen der Präsentationsschicht, BLL und DAL.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-114">Figure 1 illustrates the architectural relationships among the presentation layer, BLL, and DAL.</span></span>


![Die BLL trennt die Darstellungsschicht von der Datenzugriffsebene und erzwingt Geschäftsregeln](creating-a-business-logic-layer-cs/_static/image1.png)

<span data-ttu-id="2dc5c-116">**Abbildung 1**: die BLL trennt die Darstellungsschicht von der Datenzugriffsebene und erzwingt Geschäftsregeln</span><span class="sxs-lookup"><span data-stu-id="2dc5c-116">**Figure 1**: The BLL Separates the Presentation Layer from the Data Access Layer and Imposes Business Rules</span></span>


## <a name="step-1-creating-the-bll-classes"></a><span data-ttu-id="2dc5c-117">Schritt 1: Erstellen der BLL-Klassen</span><span class="sxs-lookup"><span data-stu-id="2dc5c-117">Step 1: Creating the BLL Classes</span></span>

<span data-ttu-id="2dc5c-118">Unsere BLL wird aus vier Klassen: eine für jeden TableAdapter in der DAL bestehen; Jede dieser Klassen BLL müssen Methoden zum Abrufen, einfügen, aktualisieren und Löschen von der jeweiligen TableAdapter in die DAL die entsprechenden Geschäftsregeln anwenden.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-118">Our BLL will be composed of four classes, one for each TableAdapter in the DAL; each of these BLL classes will have methods for retrieving, inserting, updating, and deleting from the respective TableAdapter in the DAL, applying the appropriate business rules.</span></span>

<span data-ttu-id="2dc5c-119">Der DAL - und BLL-bezogene Klassen um deutlicher zu trennen, erstellen wir zwei Unterordner in der `App_Code` Ordner `DAL` und `BLL`.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-119">To more cleanly separate the DAL- and BLL-related classes, let's create two subfolders in the `App_Code` folder, `DAL` and `BLL`.</span></span> <span data-ttu-id="2dc5c-120">Einfach mit der rechten Maustaste auf die `App_Code` Ordner im Projektmappen-Explorer, und wählen Sie die neuen Ordner.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-120">Simply right-click on the `App_Code` folder in the Solution Explorer and choose New Folder.</span></span> <span data-ttu-id="2dc5c-121">Verschieben Sie nach dem erstellen diese beiden Ordner an, die typisierte DataSet erstellt, die im ersten Lernprogramm in der `DAL` Unterordner.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-121">After creating these two folders, move the Typed DataSet created in the first tutorial into the `DAL` subfolder.</span></span>

<span data-ttu-id="2dc5c-122">Als Nächstes erstellen Sie die vier BLL-Klasse-Dateien in den `BLL` Unterordner.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-122">Next, create the four BLL class files in the `BLL` subfolder.</span></span> <span data-ttu-id="2dc5c-123">Um dies zu erreichen, rechtsklicken Sie auf die `BLL` Unterordner, wählen Sie ein neues Element hinzufügen, und wählen Sie die Klassenvorlage.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-123">To accomplish this, right-click on the `BLL` subfolder, choose Add a New Item, and choose the Class template.</span></span> <span data-ttu-id="2dc5c-124">Benennen Sie die vier Klassen `ProductsBLL`, `CategoriesBLL`, `SuppliersBLL`, und `EmployeesBLL`.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-124">Name the four classes `ProductsBLL`, `CategoriesBLL`, `SuppliersBLL`, and `EmployeesBLL`.</span></span>


![Fügen Sie vier neue Klassen hinzu, um den Ordner "App_Code"](creating-a-business-logic-layer-cs/_static/image2.png)

<span data-ttu-id="2dc5c-126">**Abbildung 2**: vier neue Klassen hinzufügen der `App_Code` Ordner</span><span class="sxs-lookup"><span data-stu-id="2dc5c-126">**Figure 2**: Add Four New Classes to the `App_Code` Folder</span></span>


<span data-ttu-id="2dc5c-127">Als Nächstes fügen Sie Methoden auf jede der Klassen, die Methoden definiert, die für die TableAdapter aus dem ersten Lernprogramm einfach zu umschließen.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-127">Next, let's add methods to each of the classes to simply wrap the methods defined for the TableAdapters from the first tutorial.</span></span> <span data-ttu-id="2dc5c-128">Jetzt werden diese Methoden nur direkt in der DAL aufrufen; Wir müssen zu einem späteren Zeitpunkt eine beliebige erforderliche Geschäftslogik hinzufügen, zurück.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-128">For now, these methods will just call directly into the DAL; we'll return later to add any needed business logic.</span></span>

> [!NOTE]
> <span data-ttu-id="2dc5c-129">Bei Verwendung von Visual Studio Standard Edition oder höher (d. h., Sie sind *nicht* mit Visual Web Developer), können Sie optional Ihren visuell mit Klassen Entwerfen der [Klassen-Designer](https://msdn.microsoft.com/library/default.asp?url=/library/en-us/dv_vstechart/html/clssdsgnr.asp).</span><span class="sxs-lookup"><span data-stu-id="2dc5c-129">If you are using Visual Studio Standard Edition or above (that is, you're *not* using Visual Web Developer), you can optionally design your classes visually using the [Class Designer](https://msdn.microsoft.com/library/default.asp?url=/library/en-us/dv_vstechart/html/clssdsgnr.asp).</span></span> <span data-ttu-id="2dc5c-130">Finden Sie in der [Klasse Designer Blog](https://blogs.msdn.com/classdesigner/default.aspx) für Weitere Informationen zu dieser neuen Funktion in Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-130">Refer to the [Class Designer Blog](https://blogs.msdn.com/classdesigner/default.aspx) for more information on this new feature in Visual Studio.</span></span>


<span data-ttu-id="2dc5c-131">Für die `ProductsBLL` Klasse, die wir insgesamt sieben Methoden hinzufügen müssen:</span><span class="sxs-lookup"><span data-stu-id="2dc5c-131">For the `ProductsBLL` class we need to add a total of seven methods:</span></span>

- <span data-ttu-id="2dc5c-132">`GetProducts()`Gibt alle Produkte zurück</span><span class="sxs-lookup"><span data-stu-id="2dc5c-132">`GetProducts()` returns all products</span></span>
- <span data-ttu-id="2dc5c-133">`GetProductByProductID(productID)`Gibt das Produkt mit der angegebenen Produkt-ID</span><span class="sxs-lookup"><span data-stu-id="2dc5c-133">`GetProductByProductID(productID)` returns the product with the specified product ID</span></span>
- <span data-ttu-id="2dc5c-134">`GetProductsByCategoryID(categoryID)`Gibt alle Produkte aus der angegebenen Kategorie zurück.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-134">`GetProductsByCategoryID(categoryID)` returns all products from the specified category</span></span>
- <span data-ttu-id="2dc5c-135">`GetProductsBySupplier(supplierID)`Gibt alle Produkte aus den angegebenen Lieferanten</span><span class="sxs-lookup"><span data-stu-id="2dc5c-135">`GetProductsBySupplier(supplierID)` returns all products from the specified supplier</span></span>
- <span data-ttu-id="2dc5c-136">`AddProduct(productName, supplierID, categoryID, quantityPerUnit, unitPrice, unitsInStock, unitsOnOrder, reorderLevel, discontinued)`Fügt ein neues Produkt in der Datenbank mithilfe der Werte ein übergeben eingehend; Gibt die `ProductID` Wert des neu eingefügten Datensatzes</span><span class="sxs-lookup"><span data-stu-id="2dc5c-136">`AddProduct(productName, supplierID, categoryID, quantityPerUnit, unitPrice, unitsInStock, unitsOnOrder, reorderLevel, discontinued)` inserts a new product into the database using the values passed-in; returns the `ProductID` value of the newly inserted record</span></span>
- <span data-ttu-id="2dc5c-137">`UpdateProduct(productName, supplierID, categoryID, quantityPerUnit, unitPrice, unitsInStock, unitsOnOrder, reorderLevel, discontinued, productID)`aktualisiert ein vorhandenes Produkt mit der übergebenen Werte in der Datenbank an. Gibt `true` wenn genau eine Zeile aktualisiert wurde, `false` andernfalls</span><span class="sxs-lookup"><span data-stu-id="2dc5c-137">`UpdateProduct(productName, supplierID, categoryID, quantityPerUnit, unitPrice, unitsInStock, unitsOnOrder, reorderLevel, discontinued, productID)` updates an existing product in the database using the passed-in values; returns `true` if precisely one row was updated, `false` otherwise</span></span>
- <span data-ttu-id="2dc5c-138">`DeleteProduct(productID)`Löscht das angegebene Produkt aus der Datenbank</span><span class="sxs-lookup"><span data-stu-id="2dc5c-138">`DeleteProduct(productID)` deletes the specified product from the database</span></span>

<span data-ttu-id="2dc5c-139">ProductsBLL.cs</span><span class="sxs-lookup"><span data-stu-id="2dc5c-139">ProductsBLL.cs</span></span>


[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample1.cs)]

<span data-ttu-id="2dc5c-140">Die Methoden, die Daten zurückgeben `GetProducts`, `GetProductByProductID`, `GetProductsByCategoryID`, und `GetProductBySuppliersID` sind recht einfach, wie sie in der DAL rufen Sie einfach nach unten.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-140">The methods that simply return data `GetProducts`, `GetProductByProductID`, `GetProductsByCategoryID`, and `GetProductBySuppliersID` are fairly straightforward as they simply call down into the DAL.</span></span> <span data-ttu-id="2dc5c-141">In einigen Szenarien besteht möglicherweise Geschäftsregeln, die implementiert werden, müssen auf dieser Ebene (z. B. die Autorisierungsregeln basierend auf den derzeit angemeldeten Benutzer oder die Rolle, zu der der Benutzer gehört), müssen wir einfach lassen diese Methoden als-ist.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-141">While in some scenarios there may be business rules that need to be implemented at this level (such as authorization rules based on the currently logged on user or the role to which the user belongs), we'll simply leave these methods as-is.</span></span> <span data-ttu-id="2dc5c-142">Für diese Methode dient dann die BLL lediglich als Proxy über dem Darstellungsschicht von der Datenzugriffsebene die zugrunde liegenden Daten zugreift.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-142">For these methods, then, the BLL serves merely as a proxy through which the presentation layer accesses the underlying data from the Data Access Layer.</span></span>

<span data-ttu-id="2dc5c-143">Die `AddProduct` und `UpdateProduct` Methoden sowohl sind als Parameter die Werte für die verschiedenen Produkt Felder und Hinzufügen eines neuen Produkts oder einer vorhandenen bzw. aktualisieren.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-143">The `AddProduct` and `UpdateProduct` methods both take in as parameters the values for the various product fields and add a new product or update an existing one, respectively.</span></span> <span data-ttu-id="2dc5c-144">Da viele der der `Product` Tabellenspalten lässt `NULL` Werte (`CategoryID`, `SupplierID`, und `UnitPrice`, um nur einige zu nennen), die Eingabeparameter für `AddProduct` und `UpdateProduct` , die solche Spalten Verwendung zugeordnet[auf NULL festlegbare Typen](https://msdn.microsoft.com/en-us/library/1t3y8s4s(v=vs.80).aspx).</span><span class="sxs-lookup"><span data-stu-id="2dc5c-144">Since many of the `Product` table's columns can accept `NULL` values (`CategoryID`, `SupplierID`, and `UnitPrice`, to name a few), those input parameters for `AddProduct` and `UpdateProduct` that map to such columns use [nullable types](https://msdn.microsoft.com/en-us/library/1t3y8s4s(v=vs.80).aspx).</span></span> <span data-ttu-id="2dc5c-145">Auf NULL festlegbare Typen sind neu in .NET 2.0 und eine Technik bereitzustellen, für sein, der angibt, ob ein Werttyp stattdessen sollten `null`.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-145">Nullable types are new to .NET 2.0 and provide a technique for indicating whether a value type should, instead, be `null`.</span></span> <span data-ttu-id="2dc5c-146">In c# können Sie einen Werttyp als dem nullable-Typ kennzeichnen, indem hinzufügen `?` nach dem Typ (z. B. `int? x;`).</span><span class="sxs-lookup"><span data-stu-id="2dc5c-146">In C# you can flag a value type as a nullable type by adding `?` after the type (like `int? x;`).</span></span> <span data-ttu-id="2dc5c-147">Finden Sie in der [auf NULL festlegbare Typen](https://msdn.microsoft.com/en-us/library/1t3y8s4s.aspx) im Abschnitt der [C#-Programmierhandbuch](https://msdn.microsoft.com/en-us/library/67ef8sbd%28VS.80%29.aspx) für Weitere Informationen.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-147">Refer to the [Nullable Types](https://msdn.microsoft.com/en-us/library/1t3y8s4s.aspx) section in the [C# Programming Guide](https://msdn.microsoft.com/en-us/library/67ef8sbd%28VS.80%29.aspx) for more information.</span></span>

<span data-ttu-id="2dc5c-148">Alle drei Methoden geben einen booleschen Wert, der angibt, ob eine Zeile eingefügt, aktualisiert oder gelöscht werden, da der Vorgang nicht in einer betroffenen Zeile möglicherweise wurde zurück.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-148">All three methods return a Boolean value indicating whether a row was inserted, updated, or deleted since the operation may not result in an affected row.</span></span> <span data-ttu-id="2dc5c-149">Beispielsweise ruft der Entwickler der Seite `DeleteProduct` übergeben eine `ProductID` für ein Produkt nicht existierende der `DELETE` Anweisung ausgegeben wird, auf die Datenbank hat keine Auswirkung und somit die `DeleteProduct` Methode zurück `false`.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-149">For example, if the page developer calls `DeleteProduct` passing in a `ProductID` for a non-existent product, the `DELETE` statement issued to the database will have no affect and therefore the `DeleteProduct` method will return `false`.</span></span>

<span data-ttu-id="2dc5c-150">Beachten Sie, dass, wenn Sie ein neues Produkt hinzufügen oder Aktualisieren einer vorhandenen wir nehmen in das neue oder geänderte Produkt Feldwerte als eine Liste von skalaren im Gegensatz zu akzeptieren einen `ProductsRow` Instanz.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-150">Note that when adding a new product or updating an existing one we take in the new or modified product's field values as a list of scalars as opposed to accepting a `ProductsRow` instance.</span></span> <span data-ttu-id="2dc5c-151">Dieser Ansatz wurde gewählt, weil die `ProductsRow` -Klasse ableitet, die ADO.NET `DataRow` -Klasse, die nicht über einen parameterlosen Standardkonstruktor verfügt.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-151">This approach was chosen because the `ProductsRow` class derives from the ADO.NET `DataRow` class, which doesn't have a default parameterless constructor.</span></span> <span data-ttu-id="2dc5c-152">Zum Erstellen eines neuen `ProductsRow` Instanz wir müssen zunächst erstellen eine `ProductsDataTable` -Instanz und rufen Sie dann die `NewProductRow()` Methode (was der Fall ist `AddProduct`).</span><span class="sxs-lookup"><span data-stu-id="2dc5c-152">In order to create a new `ProductsRow` instance, we must first create a `ProductsDataTable` instance and then invoke its `NewProductRow()` method (which we do in `AddProduct`).</span></span> <span data-ttu-id="2dc5c-153">Dieser Schwierigkeit rears den Kopf, wenn wir zum Einfügen und Aktualisieren von Produkten mithilfe der ObjectDataSource aktivieren.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-153">This shortcoming rears its head when we turn to inserting and updating products using the ObjectDataSource.</span></span> <span data-ttu-id="2dc5c-154">Kurz gesagt, versucht das ObjectDataSource zum Erstellen einer Instanz der Eingabeparameter.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-154">In short, the ObjectDataSource will try to create an instance of the input parameters.</span></span> <span data-ttu-id="2dc5c-155">Wenn die Methode BLL erwartet eine `ProductsRow` Instanz, versucht das ObjectDataSource, erstellen Sie einen, jedoch zu einem Fehler aufgrund der Mangel an einen parameterlosen Standardkonstruktor.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-155">If the BLL method expects a `ProductsRow` instance, the ObjectDataSource will try to create one, but fail due to the lack of a default parameterless constructor.</span></span> <span data-ttu-id="2dc5c-156">Weitere Informationen zu diesem Problem finden Sie in den folgenden zwei ASP.NET Foren Beiträgen: [ObjectDataSources mit Strongly-Typed DataSets aktualisieren](https://forums.asp.net/1098630/ShowPost.aspx), und [Problem mit ObjectDataSource und Strongly-Typed DataSet](https://forums.asp.net/1048212/ShowPost.aspx).</span><span class="sxs-lookup"><span data-stu-id="2dc5c-156">For more information on this problem, refer to the following two ASP.NET Forums posts: [Updating ObjectDataSources with Strongly-Typed DataSets](https://forums.asp.net/1098630/ShowPost.aspx), and [Problem With ObjectDataSource and Strongly-Typed DataSet](https://forums.asp.net/1048212/ShowPost.aspx).</span></span>

<span data-ttu-id="2dc5c-157">Als Nächstes wird in beiden `AddProduct` und `UpdateProduct`, erstellt der Code eine `ProductsRow` Instanz, und füllt sie mit den Werten, die nur übergeben.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-157">Next, in both `AddProduct` and `UpdateProduct`, the code creates a `ProductsRow` instance and populates it with the values just passed in.</span></span> <span data-ttu-id="2dc5c-158">Verschiedene Überprüfungen auf Feldebene können auftreten, wenn DataColumns einer DataRow Werte zuweisen.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-158">When assigning values to DataColumns of a DataRow various field-level validation checks can occur.</span></span> <span data-ttu-id="2dc5c-159">Aus diesem Grund kann die übergebenen Werte manuell wieder in einer DataRow einfügen sichergestellt werden die Gültigkeit der Daten an die BLL-Methode übergeben wird.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-159">Therefore, manually putting the passed in values back into a DataRow helps ensure the validity of the data being passed to the BLL method.</span></span> <span data-ttu-id="2dc5c-160">Die stark typisierte DataRow-Klassen von Visual Studio generiert verwenden leider nicht auf NULL festlegbare Typen.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-160">Unfortunately the strongly-typed DataRow classes generated by Visual Studio do not use nullable types.</span></span> <span data-ttu-id="2dc5c-161">Vielmehr, um anzugeben, dass eine bestimmte DataColumn in einer DataRow entsprechen sollten eine `NULL` Datenbank Wert wir verwenden die `SetColumnNameNull()` Methode.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-161">Rather, to indicate that a particular DataColumn in a DataRow should correspond to a `NULL` database value we must use the `SetColumnNameNull()` method.</span></span>

<span data-ttu-id="2dc5c-162">In `UpdateProduct` laden wir zuerst in das Produkt, das update mit `GetProductByProductID(productID)`.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-162">In `UpdateProduct` we first load in the product to update using `GetProductByProductID(productID)`.</span></span> <span data-ttu-id="2dc5c-163">Dies mag wie eine unnötige Roundtrips zur Datenbank, werden diese zusätzlichen Reise lohnende in zukünftigen Lernprogrammen zu prüfen, die vollständigen Parallelität zu untersuchen.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-163">While this may seem like an unnecessary trip to the database, this extra trip will prove worthwhile in future tutorials that explore optimistic concurrency.</span></span> <span data-ttu-id="2dc5c-164">Vollständige Parallelität ist eine Technik, um sicherzustellen, dass zwei Benutzer gleichzeitig auf denselben Daten arbeiten jeweiligen Änderungen nicht versehentlich überschreiben.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-164">Optimistic concurrency is a technique to ensure that two users who are simultaneously working on the same data don't accidentally overwrite one another's changes.</span></span> <span data-ttu-id="2dc5c-165">Den gesamten Datensatz Grabbing erleichtert auch zum Erstellen von Aktualisierungsmethoden in die BLL, die nur eine Teilmenge der Spalten, die DataRow ändern.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-165">Grabbing the entire record also makes it easier to create update methods in the BLL that only modify a subset of the DataRow's columns.</span></span> <span data-ttu-id="2dc5c-166">Wenn wir untersuchen das `SuppliersBLL` sehen wir ein Beispiel für eine solche Klasse.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-166">When we explore the `SuppliersBLL` class we'll see such an example.</span></span>

<span data-ttu-id="2dc5c-167">Schließlich, beachten Sie, dass die `ProductsBLL` -Klasse verfügt über die [DataObject Attribut](https://msdn.microsoft.com/en-us/library/system.componentmodel.dataobjectattribute.aspx) angewendet wird (der `[System.ComponentModel.DataObject]` Syntax direkt vor dem Class-Anweisung im oberen Bereich der Datei) und die Methoden verfügen über [ DataObjectMethodAttribute Attribute](https://msdn.microsoft.com/en-us/library/system.componentmodel.dataobjectmethodattribute.aspx).</span><span class="sxs-lookup"><span data-stu-id="2dc5c-167">Finally, note that the `ProductsBLL` class has the [DataObject attribute](https://msdn.microsoft.com/en-us/library/system.componentmodel.dataobjectattribute.aspx) applied to it (the `[System.ComponentModel.DataObject]` syntax right before the class statement near the top of the file) and the methods have [DataObjectMethodAttribute attributes](https://msdn.microsoft.com/en-us/library/system.componentmodel.dataobjectmethodattribute.aspx).</span></span> <span data-ttu-id="2dc5c-168">Die `DataObject` Attribut markiert die Klasse als ein Objekt, das für die Bindung an eine [ObjectDataSource-Steuerelement](https://msdn.microsoft.com/en-us/library/9a4kyhcx.aspx), während die `DataObjectMethodAttribute` den Zweck der Methode angibt.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-168">The `DataObject` attribute marks the class as being an object suitable for binding to an [ObjectDataSource control](https://msdn.microsoft.com/en-us/library/9a4kyhcx.aspx), whereas the `DataObjectMethodAttribute` indicates the purpose of the method.</span></span> <span data-ttu-id="2dc5c-169">Wird in zukünftigen Lernprogrammen sehen, vereinfacht die Verwendung des ASP.NET 2.0 ObjectDataSource deklarativ Daten aus einer Klasse zuzugreifen.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-169">As we'll see in future tutorials, ASP.NET 2.0's ObjectDataSource makes it easy to declaratively access data from a class.</span></span> <span data-ttu-id="2dc5c-170">Um die Liste der möglichen Klassen zum Binden an das ObjectDataSource-Assistenten Filtern zu unterstützen, werden standardmäßig nur die Klassen, die als gekennzeichnete `DataObjects` werden in den Assistenten Dropdown-Liste angezeigt.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-170">To help filter the list of possible classes to bind to in the ObjectDataSource's wizard, by default only those classes marked as `DataObjects` are shown in the wizard's drop-down list.</span></span> <span data-ttu-id="2dc5c-171">Die `ProductsBLL` Klasse funktioniert genauso gut ohne diese Attribute, aber diese hinzufügen erleichtert das Arbeiten mit im Assistenten für das ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-171">The `ProductsBLL` class will work just as well without these attributes, but adding them makes it easier to work with in the ObjectDataSource's wizard.</span></span>

## <a name="adding-the-other-classes"></a><span data-ttu-id="2dc5c-172">Hinzufügen von anderen Klassen</span><span class="sxs-lookup"><span data-stu-id="2dc5c-172">Adding the Other Classes</span></span>

<span data-ttu-id="2dc5c-173">Mit der `ProductsBLL` Klasse abgeschlossen, wir noch die Klassen für das Arbeiten mit Kategorien, Lieferanten und Mitarbeiter hinzufügen müssen.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-173">With the `ProductsBLL` class complete, we still need to add the classes for working with categories, suppliers, and employees.</span></span> <span data-ttu-id="2dc5c-174">Nehmen Sie einen Moment Zeit, um die folgenden Klassen und Methoden, die mit den Konzepten von den oben genannten Beispiel zu erstellen:</span><span class="sxs-lookup"><span data-stu-id="2dc5c-174">Take a moment to create the following classes and methods using the concepts from the example above:</span></span>

- <span data-ttu-id="2dc5c-175">**CategoriesBLL.cs**</span><span class="sxs-lookup"><span data-stu-id="2dc5c-175">**CategoriesBLL.cs**</span></span>

    - `GetCategories()`
    - `GetCategoryByCategoryID(categoryID)`
- <span data-ttu-id="2dc5c-176">**SuppliersBLL.cs**</span><span class="sxs-lookup"><span data-stu-id="2dc5c-176">**SuppliersBLL.cs**</span></span>

    - `GetSuppliers()`
    - `GetSupplierBySupplierID(supplierID)`
    - `GetSuppliersByCountry(country)`
    - `UpdateSupplierAddress(supplierID, address, city, country)`
- <span data-ttu-id="2dc5c-177">**EmployeesBLL.cs**</span><span class="sxs-lookup"><span data-stu-id="2dc5c-177">**EmployeesBLL.cs**</span></span>

    - `GetEmployees()`
    - `GetEmployeeByEmployeeID(employeeID)`
    - `GetEmployeesByManager(managerID)`

<span data-ttu-id="2dc5c-178">Die eine Methode zu beachten ist die `SuppliersBLL` Klasse `UpdateSupplierAddress` Methode.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-178">The one method worth noting is the `SuppliersBLL` class's `UpdateSupplierAddress` method.</span></span> <span data-ttu-id="2dc5c-179">Diese Methode stellt eine Schnittstelle für die Aktualisierung nur die Adressinformationen des Lieferanten.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-179">This method provides an interface for updating just the supplier's address information.</span></span> <span data-ttu-id="2dc5c-180">Intern wird diese Methode liest der `SupplierDataRow` für das angegebene Objekt `supplierID` (mit `GetSupplierBySupplierID`), legt deren Eigenschaften adressbezogenen fest und ruft dann nach unten in der `SupplierDataTable`des `Update` Methode.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-180">Internally, this method reads in the `SupplierDataRow` object for the specified `supplierID` (using `GetSupplierBySupplierID`), sets its address-related properties, and then calls down into the `SupplierDataTable`'s `Update` method.</span></span> <span data-ttu-id="2dc5c-181">Die `UpdateSupplierAddress` Methode folgt:</span><span class="sxs-lookup"><span data-stu-id="2dc5c-181">The `UpdateSupplierAddress` method follows:</span></span>


[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample2.cs)]

<span data-ttu-id="2dc5c-182">Finden Sie in diesem Artikel Download für meine vollständige Implementierung der BLL Klassen.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-182">Refer to this article's download for my complete implementation of the BLL classes.</span></span>

## <a name="step-2-accessing-the-typed-datasets-through-the-bll-classes"></a><span data-ttu-id="2dc5c-183">Schritt 2: Den Zugriff auf typisierte DataSets durch die BLL-Klassen</span><span class="sxs-lookup"><span data-stu-id="2dc5c-183">Step 2: Accessing the Typed DataSets Through the BLL Classes</span></span>

<span data-ttu-id="2dc5c-184">Im ersten Lernprogramm Filtermenü Beispiele für das direkt mit dem typisierten DataSet programmgesteuert arbeiten, aber durch das Hinzufügen von unseren BLL Klassen ist die Präsentationsebene Formulargröße gegen die BLL stattdessen.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-184">In the first tutorial we saw examples of working directly with the Typed DataSet programmatically, but with the addition of our BLL classes, the presentation tier should work against the BLL instead.</span></span> <span data-ttu-id="2dc5c-185">In der `AllProducts.aspx` Beispiel aus dem ersten Lernprogramm, das `ProductsTableAdapter` wurde um die Liste der Produkte an eine GridView zu binden verwendet, wie im folgenden Code gezeigt:</span><span class="sxs-lookup"><span data-stu-id="2dc5c-185">In the `AllProducts.aspx` example from the first tutorial, the `ProductsTableAdapter` was used to bind the list of products to a GridView, as shown in the following code:</span></span>


[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample3.cs)]

<span data-ttu-id="2dc5c-186">Verwenden Sie die neue BLL Klassen, die geändert werden muss ist ersetzen Sie die erste Zeile des Codes die `ProductsTableAdapter` -Objekt mit einer `ProductBLL` Objekt:</span><span class="sxs-lookup"><span data-stu-id="2dc5c-186">To use the new BLL classes, all that needs to be changed is the first line of code simply replace the `ProductsTableAdapter` object with a `ProductBLL` object:</span></span>


[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample4.cs)]

<span data-ttu-id="2dc5c-187">Die BLL Klassen können auch deklarativ (wie das typisierte DataSet) mithilfe der ObjectDataSource zugegriffen werden.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-187">The BLL classes can also be accessed declaratively (as can the Typed DataSet) by using the ObjectDataSource.</span></span> <span data-ttu-id="2dc5c-188">Wir müssen die ObjectDataSource ausführlicher in den folgenden Lernprogrammen erörtert.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-188">We'll be discussing the ObjectDataSource in greater detail in the following tutorials.</span></span>


<span data-ttu-id="2dc5c-189">[![Die Liste der Produkte wird in einem GridView angezeigt.](creating-a-business-logic-layer-cs/_static/image4.png)](creating-a-business-logic-layer-cs/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="2dc5c-189">[![The List of Products is Displayed in a GridView](creating-a-business-logic-layer-cs/_static/image4.png)](creating-a-business-logic-layer-cs/_static/image3.png)</span></span>

<span data-ttu-id="2dc5c-190">**Abbildung 3**: die Liste der Produkte in einer GridView angezeigt wird ([klicken Sie hier, um das Bild in voller Größe angezeigt](creating-a-business-logic-layer-cs/_static/image5.png))</span><span class="sxs-lookup"><span data-stu-id="2dc5c-190">**Figure 3**: The List of Products is Displayed in a GridView ([Click to view full-size image](creating-a-business-logic-layer-cs/_static/image5.png))</span></span>


## <a name="step-3-adding-field-level-validation-to-the-datarow-classes"></a><span data-ttu-id="2dc5c-191">Schritt 3: Hinzufügen einer Validierung der Feldebene auf die DataRow-Klassen</span><span class="sxs-lookup"><span data-stu-id="2dc5c-191">Step 3: Adding Field-Level Validation to the DataRow Classes</span></span>

<span data-ttu-id="2dc5c-192">Überprüfungsfehler auf werden überprüft, die auf die Eigenschaftswerte von Geschäftsobjekten, beim Einfügen oder Aktualisieren von beziehen.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-192">Field-level validation are checks that pertains to the property values of the business objects when inserting or updating.</span></span> <span data-ttu-id="2dc5c-193">Einige Feldebene Überprüfungsregeln für Produkte umfassen:</span><span class="sxs-lookup"><span data-stu-id="2dc5c-193">Some field-level validation rules for products include:</span></span>

- <span data-ttu-id="2dc5c-194">Die `ProductName` Feld muss 40 Zeichen oder weniger umfasst</span><span class="sxs-lookup"><span data-stu-id="2dc5c-194">The `ProductName` field must be 40 characters or less in length</span></span>
- <span data-ttu-id="2dc5c-195">Die `QuantityPerUnit` Feld muss 20 Zeichen oder weniger umfasst</span><span class="sxs-lookup"><span data-stu-id="2dc5c-195">The `QuantityPerUnit` field must be 20 characters or less in length</span></span>
- <span data-ttu-id="2dc5c-196">Die `ProductID`, `ProductName`, und `Discontinued` Felder sind erforderlich, aber alle anderen Felder sind optional</span><span class="sxs-lookup"><span data-stu-id="2dc5c-196">The `ProductID`, `ProductName`, and `Discontinued` fields are required, but all other fields are optional</span></span>
- <span data-ttu-id="2dc5c-197">Die `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, und `ReorderLevel` Felder müssen größer als oder gleich 0 (null) sein.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-197">The `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, and `ReorderLevel` fields must be greater than or equal to zero</span></span>

<span data-ttu-id="2dc5c-198">Diese Regeln können und auf Datenbankebene ausgedrückt werden soll.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-198">These rules can and should be expressed at the database level.</span></span> <span data-ttu-id="2dc5c-199">Die Zeichenlänge für den `ProductName` und `QuantityPerUnit` Felder werden erfasst, die Datentypen der Spalten in der `Products` Tabelle (`nvarchar(40)` und `nvarchar(20)`bzw.).</span><span class="sxs-lookup"><span data-stu-id="2dc5c-199">The character limit on the `ProductName` and `QuantityPerUnit` fields are captured by the data types of those columns in the `Products` table (`nvarchar(40)` and `nvarchar(20)`, respectively).</span></span> <span data-ttu-id="2dc5c-200">Gibt an, ob Felder erforderlichen und optionalen werden durch ausgedrückt werden, wenn die Datenbanktabellen-Spalte erlaubt `NULL` s.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-200">Whether fields are required and optional are expressed by if the database table column allows `NULL` s.</span></span> <span data-ttu-id="2dc5c-201">Vier [check-Einschränkungen](https://msdn.microsoft.com/en-us/library/ms188258.aspx) vorhanden, die stellen sicher, dass nur Werte größer als oder gleich 0 (null) in können die `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, oder `ReorderLevel` Spalten.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-201">Four [check constraints](https://msdn.microsoft.com/en-us/library/ms188258.aspx) exist that ensure that only values greater than or equal to zero can make it into the `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, or `ReorderLevel` columns.</span></span>

<span data-ttu-id="2dc5c-202">Zusätzlich zum Erzwingen dieser Regeln in der Datenbank sollten sie auch auf Datensatzebene erzwungen werden.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-202">In addition to enforcing these rules at the database they should also be enforced at the DataSet level.</span></span> <span data-ttu-id="2dc5c-203">In der Tat sind die Feldlänge und gibt an, ob ein Wert erforderlich oder optional ist bereits für jede DataTable Satz von DataColumns erfasst.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-203">In fact, the field length and whether a value is required or optional are already captured for each DataTable's set of DataColumns.</span></span> <span data-ttu-id="2dc5c-204">Um finden Sie in der vorhandenen Feldebene Überprüfung automatisch bereitgestellt, wechseln Sie zu der DataSet-Designer, wählen Sie ein Feld aus einer der Datentabellen, und fahren Sie mit dem Eigenschaftenfenster.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-204">To see the existing field-level validation automatically provided, go to the DataSet Designer, select a field from one of the DataTables and then go to the Properties window.</span></span> <span data-ttu-id="2dc5c-205">Wie in Abbildung 4 gezeigt, die `QuantityPerUnit` DataColumn in der `ProductsDataTable` besitzt eine maximale Länge von 20 Zeichen und lässt `NULL` Werte.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-205">As Figure 4 shows, the `QuantityPerUnit` DataColumn in the `ProductsDataTable` has a maximum length of 20 characters and does allow `NULL` values.</span></span> <span data-ttu-id="2dc5c-206">Wenn Sie versuchen, legen Sie die `ProductsDataRow`des `QuantityPerUnit` Eigenschaft auf einen Zeichenfolgenwert fest, die mehr als 20 Zeichen ein `ArgumentException` ausgelöst.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-206">If we attempt to set the `ProductsDataRow`'s `QuantityPerUnit` property to a string value longer than 20 characters an `ArgumentException` will be thrown.</span></span>


<span data-ttu-id="2dc5c-207">[![DataColumn bietet eine grundlegende Feldebene-Validierung](creating-a-business-logic-layer-cs/_static/image7.png)](creating-a-business-logic-layer-cs/_static/image6.png)</span><span class="sxs-lookup"><span data-stu-id="2dc5c-207">[![The DataColumn Provides Basic Field-Level Validation](creating-a-business-logic-layer-cs/_static/image7.png)](creating-a-business-logic-layer-cs/_static/image6.png)</span></span>

<span data-ttu-id="2dc5c-208">**Abbildung 4**: der DataColumn bietet grundlegende Feldebene Validierung ([klicken Sie hier, um das Bild in voller Größe angezeigt](creating-a-business-logic-layer-cs/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="2dc5c-208">**Figure 4**: The DataColumn Provides Basic Field-Level Validation ([Click to view full-size image](creating-a-business-logic-layer-cs/_static/image8.png))</span></span>


<span data-ttu-id="2dc5c-209">Leider kann nicht angegeben Grenzen Überprüfungen aus, wie z. B. die `UnitPrice` Wert muss größer als oder gleich 0 (null), über das Fenster "Eigenschaften".</span><span class="sxs-lookup"><span data-stu-id="2dc5c-209">Unfortunately, we can't specify bounds checks, such as the `UnitPrice` value must be greater than or equal to zero, through the Properties window.</span></span> <span data-ttu-id="2dc5c-210">Um diese Art der Feldebene Validierung bereitstellen müssen, erstellen Sie einen Ereignishandler für das DataTable [ColumnChanging](https://msdn.microsoft.com/en-us/library/system.data.datatable.columnchanging%28VS.80%29.aspx) Ereignis.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-210">In order to provide this type of field-level validation we need to create an event handler for the DataTable's [ColumnChanging](https://msdn.microsoft.com/en-us/library/system.data.datatable.columnchanging%28VS.80%29.aspx) event.</span></span> <span data-ttu-id="2dc5c-211">Siehe die [vorherigen Lernprogramm](creating-a-data-access-layer-cs.md), die Datasets und Datentabellen DataRow-Objekte erstellt, indem das typisierte DataSet durch die Verwendung von partiellen Klassen erweitert werden können.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-211">As mentioned in the [preceding tutorial](creating-a-data-access-layer-cs.md), the DataSet, DataTables, and DataRow objects created by the Typed DataSet can be extended through the use of partial classes.</span></span> <span data-ttu-id="2dc5c-212">Mit diesem Verfahren wir erstellen eine `ColumnChanging` -Ereignishandler für die `ProductsDataTable` Klasse.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-212">Using this technique we can create a `ColumnChanging` event handler for the `ProductsDataTable` class.</span></span> <span data-ttu-id="2dc5c-213">Starten Sie durch Erstellen einer Klasse in der `App_Code` Ordner mit dem Namen `ProductsDataTable.ColumnChanging.cs`.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-213">Start by creating a class in the `App_Code` folder named `ProductsDataTable.ColumnChanging.cs`.</span></span>


<span data-ttu-id="2dc5c-214">[![Fügen Sie eine neue Klasse, um den Ordner "App_Code"](creating-a-business-logic-layer-cs/_static/image10.png)](creating-a-business-logic-layer-cs/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="2dc5c-214">[![Add a New Class to the App_Code Folder](creating-a-business-logic-layer-cs/_static/image10.png)](creating-a-business-logic-layer-cs/_static/image9.png)</span></span>

<span data-ttu-id="2dc5c-215">**Abbildung 5**: Hinzufügen einer neuen Klasse in der `App_Code` Ordner ([klicken Sie hier, um das Bild in voller Größe angezeigt](creating-a-business-logic-layer-cs/_static/image11.png))</span><span class="sxs-lookup"><span data-stu-id="2dc5c-215">**Figure 5**: Add a New Class to the `App_Code` Folder ([Click to view full-size image](creating-a-business-logic-layer-cs/_static/image11.png))</span></span>


<span data-ttu-id="2dc5c-216">Als Nächstes erstellen Sie einen Ereignishandler für das `ColumnChanging` Ereignis, das wird, dass sichergestellt die `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, und `ReorderLevel` Spaltenwerte (wenn nicht `NULL`) sind größer oder gleich 0 (null).</span><span class="sxs-lookup"><span data-stu-id="2dc5c-216">Next, create an event handler for the `ColumnChanging` event that ensures that the `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, and `ReorderLevel` column values (if not `NULL`) are greater than or equal to zero.</span></span> <span data-ttu-id="2dc5c-217">Wenn eine solche Spalte außerhalb des gültigen Bereichs ist, lösen eine `ArgumentException`.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-217">If any such column is out of range, throw an `ArgumentException`.</span></span>

<span data-ttu-id="2dc5c-218">ProductsDataTable.ColumnChanging.cs</span><span class="sxs-lookup"><span data-stu-id="2dc5c-218">ProductsDataTable.ColumnChanging.cs</span></span>


[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample5.cs)]

## <a name="step-4-adding-custom-business-rules-to-the-blls-classes"></a><span data-ttu-id="2dc5c-219">Schritt 4: Hinzufügen von benutzerdefinierten Geschäftsregeln auf die BLL-Klassen</span><span class="sxs-lookup"><span data-stu-id="2dc5c-219">Step 4: Adding Custom Business Rules to the BLL's Classes</span></span>

<span data-ttu-id="2dc5c-220">Zusätzlich zur Validierung der Feldebene möglicherweise auf hoher Ebene benutzerdefinierten Geschäftsregeln, die verschiedene Entitäten oder Konzepte, die der Ebene der einzelnen Spalte nicht ausgedrückt werden kann, wie z. B. umfassen:</span><span class="sxs-lookup"><span data-stu-id="2dc5c-220">In addition to field-level validation, there may be high-level custom business rules that involve different entities or concepts not expressible at the single column level, such as:</span></span>

- <span data-ttu-id="2dc5c-221">Wenn ein Produkt, werden eingestellt ist seine `UnitPrice` kann nicht aktualisiert werden</span><span class="sxs-lookup"><span data-stu-id="2dc5c-221">If a product is discontinued, its `UnitPrice` cannot be updated</span></span>
- <span data-ttu-id="2dc5c-222">Land des Mitarbeiters muss das Land des Managers identisch sein.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-222">An employee's country of residence must be the same as their manager's country of residence</span></span>
- <span data-ttu-id="2dc5c-223">Ein Produkt kann nicht eingestellt werden, ist dies die einzige Produkt, das vom Lieferanten</span><span class="sxs-lookup"><span data-stu-id="2dc5c-223">A product cannot be discontinued if it is the only product provided by the supplier</span></span>

<span data-ttu-id="2dc5c-224">BLL Klassen dürfen Überprüfungen aus, um die Einhaltung von Geschäftsregeln für die Anwendung sicherzustellen.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-224">The BLL classes should contain checks to ensure adherence to the application's business rules.</span></span> <span data-ttu-id="2dc5c-225">Diese Überprüfungen können direkt auf die Methoden hinzugefügt werden, für die sie gelten.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-225">These checks can be added directly to the methods to which they apply.</span></span>

<span data-ttu-id="2dc5c-226">Stellen Sie sich vor, dass unsere Geschäftsregeln vorgibt, dass für ein Produkt nicht nicht mehr unterstützte gekennzeichnet werden, konnte war dies das einzige Produkt von einem bestimmten anderen Lieferanten.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-226">Imagine that our business rules dictate that a product could not be marked discontinued if it was the only product from a given supplier.</span></span> <span data-ttu-id="2dc5c-227">D. h. wenn Produkt *X* war das einzige Produkt, das wir von anderen Lieferanten erworben *Y*, markieren wir nicht *X* wie eingestellt; Wenn jedoch Lieferanten *Y*uns mit drei Produkte bereitgestellten *ein*, *B*, und *C*, konnten wir alle markieren, und alle diese als nicht mehr unterstützt.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-227">That is, if product *X* was the only product we purchased from supplier *Y*, we could not mark *X* as discontinued; if, however, supplier *Y* supplied us with three products, *A*, *B*, and *C*, then we could mark any and all of these as discontinued.</span></span> <span data-ttu-id="2dc5c-228">Eine ungerade Geschäftsregel aber Geschäftsregeln und Menschenverstand sind nicht immer ausgerichtet.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-228">An odd business rule, but business rules and common sense aren't always aligned!</span></span>

<span data-ttu-id="2dc5c-229">Zum Erzwingen dieser Geschäftsregel in die `UpdateProducts` Methode wir überprüfen zunächst würden, ob `Discontinued` wurde `true` und, falls also nennen wir würden `GetProductsBySupplierID` um zu bestimmen, wie viele Produkte wir dieses Produkt Lieferanten erworben wurden.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-229">To enforce this business rule in the `UpdateProducts` method we'd start by checking if `Discontinued` was set to `true` and, if so, we'd call `GetProductsBySupplierID` to determine how many products we purchased from this product's supplier.</span></span> <span data-ttu-id="2dc5c-230">Wenn nur ein Produkt von diesem Lieferanten erworben wird, lösen wir eine `ApplicationException`.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-230">If only one product is purchased from this supplier, we throw an `ApplicationException`.</span></span>


[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample6.cs)]

## <a name="responding-to-validation-errors-in-the-presentation-tier"></a><span data-ttu-id="2dc5c-231">Reagieren auf Validierungsfehler in der Präsentationsebene</span><span class="sxs-lookup"><span data-stu-id="2dc5c-231">Responding to Validation Errors in the Presentation Tier</span></span>

<span data-ttu-id="2dc5c-232">Beim Aufrufen der BLL von der Präsentationsebene können wir entscheiden Sie, ob der Versuch, alle Ausnahmen zu behandeln, die möglicherweise ausgelöst, oder informieren Sie ihn an ASP.NET übergeben (die löst die `HttpApplication`des `Error` Ereignis).</span><span class="sxs-lookup"><span data-stu-id="2dc5c-232">When calling the BLL from the presentation tier we can decide whether to attempt to handle any exceptions that might be raised or let them bubble up to ASP.NET (which will raise the `HttpApplication`'s `Error` event).</span></span> <span data-ttu-id="2dc5c-233">Um eine Ausnahme behandelt wird, wenn mit der BLL programmgesteuert arbeiten, verwenden wir eine [try…catch](https://msdn.microsoft.com/en-us/library/0yd65esw.aspx) Block, wie im folgenden Beispiel gezeigt:</span><span class="sxs-lookup"><span data-stu-id="2dc5c-233">To handle an exception when working with the BLL programmatically, we can use a [try...catch](https://msdn.microsoft.com/en-us/library/0yd65esw.aspx) block, as the following example shows:</span></span>


[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample7.cs)]

<span data-ttu-id="2dc5c-234">Wie wir in Zukunft Lernprogramme sehen, Behandlung von Ausnahmen, die Bubbling der BLL bei Verwendung eines-Steuerelement zum Einfügen Webserver, aktualisieren oder Löschen von Daten kann direkt in einem Ereignishandler im Gegensatz zur Verwendung in Code umschließen behandelt `try...catch` blockiert.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-234">As we'll see in future tutorials, handling exceptions that bubble up from the BLL when using a data Web control for inserting, updating, or deleting data can be handled directly in an event handler as opposed to having to wrap code in `try...catch` blocks.</span></span>

## <a name="summary"></a><span data-ttu-id="2dc5c-235">Zusammenfassung</span><span class="sxs-lookup"><span data-stu-id="2dc5c-235">Summary</span></span>

<span data-ttu-id="2dc5c-236">Ein Anwendung mit durchdachter ist in unterschiedliche Ebenen gestalteten von denen jede eine bestimmte Rolle kapselt.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-236">A well architected application is crafted into distinct layers, each of which encapsulates a particular role.</span></span> <span data-ttu-id="2dc5c-237">Im ersten Lernprogramm dieser Reihe Artikel haben wir eine Datenzugriffsschicht, typisierte DataSets verwenden; In diesem Lernprogramm wird eine Geschäftslogikschicht als erstellt eine Reihe von Klassen in der vorliegenden Anwendungsverzeichnis `App_Code` Ordner, die nach-unten unsere DAL aufrufen.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-237">In the first tutorial of this article series we created a Data Access Layer using Typed DataSets; in this tutorial we built a Business Logic Layer as a series of classes in our application's `App_Code` folder that call down into our DAL.</span></span> <span data-ttu-id="2dc5c-238">Die BLL implementiert die Logik für die Feldebene und Business-Ebene für die Anwendung.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-238">The BLL implements the field-level and business-level logic for our application.</span></span> <span data-ttu-id="2dc5c-239">Zusätzlich zur Erstellung einer separaten BLL an, wie in diesem Lernprogramm ist eine weitere Option die TableAdapter-Methoden, durch die Verwendung von partiellen Klassen erweitern.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-239">In addition to creating a separate BLL, as we did in this tutorial, another option is to extend the TableAdapters' methods through the use of partial classes.</span></span> <span data-ttu-id="2dc5c-240">Jedoch mithilfe dieser Technik lässt keine uns vorhandene Methoden überschreiben, noch ist es trennen unsere DAL und unsere BLL ordnungsgemäß als Ansatz, wenn, den wir in diesem Artikel erstellt haben.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-240">However, using this technique does not allow us to override existing methods nor does it separate our DAL and our BLL as cleanly as the approach we've taken in this article.</span></span>

<span data-ttu-id="2dc5c-241">Die DAL und BLL abgeschlossen können wir mit auf unserem Darstellungsschicht beginnen.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-241">With the DAL and BLL complete, we're ready to start on our presentation layer.</span></span> <span data-ttu-id="2dc5c-242">In der [nächsten Lernprogramm](master-pages-and-site-navigation-cs.md) wir nehmen Sie eine kurze Umleitung von Themen zum Zugriff auf der Daten und ein konsistente Seitenlayout für die Verwendung in den Lernprogrammen zu definieren.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-242">In the [next tutorial](master-pages-and-site-navigation-cs.md) we'll take a brief detour from data access topics and define a consistent page layout for use throughout the tutorials.</span></span>

<span data-ttu-id="2dc5c-243">Viel Spaß beim Programmieren!</span><span class="sxs-lookup"><span data-stu-id="2dc5c-243">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="2dc5c-244">Informationen zum Autor</span><span class="sxs-lookup"><span data-stu-id="2dc5c-244">About the Author</span></span>

<span data-ttu-id="2dc5c-245">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), Autor von sieben ASP/ASP.NET-Büchern und Gründer von [4GuysFromRolla.com](http://www.4guysfromrolla.com), Microsoft Web-Technologien seit 1998 arbeitet.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-245">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="2dc5c-246">Scott fungiert als ein unabhängiger Berater, Trainer und Writer.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-246">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="2dc5c-247">Sein neueste Buch wird [ *Sams Schulen selbst ASP.NET 2.0 in 24 Stunden*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="2dc5c-247">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="2dc5c-248">Er die erreicht werden kann, zur [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) oder über seinen Blog die finden Sie unter [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="2dc5c-248">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="2dc5c-249">Besonderen Dank an</span><span class="sxs-lookup"><span data-stu-id="2dc5c-249">Special Thanks To</span></span>

<span data-ttu-id="2dc5c-250">Diese Reihe von Lernprogrammen wurde durch viele nützliche Bearbeiter überprüft.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-250">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="2dc5c-251">Lead Prüfer für dieses Lernprogramm wurden Liz Shulok, Dennis Patterson Carlos Santos und Hilton Giesenow.</span><span class="sxs-lookup"><span data-stu-id="2dc5c-251">Lead reviewers for this tutorial were Liz Shulok, Dennis Patterson, Carlos Santos, and Hilton Giesenow.</span></span> <span data-ttu-id="2dc5c-252">Meine bevorstehende MSDN-Artikel Überprüfen von Interesse?</span><span class="sxs-lookup"><span data-stu-id="2dc5c-252">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="2dc5c-253">Wenn dies der Fall ist, löschen Sie mich zeilenweise [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="2dc5c-253">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

>[!div class="step-by-step"]
<span data-ttu-id="2dc5c-254">[Zurück](creating-a-data-access-layer-cs.md)
[Weiter](master-pages-and-site-navigation-cs.md)</span><span class="sxs-lookup"><span data-stu-id="2dc5c-254">[Previous](creating-a-data-access-layer-cs.md)
[Next](master-pages-and-site-navigation-cs.md)</span></span>
