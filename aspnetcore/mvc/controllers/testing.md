---
title: Testen von Controllerlogik in ASP.NET Core
author: ardalis
description: Informationen Sie zum Testen der Controllerlogik in ASP.NET Core mit Moq und xUnit.
keywords: ASP.NET Core, Controller, Test, testen, Komponententests, Komponententests, Integrationstest, Integrationstests, xUnit
ms.author: riande
manager: wpickett
ms.date: 10/14/2016
ms.topic: article
ms.assetid: dd4135ec-2b15-410c-b3fb-3d12eed4a1ac
ms.technology: aspnet
ms.prod: asp.net-core
uid: mvc/controllers/testing
ms.openlocfilehash: b8ba5740c96b116f9be3feb1967b91c2d675a97d
ms.sourcegitcommit: 5ee9b2ab62acaafe78ad06f1dc4ba624811ab630
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 10/02/2017
---
# <a name="testing-controller-logic-in-aspnet-core"></a><span data-ttu-id="62614-104">Testen von Controllerlogik in ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="62614-104">Testing controller logic in ASP.NET Core</span></span>

<span data-ttu-id="62614-105">Durch [Steve Smith](https://ardalis.com/)</span><span class="sxs-lookup"><span data-stu-id="62614-105">By [Steve Smith](https://ardalis.com/)</span></span>

<span data-ttu-id="62614-106">Controller in ASP.NET MVC-apps sollte klein und konzentriert sich auf die Benutzeroberfläche Bedenken.</span><span class="sxs-lookup"><span data-stu-id="62614-106">Controllers in ASP.NET MVC apps should be small and focused on user-interface concerns.</span></span> <span data-ttu-id="62614-107">Große Controller, die mit nicht-UI-Aspekte sind schwieriger zu testen und zu verwalten.</span><span class="sxs-lookup"><span data-stu-id="62614-107">Large controllers that deal with non-UI concerns are more difficult to test and maintain.</span></span>

[<span data-ttu-id="62614-108">Anzeigen oder Herunterladen des Beispiels von GitHub</span><span class="sxs-lookup"><span data-stu-id="62614-108">View or download sample from GitHub</span></span>](https://github.com/aspnet/Docs/tree/master/aspnetcore/mvc/controllers/testing/sample)

## <a name="testing-controllers"></a><span data-ttu-id="62614-109">Testen von Domänencontrollern</span><span class="sxs-lookup"><span data-stu-id="62614-109">Testing controllers</span></span>

<span data-ttu-id="62614-110">Controller sind ein zentraler Bestandteil jeder ASP.NET Core MVC-Anwendung.</span><span class="sxs-lookup"><span data-stu-id="62614-110">Controllers are a central part of any ASP.NET Core MVC application.</span></span> <span data-ttu-id="62614-111">Daher sollten Sie vertrauen verfügen, die sie für die app erwartungsgemäß Verhalten.</span><span class="sxs-lookup"><span data-stu-id="62614-111">As such, you should have confidence they behave as intended for your app.</span></span> <span data-ttu-id="62614-112">Automatisierte Tests vermittelt Ihnen dieses Vertrauen und Fehler können erkannt werden, bevor sie die Produktion erreichen.</span><span class="sxs-lookup"><span data-stu-id="62614-112">Automated tests can provide you with this confidence and can detect errors before they reach production.</span></span> <span data-ttu-id="62614-113">Es ist wichtig, die verhindert, dass unnötige Zuständigkeiten innerhalb Ihrer Controller platziert, und vergewissern Sie sich sich der Fokus Tests nur auf Controller Aufgaben.</span><span class="sxs-lookup"><span data-stu-id="62614-113">It's important to avoid placing unnecessary responsibilities within your controllers and ensure your tests focus only on controller responsibilities.</span></span>

<span data-ttu-id="62614-114">Controllerlogik sollte minimal sein und nicht mit Schwerpunkt auf Business Logic oder Infrastruktur Bedenken (z. B. Data Access).</span><span class="sxs-lookup"><span data-stu-id="62614-114">Controller logic should be minimal and not be focused on business logic or infrastructure concerns (for example, data access).</span></span> <span data-ttu-id="62614-115">Testen Sie Controllerlogik, nicht das Framework.</span><span class="sxs-lookup"><span data-stu-id="62614-115">Test controller logic, not the framework.</span></span> <span data-ttu-id="62614-116">Test wie den Controller *verhält sich* basierend auf gültige bzw. ungültige Eingaben.</span><span class="sxs-lookup"><span data-stu-id="62614-116">Test how the controller *behaves* based on valid or invalid inputs.</span></span> <span data-ttu-id="62614-117">Abhängig vom Ergebnis des Vorgangs Business ausgeführten Domänencontroller-Antworten zu testen.</span><span class="sxs-lookup"><span data-stu-id="62614-117">Test controller responses based on the result of the business operation it performs.</span></span>

<span data-ttu-id="62614-118">Typische Controller Verantwortungsbereiche:</span><span class="sxs-lookup"><span data-stu-id="62614-118">Typical controller responsibilities:</span></span>

* <span data-ttu-id="62614-119">Vergewissern Sie sich `ModelState.IsValid`.</span><span class="sxs-lookup"><span data-stu-id="62614-119">Verify `ModelState.IsValid`.</span></span>
* <span data-ttu-id="62614-120">Eine Fehlerantwort zurück, wenn `ModelState` ist ungültig.</span><span class="sxs-lookup"><span data-stu-id="62614-120">Return an error response if `ModelState` is invalid.</span></span>
* <span data-ttu-id="62614-121">Rufen Sie eine Geschäftseinheit von Persistenz.</span><span class="sxs-lookup"><span data-stu-id="62614-121">Retrieve a business entity from persistence.</span></span>
* <span data-ttu-id="62614-122">Eine Aktion für die Geschäftseinheit auszuführen.</span><span class="sxs-lookup"><span data-stu-id="62614-122">Perform an action on the business entity.</span></span>
* <span data-ttu-id="62614-123">Speichern Sie die Geschäftseinheit Persistenz.</span><span class="sxs-lookup"><span data-stu-id="62614-123">Save the business entity to persistence.</span></span>
* <span data-ttu-id="62614-124">Zurückgeben einer entsprechenden `IActionResult`.</span><span class="sxs-lookup"><span data-stu-id="62614-124">Return an appropriate `IActionResult`.</span></span>

## <a name="unit-testing"></a><span data-ttu-id="62614-125">Unittest</span><span class="sxs-lookup"><span data-stu-id="62614-125">Unit testing</span></span>

<span data-ttu-id="62614-126">[UnitTests](https://docs.microsoft.com/dotnet/articles/core/testing/unit-testing-with-dotnet-test) umfasst eine Bestandteile einer app isoliert von der Infrastruktur und die Abhängigkeiten testen.</span><span class="sxs-lookup"><span data-stu-id="62614-126">[Unit testing](https://docs.microsoft.com/dotnet/articles/core/testing/unit-testing-with-dotnet-test) involves testing a part of an app in isolation from its infrastructure and dependencies.</span></span> <span data-ttu-id="62614-127">Wenn Controllerlogik, nur den Inhalt einer einzelnen Aktion für den Komponententests getestet wird, nicht das Verhalten der zugehörigen Abhängigkeiten oder Framework selbst.</span><span class="sxs-lookup"><span data-stu-id="62614-127">When unit testing controller logic, only the contents of a single action is tested, not the behavior of its dependencies or of the framework itself.</span></span> <span data-ttu-id="62614-128">Testen Sie als Einheit Sie Ihre Controlleraktionen, stellen Sie sicher, dass Sie sich nur auf das Verhalten konzentrieren.</span><span class="sxs-lookup"><span data-stu-id="62614-128">As you unit test your controller actions, make sure you focus only on its behavior.</span></span> <span data-ttu-id="62614-129">Ein Komponententest Controller wird vermieden, z. B. [Filter](filters.md), [routing](../../fundamentals/routing.md), oder [modellbindung](../models/model-binding.md).</span><span class="sxs-lookup"><span data-stu-id="62614-129">A controller unit test avoids things like [filters](filters.md), [routing](../../fundamentals/routing.md), or [model binding](../models/model-binding.md).</span></span> <span data-ttu-id="62614-130">Komponententests sind in der Regel durch die Fokussierung auf nur einem Schritt testen, einfach zu schreiben und schnell ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="62614-130">By focusing on testing just one thing, unit tests are generally simple to write and quick to run.</span></span> <span data-ttu-id="62614-131">Ein gut geschriebener Satz von Komponententests kann ohne Mehraufwand häufig ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="62614-131">A well-written set of unit tests can be run frequently without much overhead.</span></span> <span data-ttu-id="62614-132">Komponententests erkennen jedoch nicht Probleme bei der Interaktion zwischen Komponenten, die der Zweck der ist [Integrationstests](xref:mvc/controllers/testing#integration-testing).</span><span class="sxs-lookup"><span data-stu-id="62614-132">However, unit tests do not detect issues in the interaction between components, which is the purpose of [integration testing](xref:mvc/controllers/testing#integration-testing).</span></span>

<span data-ttu-id="62614-133">Wenn Sie benutzerdefinierte Filter, Routen usw. schreiben, sollten Sie den Komponententest werden, jedoch nicht als Teil Ihrer Tests auf einer bestimmten Controlleraktion.</span><span class="sxs-lookup"><span data-stu-id="62614-133">If you're writing custom filters, routes, etc, you should unit test them, but not as part of your tests on a particular controller action.</span></span> <span data-ttu-id="62614-134">Sie sollten in Isolation getestet werden.</span><span class="sxs-lookup"><span data-stu-id="62614-134">They should be tested in isolation.</span></span>

> [!TIP]
> <span data-ttu-id="62614-135">[Erstellen und Ausführen von Komponententests mit Visual Studio](https://docs.microsoft.com/visualstudio/test/unit-test-your-code).</span><span class="sxs-lookup"><span data-stu-id="62614-135">[Create and run unit tests with Visual Studio](https://docs.microsoft.com/visualstudio/test/unit-test-your-code).</span></span>

<span data-ttu-id="62614-136">Um Komponententests zu demonstrieren, überprüfen Sie die folgenden Controller aus.</span><span class="sxs-lookup"><span data-stu-id="62614-136">To demonstrate unit testing, review the following controller.</span></span> <span data-ttu-id="62614-137">Es zeigt eine Liste von Sitzungen brainstorming an und ermöglicht neue brainstorming Sitzungen, die mit einer POST-Anforderung erstellt werden:</span><span class="sxs-lookup"><span data-stu-id="62614-137">It displays a list of brainstorming sessions and allows new brainstorming sessions to be created with a POST:</span></span>

[!code-csharp[Main](testing/sample/TestingControllersSample/src/TestingControllersSample/Controllers/HomeController.cs?highlight=12,16,21,42,43)]

<span data-ttu-id="62614-138">Liegt im Anschluss an des Controllers der [expliziten Abhängigkeiten Prinzip](http://deviq.com/explicit-dependencies-principle/), erwartet Abhängigkeitsinjektion diesen angeben, mit einer Instanz von `IBrainstormSessionRepository`.</span><span class="sxs-lookup"><span data-stu-id="62614-138">The controller is following the [explicit dependencies principle](http://deviq.com/explicit-dependencies-principle/), expecting dependency injection to provide it with an instance of `IBrainstormSessionRepository`.</span></span> <span data-ttu-id="62614-139">Dies erleichtert es relativ zum Testen mithilfe eines simulierten-Objekt, z. B. [Moq](https://www.nuget.org/packages/Moq/).</span><span class="sxs-lookup"><span data-stu-id="62614-139">This makes it fairly easy to test using a mock object framework, like [Moq](https://www.nuget.org/packages/Moq/).</span></span> <span data-ttu-id="62614-140">Die `HTTP GET Index` Methode verfügt über keine Schleife "oder" Verzweigung "und" nur, eine Aufrufe-Methode.</span><span class="sxs-lookup"><span data-stu-id="62614-140">The `HTTP GET Index` method has no looping or branching and only calls one method.</span></span> <span data-ttu-id="62614-141">Zum Testen `Index` -Methode, müssen wir überprüfen, ob eine `ViewResult` zurückgegeben wird, mit einem `ViewModel` aus des Repositorys `List` Methode.</span><span class="sxs-lookup"><span data-stu-id="62614-141">To test this `Index` method, we need to verify that a `ViewResult` is returned, with a `ViewModel` from the repository's `List` method.</span></span>

[!code-csharp[Main](testing/sample/TestingControllersSample/tests/TestingControllersSample.Tests/UnitTests/HomeControllerTests.cs?highlight=17-18&range=1-33,76-95)]

<span data-ttu-id="62614-142">Die `HomeController` `HTTP POST Index` (siehe oben) Methode überprüfen sollten:</span><span class="sxs-lookup"><span data-stu-id="62614-142">The `HomeController` `HTTP POST Index` method (shown above) should verify:</span></span>

* <span data-ttu-id="62614-143">Die Aktionsmethode gibt eine ungültige Anforderung `ViewResult` mit den entsprechenden Daten beim `ModelState.IsValid` ist`false`</span><span class="sxs-lookup"><span data-stu-id="62614-143">The action method returns a Bad Request `ViewResult` with the appropriate data when `ModelState.IsValid` is `false`</span></span>

* <span data-ttu-id="62614-144">Die `Add` im Repository wird aufgerufen, und ein `RedirectToActionResult` wird zurückgegeben, mit die richtigen Argumente beim `ModelState.IsValid` ist "true".</span><span class="sxs-lookup"><span data-stu-id="62614-144">The `Add` method on the repository is called and a `RedirectToActionResult` is returned with the correct arguments when `ModelState.IsValid` is true.</span></span>

<span data-ttu-id="62614-145">Ungültige Modellstatus getestet werden kann, durch Hinzufügen von Fehlern mit `AddModelError` wie im ersten Test unten gezeigt.</span><span class="sxs-lookup"><span data-stu-id="62614-145">Invalid model state can be tested by adding errors using `AddModelError` as shown in the first test below.</span></span>

[!code-csharp[Main](testing/sample/TestingControllersSample/tests/TestingControllersSample.Tests/UnitTests/HomeControllerTests.cs?highlight=8,15-16,37-39&range=35-75)]

<span data-ttu-id="62614-146">Der erste Test bestätigt, wenn `ModelState` ist ungültig, die gleiche `ViewResult` wird zurückgegeben, als für eine `GET` Anforderung.</span><span class="sxs-lookup"><span data-stu-id="62614-146">The first test confirms when `ModelState` is not valid, the same `ViewResult` is returned as for a `GET` request.</span></span> <span data-ttu-id="62614-147">Beachten Sie, dass der Test nicht versucht, ein ungültiges Modell übergeben.</span><span class="sxs-lookup"><span data-stu-id="62614-147">Note that the test doesn't attempt to pass in an invalid model.</span></span> <span data-ttu-id="62614-148">Das wäre nicht trotzdem funktioniert, da wurden die modellbindung ausgeführt wird (obwohl eine [Integrationstest](xref:mvc/controllers/testing#integration-testing) Übung wurden die modellbindung verwenden).</span><span class="sxs-lookup"><span data-stu-id="62614-148">That wouldn't work anyway since model binding isn't running (though an [integration test](xref:mvc/controllers/testing#integration-testing) would use exercise model binding).</span></span> <span data-ttu-id="62614-149">In diesem Fall wird die modellbindung nicht getestet wird.</span><span class="sxs-lookup"><span data-stu-id="62614-149">In this case, model binding is not being tested.</span></span> <span data-ttu-id="62614-150">Diese Komponententests werden nur durch Testen der Code in der Aktionsmethode.</span><span class="sxs-lookup"><span data-stu-id="62614-150">These unit tests are only testing what the code in the action method does.</span></span>

<span data-ttu-id="62614-151">Im zweite Test wird überprüft, ob bei `ModelState` gültig ist, ein neues `BrainstormSession` (über das Repository) hinzugefügt wird und die Methode gibt ein `RedirectToActionResult` mit den erwarteten Eigenschaften.</span><span class="sxs-lookup"><span data-stu-id="62614-151">The second test verifies that when `ModelState` is valid, a new `BrainstormSession` is added (via the repository), and the method returns a `RedirectToActionResult` with the expected properties.</span></span> <span data-ttu-id="62614-152">Mocks erstellt-Aufrufe, die aufgerufen werden, sind normalerweise ignoriert, aber das aufrufende `Verifiable` Aufruf am Ende des Setups können sie im Test überprüft werden.</span><span class="sxs-lookup"><span data-stu-id="62614-152">Mocked calls that aren't called are normally ignored, but calling `Verifiable` at the end of the setup call allows it to be verified in the test.</span></span> <span data-ttu-id="62614-153">Dies erfolgt mit dem Aufruf von `mockRepo.Verify`, dem schlägt des Tests auf, wenn die erwartete Methode nicht aufgerufen wurde.</span><span class="sxs-lookup"><span data-stu-id="62614-153">This is done with the call to `mockRepo.Verify`, which will fail the test if the expected method was not called.</span></span>

> [!NOTE]
> <span data-ttu-id="62614-154">Die Moq-Bibliothek, die in diesem Beispiel verwendete ganz einfach zum Mischen von überprüfbare oder "strict" Mocks mit nicht überprüfbar Mocks (auch als "locker" Mocks oder Stubs bezeichnet).</span><span class="sxs-lookup"><span data-stu-id="62614-154">The Moq library used in this sample makes it easy to mix verifiable, or "strict", mocks with non-verifiable mocks (also called "loose" mocks or stubs).</span></span> <span data-ttu-id="62614-155">Erfahren Sie mehr über [Anpassen des Verhaltens von Mock mit Moq](https://github.com/Moq/moq4/wiki/Quickstart#customizing-mock-behavior).</span><span class="sxs-lookup"><span data-stu-id="62614-155">Learn more about [customizing Mock behavior with Moq](https://github.com/Moq/moq4/wiki/Quickstart#customizing-mock-behavior).</span></span>

<span data-ttu-id="62614-156">Eine andere Domänencontroller in der app zeigt die Informationen im Zusammenhang mit einer bestimmten Brainstorming-Sitzung an.</span><span class="sxs-lookup"><span data-stu-id="62614-156">Another controller in the app displays information related to a particular brainstorming session.</span></span> <span data-ttu-id="62614-157">Es enthält die Logik für den Umgang mit ungültiger Id-Werte:</span><span class="sxs-lookup"><span data-stu-id="62614-157">It includes some logic to deal with invalid id values:</span></span>

[!code-csharp[Main](./testing/sample/TestingControllersSample/src/TestingControllersSample/Controllers/SessionController.cs?highlight=19,20,21,22,25,26,27,28)]

<span data-ttu-id="62614-158">Controlleraktion verfügt über drei Fälle zu testen, eine für jeden `return` Anweisung:</span><span class="sxs-lookup"><span data-stu-id="62614-158">The controller action has three cases to test, one for each `return` statement:</span></span>

[!code-csharp[Main](testing/sample/TestingControllersSample/tests/TestingControllersSample.Tests/UnitTests/SessionControllerTests.cs?highlight=27,28,29,46,47,64,65,66,67,68)]

<span data-ttu-id="62614-159">Die app macht die Funktionalität wie eine Web-API (eine Liste mit einer Sitzung Brainstorming und eine Methode zum Hinzufügen von neuer Ideen zu einer Sitzung zugeordneten Ideen):</span><span class="sxs-lookup"><span data-stu-id="62614-159">The app exposes functionality as a web API (a list of ideas associated with a brainstorming session and a method for adding new ideas to a session):</span></span>

<a name=ideas-controller></a>

[!code-csharp[Main](testing/sample/TestingControllersSample/src/TestingControllersSample/Api/IdeasController.cs?highlight=21,22,27,30,31,32,33,34,35,36,41,42,46,52,65)]

<span data-ttu-id="62614-160">Die `ForSession` Methode gibt eine Liste von `IdeaDTO` Typen.</span><span class="sxs-lookup"><span data-stu-id="62614-160">The `ForSession` method returns a list of `IdeaDTO` types.</span></span> <span data-ttu-id="62614-161">Vermeiden Sie Ihre Domäne Geschäftseinheiten direkt über API-Aufrufe, die seit häufig, die sie enthalten mehr Daten als das Client-API erfordert, und verknüpfen sie unnötig interne Domänenmodell Ihrer app mit der API, die Sie extern verfügbar machen.</span><span class="sxs-lookup"><span data-stu-id="62614-161">Avoid returning your business domain entities directly via API calls, since frequently they include more data than the API client requires, and they unnecessarily couple your app's internal domain model with the API you expose externally.</span></span> <span data-ttu-id="62614-162">Zuordnung zwischen Domänenentitäten und die Typen, die über die Verbindung wird nun wieder kann manuell ausgeführt werden (mit einer LINQ `Select` wie hier gezeigt) oder die Verwendung einer Bibliothek wie [AutoMapper](https://github.com/AutoMapper/AutoMapper)</span><span class="sxs-lookup"><span data-stu-id="62614-162">Mapping between domain entities and the types you will return over the wire can be done manually (using a LINQ `Select` as shown here) or using a library like [AutoMapper](https://github.com/AutoMapper/AutoMapper)</span></span>

<span data-ttu-id="62614-163">Die Komponententests für die `Create` und `ForSession` API-Methoden:</span><span class="sxs-lookup"><span data-stu-id="62614-163">The unit tests for the `Create` and `ForSession` API methods:</span></span>

[!code-csharp[Main](testing/sample/TestingControllersSample/tests/TestingControllersSample.Tests/UnitTests/ApiIdeasControllerTests.cs?highlight=18,23,29,33,38-39,43,50,58-59,68-70,76-78&range=1-83,121-135)]

<span data-ttu-id="62614-164">Wie zuvor erwähnt, so testen Sie das Verhalten der Methode beim `ModelState` ist ungültig, einen Modellfehler mit dem Controller als Teil des Tests hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="62614-164">As stated previously, to test the behavior of the method when `ModelState` is invalid, add a model error to the controller as part of the test.</span></span> <span data-ttu-id="62614-165">Versuchen Sie nicht, Testen von modellbindung Überprüfung oder das Modell in den Komponententests - nur Testen Ihrer Aktionsmethode-Verhalten, wenn mit einem bestimmten konfrontiert `ModelState` Wert.</span><span class="sxs-lookup"><span data-stu-id="62614-165">Don't try to test model validation or model binding in your unit tests - just test your action method's behavior when confronted with a particular `ModelState` value.</span></span>

<span data-ttu-id="62614-166">Im zweite Test hängt das Repository null zurückgeben, damit das pseudorepository konfiguriert ist, um null zurückzugeben.</span><span class="sxs-lookup"><span data-stu-id="62614-166">The second test depends on the repository returning null, so the mock repository is configured to return null.</span></span> <span data-ttu-id="62614-167">Besteht keine Notwendigkeit, eine Testdatenbank erstellen (im Arbeitsspeicher oder auf andere Weise) und erstellen Sie eine Abfrage, die diesem Ergebnis zurückgegeben werden: Es kann in einer einzelnen Anweisung ausgeführt werden, wie gezeigt.</span><span class="sxs-lookup"><span data-stu-id="62614-167">There's no need to create a test database (in memory or otherwise) and construct a query that will return this result - it can be done in a single statement as shown.</span></span>

<span data-ttu-id="62614-168">Die letzte Test überprüft, ob des Repositorys `Update` -Methode aufgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="62614-168">The last test verifies that the repository's `Update` method is called.</span></span> <span data-ttu-id="62614-169">Wie zuvor, heißt das Mock mit `Verifiable` , und klicken Sie dann die mocked des Repositorys `Verify` Methode wird aufgerufen, um zu bestätigen, die überprüfbare Methode ausgeführt wurde.</span><span class="sxs-lookup"><span data-stu-id="62614-169">As we did previously, the mock is called with `Verifiable` and then the mocked repository's `Verify` method is called to confirm the verifiable method was executed.</span></span> <span data-ttu-id="62614-170">Es ist dabei nicht um eine Einheit Test dafür verantwortlich, um sicherzustellen, dass die `Update` Methode gespeichert, die Daten; die mit einen Integrationstest durchgeführt werden können.</span><span class="sxs-lookup"><span data-stu-id="62614-170">It's not a unit test responsibility to ensure that the `Update` method saved the data; that can be done with an integration test.</span></span>

## <a name="integration-testing"></a><span data-ttu-id="62614-171">Integrationstests</span><span class="sxs-lookup"><span data-stu-id="62614-171">Integration testing</span></span>

<span data-ttu-id="62614-172">[Integrationstests](../../testing/integration-testing.md) geschieht, um separate Module innerhalb der app-Arbeit ordnungsgemäß zusammen sicherzustellen.</span><span class="sxs-lookup"><span data-stu-id="62614-172">[Integration testing](../../testing/integration-testing.md) is done to ensure separate modules within your app work correctly together.</span></span> <span data-ttu-id="62614-173">Im Allgemeinen alles, was Sie mit einem Komponententest testen können, Sie können auch mit Testen einen Integrationstest, aber umgekehrt nicht "true".</span><span class="sxs-lookup"><span data-stu-id="62614-173">Generally, anything you can test with a unit test, you can also test with an integration test, but the reverse isn't true.</span></span> <span data-ttu-id="62614-174">Allerdings sind eher Integrationstests sehr viel langsamer als Komponententests.</span><span class="sxs-lookup"><span data-stu-id="62614-174">However, integration tests tend to be much slower than unit tests.</span></span> <span data-ttu-id="62614-175">Daher ist es am besten, testen, was Sie mit Komponententests können und Integrationstests für Szenarien, die mehrere Projektmitarbeiter umfassen.</span><span class="sxs-lookup"><span data-stu-id="62614-175">Thus, it's best to test whatever you can with unit tests, and use integration tests for scenarios that involve multiple collaborators.</span></span>

<span data-ttu-id="62614-176">Obwohl sie immer noch nützlich sein können, werden Pseudoobjekten in Integrationstests selten verwendet.</span><span class="sxs-lookup"><span data-stu-id="62614-176">Although they may still be useful, mock objects are rarely used in integration tests.</span></span> <span data-ttu-id="62614-177">In Komponententests ausgeführt werden sind Pseudoobjekten eine effektive Möglichkeit zur Steuerung, wie Projektmitarbeiter außerhalb der Komponententests im Rahmen des Tests Verhalten soll.</span><span class="sxs-lookup"><span data-stu-id="62614-177">In unit testing, mock objects are an effective way to control how collaborators outside of the unit being tested should behave for the purposes of the test.</span></span> <span data-ttu-id="62614-178">In einen Integrationstest werden echte Projektmitarbeiter verwendet, um zu bestätigen, dass das gesamte Subsystem zusammen ordnungsgemäß funktioniert.</span><span class="sxs-lookup"><span data-stu-id="62614-178">In an integration test, real collaborators are used to confirm the whole subsystem works together correctly.</span></span>

### <a name="application-state"></a><span data-ttu-id="62614-179">Anwendungsstatus</span><span class="sxs-lookup"><span data-stu-id="62614-179">Application state</span></span>

<span data-ttu-id="62614-180">Ein wichtiger Aspekt beim Ausführen von Integrationstests ist wie den Zustand der Anwendung festgelegt.</span><span class="sxs-lookup"><span data-stu-id="62614-180">One important consideration when performing integration testing is how to set your app's state.</span></span> <span data-ttu-id="62614-181">Getestet unabhängig voneinander ausgeführt werden sollen, und daher starten jedes Tests sollten mit der app in einem bekannten Zustand.</span><span class="sxs-lookup"><span data-stu-id="62614-181">Tests need to run independent of one another, and so each test should start with the app in a known state.</span></span> <span data-ttu-id="62614-182">Wenn Ihre app verwenden Sie eine Datenbank oder haben die Persistenz nicht, kann dies ein Problem nicht.</span><span class="sxs-lookup"><span data-stu-id="62614-182">If your app doesn't use a database or have any persistence, this may not be an issue.</span></span> <span data-ttu-id="62614-183">Allerdings beibehalten den meisten realen apps ihren Status an eine Art des Datenspeichers, damit die Änderungen durch ein Test einen anderen Test auswirken können, es sei denn, die Datenspeicher zurückgesetzt wird.</span><span class="sxs-lookup"><span data-stu-id="62614-183">However, most real-world apps persist their state to some kind of data store, so any modifications made by one test could impact another test unless the data store is reset.</span></span> <span data-ttu-id="62614-184">Unter Verwendung der integrierten `TestServer`, es ist sehr einfach zu ASP.NET Core-apps in unserer Integrationstests Host, aber, die nicht unbedingt gewähren Zugriff auf die Daten werden soll.</span><span class="sxs-lookup"><span data-stu-id="62614-184">Using the built-in `TestServer`, it's very straightforward to host ASP.NET Core apps within our integration tests, but that doesn't necessarily grant access to the data it will use.</span></span> <span data-ttu-id="62614-185">Wenn Sie eine tatsächliche Datenbank verwenden, ein Ansatz besteht darin, die app auf eine Testdatenbank hergestellt haben die Tests zugreifen und sicherstellen können, werden in einen bekannten Zustand zurückgesetzt, vor jedem Test ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="62614-185">If you're using an actual database, one approach is to have the app connect to a test database, which your tests can access and ensure is reset to a known state before each test executes.</span></span>

<span data-ttu-id="62614-186">In dieser beispielanwendung verwende ich Entity Framework Core-InMemoryDatabase-Unterstützung, damit ich nur aus meinem Testprojekt hergestellt werden konnte.</span><span class="sxs-lookup"><span data-stu-id="62614-186">In this sample application, I'm using Entity Framework Core's InMemoryDatabase support, so I can't just connect to it from my test project.</span></span> <span data-ttu-id="62614-187">Stattdessen ich verfügbar machen eine `InitializeDatabase` Methode aus der app `Startup` -Klasse, die ich aufgerufen werden, wenn die app gestartet wird, wird jedoch der `Development` Umgebung.</span><span class="sxs-lookup"><span data-stu-id="62614-187">Instead, I expose an `InitializeDatabase` method from the app's `Startup` class, which I call when the app starts up if it's in the `Development` environment.</span></span> <span data-ttu-id="62614-188">Meine Integrationstests automatisch hiervon profitieren, solange sie die Umgebung, um festgelegt `Development`.</span><span class="sxs-lookup"><span data-stu-id="62614-188">My integration tests automatically benefit from this as long as they set the environment to `Development`.</span></span> <span data-ttu-id="62614-189">Muss ich mir keine Gedanken machen, die Datenbank zurückgesetzt, da jedes Mal die InMemoryDatabase zurückgesetzt wird, wenn die app wird neu gestartet.</span><span class="sxs-lookup"><span data-stu-id="62614-189">I don't have to worry about resetting the database, since the InMemoryDatabase is reset each time the app restarts.</span></span>

<span data-ttu-id="62614-190">Die `Startup` Klasse:</span><span class="sxs-lookup"><span data-stu-id="62614-190">The `Startup` class:</span></span>

[!code-csharp[Main](testing/sample/TestingControllersSample/src/TestingControllersSample/Startup.cs?highlight=19,20,34,35,43,52)]

<span data-ttu-id="62614-191">Sehen Sie die `GetTestSession` in der folgenden Integrationstests häufig verwendete Methode.</span><span class="sxs-lookup"><span data-stu-id="62614-191">You'll see the `GetTestSession` method used frequently in the integration tests below.</span></span>

### <a name="accessing-views"></a><span data-ttu-id="62614-192">Zugreifen auf Ansichten</span><span class="sxs-lookup"><span data-stu-id="62614-192">Accessing views</span></span>

<span data-ttu-id="62614-193">Jeder Testklasse Integration konfiguriert die `TestServer` ASP.NET Core-app ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="62614-193">Each integration test class configures the `TestServer` that will run the ASP.NET Core app.</span></span> <span data-ttu-id="62614-194">Standardmäßig `TestServer` hostet die Web-app in den Ordner, in dem er ausgeführt – in diesem Fall die Test-Projektordner wird.</span><span class="sxs-lookup"><span data-stu-id="62614-194">By default, `TestServer` hosts the web app in the folder where it's running - in this case, the test project folder.</span></span> <span data-ttu-id="62614-195">Daher, wenn Sie versuchen, Controlleraktionen zu testen, die zurückgeben `ViewResult`, dieser Fehler vermutlich angezeigt:</span><span class="sxs-lookup"><span data-stu-id="62614-195">Thus, when you attempt to test controller actions that return `ViewResult`, you may see this error:</span></span>

```
The view 'Index' was not found. The following locations were searched:
(list of locations)
```

<span data-ttu-id="62614-196">Um dieses Problem zu beheben, müssen Sie das Stammverzeichnis des Servers Inhalt, zu konfigurieren, damit sie die Ansichten für das getestete Projekt suchen kann.</span><span class="sxs-lookup"><span data-stu-id="62614-196">To correct this issue, you need to configure the server's content root, so it can locate the views for the project being tested.</span></span> <span data-ttu-id="62614-197">Dies erfolgt durch einen Aufruf von `UseContentRoot` in die `TestFixture` Klasse, die im folgenden gezeigt:</span><span class="sxs-lookup"><span data-stu-id="62614-197">This is done by a call to `UseContentRoot` in the `TestFixture` class, shown below:</span></span>

[!code-csharp[Main](testing/sample/TestingControllersSample/tests/TestingControllersSample.Tests/IntegrationTests/TestFixture.cs?highlight=30,33)]

<span data-ttu-id="62614-198">Die `TestFixture` Klasse dient zum Konfigurieren und erstellen die `TestServer`, das Einrichten einer `HttpClient` für die Kommunikation mit der `TestServer`.</span><span class="sxs-lookup"><span data-stu-id="62614-198">The `TestFixture` class is responsible for configuring and creating the `TestServer`, setting up an `HttpClient` to communicate with the `TestServer`.</span></span> <span data-ttu-id="62614-199">Jede der Integration testet verwendet die `Client` Eigenschaft zum Herstellen einer Verbindung mit dem Testserver und führen Sie eine Anforderung.</span><span class="sxs-lookup"><span data-stu-id="62614-199">Each of the integration tests uses the `Client` property to connect to the test server and make a request.</span></span>

[!code-csharp[Main](testing/sample/TestingControllersSample/tests/TestingControllersSample.Tests/IntegrationTests/HomeControllerTests.cs?highlight=20,26,29,30,31,35,38,39,40,41,44,47,48)]

<span data-ttu-id="62614-200">Im ersten Test weiter oben wird die `responseString` enthält die tatsächlichen HTML gerendert, aus der Sicht, die überprüft werden kann, um zu bestätigen sie die erwarteten Ergebnisse enthält.</span><span class="sxs-lookup"><span data-stu-id="62614-200">In the first test above, the `responseString` holds the actual rendered HTML from the View, which can be inspected to confirm it contains expected results.</span></span>

<span data-ttu-id="62614-201">Im zweite Test erstellt einen Formular-POST mit einen eindeutigen Sitzungsnamen an und sendet es an die app, und stellt sicher, dass die erwarteten Umleitung zurückgegeben wird.</span><span class="sxs-lookup"><span data-stu-id="62614-201">The second test constructs a form POST with a unique session name and POSTs it to the app, then verifies that the expected redirect is returned.</span></span>

### <a name="api-methods"></a><span data-ttu-id="62614-202">API-Methoden</span><span class="sxs-lookup"><span data-stu-id="62614-202">API methods</span></span>

<span data-ttu-id="62614-203">Wenn Ihre app verfügbar, Web-APIs, es eine gute Idee macht, automatisierte Tests bestätigen sie erwartungsgemäß ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="62614-203">If your app exposes web APIs, it's a good idea to have automated tests confirm they execute as expected.</span></span> <span data-ttu-id="62614-204">Die integrierte `TestServer` erleichtert das Web-APIs zu testen.</span><span class="sxs-lookup"><span data-stu-id="62614-204">The built-in `TestServer` makes it easy to test web APIs.</span></span> <span data-ttu-id="62614-205">Wenn Ihre API-Methoden wurden die modellbindung verwenden, sollten Sie immer überprüfen `ModelState.IsValid`, und Integrationstests erfolgreich sind, die richtige Stelle, um sicherzustellen, dass die modellvalidierung ordnungsgemäß funktioniert.</span><span class="sxs-lookup"><span data-stu-id="62614-205">If your API methods are using model binding, you should always check `ModelState.IsValid`, and integration tests are the right place to confirm that your model validation is working properly.</span></span>

<span data-ttu-id="62614-206">Die folgende Gruppe von Tests Ziel der `Create` Methode in der [IdeasController](xref:mvc/controllers/testing#ideas-controller) oben gezeigte Klasse:</span><span class="sxs-lookup"><span data-stu-id="62614-206">The following set of tests target the `Create` method in the [IdeasController](xref:mvc/controllers/testing#ideas-controller) class shown above:</span></span>

[!code-csharp[Main](testing/sample/TestingControllersSample/tests/TestingControllersSample.Tests/IntegrationTests/ApiIdeasControllerTests.cs)]

<span data-ttu-id="62614-207">Im Gegensatz zu Integrationstests von Aktionen, die HTML-Ansichten zurückgibt, können Web-API-Methoden, die Ergebnisse in der Regel als stark typisierte Objekte deserialisiert werden, wie in der letzten Test oben gezeigt.</span><span class="sxs-lookup"><span data-stu-id="62614-207">Unlike integration tests of actions that returns HTML views, web API methods that return results can usually be deserialized as strongly typed objects, as the last test above shows.</span></span> <span data-ttu-id="62614-208">In diesem Fall der Test das Ergebnis, das deserialisiert eine `BrainstormSession` -Instanz und bestätigt, dass das Konzept auf die Auflistung von Ideen ordnungsgemäß hinzugefügt wurde.</span><span class="sxs-lookup"><span data-stu-id="62614-208">In this case, the test deserializes the result to a `BrainstormSession` instance, and confirms that the idea was correctly added to its collection of ideas.</span></span>

<span data-ttu-id="62614-209">Weitere Beispiele für Integrationstests finden Sie in diesem Artikel [Beispielprojekt](https://github.com/aspnet/Docs/tree/master/aspnetcore/mvc/controllers/testing/sample).</span><span class="sxs-lookup"><span data-stu-id="62614-209">You'll find additional examples of integration tests in this article's [sample project](https://github.com/aspnet/Docs/tree/master/aspnetcore/mvc/controllers/testing/sample).</span></span>
