---
uid: mvc/overview/older-versions-1/nerddinner/use-ajax-to-implement-mapping-scenarios
title: Verwenden von AJAX zum Zuordnen von Szenarien implementieren | Microsoft Docs
author: microsoft
description: Schritt 11 veranschaulicht das Integrieren von Unterstützung für AJAX-Zuordnung in unserer NerdDinner Anwendung Benutzer erstellen, bearbeiten oder Anzeigen von Abendessen Beiträgen l aktivieren...
ms.author: aspnetcontent
manager: wpickett
ms.date: 07/27/2010
ms.topic: article
ms.assetid: f731990a-0a81-4d62-81df-87d676cdedd6
ms.technology: dotnet-mvc
ms.prod: .net-framework
msc.legacyurl: /mvc/overview/older-versions-1/nerddinner/use-ajax-to-implement-mapping-scenarios
msc.type: authoredcontent
ms.openlocfilehash: 4b3f1e46886c4c1f054e43768b0a44695d71bf09
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 04/06/2018
---
<a name="use-ajax-to-implement-mapping-scenarios"></a><span data-ttu-id="f2a35-103">Verwenden von AJAX implementieren Szenarien zuordnen</span><span class="sxs-lookup"><span data-stu-id="f2a35-103">Use AJAX to Implement Mapping Scenarios</span></span>
====================
<span data-ttu-id="f2a35-104">durch [Microsoft](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="f2a35-104">by [Microsoft](https://github.com/microsoft)</span></span>

[<span data-ttu-id="f2a35-105">PDF herunterladen</span><span class="sxs-lookup"><span data-stu-id="f2a35-105">Download PDF</span></span>](http://aspnetmvcbook.s3.amazonaws.com/aspnetmvc-nerdinner_v1.pdf)

> <span data-ttu-id="f2a35-106">Dies ist Schritt 11 mit einem kostenlosen ["NerdDinner" Anwendung Lernprogramm](introducing-the-nerddinner-tutorial.md) , die Durchläufe-durch die Schritte zum Erstellen einer kleinen, aber abgeschlossen haben, Webanwendung, die mithilfe von ASP.NET MVC-1.</span><span class="sxs-lookup"><span data-stu-id="f2a35-106">This is step 11 of a free ["NerdDinner" application tutorial](introducing-the-nerddinner-tutorial.md) that walks-through how to build a small, but complete, web application using ASP.NET MVC 1.</span></span>
> 
> <span data-ttu-id="f2a35-107">Schritt 11 veranschaulicht, wie Unterstützung für AJAX-Zuordnung in unsere NerdDinner-Anwendung, aktivieren Benutzer erstellen, bearbeiten oder Anzeigen von Abendessen um Diagramme einsehen, die den Speicherort von der Dinner integrieren.</span><span class="sxs-lookup"><span data-stu-id="f2a35-107">Step 11 shows how to integrate AJAX mapping support into our NerdDinner application, enabling users who are creating, editing or viewing dinners to see the location of the dinner graphically.</span></span>
> 
> <span data-ttu-id="f2a35-108">Bei Verwendung von ASP.NET MVC 3 empfehlen wir führen Sie die [erste Schritte mit MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) oder [MVC Music Store](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) Lernprogramme.</span><span class="sxs-lookup"><span data-stu-id="f2a35-108">If you are using ASP.NET MVC 3, we recommend you follow the [Getting Started With MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) or [MVC Music Store](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) tutorials.</span></span>


## <a name="nerddinner-step-11-integrating-an-ajax-map"></a><span data-ttu-id="f2a35-109">NerdDinner Schritt 11: Integrieren einer AJAX-Karte</span><span class="sxs-lookup"><span data-stu-id="f2a35-109">NerdDinner Step 11: Integrating an AJAX Map</span></span>

<span data-ttu-id="f2a35-110">Wir nun treffen unsere Anwendung ein wenig aufregenden visuell durch die Integration von Unterstützung für AJAX-Zuordnung.</span><span class="sxs-lookup"><span data-stu-id="f2a35-110">We'll now make our application a little more visually exciting by integrating AJAX mapping support.</span></span> <span data-ttu-id="f2a35-111">Dadurch können Benutzer, die erstellen, bearbeiten oder Anzeigen von Abendessen, um den Speicherort von der Dinner grafisch finden Sie unter.</span><span class="sxs-lookup"><span data-stu-id="f2a35-111">This will enable users who are creating, editing or viewing dinners to see the location of the dinner graphically.</span></span>

### <a name="creating-a-map-partial-view"></a><span data-ttu-id="f2a35-112">Erstellen eine Zuordnung Teilansicht</span><span class="sxs-lookup"><span data-stu-id="f2a35-112">Creating a Map Partial View</span></span>

<span data-ttu-id="f2a35-113">Kegel zum Zuordnungsvorgang an mehreren Stellen innerhalb der Anwendung zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="f2a35-113">We are going to use mapping functionality in several places within our application.</span></span> <span data-ttu-id="f2a35-114">Zum Beibehalten des getesteten Codes trocken müssen wir die allgemeine Funktionalität der Zuordnung in eine einzelne partielle Vorlage kapseln, die wir über mehrere Controlleraktionen und Sichten erneut verwenden können.</span><span class="sxs-lookup"><span data-stu-id="f2a35-114">To keep our code DRY we'll encapsulate the common map functionality within a single partial template that we can re-use across multiple controller actions and views.</span></span> <span data-ttu-id="f2a35-115">Wir nennen diese partielle Ansicht "map.ascx" und erstellen Sie ihn in das Verzeichnis \Views\Dinners.</span><span class="sxs-lookup"><span data-stu-id="f2a35-115">We'll name this partial view "map.ascx" and create it within the \Views\Dinners directory.</span></span>

<span data-ttu-id="f2a35-116">Wir können die map.ascx partielle erstellen, indem Sie mit der rechten Maustaste auf das Verzeichnis \Views\Dinners und Add -&gt;Menübefehl anzeigen.</span><span class="sxs-lookup"><span data-stu-id="f2a35-116">We can create the map.ascx partial by right-clicking on the \Views\Dinners directory and choosing the Add-&gt;View menu command.</span></span> <span data-ttu-id="f2a35-117">Wir nennen Sie die Ansicht "Map.ascx", checken Sie es als eine Teilansicht und anzugeben, dass wir werden eine Modellklasse stark typisierte "Dinner" übergeben:</span><span class="sxs-lookup"><span data-stu-id="f2a35-117">We'll name the view "Map.ascx", check it as a partial view, and indicate that we are going to pass it a strongly-typed "Dinner" model class:</span></span>

![](use-ajax-to-implement-mapping-scenarios/_static/image1.png)

<span data-ttu-id="f2a35-118">Beim Klicken auf die Schaltfläche "Hinzufügen" wird unsere partielle Vorlage erstellt werden.</span><span class="sxs-lookup"><span data-stu-id="f2a35-118">When we click the "Add" button our partial template will be created.</span></span> <span data-ttu-id="f2a35-119">Wir werden dann die Map.ascx-Datei, um den folgenden Inhalt haben aktualisieren:</span><span class="sxs-lookup"><span data-stu-id="f2a35-119">We'll then update the Map.ascx file to have the following content:</span></span>

[!code-aspx[Main](use-ajax-to-implement-mapping-scenarios/samples/sample1.aspx)]

<span data-ttu-id="f2a35-120">Die erste &lt;Skript&gt; verweist auf die Bibliothek der Microsoft Virtual Earth 6.2 Zuordnung verweisen.</span><span class="sxs-lookup"><span data-stu-id="f2a35-120">The first &lt;script&gt; reference points to the Microsoft Virtual Earth 6.2 mapping library.</span></span> <span data-ttu-id="f2a35-121">Die zweite &lt;Skript&gt; verweisen verweist auf eine map.js-Datei, die wir in Kürze erstellen, die unsere allgemeine Javascript Zuordnungslogik gekapselt wird.</span><span class="sxs-lookup"><span data-stu-id="f2a35-121">The second &lt;script&gt; reference points to a map.js file that we will shortly create which will encapsulate our common Javascript mapping logic.</span></span> <span data-ttu-id="f2a35-122">Die &lt;Div Id = "TheMap"&gt; -Element ist der HTML-Container, die Virtual Earth nutzt, um die Zuordnung zu hosten.</span><span class="sxs-lookup"><span data-stu-id="f2a35-122">The &lt;div id="theMap"&gt; element is the HTML container that Virtual Earth will use to host the map.</span></span>

<span data-ttu-id="f2a35-123">Wir haben dann ein eingebetteter &lt;Skript&gt; Datenblock, der zwei JavaScript-Funktionen, die speziell für diese Sicht enthält.</span><span class="sxs-lookup"><span data-stu-id="f2a35-123">We then have an embedded &lt;script&gt; block that contains two JavaScript functions specific to this view.</span></span> <span data-ttu-id="f2a35-124">Die erste Funktion verwendet jQuery, um über das Netzwerk eine Funktion von Volltextkatalogen, die ausgeführt wird, wenn die Seite für die Ausführung von clientseitigem Skript bereit ist.</span><span class="sxs-lookup"><span data-stu-id="f2a35-124">The first function uses jQuery to wire-up a function that executes when the page is ready to run client-side script.</span></span> <span data-ttu-id="f2a35-125">Er ruft eine LoadMap()-Hilfsfunktion, die wir in unserer Map.js-Skriptdatei, laden Sie das virtual Earth-Kartensteuerelement definieren.</span><span class="sxs-lookup"><span data-stu-id="f2a35-125">It calls a LoadMap() helper function that we'll define within our Map.js script file to load the virtual earth map control.</span></span> <span data-ttu-id="f2a35-126">Die zweite Funktion ist ein Rückruf-Ereignishandler eine Pin zur Zuordnung hinzu, die einen Ort identifiziert.</span><span class="sxs-lookup"><span data-stu-id="f2a35-126">The second function is a callback event handler that adds a pin to the map that identifies a location.</span></span>

<span data-ttu-id="f2a35-127">Beachten Sie, wie ein serverseitiger verwenden &lt;% = %&gt; Block innerhalb des Blocks clientseitigem Skript eingebettet, die Breiten- und Längengrad der Dinner in der JavaScript-Code zugeordnet werden soll.</span><span class="sxs-lookup"><span data-stu-id="f2a35-127">Notice how we are using a server-side &lt;%= %&gt; block within the client-side script block to embed the latitude and longitude of the Dinner we want to map into the JavaScript.</span></span> <span data-ttu-id="f2a35-128">Dies ist ein nützliches Verfahren, um dynamische Werte ausgegeben werden, die von clientseitigem Skript (ohne einen separaten AJAX-Aufruf an den Server zum Abrufen der Werte –, wodurch schneller) verwendet werden kann.</span><span class="sxs-lookup"><span data-stu-id="f2a35-128">This is a useful technique to output dynamic values that can be used by client-side script (without requiring a separate AJAX call back to the server to retrieve the values – which makes it faster).</span></span> <span data-ttu-id="f2a35-129">Die &lt;% = %&gt; Blöcke werden ausgeführt, wenn die Ansicht, auf dem Server gerendert wird – und daher die Ausgabe der HTML-Datei nur enden mit eingebetteten JavaScript-Werte (z. B.: Breitengrad Var = 47.64312;).</span><span class="sxs-lookup"><span data-stu-id="f2a35-129">The &lt;%= %&gt; blocks will execute when the view is rendering on the server – and so the output of the HTML will just end up with embedded JavaScript values (for example: var latitude = 47.64312;).</span></span>

### <a name="creating-a-mapjs-utility-library"></a><span data-ttu-id="f2a35-130">Erstellen einer Bibliothek für Map.js-Hilfsprogramm</span><span class="sxs-lookup"><span data-stu-id="f2a35-130">Creating a Map.js utility library</span></span>

<span data-ttu-id="f2a35-131">Jetzt erstellen wir die Map.js-Datei, die wir zum Kapseln der JavaScript-Funktionen für unsere Map (und implementieren Sie die oben genannten Methoden LoadMap und LoadPin) verwenden können.</span><span class="sxs-lookup"><span data-stu-id="f2a35-131">Let's now create the Map.js file that we can use to encapsulate the JavaScript functionality for our map (and implement the LoadMap and LoadPin methods above).</span></span> <span data-ttu-id="f2a35-132">Sie können zu diesem Zweck mit der rechten Maustaste auf das Verzeichnis \Scripts in unserem Projekt und wählen Sie dann die "Add -&gt;neues Element" Menübefehl, wählen Sie die JScript-Element, und nennen Sie sie "Map.js".</span><span class="sxs-lookup"><span data-stu-id="f2a35-132">We can do this by right-clicking on the \Scripts directory within our project, and then choose the "Add-&gt;New Item" menu command, select the JScript item, and name it "Map.js".</span></span>

<span data-ttu-id="f2a35-133">Im folgenden finden Sie der JavaScript-Code wir fügen der Map.js-Datei, die in Virtual Earth eine Karte anzuzeigen und Speicherorte Pins hinzuzufügen, für unsere Abendessen interagieren:</span><span class="sxs-lookup"><span data-stu-id="f2a35-133">Below is the JavaScript code we'll add to the Map.js file that will interact with Virtual Earth to display our map and add locations pins to it for our dinners:</span></span>

[!code-javascript[Main](use-ajax-to-implement-mapping-scenarios/samples/sample2.js)]

### <a name="integrating-the-map-with-create-and-edit-forms"></a><span data-ttu-id="f2a35-134">Integrieren der Zuordnung erstellen und Bearbeiten von Formularen</span><span class="sxs-lookup"><span data-stu-id="f2a35-134">Integrating the Map with Create and Edit Forms</span></span>

<span data-ttu-id="f2a35-135">Jetzt müssen wir unsere vorhandenen erstellen und Bearbeiten von Szenarien die Unterstützung von Karten integrieren.</span><span class="sxs-lookup"><span data-stu-id="f2a35-135">We'll now integrate the Map support with our existing Create and Edit scenarios.</span></span> <span data-ttu-id="f2a35-136">Die gute Nachricht ist, dass dies sehr einfache Aufgabe ist, und erfordert nicht, wir unsere controllercode nicht ändern.</span><span class="sxs-lookup"><span data-stu-id="f2a35-136">The good news is that this is pretty easy to-do, and doesn't require us to change any of our Controller code.</span></span> <span data-ttu-id="f2a35-137">Da unsere erstellen und Bearbeiten von Ansichten eine allgemeine "DinnerForm" Teilansicht um Dinner-Formular-Benutzeroberfläche implementieren können, kann die Zuordnung an einem Ort hinzufügen und haben beide unsere erstellen und Bearbeiten von Szenarien verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="f2a35-137">Because our Create and Edit views share a common "DinnerForm" partial view to implement the dinner form UI, we can add the map in one place and have both our Create and Edit scenarios use it.</span></span>

<span data-ttu-id="f2a35-138">Müssen wir nur die Aufgabe besteht darin die Teilansicht \Views\Dinners\DinnerForm.ascx öffnen und aktualisieren, um unsere neue Zuordnung, die teilweise enthalten.</span><span class="sxs-lookup"><span data-stu-id="f2a35-138">All we need to-do is to open the \Views\Dinners\DinnerForm.ascx partial view and update it to include our new map partial.</span></span> <span data-ttu-id="f2a35-139">Im folgenden finden Sie die aktualisierte DinnerForm aussehen, nachdem die Zuordnung hinzugefügt wurde (Hinweis: die HTML-Formularelemente werden aus der Codeausschnitt unten aus Gründen der Übersichtlichkeit weggelassen):</span><span class="sxs-lookup"><span data-stu-id="f2a35-139">Below is what the updated DinnerForm will look like once the map is added (note: the HTML form elements are omitted from the code snippet below for brevity):</span></span>

[!code-aspx[Main](use-ajax-to-implement-mapping-scenarios/samples/sample3.aspx)]

<span data-ttu-id="f2a35-140">Die partielle oben DinnerForm akzeptiert ein Objekt vom Typ "DinnerFormViewModel" als seine Modelltyp (da sowohl ein Dinner-Objekt als auch eine SelectList zum Auffüllen der Dropdownlist Länder oder Regionen benötigt).</span><span class="sxs-lookup"><span data-stu-id="f2a35-140">The DinnerForm partial above takes an object of type "DinnerFormViewModel" as its model type (because it needs both a Dinner object, as well as a SelectList to populate the dropdownlist of countries).</span></span> <span data-ttu-id="f2a35-141">Unsere partielle Zuordnung benötigt nur ein Objekt vom Typ "Dinner" als Modelltyp, und daher Wenn wir die Zuordnung teilweise Rendern wir werden nur die untergeordneten Dinner-Eigenschaft, der DinnerFormViewModel an sie übergibt:</span><span class="sxs-lookup"><span data-stu-id="f2a35-141">Our Map partial just needs an object of type "Dinner" as its model type, and so when we render the map partial we are passing just the Dinner sub-property of DinnerFormViewModel to it:</span></span>

[!code-aspx[Main](use-ajax-to-implement-mapping-scenarios/samples/sample4.aspx)]

<span data-ttu-id="f2a35-142">Die JavaScript-Funktion haben wir die partielle verwendet jQuery an ein Ereignis "Blur" auf das Textfeld "Address" HTML hinzugefügt.</span><span class="sxs-lookup"><span data-stu-id="f2a35-142">The JavaScript function we've added to the partial uses jQuery to attach a "blur" event to the "Address" HTML textbox.</span></span> <span data-ttu-id="f2a35-143">Sie haben wahrscheinlich "den"-Fokusereignisse, die ausgelöst werden, wenn ein Benutzer klickt oder Registerkarten gehört, in ein Textfeld.</span><span class="sxs-lookup"><span data-stu-id="f2a35-143">You've probably heard of "focus" events that fire when a user clicks or tabs into a textbox.</span></span> <span data-ttu-id="f2a35-144">Das Gegenteil ist ein "Blur"-Ereignis, das ausgelöst wird, wenn ein Benutzer ein Textfeld beendet wird.</span><span class="sxs-lookup"><span data-stu-id="f2a35-144">The opposite is a "blur" event that fires when a user exits a textbox.</span></span> <span data-ttu-id="f2a35-145">Der oben genannten Ereignishandler löscht die Breiten- und Längengrad Textbox-Werte auf, wenn dies passiert, und klicken Sie dann den neuen Adressspeicherort auf der Karte gezeichnet.</span><span class="sxs-lookup"><span data-stu-id="f2a35-145">The above event handler clears the latitude and longitude textbox values when this happens, and then plots the new address location on our map.</span></span> <span data-ttu-id="f2a35-146">Ein Rückruf-Ereignishandler, den wir in der Datei map.js definiert aktualisieren Sie dann die Längen- und Breitengrad Textfelder ein, in unserem Formular mithilfe der Rückgabewerte von virtual Earth basierend auf der Adresse, die wir es zugewiesen haben.</span><span class="sxs-lookup"><span data-stu-id="f2a35-146">A callback event handler that we defined within the map.js file will then update the longitude and latitude textboxes on our form using values returned by virtual earth based on the address we gave it.</span></span>

<span data-ttu-id="f2a35-147">Und führen Sie nun Wenn wir unsere Anwendung dann erneut aus und klicken Sie auf der Registerkarte "Host Dinner" "" eingehendem einen Standardwert zugeordnet zusammen mit unserer Dinner Formular Standardelemente angezeigt:</span><span class="sxs-lookup"><span data-stu-id="f2a35-147">And now when we run our application again and click the "Host Dinner" tab we'll see a default map displayed along with our standard Dinner form elements:</span></span>

![](use-ajax-to-implement-mapping-scenarios/_static/image2.png)

<span data-ttu-id="f2a35-148">Wenn wir geben Sie eine Adresse, und klicken Sie dann die Registerkarte entfernt, die Zuordnung wird dynamisch aktualisiert, um den Ort anzuzeigen und unsere Ereignishandler füllt die Längen-und Breitengraden Textfelder ein, mit der die Werte:</span><span class="sxs-lookup"><span data-stu-id="f2a35-148">When we type in an address, and then tab away, the map will dynamically update to display the location, and our event handler will populate the latitude/longitude textboxes with the location values:</span></span>

![](use-ajax-to-implement-mapping-scenarios/_static/image3.png)

<span data-ttu-id="f2a35-149">Wenn wir neue Dinner speichern und es dann erneut zur Bearbeitung öffnen, fest wir, dass die Standorte der Karte angezeigt wird, wenn die Seite geladen:</span><span class="sxs-lookup"><span data-stu-id="f2a35-149">If we save the new dinner and then open it again for editing, we'll find that the map location is displayed when the page loads:</span></span>

![](use-ajax-to-implement-mapping-scenarios/_static/image4.png)

<span data-ttu-id="f2a35-150">Jedes Mal, wenn das Adressfeld geändert wird, werden die Karte und die Koordinaten des Längen-und Breitengraden aktualisiert.</span><span class="sxs-lookup"><span data-stu-id="f2a35-150">Every time the address field is changed, the map and the latitude/longitude coordinates will update.</span></span>

<span data-ttu-id="f2a35-151">Nun, dass die Zuordnung den Dinner Speicherort angezeigt wird, können wir auch Formularfelder breiten- und Längengrad ändern, nicht sichtbar Textfelder auf ausgeblendete Elemente empfiehlt sich u. (da die Zuordnung automatisch sie jedes Mal eine Adresse eingegebene aktualisiert wird).</span><span class="sxs-lookup"><span data-stu-id="f2a35-151">Now that the map displays the Dinner location, we can also change the Latitude and Longitude form fields from being visible textboxes to instead be hidden elements (since the map is automatically updating them each time an address is entered).</span></span> <span data-ttu-id="f2a35-152">To-do dies wir wechseln das Html.TextBox() HTML-Hilfsobjekt, verwenden die Hilfsmethode Html.Hidden() verwenden:</span><span class="sxs-lookup"><span data-stu-id="f2a35-152">To-do this we'll switch from using the Html.TextBox() HTML helper to using the Html.Hidden() helper method:</span></span>

[!code-aspx[Main](use-ajax-to-implement-mapping-scenarios/samples/sample5.aspx)]

<span data-ttu-id="f2a35-153">Und jetzt unsere Formulare etwas Benutzerfreundlicher sind, und vermeiden Sie die unformatierten Längen-und Breitengraden (während Sie weiterhin mit jeder Dinner in der Datenbank speichern) anzeigen:</span><span class="sxs-lookup"><span data-stu-id="f2a35-153">And now our forms are a little more user-friendly and avoid displaying the raw latitude/longitude (while still storing them with each Dinner in the database):</span></span>

![](use-ajax-to-implement-mapping-scenarios/_static/image5.png)

### <a name="integrating-the-map-with-the-details-view"></a><span data-ttu-id="f2a35-154">Integration von der Zuordnung in der Detailansicht</span><span class="sxs-lookup"><span data-stu-id="f2a35-154">Integrating the Map with the Details View</span></span>

<span data-ttu-id="f2a35-155">Nun mit dem die Zuordnung wir in unserer Szenarien erstellen und Bearbeiten von integriert, die ihn auch in unserem Szenario Details zu integrieren.</span><span class="sxs-lookup"><span data-stu-id="f2a35-155">Now that we have the map integrated with our Create and Edit scenarios, let's also integrate it with our Details scenario.</span></span> <span data-ttu-id="f2a35-156">Wir benötigen lediglich Aufgabe besteht im Aufrufen &lt;"" Html.RenderPartial("map");&gt; innerhalb der Ansicht.</span><span class="sxs-lookup"><span data-stu-id="f2a35-156">All we need to-do is to call &lt;% Html.RenderPartial("map"); %&gt; within the Details view.</span></span>

<span data-ttu-id="f2a35-157">Im folgenden finden Sie Quellcode und die vollständige Detailansicht (mit Map-Integration) aussieht:</span><span class="sxs-lookup"><span data-stu-id="f2a35-157">Below is what the source code to the complete Details view (with map integration) looks like:</span></span>

[!code-aspx[Main](use-ajax-to-implement-mapping-scenarios/samples/sample6.aspx)]

<span data-ttu-id="f2a35-158">Nun, wenn ein Benutzer zu einer /Dinners/Informationen / [Id] URL navigiert. sie sehen Details zu den Essen, den Speicherort von der Dinner auf der Karte (mit einem Push-Pin abgeschlossen, die bei über bewegt wird zeigt den Titel der Dinner und die Adresse des Zertifikats), und über ein AJAX-Verknüpfung zum Antwort fo R es:</span><span class="sxs-lookup"><span data-stu-id="f2a35-158">And now when a user navigates to a /Dinners/Details/[id] URL they'll see details about the dinner, the location of the dinner on the map (complete with a push-pin that when hovered over displays the title of the dinner and the address of it), and have an AJAX link to RSVP for it:</span></span>

![](use-ajax-to-implement-mapping-scenarios/_static/image6.png)

### <a name="implementing-location-search-in-our-database-and-repository"></a><span data-ttu-id="f2a35-159">Implementieren in unserer Datenbank und des Repositorys Speicherort suchen</span><span class="sxs-lookup"><span data-stu-id="f2a35-159">Implementing Location Search in our Database and Repository</span></span>

<span data-ttu-id="f2a35-160">Um unsere AJAX-Implementierung zu beenden, fügen Sie eine Zuordnung zur Startseite der Anwendung, die Benutzern ermöglicht, die grafisch Abendessen in der Nähe sie suchen.</span><span class="sxs-lookup"><span data-stu-id="f2a35-160">To finish off our AJAX implementation, let's add a Map to the home page of the application that allows users to graphically search for dinners near them.</span></span>

![](use-ajax-to-implement-mapping-scenarios/_static/image7.png)

<span data-ttu-id="f2a35-161">Wir beginnen, indem das Implementieren der Unterstützung unserer Datenbank und die Daten Repository Ebene eine standortbasierte Radius nach Abendessen effizient ausführen.</span><span class="sxs-lookup"><span data-stu-id="f2a35-161">We'll begin by implementing support within our database and data repository layer to efficiently perform a location-based radius search for Dinners.</span></span> <span data-ttu-id="f2a35-162">Wir verwenden die neue [Geospatial-Funktionen von SQL 2008](https://www.microsoft.com/sqlserver/2008/en/us/spatial-data.aspx) implementiert, oder es können auch einen SQL-Funktion-Ansatz, der Gary Dryden im Artikel hier erläutert verwenden: [ http://www.codeproject.com/KB/cs/distancebetweenlocations.aspx ](http://www.codeproject.com/KB/cs/distancebetweenlocations.aspx) und Rob Conery einem Blog beschrieben hat, zur Verwendung mit LINQ to SQL hier: [http://blog.wekeroad.com/2007/08/30/linq-and-geocoding/](http://blog.wekeroad.com/2007/08/30/linq-and-geocoding/)</span><span class="sxs-lookup"><span data-stu-id="f2a35-162">We could use the new [geospatial features of SQL 2008](https://www.microsoft.com/sqlserver/2008/en/us/spatial-data.aspx) to implement this, or alternatively we can use a SQL function approach that Gary Dryden discussed in article here: [http://www.codeproject.com/KB/cs/distancebetweenlocations.aspx](http://www.codeproject.com/KB/cs/distancebetweenlocations.aspx) and Rob Conery blogged about using with LINQ to SQL here: [http://blog.wekeroad.com/2007/08/30/linq-and-geocoding/](http://blog.wekeroad.com/2007/08/30/linq-and-geocoding/)</span></span>

<span data-ttu-id="f2a35-163">Um dieses Verfahren zu implementieren, wir die "Server-Explorer öffnen" in Visual Studio, wählen Sie die Datenbank NerdDinner, und klicken Sie dann mit der rechten Maustaste auf den Funktionsknoten "" untergeordnete, darunter und wählen Sie zum Erstellen einer neuen "skalarwertige Funktion":</span><span class="sxs-lookup"><span data-stu-id="f2a35-163">To implement this technique, we will open the "Server Explorer" within Visual Studio, select the NerdDinner database, and then right-click on the "functions" sub-node under it and choose to create a new "Scalar-valued function":</span></span>

![](use-ajax-to-implement-mapping-scenarios/_static/image8.png)

<span data-ttu-id="f2a35-164">Wir müssen dann in der folgenden DistanceBetween-Funktion einfügen:</span><span class="sxs-lookup"><span data-stu-id="f2a35-164">We'll then paste in the following DistanceBetween function:</span></span>

[!code-sql[Main](use-ajax-to-implement-mapping-scenarios/samples/sample7.sql)]

<span data-ttu-id="f2a35-165">Wir erstellen Sie dann, dass wir "NearestDinners" aufrufen, wird eine neue Funktion mit Tabellenrückgabe in SQL Server:</span><span class="sxs-lookup"><span data-stu-id="f2a35-165">We'll then create a new table-valued function in SQL Server that we'll call "NearestDinners":</span></span>

![](use-ajax-to-implement-mapping-scenarios/_static/image9.png)

<span data-ttu-id="f2a35-166">Diese "NearestDinners" Tabelle-Funktion verwendet die Hilfsfunktion DistanceBetween zurückzugebenden alle Abendessen innerhalb 100 Meilen von der Breitengrad und Längengrad wir angeben:</span><span class="sxs-lookup"><span data-stu-id="f2a35-166">This "NearestDinners" table function uses the DistanceBetween helper function to return all Dinners within 100 miles of the latitude and longitude we supply it:</span></span>

[!code-sql[Main](use-ajax-to-implement-mapping-scenarios/samples/sample8.sql)]

<span data-ttu-id="f2a35-167">Um diese Funktion aufrufen, müssen wir zunächst die LINQ to SQL-Designer Öffnen durch Doppelklicken auf die Datei NerdDinner.dbml in unserem \Models-Verzeichnis:</span><span class="sxs-lookup"><span data-stu-id="f2a35-167">To call this function, we'll first open up the LINQ to SQL designer by double-clicking on the NerdDinner.dbml file within our \Models directory:</span></span>

![](use-ajax-to-implement-mapping-scenarios/_static/image10.png)

<span data-ttu-id="f2a35-168">Wir müssen dann NearestDinners und DistanceBetween-Funktionen in LINQ to SQL-Designer ziehen, werden als Methoden für unsere LINQ zu SQL NerdDinnerDataContext-Klasse hinzugefügt werden dadurch wird:</span><span class="sxs-lookup"><span data-stu-id="f2a35-168">We'll then drag the NearestDinners and DistanceBetween functions onto the LINQ to SQL designer, which will cause them to be added as methods on our LINQ to SQL NerdDinnerDataContext class:</span></span>

![](use-ajax-to-implement-mapping-scenarios/_static/image11.png)

<span data-ttu-id="f2a35-169">Wir können eine Abfragemethode "FindByLocation" Sie verfügbar machen, unsere DinnerRepository-Klasse, die die NearestDinner-Funktion verwendet, um anstehende zurückzugeben Abendessen angezeigt, die innerhalb des angegebenen Speicherorts 100 Meilen sind:</span><span class="sxs-lookup"><span data-stu-id="f2a35-169">We can then expose a "FindByLocation" query method on our DinnerRepository class that uses the NearestDinner function to return upcoming Dinners that are within 100 miles of the specified location:</span></span>

[!code-csharp[Main](use-ajax-to-implement-mapping-scenarios/samples/sample9.cs)]

### <a name="implementing-a-json-based-ajax-search-action-method"></a><span data-ttu-id="f2a35-170">Implementieren eine Aktionsmethode der JSON-basierte AJAX-Suche</span><span class="sxs-lookup"><span data-stu-id="f2a35-170">Implementing a JSON-based AJAX Search Action Method</span></span>

<span data-ttu-id="f2a35-171">Implementieren wir nun eine Controlleraktionsmethode, die nutzt die Vorteile der neuen FindByLocation() Repository Methode, um wieder eine Liste mit Dinner Daten zurückzugeben, die zum Auffüllen einer Zuordnung verwendet werden kann.</span><span class="sxs-lookup"><span data-stu-id="f2a35-171">We'll now implement a controller action method that takes advantage of the new FindByLocation() repository method to return back a list of Dinner data that can be used to populate a map.</span></span> <span data-ttu-id="f2a35-172">Wir müssen diese Aktionsmethode zurück Dinner Rückgabe der Daten in einem Format der JSON (JavaScript Object Notation), damit sie problemlos verarbeitet werden, kann mit JavaScript auf dem Client.</span><span class="sxs-lookup"><span data-stu-id="f2a35-172">We'll have this action method return back the Dinner data in a JSON (JavaScript Object Notation) format so that it can be easily manipulated using JavaScript on the client.</span></span>

<span data-ttu-id="f2a35-173">Um dies zu implementieren, wir erstellen eine neue "SearchController"-Klasse indem Sie mit der rechten Maustaste auf das Verzeichnis \Controllers und Add -&gt;Controller Menübefehl aus.</span><span class="sxs-lookup"><span data-stu-id="f2a35-173">To implement this, we'll create a new "SearchController" class by right-clicking on the \Controllers directory and choosing the Add-&gt;Controller menu command.</span></span> <span data-ttu-id="f2a35-174">Klicken Sie dann implementieren wir eine Aktionsmethode "SearchByLocation" innerhalb der neuen Klasse SearchController wie unten:</span><span class="sxs-lookup"><span data-stu-id="f2a35-174">We'll then implement a "SearchByLocation" action method within the new SearchController class like below:</span></span>

[!code-csharp[Main](use-ajax-to-implement-mapping-scenarios/samples/sample10.cs)]

<span data-ttu-id="f2a35-175">Die SearchController SearchByLocation Aktionsmethode ruft die FindByLocation-Methode intern für DinnerRespository, um eine Liste von benachbarten Abendessen abzurufen.</span><span class="sxs-lookup"><span data-stu-id="f2a35-175">The SearchController's SearchByLocation action method internally calls the FindByLocation method on DinnerRespository to get a list of nearby dinners.</span></span> <span data-ttu-id="f2a35-176">Anstatt die Dinner Objekte direkt an den Client zurückgegeben, aber es stattdessen JsonDinner gibt Objekte zurück.</span><span class="sxs-lookup"><span data-stu-id="f2a35-176">Rather than return the Dinner objects directly to the client, though, it instead returns JsonDinner objects.</span></span> <span data-ttu-id="f2a35-177">Die Klasse JsonDinner macht eine Teilmenge der Eigenschaften von Dinner (z. B.: Sicherheitsgründen es nicht verpflichtet, die Namen von Personen, die auf die Antwort für eine Dinner gebeten haben).</span><span class="sxs-lookup"><span data-stu-id="f2a35-177">The JsonDinner class exposes a subset of Dinner properties (for example: for security reasons it doesn't disclose the names of the people who have RSVP'd for a dinner).</span></span> <span data-ttu-id="f2a35-178">Darüber hinaus eine RSVPCount-Eigenschaft, die nicht vorhanden ist, auf der Dinner – und die dynamisch durch zählen der Anzahl der Antwort-Objekte, die einen bestimmten Dinner zugeordnet berechnet wird.</span><span class="sxs-lookup"><span data-stu-id="f2a35-178">It also includes an RSVPCount property that doesn't exist on Dinner– and which is dynamically calculated by counting the number of RSVP objects associated with a particular dinner.</span></span>

<span data-ttu-id="f2a35-179">Klicken Sie dann verwenden die Json()-Hilfsmethode für die Basisklasse für Controller wir die Abfolge der Abendessen mit einem JSON-basierte Wireformat zurückgegeben.</span><span class="sxs-lookup"><span data-stu-id="f2a35-179">We are then using the Json() helper method on the Controller base class to return the sequence of dinners using a JSON-based wire format.</span></span> <span data-ttu-id="f2a35-180">JSON ist ein standard-Text-Format für die Darstellung von einfachen Datenstrukturen.</span><span class="sxs-lookup"><span data-stu-id="f2a35-180">JSON is a standard text format for representing simple data-structures.</span></span> <span data-ttu-id="f2a35-181">Es folgt ein Beispiel, wie eine JSON-formatierte Liste zwei JsonDinner Objekte aussieht, wie wenn aus unserem Aktionsmethode zurückgegeben:</span><span class="sxs-lookup"><span data-stu-id="f2a35-181">Below is an example of what a JSON-formatted list of two JsonDinner objects looks like when returned from our action method:</span></span>

[!code-json[Main](use-ajax-to-implement-mapping-scenarios/samples/sample11.json)]

### <a name="calling-the-json-based-ajax-method-using-jquery"></a><span data-ttu-id="f2a35-182">Aufrufen der unter Verwendung von jQuery AJAX-basierten JSON-Methode</span><span class="sxs-lookup"><span data-stu-id="f2a35-182">Calling the JSON-based AJAX method using jQuery</span></span>

<span data-ttu-id="f2a35-183">Wir können nun auf der Startseite der Anwendung NerdDinner, verwenden Sie die SearchController SearchByLocation Aktionsmethode zu aktualisieren.</span><span class="sxs-lookup"><span data-stu-id="f2a35-183">We are now ready to update the home page of the NerdDinner application to use the SearchController's SearchByLocation action method.</span></span> <span data-ttu-id="f2a35-184">To-do, wir öffnen Sie die Vorlage der /Views/Home/Index.aspx anzeigen und aktualisieren, um ein Textfeld, Schaltfläche "Suchen", unsere Map haben und ein &lt;Div&gt; Element mit dem Namen DinnerList:</span><span class="sxs-lookup"><span data-stu-id="f2a35-184">To-do this, we'll open the /Views/Home/Index.aspx view template and update it to have a textbox, search button, our map, and a &lt;div&gt; element named dinnerList:</span></span>

[!code-aspx[Main](use-ajax-to-implement-mapping-scenarios/samples/sample12.aspx)]

<span data-ttu-id="f2a35-185">Wir können die Seite zwei JavaScript-Funktionen hinzugefügt werden:</span><span class="sxs-lookup"><span data-stu-id="f2a35-185">We can then add two JavaScript functions to the page:</span></span>

[!code-html[Main](use-ajax-to-implement-mapping-scenarios/samples/sample13.html)]

<span data-ttu-id="f2a35-186">Die erste JavaScript-Funktion lädt die Zuordnung beim ersten die Seite laden.</span><span class="sxs-lookup"><span data-stu-id="f2a35-186">The first JavaScript function loads the map when the page first loads.</span></span> <span data-ttu-id="f2a35-187">Die zweite JavaScript-Funktion Drähten von einer JavaScript-click-Ereignishandler auf die Schaltfläche "Suchen".</span><span class="sxs-lookup"><span data-stu-id="f2a35-187">The second JavaScript function wires up a JavaScript click event handler on the search button.</span></span> <span data-ttu-id="f2a35-188">Beim Klicken auf die Schaltfläche aufgerufen wird ruft es die FindDinnersGivenLocation()-JavaScript-Funktion, die wir in unserer Map.js-Datei hinzufügen:</span><span class="sxs-lookup"><span data-stu-id="f2a35-188">When the button is pressed it calls the FindDinnersGivenLocation() JavaScript function which we'll add to our Map.js file:</span></span>

[!code-javascript[Main](use-ajax-to-implement-mapping-scenarios/samples/sample14.js)]

<span data-ttu-id="f2a35-189">Diese FindDinnersGivenLocation()-Funktion ruft Zuordnung. Wird auf dem Virtual Earth-Steuerelement um auf den eingegebenen Pfad zu zentrieren.</span><span class="sxs-lookup"><span data-stu-id="f2a35-189">This FindDinnersGivenLocation() function calls map.Find() on the Virtual Earth Control to center it on the entered location.</span></span> <span data-ttu-id="f2a35-190">Wenn die Zuordnung virtual Earth-Dienst, gibt die Karte zurück. Wird-Methode ruft die CallbackUpdateMapDinners-Rückrufmethode, die wir ihn als das letzte Argument übergeben.</span><span class="sxs-lookup"><span data-stu-id="f2a35-190">When the virtual earth map service returns, the map.Find() method invokes the callbackUpdateMapDinners callback method we passed it as the final argument.</span></span>

<span data-ttu-id="f2a35-191">Die callbackUpdateMapDinners()-Methode ist, in denen die eigentliche Arbeit ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="f2a35-191">The callbackUpdateMapDinners() method is where the real work is done.</span></span> <span data-ttu-id="f2a35-192">Es führt mithilfe des jQuery $.post() Hilfsmethode ein AJAX-Aufruf an unsere SearchController SearchByLocation() Aktionsmethode – und übergeben sie den Breiten- und Längengrad der Zuordnung neu zentriert aus.</span><span class="sxs-lookup"><span data-stu-id="f2a35-192">It uses jQuery's $.post() helper method to perform an AJAX call to our SearchController's SearchByLocation() action method – passing it the latitude and longitude of the newly centered map.</span></span> <span data-ttu-id="f2a35-193">Definiert eine Inlinefunktion, die aufgerufen wird, wenn die Hilfsmethode $.post() abgeschlossen ist, und die JSON-formatierte Dinner Ergebnisse zurückgegeben, aus der SearchByLocation() Aktionsmethode mit einer Variablen namens "Abendessen" übergeben wird.</span><span class="sxs-lookup"><span data-stu-id="f2a35-193">It defines an inline function that will be called when the $.post() helper method completes, and the JSON-formatted dinner results returned from the SearchByLocation() action method will be passed it using a variable called "dinners".</span></span> <span data-ttu-id="f2a35-194">Klicken Sie dann Foreach über jedes zurückgegebene Dinner verfügt, und der Dinner Breiten- und Längengrad und andere Eigenschaften verwendet, um eine neue Pin auf der Karte hinzuzufügen.</span><span class="sxs-lookup"><span data-stu-id="f2a35-194">It then does a foreach over each returned dinner, and uses the dinner's latitude and longitude and other properties to add a new pin on the map.</span></span> <span data-ttu-id="f2a35-195">Außerdem werden die HTML-Liste von Abendessen rechts neben der Karte einen Eintrag Dinner hinzugefügt.</span><span class="sxs-lookup"><span data-stu-id="f2a35-195">It also adds a dinner entry to the HTML list of dinners to the right of the map.</span></span> <span data-ttu-id="f2a35-196">Es Drähten-nach-oben klicken Sie dann ein Mauszeiger-Bewegungsereignis für Pins und die HTML-Liste, damit Informationen zu den Dinner angezeigt werden, wenn ein Benutzer darauf zeigt:</span><span class="sxs-lookup"><span data-stu-id="f2a35-196">It then wires-up a hover event for both the pushpins and the HTML list so that details about the dinner are displayed when a user hovers over them:</span></span>

[!code-html[Main](use-ajax-to-implement-mapping-scenarios/samples/sample15.html)]

<span data-ttu-id="f2a35-197">Und jetzt Wenn wir die Anwendung auszuführen und finden Sie auf der Startseite, die wir mit einer Karte angezeigt.</span><span class="sxs-lookup"><span data-stu-id="f2a35-197">And now when we run the application and visit the home-page we'll be presented with a map.</span></span> <span data-ttu-id="f2a35-198">Wenn wir den Namen einer Stadt einzugeben wird die Zuordnung in der Nähe der bevorstehenden Abendessen anzuzeigen:</span><span class="sxs-lookup"><span data-stu-id="f2a35-198">When we enter the name of a city the map will display the upcoming dinners near it:</span></span>

![](use-ajax-to-implement-mapping-scenarios/_static/image12.png)

<span data-ttu-id="f2a35-199">Mit dem Mauszeiger auf eine Dinner werden Details angezeigt.</span><span class="sxs-lookup"><span data-stu-id="f2a35-199">Hovering over a dinner will display details about it.</span></span>

<span data-ttu-id="f2a35-200">Klicken auf den Titel Dinner wird entweder im Blasendiagramm oder auf der rechten Seite in der HTML-Liste uns auf der Dinner – navigieren, das wir dann optional für RSVP können:</span><span class="sxs-lookup"><span data-stu-id="f2a35-200">Clicking the Dinner title either in the bubble or on the right-hand side in the HTML list will navigate us to the dinner – which we can then optionally RSVP for:</span></span>

![](use-ajax-to-implement-mapping-scenarios/_static/image13.png)

### <a name="next-step"></a><span data-ttu-id="f2a35-201">Nächster Schritt</span><span class="sxs-lookup"><span data-stu-id="f2a35-201">Next Step</span></span>

<span data-ttu-id="f2a35-202">Wir haben jetzt die Anwendungsfunktionalität unsere NerdDinner-Anwendung implementiert.</span><span class="sxs-lookup"><span data-stu-id="f2a35-202">We've now implemented all the application functionality of our NerdDinner application.</span></span> <span data-ttu-id="f2a35-203">Lassen Sie uns nun ansehen, wie wir aktivieren können automatisiert Einheit davon testen.</span><span class="sxs-lookup"><span data-stu-id="f2a35-203">Let's now look at how we can enable automated unit testing of it.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="f2a35-204">[Zurück](use-ajax-to-deliver-dynamic-updates.md)
> [Weiter](enable-automated-unit-testing.md)</span><span class="sxs-lookup"><span data-stu-id="f2a35-204">[Previous](use-ajax-to-deliver-dynamic-updates.md)
[Next](enable-automated-unit-testing.md)</span></span>
