---
uid: web-forms/overview/data-access/editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb
title: Behandeln von Ausnahmen BLL und DAL-Ebene, auf einer ASP.NET-Seite (VB) | Microsoft Docs
author: rick-anderson
description: "In diesem Lernprogramm wird gezeigt, wie mit eine benutzerfreundlichen, informative Fehlermeldung anzuzeigen, eine Ausnahme während einer INSERT-, Update- oder Delete-Vorgang der erfolgen soll..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 07/17/2006
ms.topic: article
ms.assetid: 129d4338-1315-4f40-89b5-2b84b807707d
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/data-access/editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb
msc.type: authoredcontent
ms.openlocfilehash: 2269458cbc41fd3a483aaade0f07288ee805bdd1
ms.sourcegitcommit: 060879fcf3f73d2366b5c811986f8695fff65db8
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/24/2018
---
<a name="handling-bll--and-dal-level-exceptions-in-an-aspnet-page-vb"></a><span data-ttu-id="44f33-103">Behandeln von Ausnahmen BLL und DAL-Ebene, auf einer ASP.NET-Seite (VB)</span><span class="sxs-lookup"><span data-stu-id="44f33-103">Handling BLL- and DAL-Level Exceptions in an ASP.NET Page (VB)</span></span>
====================
<span data-ttu-id="44f33-104">durch [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="44f33-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="44f33-105">[Beispiel-App herunterladen](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_18_VB.exe) oder [PDF herunterladen](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/datatutorial18vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="44f33-105">[Download Sample App](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_18_VB.exe) or [Download PDF](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/datatutorial18vb1.pdf)</span></span>

> <span data-ttu-id="44f33-106">In diesem Lernprogramm wird gezeigt, wie mit eine benutzerfreundlichen, informative Fehlermeldung angezeigt, eine Ausnahme während einer INSERT-, Update- oder Löschvorgang eines ASP.NET Daten Websteuerelement erfolgen soll.</span><span class="sxs-lookup"><span data-stu-id="44f33-106">In this tutorial we will see how to display a friendly, informative error message should an exception occur during an insert, update, or delete operation of an ASP.NET data Web control.</span></span>


## <a name="introduction"></a><span data-ttu-id="44f33-107">Einführung</span><span class="sxs-lookup"><span data-stu-id="44f33-107">Introduction</span></span>

<span data-ttu-id="44f33-108">Arbeiten mit Daten aus einer ASP.NET Web-Anwendung mithilfe einer Anwendung mit mehreren Ebenen-Architektur umfasst die folgenden drei allgemeine Schritte aus:</span><span class="sxs-lookup"><span data-stu-id="44f33-108">Working with data from an ASP.NET web application using a tiered application architecture involves the following three general steps:</span></span>

1. <span data-ttu-id="44f33-109">Bestimmen Sie, welche Methode für die Business Logic Layer muss aufgerufen werden und welche Parameterwerte, um es zu übergeben.</span><span class="sxs-lookup"><span data-stu-id="44f33-109">Determine what method of the Business Logic Layer needs to be invoked and what parameter values to pass it.</span></span> <span data-ttu-id="44f33-110">Parameterwerte können hartcodierten, programmgesteuert zugewiesen sein oder Eingaben vom Benutzer eingegeben werden.</span><span class="sxs-lookup"><span data-stu-id="44f33-110">The parameter values can be hard coded, programmatically-assigned, or inputs entered by the user.</span></span>
2. <span data-ttu-id="44f33-111">Rufen Sie die Methode auf.</span><span class="sxs-lookup"><span data-stu-id="44f33-111">Invoke the method.</span></span>
3. <span data-ttu-id="44f33-112">Die Ergebnisse zu verarbeiten.</span><span class="sxs-lookup"><span data-stu-id="44f33-112">Process the results.</span></span> <span data-ttu-id="44f33-113">Beim Aufrufen einer BLL-Methode, die Daten zurückgibt, kann dies die Binden der Daten in eine Datendatei Websteuerelement umfassen.</span><span class="sxs-lookup"><span data-stu-id="44f33-113">When calling a BLL method that returns data, this may involve binding the data to a data Web control.</span></span> <span data-ttu-id="44f33-114">Für BLL-Methoden, die Daten ändern, kann dies enthalten einige Aktion basierend auf einen Rückgabewert oder ordnungsgemäß Behandeln von Ausnahmen, die in Schritt2 entstanden ist.</span><span class="sxs-lookup"><span data-stu-id="44f33-114">For BLL methods that modify data, this may include performing some action based on a return value or gracefully handling any exception that arose in Step 2.</span></span>

<span data-ttu-id="44f33-115">Wie wir gesehen, in haben der [vorherigen Lernprogramm](examining-the-events-associated-with-inserting-updating-and-deleting-vb.md), das ObjectDataSource und die Daten Websteuerelemente bieten Erweiterungspunkte für die Schritte 1 und 3.</span><span class="sxs-lookup"><span data-stu-id="44f33-115">As we saw in the [previous tutorial](examining-the-events-associated-with-inserting-updating-and-deleting-vb.md), both the ObjectDataSource and the data Web controls provide extensibility points for Steps 1 and 3.</span></span> <span data-ttu-id="44f33-116">Beispielsweise löst die GridView seine `RowUpdating` Ereignis vor dessen Feldwerte zuweisen, dessen ObjectDataSource `UpdateParameters` Auflistung; die `RowUpdated` Ereignis wird ausgelöst, nachdem das ObjectDataSource der Vorgang abgeschlossen wurde.</span><span class="sxs-lookup"><span data-stu-id="44f33-116">The GridView, for example, fires its `RowUpdating` event prior to assigning its field values to its ObjectDataSource's `UpdateParameters` collection; its `RowUpdated` event is raised after the ObjectDataSource has completed the operation.</span></span>

<span data-ttu-id="44f33-117">Wir haben bereits die Ereignisse überprüft werden, die ausgelöst werden, während Schritt 1 und haben gesehen, wie sie verwendet werden können, um die Eingabeparameter anpassen, oder brechen Sie den Vorgang.</span><span class="sxs-lookup"><span data-stu-id="44f33-117">We've already examined the events that fire during Step 1 and have seen how they can be used to customize the input parameters or cancel the operation.</span></span> <span data-ttu-id="44f33-118">In diesem Lernprogramm aktivieren wir unsere Aufmerksamkeit auf die Ereignisse, die ausgelöst werden, nachdem der Vorgang abgeschlossen wurde.</span><span class="sxs-lookup"><span data-stu-id="44f33-118">In this tutorial we'll turn our attention to the events that fire after the operation has completed.</span></span> <span data-ttu-id="44f33-119">Mit dieser nach der Ebene, die wir unter anderem können, Ereignishandler zu bestimmen Sie, ob eine Ausnahme während des Vorgangs aufgetreten ist und handhaben Sie kann es, eine benutzerfreundlichen, informative Fehlermeldung auf dem Bildschirm anzeigen, statt der standardmäßigen ASP.NET direktionales Seite "Ausnahme.</span><span class="sxs-lookup"><span data-stu-id="44f33-119">With these post-level event handlers we can, among other things, determine if an exception occurred during the operation and handle it gracefully, displaying a friendly, informative error message on the screen rather than defaulting to the standard ASP.NET exception page.</span></span>

<span data-ttu-id="44f33-120">Zum Arbeiten mit diese Ereignisse nach der Ebene zu veranschaulichen, erstellen Sie eine Seite, die der Produkte in einem bearbeitbaren GridView aufgeführt sind.</span><span class="sxs-lookup"><span data-stu-id="44f33-120">To illustrate working with these post-level events, let's create a page that lists the products in an editable GridView.</span></span> <span data-ttu-id="44f33-121">Wenn ein Produkt aktualisiert werden, wenn eine Ausnahme ist unsere ASP.NET ausgelöst Seite zeigt eine kurze Nachricht über die GridView erläutert wird, dass ein Problem aufgetreten ist.</span><span class="sxs-lookup"><span data-stu-id="44f33-121">When updating a product, if an exception is raised our ASP.NET page will display a short message above the GridView explaining that a problem has occurred.</span></span> <span data-ttu-id="44f33-122">Fangen wir an!</span><span class="sxs-lookup"><span data-stu-id="44f33-122">Let's get started!</span></span>

## <a name="step-1-creating-an-editable-gridview-of-products"></a><span data-ttu-id="44f33-123">Schritt 1: Erstellen einer bearbeitbaren GridView von Produkten</span><span class="sxs-lookup"><span data-stu-id="44f33-123">Step 1: Creating an Editable GridView of Products</span></span>

<span data-ttu-id="44f33-124">Im vorherigen Lernprogramm erstellt es einen bearbeitbaren GridView mit nur zwei Felder `ProductName` und `UnitPrice`.</span><span class="sxs-lookup"><span data-stu-id="44f33-124">In the previous tutorial we created an editable GridView with just two fields, `ProductName` and `UnitPrice`.</span></span> <span data-ttu-id="44f33-125">Diese Einstellung ist erforderlich erstellen eine weitere Überladung für die `ProductsBLL` Klasse `UpdateProduct` -Methode, ein, die nur drei Eingabeparameter (der Product Name, Einzelpreis und ID) wie einzurichten einen Parameter für jedes Feld "Product" akzeptiert.</span><span class="sxs-lookup"><span data-stu-id="44f33-125">This required creating an additional overload for the `ProductsBLL` class's `UpdateProduct` method, one that only accepted three input parameters (the product's name, unit price, and ID) as opposed a parameter for each product field.</span></span> <span data-ttu-id="44f33-126">Üben Sie für dieses Lernprogramm nehmen wir diese Technik erneut aus, erstellen eine bearbeitbare GridView, die zeigt den Namen des Produkts, Menge pro Einheit, Einzelpreis und Einheiten im Lager, aber nur der Name, den Einzelpreis und die Einheiten im Lager bearbeitet werden kann.</span><span class="sxs-lookup"><span data-stu-id="44f33-126">For this tutorial, let's practice this technique again, creating an editable GridView that displays the product's name, quantity per unit, unit price, and units in stock, but only allows the name, unit price, and units in stock to be edited.</span></span>

<span data-ttu-id="44f33-127">Für dieses Szenario benötigen wir eine andere Überladung der `UpdateProduct` -Methode, die vier Parameter akzeptiert: den Namen des Produkts, Preis pro Einheit, Einheiten im Bestand und -ID.</span><span class="sxs-lookup"><span data-stu-id="44f33-127">To accommodate this scenario we'll need another overload of the `UpdateProduct` method, one that accepts four parameters: the product's name, unit price, units in stock, and ID.</span></span> <span data-ttu-id="44f33-128">Fügen Sie die folgende Methode, die `ProductsBLL` Klasse:</span><span class="sxs-lookup"><span data-stu-id="44f33-128">Add the following method to the `ProductsBLL` class:</span></span>


[!code-vb[Main](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/samples/sample1.vb)]

<span data-ttu-id="44f33-129">Mit dieser Methode abgeschlossen ist können wir die ASP.NET-Seite zu erstellen, die es ermöglicht die Bearbeitung dieser vier bestimmtes Produkt Felder.</span><span class="sxs-lookup"><span data-stu-id="44f33-129">With this method complete, we're ready to create the ASP.NET page that allows for editing these four particular product fields.</span></span> <span data-ttu-id="44f33-130">Öffnen der `ErrorHandling.aspx` auf der Seite der `EditInsertDelete` Ordner und die Seite mithilfe des Designers eine GridView hinzuzufügen.</span><span class="sxs-lookup"><span data-stu-id="44f33-130">Open the `ErrorHandling.aspx` page in the `EditInsertDelete` folder and add a GridView to the page through the Designer.</span></span> <span data-ttu-id="44f33-131">GridView zu binden, um eine neue ObjectDataSource Zuordnung der `Select()` Methode, um die `ProductsBLL` Klasse `GetProducts()` Methode und die `Update()` Methode, um die `UpdateProduct` Überladung, die gerade erstellt haben.</span><span class="sxs-lookup"><span data-stu-id="44f33-131">Bind the GridView to a new ObjectDataSource, mapping the `Select()` method to the `ProductsBLL` class's `GetProducts()` method and the `Update()` method to the `UpdateProduct` overload just created.</span></span>


<span data-ttu-id="44f33-132">[![Verwenden Sie die UpdateProduct Methodenüberladung, die vier Eingabeparameter akzeptiert.](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image2.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="44f33-132">[![Use the UpdateProduct Method Overload That Accepts Four Input Parameters](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image2.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image1.png)</span></span>

<span data-ttu-id="44f33-133">**Abbildung 1**: Verwenden der `UpdateProduct` -Methode zu überladen, akzeptiert vier Eingabeparameter ([klicken Sie hier, um das Bild in voller Größe angezeigt](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="44f33-133">**Figure 1**: Use the `UpdateProduct` Method Overload That Accepts Four Input Parameters ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image3.png))</span></span>


<span data-ttu-id="44f33-134">Dadurch wird ein ObjectDataSource mit erstellt eine `UpdateParameters` Auflistung mit vier Parametern und einer GridView mit einem Feld für jedes der Felder Product.</span><span class="sxs-lookup"><span data-stu-id="44f33-134">This will create an ObjectDataSource with an `UpdateParameters` collection with four parameters and a GridView with a field for each of the product fields.</span></span> <span data-ttu-id="44f33-135">Das ObjectDataSource deklarative Markup weist die `OldValuesParameterFormatString` Eigenschaft den Wert `original_{0}`, dem wird eine Ausnahme ausgelöst, da unsere BLL Klasse einen Eingabeparameter mit dem Namen unerwarteterweise `original_productID` übergeben werden muss.</span><span class="sxs-lookup"><span data-stu-id="44f33-135">The ObjectDataSource's declarative markup assigns the `OldValuesParameterFormatString` property the value `original_{0}`, which will cause an exception since our BLL class's don't expect an input parameter named `original_productID` to be passed in.</span></span> <span data-ttu-id="44f33-136">Vergessen Sie nicht, entfernen Sie diese Einstellung vollständig vom deklarative Syntax (oder legen Sie sie auf den Standardwert `{0}`).</span><span class="sxs-lookup"><span data-stu-id="44f33-136">Don't forget to remove this setting altogether from the declarative syntax (or set it to the default value, `{0}`).</span></span>

<span data-ttu-id="44f33-137">Als Nächstes die GridView nur einschließen Kürzen der `ProductName`, `QuantityPerUnit`, `UnitPrice`, und `UnitsInStock` BoundFields.</span><span class="sxs-lookup"><span data-stu-id="44f33-137">Next, pare down the GridView to include only the `ProductName`, `QuantityPerUnit`, `UnitPrice`, and `UnitsInStock` BoundFields.</span></span> <span data-ttu-id="44f33-138">Darüber hinaus können Sie alle Feldebene Formatierung aus, die Sie für erforderlich halten, anwenden (z. B. das Ändern der `HeaderText` Eigenschaften).</span><span class="sxs-lookup"><span data-stu-id="44f33-138">Also feel free to apply any field-level formatting you deem necessary (such as changing the `HeaderText` properties).</span></span>

<span data-ttu-id="44f33-139">Im vorherigen Lernprogramm erläutert, wie Sie formatieren die `UnitPrice` BoundField als Währung in nur-Lese-Modus und Bearbeitungsmodus.</span><span class="sxs-lookup"><span data-stu-id="44f33-139">In the previous tutorial we looked at how to format the `UnitPrice` BoundField as a currency both in read-only mode and edit mode.</span></span> <span data-ttu-id="44f33-140">Führen wir die gleichen hier ein.</span><span class="sxs-lookup"><span data-stu-id="44f33-140">Let's do the same here.</span></span> <span data-ttu-id="44f33-141">Beachten Sie, dass dies erforderlich Festlegen der BoundField `DataFormatString` Eigenschaft, um `{0:c}`, dessen `HtmlEncode` Eigenschaft, um `false`, und die zugehörige `ApplyFormatInEditMode` auf `true`, wie in Abbildung 2 dargestellt.</span><span class="sxs-lookup"><span data-stu-id="44f33-141">Recall that this required setting the BoundField's `DataFormatString` property to `{0:c}`, its `HtmlEncode` property to `false`, and its `ApplyFormatInEditMode` to `true`, as shown in Figure 2.</span></span>


<span data-ttu-id="44f33-142">[![Konfigurieren Sie die UnitPrice BoundField-anzuzeigende als Währung](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image5.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="44f33-142">[![Configure the UnitPrice BoundField to Display as a Currency](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image5.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image4.png)</span></span>

<span data-ttu-id="44f33-143">**Abbildung 2**: Konfigurieren der `UnitPrice` BoundField anzuzeigende als Währung ([klicken Sie hier, um das Bild in voller Größe angezeigt](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="44f33-143">**Figure 2**: Configure the `UnitPrice` BoundField to Display as a Currency ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image6.png))</span></span>


<span data-ttu-id="44f33-144">Formatieren der `UnitPrice` als Währung in der Bearbeitung Schnittstelle erfordert, erstellen einen Ereignishandler für der GridView `RowUpdating` Ereignis, das analysiert die Currency-formatierte Zeichenfolge in eine `decimal` Wert.</span><span class="sxs-lookup"><span data-stu-id="44f33-144">Formatting the `UnitPrice` as a currency in the editing interface requires creating an event handler for the GridView's `RowUpdating` event that parses the currency-formatted string into a `decimal` value.</span></span> <span data-ttu-id="44f33-145">Bedenken Sie, dass die `RowUpdating` -Ereignishandler aus dem letzten Lernprogramm auch überprüft, um sicherzustellen, dass vom Benutzer angegebenen ein `UnitPrice` Wert.</span><span class="sxs-lookup"><span data-stu-id="44f33-145">Recall that the `RowUpdating` event handler from the last tutorial also checked to ensure that the user provided a `UnitPrice` value.</span></span> <span data-ttu-id="44f33-146">Allerdings für dieses Lernprogramm nehmen wir ermöglicht dem Benutzer, um den Preis zu unterdrücken.</span><span class="sxs-lookup"><span data-stu-id="44f33-146">However, for this tutorial let's allow the user to omit the price.</span></span>


[!code-vb[Main](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/samples/sample2.vb)]

<span data-ttu-id="44f33-147">Unsere GridView umfasst eine `QuantityPerUnit` BoundField-, aber diese BoundField-sollte nur zu Anzeigezwecken sein und sollte nicht vom Benutzer bearbeitet werden.</span><span class="sxs-lookup"><span data-stu-id="44f33-147">Our GridView includes a `QuantityPerUnit` BoundField, but this BoundField should be only for display purposes and should not be editable by the user.</span></span> <span data-ttu-id="44f33-148">Um dies zu sortieren, legen Sie einfach die BoundFields' `ReadOnly` Eigenschaft `true`.</span><span class="sxs-lookup"><span data-stu-id="44f33-148">To arrange this, simply set the BoundFields' `ReadOnly` property to `true`.</span></span>


<span data-ttu-id="44f33-149">[![Aktivieren des Schreibschutzes für die QuantityPerUnit BoundField-](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image8.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="44f33-149">[![Make the QuantityPerUnit BoundField Read-Only](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image8.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image7.png)</span></span>

<span data-ttu-id="44f33-150">**Abbildung 3**: Stellen Sie die `QuantityPerUnit` BoundField schreibgeschützt ([klicken Sie hier, um das Bild in voller Größe angezeigt](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="44f33-150">**Figure 3**: Make the `QuantityPerUnit` BoundField Read-Only ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image9.png))</span></span>


<span data-ttu-id="44f33-151">Zum Schluss das Kontrollkästchen Sie Bearbeiten aktivieren aus der GridView Smarttag.</span><span class="sxs-lookup"><span data-stu-id="44f33-151">Finally, check the Enable Editing checkbox from the GridView's smart tag.</span></span> <span data-ttu-id="44f33-152">Nach Abschluss dieser Schritte der `ErrorHandling.aspx` Seite Designer sollte ähnlich wie in Abbildung 4 aussehen.</span><span class="sxs-lookup"><span data-stu-id="44f33-152">After completing these steps the `ErrorHandling.aspx` page's Designer should look similar to Figure 4.</span></span>


<span data-ttu-id="44f33-153">[![Entfernen Sie alle bis auf die erforderliche BoundFields und Kontrollkästchen bearbeiten das Kontrollkästchen aktivieren](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image11.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="44f33-153">[![Remove All But the Needed BoundFields and Check the Enable Editing Checkbox](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image11.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image10.png)</span></span>

<span data-ttu-id="44f33-154">**Abbildung 4**: Entfernen Sie alle außer der benötigt BoundFields und aktivieren Sie das Kontrollkästchen aktivieren bearbeiten ([klicken Sie hier, um das Bild in voller Größe angezeigt](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="44f33-154">**Figure 4**: Remove All But the Needed BoundFields and Check the Enable Editing Checkbox ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image12.png))</span></span>


<span data-ttu-id="44f33-155">An diesem Punkt haben wir eine Liste aller Produkte `ProductName`, `QuantityPerUnit`, `UnitPrice`, und `UnitsInStock` Felder; allerdings nur die `ProductName`, `UnitPrice`, und `UnitsInStock` Felder können bearbeitet werden.</span><span class="sxs-lookup"><span data-stu-id="44f33-155">At this point we have a list of all of the products' `ProductName`, `QuantityPerUnit`, `UnitPrice`, and `UnitsInStock` fields; however, only the `ProductName`, `UnitPrice`, and `UnitsInStock` fields can be edited.</span></span>


<span data-ttu-id="44f33-156">[![Benutzer können nun problemlos Produkte Namen, Preise und Units In Stock Felder bearbeiten](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image14.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="44f33-156">[![Users Can Now Easily Edit Products' Names, Prices, and Units In Stock Fields](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image14.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image13.png)</span></span>

<span data-ttu-id="44f33-157">**Abbildung 5**: Benutzer können nun problemlos bearbeiten Produkte Namen, Preise und Units In Stock Felder ([klicken Sie hier, um das Bild in voller Größe angezeigt](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="44f33-157">**Figure 5**: Users Can Now Easily Edit Products' Names, Prices, and Units In Stock Fields ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image15.png))</span></span>


## <a name="step-2-gracefully-handling-dal-level-exceptions"></a><span data-ttu-id="44f33-158">Schritt 2: Ordnungsgemäß Ausnahmebehandlung DAL-Ebene</span><span class="sxs-lookup"><span data-stu-id="44f33-158">Step 2: Gracefully Handling DAL-Level Exceptions</span></span>

<span data-ttu-id="44f33-159">Unsere bearbeitbaren GridView wunderbar funktioniert, zwar beim Benutzer zulässigen Werte für die bearbeitete Product Name, Preis und Einheiten im Lager eingeben wird eine Ausnahme ausgelöst ungültige Werte eingeben.</span><span class="sxs-lookup"><span data-stu-id="44f33-159">While our editable GridView works wonderfully when users enter legal values for the edited product's name, price, and units in stock, entering illegal values results in an exception.</span></span> <span data-ttu-id="44f33-160">Z. B. Auslassen der `ProductName` Werts wird eine [NoNullAllowedException](https://msdn.microsoft.com/library/default.asp?url=/library/cpref/html/frlrfsystemdatanonullallowedexceptionclasstopic.asp) ausgelöst wird, seit der `ProductName` Eigenschaft in der `ProdcutsRow` -Klasse verfügt über seine `AllowDBNull` -Eigenschaftensatz auf `false`; Wenn der Datenbank betriebsbereit ist, eine `SqlException` von TableAdapter ausgelöst wird, beim Verbinden mit der Datenbank.</span><span class="sxs-lookup"><span data-stu-id="44f33-160">For example, omitting the `ProductName` value causes a [NoNullAllowedException](https://msdn.microsoft.com/library/default.asp?url=/library/cpref/html/frlrfsystemdatanonullallowedexceptionclasstopic.asp) to be thrown since the `ProductName` property in the `ProdcutsRow` class has its `AllowDBNull` property set to `false`; if the database is down, a `SqlException` will be thrown by the TableAdapter when attempting to connect to the database.</span></span> <span data-ttu-id="44f33-161">Ohne weitere Aktionen durchzuführen, diese Ausnahmen Blase Einrichten von der Datenzugriffsebene, die Geschäftslogikschicht und anschließend auf der ASP.NET-Seite und schließlich auf die ASP.NET-Laufzeit.</span><span class="sxs-lookup"><span data-stu-id="44f33-161">Without taking any action, these exceptions bubble up from the Data Access Layer to the Business Logic Layer, then to the ASP.NET page, and finally to the ASP.NET runtime.</span></span>

<span data-ttu-id="44f33-162">Je nach Konfiguration Ihrer Webanwendung und davon, ob die Anwendung von besuchte `localhost`, eine nicht behandelte Ausnahme kann dazu führen, entweder eine generische Fehlerseite des Servers, einer ausführlichen Fehlerbericht oder eine benutzerfreundliche Webseite.</span><span class="sxs-lookup"><span data-stu-id="44f33-162">Depending on how your web application is configured and whether or not you're visiting the application from `localhost`, an unhandled exception can result in either a generic server-error page, a detailed error report, or a user-friendly web page.</span></span> <span data-ttu-id="44f33-163">Finden Sie unter [Web Application Error Handling in ASP.NET](http://www.15seconds.com/issue/030102.htm) und [CustomErrors Element](https://msdn.microsoft.com/library/h0hfz6fc(VS.80).aspx) detaillierte Informationen wie die ASP.NET-Laufzeit auf eine nicht abgefangene Ausnahme reagiert.</span><span class="sxs-lookup"><span data-stu-id="44f33-163">See [Web Application Error Handling in ASP.NET](http://www.15seconds.com/issue/030102.htm) and the [customErrors Element](https://msdn.microsoft.com/library/h0hfz6fc(VS.80).aspx) for more information on how the ASP.NET runtime responds to an uncaught exception.</span></span>

<span data-ttu-id="44f33-164">Abbildung 6 zeigt den Bildschirm aufgetreten beim Versuch, ein Produkt zu aktualisieren, ohne die `ProductName` Wert.</span><span class="sxs-lookup"><span data-stu-id="44f33-164">Figure 6 shows the screen encountered when attempting to update a product without specifying the `ProductName` value.</span></span> <span data-ttu-id="44f33-165">Dies ist die Standardeinstellung, die ausführliche Fehlermeldung-Bericht angezeigt, wenn kommen `localhost`.</span><span class="sxs-lookup"><span data-stu-id="44f33-165">This is the default detailed error report displayed when coming through `localhost`.</span></span>


<span data-ttu-id="44f33-166">[![Das Weglassen der Product Name wird Anzeige Ausnahmedetails:](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image17.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="44f33-166">[![Omitting the Product's Name Will Display Exception Details](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image17.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image16.png)</span></span>

<span data-ttu-id="44f33-167">**Abbildung 6**: Auslassen der Product Name wird Anzeige Ausnahmedetails ([klicken Sie hier, um das Bild in voller Größe angezeigt](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="44f33-167">**Figure 6**: Omitting the Product's Name Will Display Exception Details ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image18.png))</span></span>


<span data-ttu-id="44f33-168">Während solche Ausnahmedetails hilfreich sind, wenn eine Anwendung zu testen, eignet sich einen Endbenutzer Bildschirm bei einer Ausnahme vorlegen kleiner als.</span><span class="sxs-lookup"><span data-stu-id="44f33-168">While such exception details are helpful when testing an application, presenting an end user with such a screen in the face of an exception is less than ideal.</span></span> <span data-ttu-id="44f33-169">Ein Endbenutzer, die wahrscheinlich nicht wissen, was eine `NoNullAllowedException` wird oder warum sie verursacht wurde.</span><span class="sxs-lookup"><span data-stu-id="44f33-169">An end user likely doesn't know what a `NoNullAllowedException` is or why it was caused.</span></span> <span data-ttu-id="44f33-170">Ein besserer Ansatz ist, stehen dem Benutzer eine benutzerfreundlichere Meldung darauf hingewiesen, dass beim Versuch, das Produkt zu aktualisieren sind Probleme aufgetreten.</span><span class="sxs-lookup"><span data-stu-id="44f33-170">A better approach is to present the user with a more user-friendly message explaining that there were problems attempting to update the product.</span></span>

<span data-ttu-id="44f33-171">Wenn eine Ausnahme tritt auf, wenn der Vorgang ausführt, geben Sie die Ereignisse nach der Ebene in der ObjectDataSource und das Webserver-Steuerelement eine Möglichkeit zum Erkennen und die Ausnahme von bis zu die ASP.NET-Laufzeit bubbling Abbrechen.</span><span class="sxs-lookup"><span data-stu-id="44f33-171">If an exception occurs when performing the operation, the post-level events in both the ObjectDataSource and the data Web control provide a means to detect it and cancel the exception from bubbling up to the ASP.NET runtime.</span></span> <span data-ttu-id="44f33-172">In unserem Beispiel erstellen Sie nun einen Ereignishandler für der GridView `RowUpdated` Ereignis, das bestimmt, ob eine Ausnahme ausgelöst wurde, und wenn dies der Fall ist, die Details der Ausnahme in einem Label-Steuerelement zeigt.</span><span class="sxs-lookup"><span data-stu-id="44f33-172">For our example, let's create an event handler for the GridView's `RowUpdated` event that determines if an exception has fired and, if so, displays the exception details in a Label Web control.</span></span>

<span data-ttu-id="44f33-173">Starten, indem Sie eine Bezeichnung auf der ASP.NET-Seite festlegen seiner `ID` Eigenschaft `ExceptionDetails` und gelöscht wird, seine `Text` Eigenschaft.</span><span class="sxs-lookup"><span data-stu-id="44f33-173">Start by adding a Label to the ASP.NET page, setting its `ID` property to `ExceptionDetails` and clearing out its `Text` property.</span></span> <span data-ttu-id="44f33-174">Um sollten Sie die der Benutzer auf diese Meldung zu zeichnen, legen Sie seine `CssClass` Eigenschaft, um `Warning`, ist eine CSS-Klasse, die wir, um hinzugefügt die `Styles.css` Datei im vorherigen Lernprogramm.</span><span class="sxs-lookup"><span data-stu-id="44f33-174">In order to draw the user's eye to this message, set its `CssClass` property to `Warning`, which is a CSS class we added to the `Styles.css` file in the previous tutorial.</span></span> <span data-ttu-id="44f33-175">Beachten Sie, dass diese CSS-Klasse bewirkt, dass die Bezeichnung, die in Rot, kursiv, fett, Extragroß Schriftart anzuzeigende Text.</span><span class="sxs-lookup"><span data-stu-id="44f33-175">Recall that this CSS class causes the Label's text to be displayed in a red, italic, bold, extra large font.</span></span>


<span data-ttu-id="44f33-176">[![Fügen Sie ein Websteuerelement Bezeichnung auf der Seite "](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image20.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="44f33-176">[![Add a Label Web Control to the Page](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image20.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image19.png)</span></span>

<span data-ttu-id="44f33-177">**Abbildung 7**: Fügen Sie ein Websteuerelement Bezeichnung auf der Seite "([klicken Sie hier, um das Bild in voller Größe angezeigt](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="44f33-177">**Figure 7**: Add a Label Web Control to the Page ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image21.png))</span></span>


<span data-ttu-id="44f33-178">Eine Ausnahme ist aufgetreten, da diese Bezeichnung Websteuerelement sichtbar nur unmittelbar nach dem sein soll, legen Sie dessen `Visible` Eigenschaft auf "false" in der `Page_Load` Ereignishandler:</span><span class="sxs-lookup"><span data-stu-id="44f33-178">Since we want this Label Web control to be visible only immediately after an exception has occurred, set its `Visible` property to false in the `Page_Load` event handler:</span></span>


[!code-vb[Main](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/samples/sample3.vb)]

<span data-ttu-id="44f33-179">Mit diesem Code wird auf dem ersten Besuch der Seite und die nachfolgenden Postbacks der `ExceptionDetails` -Steuerelement seine `Visible` -Eigenschaftensatz auf `false`.</span><span class="sxs-lookup"><span data-stu-id="44f33-179">With this code, on the first page visit and subsequent postbacks the `ExceptionDetails` control will have its `Visible` property set to `false`.</span></span> <span data-ttu-id="44f33-180">Bei einem DAL-BLL Level Ausnahme aus, die in der GridView erkannt werden kann `RowUpdated` Ereignishandler, d. h. legen wir den `ExceptionDetails` des Steuerelements `Visible` Eigenschaft auf "true".</span><span class="sxs-lookup"><span data-stu-id="44f33-180">In the face of a DAL- or BLL-level exception, which we can detect in the GridView's `RowUpdated` event handler, we will set the `ExceptionDetails` control's `Visible` property to true.</span></span> <span data-ttu-id="44f33-181">Da Web Control-Ereignishandler nach dem Auftreten der `Page_Load` -Ereignishandler im Lebenszyklus Seite die Bezeichnung wird angezeigt.</span><span class="sxs-lookup"><span data-stu-id="44f33-181">Since Web control event handlers occur after the `Page_Load` event handler in the page lifecycle, the Label will be shown.</span></span> <span data-ttu-id="44f33-182">Allerdings auf das nächste Postback der `Page_Load` Ereignishandler zurückversetzt der `Visible` -Eigenschaft zurück auf `false`, erneut aus der Ansicht ausgeblendet.</span><span class="sxs-lookup"><span data-stu-id="44f33-182">However, on the next postback, the `Page_Load` event handler will revert the `Visible` property back to `false`, hiding it from view again.</span></span>

> [!NOTE]
> <span data-ttu-id="44f33-183">Alternativ können wir die Notwendigkeit für die Einstellung Entfernen der `ExceptionDetails` des Steuerelements `Visible` Eigenschaft im `Page_Load` durch Zuweisen der `Visible` Eigenschaft `false` in die deklarative Syntax und Deaktivieren von seinen Ansichtszustand (Festlegen der `EnableViewState` Eigenschaft `false`).</span><span class="sxs-lookup"><span data-stu-id="44f33-183">Alternatively, we could remove the necessity for setting the `ExceptionDetails` control's `Visible` property in `Page_Load` by assigning its `Visible` property `false` in the declarative syntax and disabling its view state (setting its `EnableViewState` property to `false`).</span></span> <span data-ttu-id="44f33-184">Wir verwenden diese alternativen Ansatz in einem späteren Lernprogramm.</span><span class="sxs-lookup"><span data-stu-id="44f33-184">We'll use this alternative approach in a future tutorial.</span></span>


<span data-ttu-id="44f33-185">Mit dem Label-Steuerelement hinzugefügt, wird im nächsten Schritt erstellen Sie den Ereignishandler für der GridView `RowUpdated` Ereignis.</span><span class="sxs-lookup"><span data-stu-id="44f33-185">With the Label control added, our next step is to create the event handler for the GridView's `RowUpdated` event.</span></span> <span data-ttu-id="44f33-186">Wählen Sie im Designer die GridView, wechseln Sie zum Fenster Eigenschaften und klicken Sie auf das Blitzsymbol Auflisten der GridView-Ereignisse.</span><span class="sxs-lookup"><span data-stu-id="44f33-186">Select the GridView in the Designer, go to the Properties window, and click the lightning bolt icon, listing the GridView's events.</span></span> <span data-ttu-id="44f33-187">Es bereits darf es ein Eintrag für der GridView `RowUpdating` Ereignis, wie wir einen Ereignishandler für dieses Ereignis weiter oben in diesem Lernprogramm erstellt haben.</span><span class="sxs-lookup"><span data-stu-id="44f33-187">There should already be an entry there for the GridView's `RowUpdating` event, as we created an event handler for this event earlier in this tutorial.</span></span> <span data-ttu-id="44f33-188">Erstellen Sie einen Ereignishandler für das `RowUpdated` Ereignis sowie.</span><span class="sxs-lookup"><span data-stu-id="44f33-188">Create an event handler for the `RowUpdated` event as well.</span></span>


![Erstellen Sie einen Ereignishandler für der GridView RowUpdated-Ereignis](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image22.png)

<span data-ttu-id="44f33-190">**Abbildung 8**: Erstellen Sie einen Ereignishandler für der GridView `RowUpdated` Ereignis</span><span class="sxs-lookup"><span data-stu-id="44f33-190">**Figure 8**: Create an Event Handler for the GridView's `RowUpdated` Event</span></span>


> [!NOTE]
> <span data-ttu-id="44f33-191">Sie können auch den Ereignishandler über die Dropdownlisten am oberen Rand der Code-Behind-Klassendatei erstellen.</span><span class="sxs-lookup"><span data-stu-id="44f33-191">You can also create the event handler through the drop-down lists at the top of the code-behind class file.</span></span> <span data-ttu-id="44f33-192">Wählen Sie aus der Dropdown-Liste auf der linken Seite die GridView und die `RowUpdated` Ereignis von der auf der rechten Seite.</span><span class="sxs-lookup"><span data-stu-id="44f33-192">Select the GridView from the drop-down list on the left and the `RowUpdated` event from the one on the right.</span></span>


<span data-ttu-id="44f33-193">Durch das Erstellen dieser Ereignishandler wird den folgenden Code auf der ASP.NET-Seite Code-Behind-Klasse hinzugefügt:</span><span class="sxs-lookup"><span data-stu-id="44f33-193">Creating this event handler will add the following code to the ASP.NET page's code-behind class:</span></span>


[!code-vb[Main](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/samples/sample4.vb)]

<span data-ttu-id="44f33-194">Dieser Ereignishandler zweiten Eingabeparameter ist ein Objekt des Typs [GridViewUpdatedEventArgs](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridviewupdatedeventargs.aspx), dem verfügt über drei Eigenschaften für das Behandeln von Ausnahmen von Bedeutung sind:</span><span class="sxs-lookup"><span data-stu-id="44f33-194">This event handler's second input parameter is an object of type [GridViewUpdatedEventArgs](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridviewupdatedeventargs.aspx), which has three properties of interest for handling exceptions:</span></span>

- <span data-ttu-id="44f33-195">`Exception`Ein Verweis auf die ausgelöste Ausnahme Wenn keine Ausnahme ausgelöst wurde, wird diese Eigenschaft einen Wert aufweisen.`null`</span><span class="sxs-lookup"><span data-stu-id="44f33-195">`Exception` a reference to the thrown exception; if no exception has been thrown, this property will have a value of `null`</span></span>
- <span data-ttu-id="44f33-196">`ExceptionHandled`Ein boolescher Wert, der angibt, ob die Ausnahme behandelt wurde, in der `RowUpdated` Ereignishandler; Wenn `false` (Standard), die Ausnahme wird erneut ausgelöst, bis zu die ASP.NET-Laufzeit durchsickert</span><span class="sxs-lookup"><span data-stu-id="44f33-196">`ExceptionHandled` a Boolean value that indicates whether or not the exception was handled in the `RowUpdated` event handler; if `false` (the default), the exception is re-thrown, percolating up to the ASP.NET runtime</span></span>
- <span data-ttu-id="44f33-197">`KeepInEditMode`Wenn auf festgelegt `true` bearbeitete GridView Zeile bleibt im Bearbeitungsmodus befindet; Wenn `false` (Standard), die GridView-Zeile, die nur-Lese-Modus wiederhergestellt</span><span class="sxs-lookup"><span data-stu-id="44f33-197">`KeepInEditMode` if set to `true` the edited GridView row remains in edit mode; if `false` (the default), the GridView row reverts back to its read-only mode</span></span>

<span data-ttu-id="44f33-198">Getesteten Codes, prüfen Sie dann, sollte Wenn `Exception` nicht `null`, was bedeutet, dass eine Ausnahme, beim Ausführen des Vorgangs ausgelöst wurde.</span><span class="sxs-lookup"><span data-stu-id="44f33-198">Our code, then, should check to see if `Exception` is not `null`, meaning that an exception was raised while performing the operation.</span></span> <span data-ttu-id="44f33-199">Wenn dies der Fall ist, möchten wir:</span><span class="sxs-lookup"><span data-stu-id="44f33-199">If this is the case, we want to:</span></span>

- <span data-ttu-id="44f33-200">Eine benutzerfreundliche Meldung in die `ExceptionDetails` Bezeichnung</span><span class="sxs-lookup"><span data-stu-id="44f33-200">Display a user-friendly message in the `ExceptionDetails` Label</span></span>
- <span data-ttu-id="44f33-201">Um anzugeben Sie, dass die Ausnahme behandelt wurde</span><span class="sxs-lookup"><span data-stu-id="44f33-201">Indicate that the exception was handled</span></span>
- <span data-ttu-id="44f33-202">Halten Sie die GridView-Zeile in den Bearbeitungsmodus</span><span class="sxs-lookup"><span data-stu-id="44f33-202">Keep the GridView row in edit mode</span></span>

<span data-ttu-id="44f33-203">Der folgende Code führt diese Ziele zu erreichen:</span><span class="sxs-lookup"><span data-stu-id="44f33-203">This following code accomplishes these objectives:</span></span>


[!code-vb[Main](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/samples/sample5.vb)]

<span data-ttu-id="44f33-204">Dieser Ereignishandler beginnt, indem überprüft wird, finden Sie unter `e.Exception` ist `null`.</span><span class="sxs-lookup"><span data-stu-id="44f33-204">This event handler begins by checking to see if `e.Exception` is `null`.</span></span> <span data-ttu-id="44f33-205">Ist dies nicht der Fall, die `ExceptionDetails` Bezeichnungsfelds `Visible` -Eigenschaftensatz auf `true` und seine `Text` -Eigenschaft auf "Es wurde ein Problem mit dem Aktualisieren des Produkts."</span><span class="sxs-lookup"><span data-stu-id="44f33-205">If it's not, the `ExceptionDetails` Label's `Visible` property is set to `true` and its `Text` property to "There was a problem updating the product."</span></span> <span data-ttu-id="44f33-206">Die Details der tatsächliche Ausnahme, die ausgelöst wurde, befinden sich in der `e.Exception` des Objekts `InnerException` Eigenschaft.</span><span class="sxs-lookup"><span data-stu-id="44f33-206">The details of the actual exception that was thrown reside in the `e.Exception` object's `InnerException` property.</span></span> <span data-ttu-id="44f33-207">Diese Beschreibung der eingeschlossenen Ausnahme überprüft wird und wenn es einen bestimmten Typ handelt, an eine zusätzliche, hilfreiche-Nachricht angefügt der `ExceptionDetails` Bezeichnungsfelds `Text` Eigenschaft.</span><span class="sxs-lookup"><span data-stu-id="44f33-207">This inner exception is examined and, if it is of a particular type, an additional, helpful message is appended to the `ExceptionDetails` Label's `Text` property.</span></span> <span data-ttu-id="44f33-208">Abschließend wird die `ExceptionHandled` und `KeepInEditMode` Eigenschaften festgelegt `true`.</span><span class="sxs-lookup"><span data-stu-id="44f33-208">Lastly, the `ExceptionHandled` and `KeepInEditMode` properties are both set to `true`.</span></span>

<span data-ttu-id="44f33-209">Abbildung 9 zeigt ein Screenshot, der auf dieser Seite aus, wenn der Name des Produkts auslassen; Abbildung 10 zeigt die Ergebnisse bei der Eingabe eine unzulässige `UnitPrice` Wert (-50).</span><span class="sxs-lookup"><span data-stu-id="44f33-209">Figure 9 shows a screen shot of this page when omitting the name of the product; Figure 10 shows the results when entering an illegal `UnitPrice` value (-50).</span></span>


<span data-ttu-id="44f33-210">[![Die ProductName BoundField-muss einen Wert enthalten.](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image24.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="44f33-210">[![The ProductName BoundField Must Contain a Value](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image24.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image23.png)</span></span>

<span data-ttu-id="44f33-211">**Abbildung 9**: die `ProductName` BoundField muss einen Wert enthalten ([klicken Sie hier, um das Bild in voller Größe angezeigt](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image25.png))</span><span class="sxs-lookup"><span data-stu-id="44f33-211">**Figure 9**: The `ProductName` BoundField Must Contain a Value ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image25.png))</span></span>


<span data-ttu-id="44f33-212">[![Negative UnitPrice-Werte sind nicht zulässig.](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image27.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image26.png)</span><span class="sxs-lookup"><span data-stu-id="44f33-212">[![Negative UnitPrice Values are Not Allowed](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image27.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image26.png)</span></span>

<span data-ttu-id="44f33-213">**Abbildung 10**: Negative `UnitPrice` Werte sind nicht zulässig ([klicken Sie hier, um das Bild in voller Größe angezeigt](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image28.png))</span><span class="sxs-lookup"><span data-stu-id="44f33-213">**Figure 10**: Negative `UnitPrice` Values are Not Allowed ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image28.png))</span></span>


<span data-ttu-id="44f33-214">Durch Festlegen der `e.ExceptionHandled` Eigenschaft `true`, `RowUpdated` -Ereignishandler hat festgelegt, dass sie die Ausnahme verarbeitet wurde.</span><span class="sxs-lookup"><span data-stu-id="44f33-214">By setting the `e.ExceptionHandled` property to `true`, the `RowUpdated` event handler has indicated that it has handled the exception.</span></span> <span data-ttu-id="44f33-215">Die Ausnahme wird nicht aus diesem Grund bis zu die ASP.NET-Laufzeit weitergeleitet.</span><span class="sxs-lookup"><span data-stu-id="44f33-215">Therefore, the exception won't propagate up to the ASP.NET runtime.</span></span>

> [!NOTE]
> <span data-ttu-id="44f33-216">Abbildung 9 und 10 zeigen eine ordnungsgemäße Möglichkeit zum Behandeln von Ausnahmen, die aufgrund von ungültigen Benutzereingaben ausgelöst werden.</span><span class="sxs-lookup"><span data-stu-id="44f33-216">Figures 9 and 10 show a graceful way to handle exceptions raised due to invalid user input.</span></span> <span data-ttu-id="44f33-217">Im Idealfall jedoch solche ungültige Eingabe wird nie Reichweite der Geschäftslogikschicht ursprünglich, wie die ASP.NET-Seite sicherstellen sollten, dass Eingaben des Benutzers gültig, vor dem Aufrufen sind der `ProductsBLL` Klasse `UpdateProduct` Methode.</span><span class="sxs-lookup"><span data-stu-id="44f33-217">Ideally, though, such invalid input will never reach the Business Logic Layer in the first place, as the ASP.NET page should ensure that the user's inputs are valid before invoking the `ProductsBLL` class's `UpdateProduct` method.</span></span> <span data-ttu-id="44f33-218">In unserem nächsten Lernprogramm zum Hinzufügen von Steuerelementen für die Validierung zu die bearbeiten und Einfügen von Schnittstellen, um sicherzustellen, dass die Daten übermittelt, die Business Logic Layer eingehendem entspricht der Geschäftsregeln.</span><span class="sxs-lookup"><span data-stu-id="44f33-218">In our next tutorial we'll see how to add validation controls to the editing and inserting interfaces to ensure that the data submitted to the Business Logic Layer conforms to the business rules.</span></span> <span data-ttu-id="44f33-219">Die Validierungssteuerelemente nicht nur zu verhindern, dass den Aufruf der `UpdateProduct` Methode, bis die vom Benutzer bereitgestellten Daten gültig ist, aber auch eine umfangreichere benutzererfahrung, zum Identifizieren der Probleme mit der Dateneingabe bieten.</span><span class="sxs-lookup"><span data-stu-id="44f33-219">The validation controls not only prevent the invocation of the `UpdateProduct` method until the user-supplied data is valid, but also provide a more informative user experience for identifying data entry problems.</span></span>


## <a name="step-3-gracefully-handling-bll-level-exceptions"></a><span data-ttu-id="44f33-220">Schritt 3: Ordnungsgemäß Ausnahmebehandlung BLL auf Dokumentebene</span><span class="sxs-lookup"><span data-stu-id="44f33-220">Step 3: Gracefully Handling BLL-Level Exceptions</span></span>

<span data-ttu-id="44f33-221">Beim Einfügen von möglicherweise aktualisieren oder Löschen von Daten, die Datenzugriffsebene eine Ausnahme im ein Daten-bezogener Fehler ausgelöst.</span><span class="sxs-lookup"><span data-stu-id="44f33-221">When inserting, updating, or deleting data, the Data Access Layer may throw an exception in the face of a data-related error.</span></span> <span data-ttu-id="44f33-222">Die Datenbank ist möglicherweise offline, eine erforderlichen Datenbanktabellen-Spalte kann einen angegebenen Wert nicht hatten, oder eine Einschränkung auf Tabellenebene wurde verletzt.</span><span class="sxs-lookup"><span data-stu-id="44f33-222">The database may be offline, a required database table column might not have had a value specified, or a table-level constraint may have been violated.</span></span> <span data-ttu-id="44f33-223">Zusätzlich zu den Ausnahmen streng datenbezogene können die Geschäftslogikschicht Ausnahmen verwenden, um anzugeben, wann Geschäftsregeln verletzt wurden.</span><span class="sxs-lookup"><span data-stu-id="44f33-223">In addition to strictly data-related exceptions, the Business Logic Layer can use exceptions to indicate when business rules have been violated.</span></span> <span data-ttu-id="44f33-224">In der [erstellen eine Geschäftslogikschicht](../introduction/creating-a-business-logic-layer-vb.md) Lernprogramm, z. B. wir eine regelüberprüfung Business hinzugefügt, mit dem ursprünglichen `UpdateProduct` überladen.</span><span class="sxs-lookup"><span data-stu-id="44f33-224">In the [Creating a Business Logic Layer](../introduction/creating-a-business-logic-layer-vb.md) tutorial, for example, we added a business rule check to the original `UpdateProduct` overload.</span></span> <span data-ttu-id="44f33-225">Insbesondere, wenn der Benutzer ein Produkt kennzeichnen wurde Sie als nicht mehr unterstützt, erforderlich sind wir, dass das Produkt nicht die einzige von seiner Lieferanten bereitgestellt werden.</span><span class="sxs-lookup"><span data-stu-id="44f33-225">Specifically, if the user was marking a product as discontinued, we required that the product not be the only one provided by its supplier.</span></span> <span data-ttu-id="44f33-226">Wenn diese Bedingung gegen die verstoßen wurde, ein `ApplicationException` ausgelöst wurde.</span><span class="sxs-lookup"><span data-stu-id="44f33-226">If this condition was violated, an `ApplicationException` was thrown.</span></span>

<span data-ttu-id="44f33-227">Für die `UpdateProduct` Überladung, die in diesem Lernprogramm erstellt haben, fügen Sie eine Geschäftsregel, die verhindert, dass die `UnitPrice` festgelegt wird, um einen neuen Wert, der mehr als zweimal die ursprüngliche Feld `UnitPrice` Wert.</span><span class="sxs-lookup"><span data-stu-id="44f33-227">For the `UpdateProduct` overload created in this tutorial, let's add a business rule that prohibits the `UnitPrice` field from being set to a new value that's more than twice the original `UnitPrice` value.</span></span> <span data-ttu-id="44f33-228">Anpassen, um dies zu erreichen, die `UpdateProduct` überladen, sodass er führt diese Überprüfung aus, und löst eine `ApplicationException` , wenn die Regel verletzt wird.</span><span class="sxs-lookup"><span data-stu-id="44f33-228">To accomplish this, adjust the `UpdateProduct` overload so that it performs this check and throws an `ApplicationException` if the rule is violated.</span></span> <span data-ttu-id="44f33-229">Die aktualisierte Methode lautet folgendermaßen:</span><span class="sxs-lookup"><span data-stu-id="44f33-229">The updated method follows:</span></span>


[!code-vb[Main](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/samples/sample6.vb)]

<span data-ttu-id="44f33-230">Durch diese Änderung alle Preis Update, das mehr als doppelt vorhandene Preis führt dazu, dass ein `ApplicationException` ausgelöst wird.</span><span class="sxs-lookup"><span data-stu-id="44f33-230">With this change, any price update that is more than twice the existing price will cause an `ApplicationException` to be thrown.</span></span> <span data-ttu-id="44f33-231">Ebenso wie die Ausnahme, die ausgelöst wird, von der DAL, die diesem BLL-ausgelöst `ApplicationException` erkannt und behandelt der GridView `RowUpdated` -Ereignishandler.</span><span class="sxs-lookup"><span data-stu-id="44f33-231">Just like the exception raised from the DAL, this BLL-raised `ApplicationException` can be detected and handled in the GridView's `RowUpdated` event handler.</span></span> <span data-ttu-id="44f33-232">In der Tat die `RowUpdated` --Ereignishandler Code geschrieben, ordnungsgemäß erkennt diese Ausnahme und zeigt die `ApplicationException`des `Message` Eigenschaftswert.</span><span class="sxs-lookup"><span data-stu-id="44f33-232">In fact, the `RowUpdated` event handler's code, as written, will correctly detect this exception and display the `ApplicationException`'s `Message` property value.</span></span> <span data-ttu-id="44f33-233">Abbildung 11 zeigt einen Screenshot, wenn ein Benutzer versucht, aktualisieren Sie den Preis Chai auf 50,00 $, also mehr als das Doppelte der aktuellen Preis des 19,95 $.</span><span class="sxs-lookup"><span data-stu-id="44f33-233">Figure 11 shows a screen shot when a user attempts to update the price of Chai to $50.00, which is more than double its current price of $19.95.</span></span>


<span data-ttu-id="44f33-234">[![Die Geschäftsregeln unterbinden, Preis erhöht, die mehr als doppelt so Preis eines Produkts](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image30.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image29.png)</span><span class="sxs-lookup"><span data-stu-id="44f33-234">[![The Business Rules Disallow Price Increases That More Than Double a Product's Price](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image30.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image29.png)</span></span>

<span data-ttu-id="44f33-235">**Abbildung 11**: die Geschäftsregel Disallow Preis erhöht, die mehr als doppelt so Preis eines Produkts ([klicken Sie hier, um das Bild in voller Größe angezeigt](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image31.png))</span><span class="sxs-lookup"><span data-stu-id="44f33-235">**Figure 11**: The Business Rules Disallow Price Increases That More Than Double a Product's Price ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image31.png))</span></span>


> [!NOTE]
> <span data-ttu-id="44f33-236">Im Idealfall würden unsere Geschäftslogikregeln umgestaltet werden, von der `UpdateProduct` Überladungen der Methode und in eine gängige Methode.</span><span class="sxs-lookup"><span data-stu-id="44f33-236">Ideally our business logic rules would be refactored out of the `UpdateProduct` method overloads and into a common method.</span></span> <span data-ttu-id="44f33-237">Dies wird als Übung für den Leser belassen.</span><span class="sxs-lookup"><span data-stu-id="44f33-237">This is left as an exercise for the reader.</span></span>


## <a name="summary"></a><span data-ttu-id="44f33-238">Zusammenfassung</span><span class="sxs-lookup"><span data-stu-id="44f33-238">Summary</span></span>

<span data-ttu-id="44f33-239">Beim Einfügen, aktualisieren und Löschen von Vorgängen das Websteuerelement Daten und die Beteiligten ObjectDataSource vor und nach dem Kompatibilitätsgrad Ereignisse auslösen, Buchstütze den aktuellen Vorgang.</span><span class="sxs-lookup"><span data-stu-id="44f33-239">During inserting, updating, and deleting operations, both the data Web control and the ObjectDataSource involved fire pre- and post-level events that bookend the actual operation.</span></span> <span data-ttu-id="44f33-240">Wie in diesem Lernprogramm und der vorherigen Abfrage, wurde erläutert, bei der Arbeit mit einer bearbeitbaren GridView der GridView `RowUpdating` Ereignis wird ausgelöst, gefolgt von der ObjectDataSource `Updating` an diesem Punkt der Updatebefehl, um das ObjectDataSource ausgelöst wird-Ereignis zugrunde liegende Objekt.</span><span class="sxs-lookup"><span data-stu-id="44f33-240">As we saw in this tutorial and the preceding one, when working with an editable GridView the GridView's `RowUpdating` event fires, followed by the ObjectDataSource's `Updating` event, at which point the update command is made to the ObjectDataSource's underlying object.</span></span> <span data-ttu-id="44f33-241">Nachdem der Vorgang abgeschlossen wurde, wird das ObjectDataSource `Updated` Ereignis wird ausgelöst, gefolgt von der GridView `RowUpdated` Ereignis.</span><span class="sxs-lookup"><span data-stu-id="44f33-241">After the operation has completed, the ObjectDataSource's `Updated` event fires, followed by the GridView's `RowUpdated` event.</span></span>

<span data-ttu-id="44f33-242">Wir können Ereignishandler für die Ereignisse vorab Ebene, um die Eingabeparameter anpassen oder die Ereignisse nach der Ebene, um zu überprüfen und reagieren auf Ergebnisse(n) der Vorgang erstellen.</span><span class="sxs-lookup"><span data-stu-id="44f33-242">We can create event handlers for the pre-level events in order to customize the input parameters or for the post-level events in order to inspect and respond to the operation's results.</span></span> <span data-ttu-id="44f33-243">Nach der Servicelevel-Ereignishandler werden am häufigsten verwendet, um festzustellen, ob eine Ausnahme während des Vorgangs aufgetreten ist.</span><span class="sxs-lookup"><span data-stu-id="44f33-243">Post-level event handlers are most commonly used to detect whether an exception occurred during the operation.</span></span> <span data-ttu-id="44f33-244">Bei einer Ausnahme können diese nach der Ebene Ereignishandler optional die Ausnahme für ihre eigenen behandeln.</span><span class="sxs-lookup"><span data-stu-id="44f33-244">In the face of an exception, these post-level event handlers can optionally handle the exception on their own.</span></span> <span data-ttu-id="44f33-245">In diesem Lernprogramm wurde erläutert, wie solche eine Ausnahme zu behandeln, indem eine benutzerfreundliche Fehlermeldung angezeigt.</span><span class="sxs-lookup"><span data-stu-id="44f33-245">In this tutorial we saw how to handle such an exception by displaying a friendly error message.</span></span>

<span data-ttu-id="44f33-246">In den nächsten Lernprogrammen erfahren wir, wie Sie verringern die Wahrscheinlichkeit von Ausnahmen, die aus der datenformatierung Probleme (z. B. eine Negative eingeben `UnitPrice`).</span><span class="sxs-lookup"><span data-stu-id="44f33-246">In the next tutorial we'll see how to lessen the likelihood of exceptions arising from data formatting issues (such as entering a negative `UnitPrice`).</span></span> <span data-ttu-id="44f33-247">Insbesondere sehen wir uns zum Hinzufügen von Steuerelementen für die Validierung zu bearbeiten und Einfügen von Schnittstellen.</span><span class="sxs-lookup"><span data-stu-id="44f33-247">Specifically, we'll look at how to add validation controls to the editing and inserting interfaces.</span></span>

<span data-ttu-id="44f33-248">Viel Spaß beim Programmieren!</span><span class="sxs-lookup"><span data-stu-id="44f33-248">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="44f33-249">Informationen zum Autor</span><span class="sxs-lookup"><span data-stu-id="44f33-249">About the Author</span></span>

<span data-ttu-id="44f33-250">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), Autor von sieben ASP/ASP.NET-Büchern und Gründer von [4GuysFromRolla.com](http://www.4guysfromrolla.com), Microsoft Web-Technologien seit 1998 arbeitet.</span><span class="sxs-lookup"><span data-stu-id="44f33-250">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="44f33-251">Scott fungiert als ein unabhängiger Berater, Trainer und Writer.</span><span class="sxs-lookup"><span data-stu-id="44f33-251">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="44f33-252">Sein neueste Buch wird [ *Sams Schulen selbst ASP.NET 2.0 in 24 Stunden*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="44f33-252">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="44f33-253">Er die erreicht werden kann, zur [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) oder über seinen Blog die finden Sie unter [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="44f33-253">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="44f33-254">Besonderen Dank an</span><span class="sxs-lookup"><span data-stu-id="44f33-254">Special Thanks To</span></span>

<span data-ttu-id="44f33-255">Diese Reihe von Lernprogrammen wurde durch viele nützliche Bearbeiter überprüft.</span><span class="sxs-lookup"><span data-stu-id="44f33-255">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="44f33-256">Lead Prüfer für dieses Lernprogramm wurde Liz Shulok.</span><span class="sxs-lookup"><span data-stu-id="44f33-256">Lead reviewer for this tutorial was Liz Shulok.</span></span> <span data-ttu-id="44f33-257">Meine bevorstehende MSDN-Artikel Überprüfen von Interesse?</span><span class="sxs-lookup"><span data-stu-id="44f33-257">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="44f33-258">Wenn dies der Fall ist, löschen Sie mich zeilenweise [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="44f33-258">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

>[!div class="step-by-step"]
<span data-ttu-id="44f33-259">[Zurück](examining-the-events-associated-with-inserting-updating-and-deleting-vb.md)
[Weiter](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb.md)</span><span class="sxs-lookup"><span data-stu-id="44f33-259">[Previous](examining-the-events-associated-with-inserting-updating-and-deleting-vb.md)
[Next](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb.md)</span></span>
