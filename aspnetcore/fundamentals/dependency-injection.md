---
title: "Abhängigkeitsinjektion in ASP.NET Core"
author: ardalis
description: "Erfahren Sie, wie ASP.NET Core Abhängigkeitsinjektion implementiert und wie Sie es verwenden."
keywords: ASP.NET Core, Dependency Injection, di
ms.author: riande
manager: wpickett
ms.date: 10/14/2016
ms.topic: article
ms.assetid: fccd69be-7ad1-47fb-b203-b3633b6b9a9b
ms.technology: aspnet
ms.prod: asp.net-core
uid: fundamentals/dependency-injection
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: e5dfebeddb3a9394fd1faf798e029a9312201089
ms.sourcegitcommit: 78d28178345a0eea91556e4cd1adad98b1446db8
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 09/22/2017
---
# <a name="introduction-to-dependency-injection-in-aspnet-core"></a><span data-ttu-id="23982-104">Einführung in die Abhängigkeitsinjektion in ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="23982-104">Introduction to Dependency Injection in ASP.NET Core</span></span>

<a name=fundamentals-dependency-injection></a>

<span data-ttu-id="23982-105">Durch [Steve Smith](https://ardalis.com/) und [Scott Addie](https://scottaddie.com)</span><span class="sxs-lookup"><span data-stu-id="23982-105">By [Steve Smith](https://ardalis.com/) and [Scott Addie](https://scottaddie.com)</span></span>

<span data-ttu-id="23982-106">ASP.NET Core dient zur Unterstützung und Abhängigkeitsinjektion Nutzen von Grund auf neu einrichten.</span><span class="sxs-lookup"><span data-stu-id="23982-106">ASP.NET Core is designed from the ground up to support and leverage dependency injection.</span></span> <span data-ttu-id="23982-107">ASP.NET Core-Anwendungen können integriertes Framework Services, wenn diese in Methoden, die in die Startklasse eingeschleust nutzen und Anwendungsdienste für Injection ebenfalls konfiguriert werden können.</span><span class="sxs-lookup"><span data-stu-id="23982-107">ASP.NET Core applications can leverage built-in framework services by having them injected into methods in the Startup class, and application services can be configured for injection as well.</span></span> <span data-ttu-id="23982-108">Der von ASP.NET Core bereitgestellten Dienste Standardcontainer bietet eine minimale Funktion festgelegt und sollte nicht auf andere Container zu ersetzen.</span><span class="sxs-lookup"><span data-stu-id="23982-108">The default services container provided by ASP.NET Core provides a minimal feature set and is not intended to replace other containers.</span></span>

[<span data-ttu-id="23982-109">Anzeigen oder Herunterladen von Beispielcode</span><span class="sxs-lookup"><span data-stu-id="23982-109">View or download sample code</span></span>](https://github.com/aspnet/Docs/tree/master/aspnetcore/fundamentals/dependency-injection/sample)

## <a name="what-is-dependency-injection"></a><span data-ttu-id="23982-110">Was ist die Abhängigkeitsinjektion?</span><span class="sxs-lookup"><span data-stu-id="23982-110">What is Dependency Injection?</span></span>

<span data-ttu-id="23982-111">Abhängigkeiteneinschleusung (DI) ist eine Technik zum Erreichen einer losen Kopplung zwischen Objekten und ihren Mitarbeitern oder Abhängigkeiten.</span><span class="sxs-lookup"><span data-stu-id="23982-111">Dependency injection (DI) is a technique for achieving loose coupling between objects and their collaborators, or dependencies.</span></span> <span data-ttu-id="23982-112">Statt direkt instanziieren Projektmitarbeiter oder der Code statische Verweise verwenden werden die Objekte, die eine Klasse benötigt wird, um ihre Aktionen, auf die Klasse in irgendeiner Weise bereitgestellt.</span><span class="sxs-lookup"><span data-stu-id="23982-112">Rather than directly instantiating collaborators, or using static references, the objects a class needs in order to perform its actions are provided to the class in some fashion.</span></span> <span data-ttu-id="23982-113">In den meisten Fällen werden Klassen deklarieren ihre Abhängigkeiten über ihren Konstruktor, der ihnen ermöglicht, befolgen die [expliziten Abhängigkeiten Prinzip](http://deviq.com/explicit-dependencies-principle/).</span><span class="sxs-lookup"><span data-stu-id="23982-113">Most often, classes will declare their dependencies via their constructor, allowing them to follow the [Explicit Dependencies Principle](http://deviq.com/explicit-dependencies-principle/).</span></span> <span data-ttu-id="23982-114">Dieser Ansatz wird als "Konstruktoreinfügung" bezeichnet.</span><span class="sxs-lookup"><span data-stu-id="23982-114">This approach is known as "constructor injection".</span></span>

<span data-ttu-id="23982-115">Bei Klassen mit DI entworfen werden, sind sie besser lose gekoppelt, da sie nicht direkte und hartcodierten Abhängigkeiten für ihre Mitarbeiter verfügen.</span><span class="sxs-lookup"><span data-stu-id="23982-115">When classes are designed with DI in mind, they are more loosely coupled because they do not have direct, hard-coded dependencies on their collaborators.</span></span> <span data-ttu-id="23982-116">Dies folgt dem [Abhängigkeit Umkehrung Prinzip](http://deviq.com/dependency-inversion-principle/), der gibt an, dass *"hohe Ebene Module sollten nicht auf niedriger Ebene Module abhängen; beide sollte Abstraktionen abhängen."*</span><span class="sxs-lookup"><span data-stu-id="23982-116">This follows the [Dependency Inversion Principle](http://deviq.com/dependency-inversion-principle/), which states that *"high level modules should not depend on low level modules; both should depend on abstractions."*</span></span> <span data-ttu-id="23982-117">Anstelle von Verweisen auf bestimmte Implementierungen Klassen Abstraktionen anfordern (in der Regel `interfaces`) die werden Ihnen bereitgestellt, wenn die Klasse erstellt wird.</span><span class="sxs-lookup"><span data-stu-id="23982-117">Instead of referencing specific implementations, classes request abstractions (typically `interfaces`) which are provided to them when the class is constructed.</span></span> <span data-ttu-id="23982-118">Extrahieren von Abhängigkeiten in Schnittstellen und Implementierungen dieser Schnittstellen als Parameter bereitstellen, ist auch ein Beispiel für die [Strategie Entwurfsmuster](http://deviq.com/strategy-design-pattern/).</span><span class="sxs-lookup"><span data-stu-id="23982-118">Extracting dependencies into interfaces and providing implementations of these interfaces as parameters is also an example of the [Strategy design pattern](http://deviq.com/strategy-design-pattern/).</span></span>

<span data-ttu-id="23982-119">Wenn ein System mit DI konzipiert ist, ist es mit vielen Klassen anfordern ihre Abhängigkeiten über ihren Konstruktor (oder Eigenschaften) hilfreich, wenn eine Klasse, die für diese Klassen mit ihren zugehörigen Abhängigkeiten erstellen können.</span><span class="sxs-lookup"><span data-stu-id="23982-119">When a system is designed to use DI, with many classes requesting their dependencies via their constructor (or properties), it's helpful to have a class dedicated to creating these classes with their associated dependencies.</span></span> <span data-ttu-id="23982-120">Diese Klassen werden als bezeichnet *Container*, genauer gesagt, [Inversion of Control (IoC)](http://deviq.com/inversion-of-control/) Container oder Container (Dependency Injection, DI).</span><span class="sxs-lookup"><span data-stu-id="23982-120">These classes are referred to as *containers*, or more specifically, [Inversion of Control (IoC)](http://deviq.com/inversion-of-control/) containers or Dependency Injection (DI) containers.</span></span> <span data-ttu-id="23982-121">Ein Container ist im Wesentlichen eine Factory, die ist verantwortlich für das Bereitstellen von Instanzen von Typen, die von ihm angefordert werden.</span><span class="sxs-lookup"><span data-stu-id="23982-121">A container is essentially a factory that is responsible for providing instances of types that are requested from it.</span></span> <span data-ttu-id="23982-122">Wenn ein bestimmten Typs deklariert hat, dass sie Abhängigkeiten und der Container konfiguriert wurde, dass die Abhängigkeit Typen bereitzustellen, erstellt er die Abhängigkeiten im Rahmen der Erstellung der angeforderten Instanz.</span><span class="sxs-lookup"><span data-stu-id="23982-122">If a given type has declared that it has dependencies, and the container has been configured to provide the dependency types, it will create the dependencies as part of creating the requested instance.</span></span> <span data-ttu-id="23982-123">Auf diese Weise können komplexe Abhängigkeitsdiagramme auf Klassen ohne die Notwendigkeit für alle hartcodierten Objektkonstruktion bereitgestellt werden.</span><span class="sxs-lookup"><span data-stu-id="23982-123">In this way, complex dependency graphs can be provided to classes without the need for any hard-coded object construction.</span></span> <span data-ttu-id="23982-124">Zusätzlich zum Erstellen von Objekten mit deren Abhängigkeiten, Verwalten von Containern in der Regel Objektlebensdauer innerhalb der Anwendung.</span><span class="sxs-lookup"><span data-stu-id="23982-124">In addition to creating objects with their dependencies, containers typically manage object lifetimes within the application.</span></span>

<span data-ttu-id="23982-125">ASP.NET Core enthält einen einfachen integrierte Container (dargestellt durch die `IServiceProvider` Schnittstelle), konstruktoreinschleusung standardmäßig unterstützt und ASP.NET macht bestimmte Dienste DI erhältlich.</span><span class="sxs-lookup"><span data-stu-id="23982-125">ASP.NET Core includes a simple built-in container (represented by the `IServiceProvider` interface) that supports constructor injection by default, and ASP.NET makes certain services available through DI.</span></span> <span data-ttu-id="23982-126">ASP IST. NET Container bezieht sich auf die Typen, die er, als verwaltet *Services*.</span><span class="sxs-lookup"><span data-stu-id="23982-126">ASP.NET's container refers to the types it manages as *services*.</span></span> <span data-ttu-id="23982-127">Im weiteren Verlauf dieses Artikels *Services* verweist auf Typen, die von ASP.NET Core des IoC-Container verwaltet werden.</span><span class="sxs-lookup"><span data-stu-id="23982-127">Throughout the rest of this article, *services* will refer to types that are managed by ASP.NET Core's IoC container.</span></span> <span data-ttu-id="23982-128">Sie konfigurieren den integrierten Container Dienste in der `ConfigureServices` Methoden in Ihrer Anwendung `Startup` Klasse.</span><span class="sxs-lookup"><span data-stu-id="23982-128">You configure the built-in container's services in the `ConfigureServices` method in your application's `Startup` class.</span></span>

> [!NOTE]
> <span data-ttu-id="23982-129">Smell verfügt über einen umfangreichen Artikel geschrieben, auf [die Umkehrung der Steuerelementcontainer und dem Dependency Injection Muster](https://www.martinfowler.com/articles/injection.html).</span><span class="sxs-lookup"><span data-stu-id="23982-129">Martin Fowler has written an extensive article on [Inversion of Control Containers and the Dependency Injection Pattern](https://www.martinfowler.com/articles/injection.html).</span></span> <span data-ttu-id="23982-130">Microsoft Patterns and Practices verfügt auch über eine hervorragende Beschreibung [Abhängigkeitsinjektion](https://msdn.microsoft.com/library/hh323705.aspx).</span><span class="sxs-lookup"><span data-stu-id="23982-130">Microsoft Patterns and Practices also has a great description of [Dependency Injection](https://msdn.microsoft.com/library/hh323705.aspx).</span></span>

> [!NOTE]
> <span data-ttu-id="23982-131">Dieser Artikel behandelt die Abhängigkeitsinjektion anwenden auf alle ASP.NET-Anwendungen.</span><span class="sxs-lookup"><span data-stu-id="23982-131">This article covers Dependency Injection as it applies to all ASP.NET applications.</span></span> <span data-ttu-id="23982-132">Abhängigkeitsinjektion in MVC-Controller wird in behandelt [Abhängigkeiteneinschleusung und Controllern](../mvc/controllers/dependency-injection.md).</span><span class="sxs-lookup"><span data-stu-id="23982-132">Dependency Injection within MVC controllers is covered in [Dependency Injection and Controllers](../mvc/controllers/dependency-injection.md).</span></span>

### <a name="constructor-injection-behavior"></a><span data-ttu-id="23982-133">Konstruktor-Injection-Verhalten</span><span class="sxs-lookup"><span data-stu-id="23982-133">Constructor Injection Behavior</span></span>

<span data-ttu-id="23982-134">Konstruktoreinfügung erfordert, dass der betreffende Konstruktor *öffentlichen*.</span><span class="sxs-lookup"><span data-stu-id="23982-134">Constructor injection requires that the constructor in question be *public*.</span></span> <span data-ttu-id="23982-135">Andernfalls löst die app eine `InvalidOperationException`:</span><span class="sxs-lookup"><span data-stu-id="23982-135">Otherwise, your app will throw an `InvalidOperationException`:</span></span>

> <span data-ttu-id="23982-136">Ein geeigneter Konstruktor für Typ "YourType" konnte nicht gefunden werden.</span><span class="sxs-lookup"><span data-stu-id="23982-136">A suitable constructor for type 'YourType' could not be located.</span></span> <span data-ttu-id="23982-137">Sicherstellen, dass der Typ konkrete und Dienste für alle Parameter für einen öffentlichen Konstruktor registriert sind.</span><span class="sxs-lookup"><span data-stu-id="23982-137">Ensure the type is concrete and services are registered for all parameters of a public constructor.</span></span>


<span data-ttu-id="23982-138">Konstruktoreinfügung erfordert, nur über einen entsprechenden Konstruktor vorhanden.</span><span class="sxs-lookup"><span data-stu-id="23982-138">Constructor injection requires that only one applicable constructor exist.</span></span> <span data-ttu-id="23982-139">Konstruktorüberladungen werden unterstützt, jedoch nur eine Überladung kann vorhanden sein, deren Argumente alle durch Abhängigkeitsinjektion erfüllt werden können.</span><span class="sxs-lookup"><span data-stu-id="23982-139">Constructor overloads are supported, but only one overload can exist whose arguments can all be fulfilled by dependency injection.</span></span> <span data-ttu-id="23982-140">Wenn mehr als eine vorhanden ist, löst die app ein `InvalidOperationException`:</span><span class="sxs-lookup"><span data-stu-id="23982-140">If more than one exists, your app will throw an `InvalidOperationException`:</span></span>

> <span data-ttu-id="23982-141">Im Typ "YourType" wurden mehrere Konstruktoren akzeptieren alle angegebenen Argumenttypen gefunden.</span><span class="sxs-lookup"><span data-stu-id="23982-141">Multiple constructors accepting all given argument types have been found in type 'YourType'.</span></span> <span data-ttu-id="23982-142">Es sollte nur einen entsprechenden Konstruktor vorhanden sein.</span><span class="sxs-lookup"><span data-stu-id="23982-142">There should only be one applicable constructor.</span></span>

<span data-ttu-id="23982-143">Konstruktoren können akzeptieren Argumente, die Abhängigkeitsinjektion nicht enthalten sind, jedoch müssen diese Standardwerte unterstützen.</span><span class="sxs-lookup"><span data-stu-id="23982-143">Constructors can accept arguments that are not provided by dependency injection, but these must support default values.</span></span> <span data-ttu-id="23982-144">Zum Beispiel:</span><span class="sxs-lookup"><span data-stu-id="23982-144">For example:</span></span>

```csharp
// throws InvalidOperationException: Unable to resolve service for type 'System.String'...
public CharactersController(ICharacterRepository characterRepository, string title)
{
    _characterRepository = characterRepository;
    _title = title;
}

// runs without error
public CharactersController(ICharacterRepository characterRepository, string title = "Characters")
{
    _characterRepository = characterRepository;
    _title = title;
}
```

## <a name="using-framework-provided-services"></a><span data-ttu-id="23982-145">Framework-Dienste verwenden</span><span class="sxs-lookup"><span data-stu-id="23982-145">Using Framework-Provided Services</span></span>

<span data-ttu-id="23982-146">Die `ConfigureServices` Methode in der `Startup` -Klasse ist verantwortlich für die Dienste, die die Anwendung, einschließlich Plattformfunktionen wie Entity Framework Core und ASP.NET Core MVC verwendet wird definieren.</span><span class="sxs-lookup"><span data-stu-id="23982-146">The `ConfigureServices` method in the `Startup` class is responsible for defining the services the application will use, including platform features like Entity Framework Core and ASP.NET Core MVC.</span></span> <span data-ttu-id="23982-147">Zu Beginn der `IServiceCollection` bereitgestellt, um `ConfigureServices` hat die folgenden Dienste definiert (je nach [wie der Host konfiguriert wurde](xref:fundamentals/hosting)):</span><span class="sxs-lookup"><span data-stu-id="23982-147">Initially, the `IServiceCollection` provided to `ConfigureServices` has the following services defined (depending on [how the host was configured](xref:fundamentals/hosting)):</span></span>

| <span data-ttu-id="23982-148">Diensttyp</span><span class="sxs-lookup"><span data-stu-id="23982-148">Service Type</span></span> | <span data-ttu-id="23982-149">Lebensdauer</span><span class="sxs-lookup"><span data-stu-id="23982-149">Lifetime</span></span> |
| ----- | ------- |
| [<span data-ttu-id="23982-150">Microsoft.AspNetCore.Hosting.IHostingEnvironment</span><span class="sxs-lookup"><span data-stu-id="23982-150">Microsoft.AspNetCore.Hosting.IHostingEnvironment</span></span>](https://docs.microsoft.com/aspnet/core/api/microsoft.aspnetcore.hosting.ihostingenvironment) | <span data-ttu-id="23982-151">Singleton</span><span class="sxs-lookup"><span data-stu-id="23982-151">Singleton</span></span> |
| [<span data-ttu-id="23982-152">Microsoft.Extensions.Logging.ILoggerFactory</span><span class="sxs-lookup"><span data-stu-id="23982-152">Microsoft.Extensions.Logging.ILoggerFactory</span></span>](https://docs.microsoft.com/aspnet/core/api/microsoft.extensions.logging.iloggerfactory) | <span data-ttu-id="23982-153">Singleton</span><span class="sxs-lookup"><span data-stu-id="23982-153">Singleton</span></span> |
| [<span data-ttu-id="23982-154">Microsoft.Extensions.Logging.ILogger&lt;T&gt;</span><span class="sxs-lookup"><span data-stu-id="23982-154">Microsoft.Extensions.Logging.ILogger&lt;T&gt;</span></span>](https://docs.microsoft.com/aspnet/core/api/microsoft.extensions.logging.ilogger) | <span data-ttu-id="23982-155">Singleton</span><span class="sxs-lookup"><span data-stu-id="23982-155">Singleton</span></span> |
| [<span data-ttu-id="23982-156">Microsoft.AspNetCore.Hosting.Builder.IApplicationBuilderFactory</span><span class="sxs-lookup"><span data-stu-id="23982-156">Microsoft.AspNetCore.Hosting.Builder.IApplicationBuilderFactory</span></span>](https://docs.microsoft.com/aspnet/core/api/microsoft.aspnetcore.hosting.builder.iapplicationbuilderfactory) | <span data-ttu-id="23982-157">Vorübergehend</span><span class="sxs-lookup"><span data-stu-id="23982-157">Transient</span></span> |
| [<span data-ttu-id="23982-158">Microsoft.AspNetCore.Http.IHttpContextFactory</span><span class="sxs-lookup"><span data-stu-id="23982-158">Microsoft.AspNetCore.Http.IHttpContextFactory</span></span>](https://docs.microsoft.com/aspnet/core/api/microsoft.aspnetcore.http.ihttpcontextfactory) | <span data-ttu-id="23982-159">Vorübergehend</span><span class="sxs-lookup"><span data-stu-id="23982-159">Transient</span></span> |
| [<span data-ttu-id="23982-160">Microsoft.Extensions.Options.IOptions&lt;T&gt;</span><span class="sxs-lookup"><span data-stu-id="23982-160">Microsoft.Extensions.Options.IOptions&lt;T&gt;</span></span>](https://docs.microsoft.com/aspnet/core/api/microsoft.extensions.options.ioptions-1) | <span data-ttu-id="23982-161">Singleton</span><span class="sxs-lookup"><span data-stu-id="23982-161">Singleton</span></span> |
| [<span data-ttu-id="23982-162">System.Diagnostics.DiagnosticSource</span><span class="sxs-lookup"><span data-stu-id="23982-162">System.Diagnostics.DiagnosticSource</span></span>](https://docs.microsoft.com/dotnet/core/api/system.diagnostics.diagnosticsource) | <span data-ttu-id="23982-163">Singleton</span><span class="sxs-lookup"><span data-stu-id="23982-163">Singleton</span></span> |
| [<span data-ttu-id="23982-164">System.Diagnostics.DiagnosticListener</span><span class="sxs-lookup"><span data-stu-id="23982-164">System.Diagnostics.DiagnosticListener</span></span>](https://docs.microsoft.com/dotnet/core/api/system.diagnostics.diagnosticlistener) | <span data-ttu-id="23982-165">Singleton</span><span class="sxs-lookup"><span data-stu-id="23982-165">Singleton</span></span> |
| [<span data-ttu-id="23982-166">Microsoft.AspNetCore.Hosting.IStartupFilter</span><span class="sxs-lookup"><span data-stu-id="23982-166">Microsoft.AspNetCore.Hosting.IStartupFilter</span></span>](https://docs.microsoft.com/aspnet/core/api/microsoft.aspnetcore.hosting.istartupfilter) | <span data-ttu-id="23982-167">Vorübergehend</span><span class="sxs-lookup"><span data-stu-id="23982-167">Transient</span></span> |
| [<span data-ttu-id="23982-168">Microsoft.Extensions.ObjectPool.ObjectPoolProvider</span><span class="sxs-lookup"><span data-stu-id="23982-168">Microsoft.Extensions.ObjectPool.ObjectPoolProvider</span></span>](https://docs.microsoft.com/aspnet/core/api/microsoft.extensions.objectpool.objectpoolprovider) | <span data-ttu-id="23982-169">Singleton</span><span class="sxs-lookup"><span data-stu-id="23982-169">Singleton</span></span> |
| [<span data-ttu-id="23982-170">Microsoft.Extensions.Options.IConfigureOptions&lt;T&gt;</span><span class="sxs-lookup"><span data-stu-id="23982-170">Microsoft.Extensions.Options.IConfigureOptions&lt;T&gt;</span></span>](https://docs.microsoft.com/aspnet/core/api/microsoft.extensions.options.iconfigureoptions-1) | <span data-ttu-id="23982-171">Vorübergehend</span><span class="sxs-lookup"><span data-stu-id="23982-171">Transient</span></span> |
| [<span data-ttu-id="23982-172">Microsoft.AspNetCore.Hosting.Server.IServer</span><span class="sxs-lookup"><span data-stu-id="23982-172">Microsoft.AspNetCore.Hosting.Server.IServer</span></span>](https://docs.microsoft.com/aspnet/core/api/microsoft.aspnetcore.hosting.server.iserver) | <span data-ttu-id="23982-173">Singleton</span><span class="sxs-lookup"><span data-stu-id="23982-173">Singleton</span></span> |
| [<span data-ttu-id="23982-174">Microsoft.AspNetCore.Hosting.IStartup</span><span class="sxs-lookup"><span data-stu-id="23982-174">Microsoft.AspNetCore.Hosting.IStartup</span></span>](https://docs.microsoft.com/aspnet/core/api/microsoft.aspnetcore.hosting.istartup) | <span data-ttu-id="23982-175">Singleton</span><span class="sxs-lookup"><span data-stu-id="23982-175">Singleton</span></span> |
| [<span data-ttu-id="23982-176">Microsoft.AspNetCore.Hosting.IApplicationLifetime</span><span class="sxs-lookup"><span data-stu-id="23982-176">Microsoft.AspNetCore.Hosting.IApplicationLifetime</span></span>](https://docs.microsoft.com/aspnet/core/api/microsoft.aspnetcore.hosting.iapplicationlifetime) | <span data-ttu-id="23982-177">Singleton</span><span class="sxs-lookup"><span data-stu-id="23982-177">Singleton</span></span> |

<span data-ttu-id="23982-178">Im folgenden finden Sie ein Beispiel zum Hinzufügen von zusätzlichen Dienste für den Container über eine Reihe von Erweiterungsmethoden wie `AddDbContext`, `AddIdentity`, und `AddMvc`.</span><span class="sxs-lookup"><span data-stu-id="23982-178">Below is an example of how to add additional services to the container using a number of extension methods like `AddDbContext`, `AddIdentity`, and `AddMvc`.</span></span>

[!code-csharp[Main](../common/samples/WebApplication1/Startup.cs?highlight=5-6,8-10,12&range=39-56)]

<span data-ttu-id="23982-179">Die Funktionen und ASP.NET verwenden, z. B. MVC-Middleware führen Sie eine Konvention für die Verwendung einer einzelnen hinzufügen*ServiceName* Extension-Methode, um alle von dieser Funktion erforderlichen Dienste zu registrieren.</span><span class="sxs-lookup"><span data-stu-id="23982-179">The features and middleware provided by ASP.NET, such as MVC, follow a convention of using a single Add*ServiceName* extension method to register all of the services required by that feature.</span></span>

>[!TIP]
> <span data-ttu-id="23982-180">Sie können anfordern, dass bestimmte Framework bereitgestellten Dienste in `Startup` über ihre Parameterlisten - Methoden finden Sie unter [Anwendungsstart](startup.md) Weitere Details.</span><span class="sxs-lookup"><span data-stu-id="23982-180">You can request certain framework-provided services within `Startup` methods through their parameter lists - see [Application Startup](startup.md) for more details.</span></span>

## <a name="registering-your-own-services"></a><span data-ttu-id="23982-181">Registrieren Ihre eigenen Dienste</span><span class="sxs-lookup"><span data-stu-id="23982-181">Registering Your Own Services</span></span>

<span data-ttu-id="23982-182">Sie können eigene Anwendungsdienste wie folgt registrieren.</span><span class="sxs-lookup"><span data-stu-id="23982-182">You can register your own application services as follows.</span></span> <span data-ttu-id="23982-183">Der erste generischen Typ darstellt, den Typ (in der Regel eine Schnittstelle), der aus dem Container angefordert werden.</span><span class="sxs-lookup"><span data-stu-id="23982-183">The first generic type represents the type (typically an interface) that will be requested from the container.</span></span> <span data-ttu-id="23982-184">Die zweiten generischen Typs darstellt, den konkreten Typ, der vom Container instanziiert und verwendet, um solche Anforderungen erfüllt werden.</span><span class="sxs-lookup"><span data-stu-id="23982-184">The second generic type represents the concrete type that will be instantiated by the container and used to fulfill such requests.</span></span>

[!code-csharp[Main](../common/samples/WebApplication1/Startup.cs?range=53-54)]

> [!NOTE]
> <span data-ttu-id="23982-185">Jede `services.Add<ServiceName>` Erweiterungsmethode Services fügt (und möglicherweise konfiguriert).</span><span class="sxs-lookup"><span data-stu-id="23982-185">Each `services.Add<ServiceName>` extension method adds (and potentially configures) services.</span></span> <span data-ttu-id="23982-186">Beispielsweise `services.AddMvc()` fügt die Dienste MVC erfordert.</span><span class="sxs-lookup"><span data-stu-id="23982-186">For example, `services.AddMvc()` adds the services MVC requires.</span></span> <span data-ttu-id="23982-187">Es wird empfohlen, dass Sie diese Konvention befolgen, platzieren die Erweiterungsmethoden in den `Microsoft.Extensions.DependencyInjection` -Namespace, um Gruppen von Dienst-Registrierungen zu kapseln.</span><span class="sxs-lookup"><span data-stu-id="23982-187">It's recommended that you follow this convention, placing extension methods in the `Microsoft.Extensions.DependencyInjection` namespace, to encapsulate groups of service registrations.</span></span>

<span data-ttu-id="23982-188">Die `AddTransient` Methode wird verwendet, um die konkrete Services abstrakte Typen zuordnen, die separat für jedes Objekt instanziiert, der dies erfordert.</span><span class="sxs-lookup"><span data-stu-id="23982-188">The `AddTransient` method is used to map abstract types to concrete services that are instantiated separately for every object that requires it.</span></span> <span data-ttu-id="23982-189">Dies bezeichnet man des Diensts *Lebensdauer*, und zusätzliche Lebensdauer Optionen sind im folgenden beschrieben.</span><span class="sxs-lookup"><span data-stu-id="23982-189">This is known as the service's *lifetime*, and additional lifetime options are described below.</span></span> <span data-ttu-id="23982-190">Es ist wichtig, eine entsprechende Lebensdauer für jeden der Dienste auszuwählen, die Sie registrieren.</span><span class="sxs-lookup"><span data-stu-id="23982-190">It is important to choose an appropriate lifetime for each of the services you register.</span></span> <span data-ttu-id="23982-191">Sollte eine neue Instanz des Diensts für die einzelnen Klassen werden bereitgestellt, die diese anfordert?</span><span class="sxs-lookup"><span data-stu-id="23982-191">Should a new instance of the service be provided to each class that requests it?</span></span> <span data-ttu-id="23982-192">Eine Instanz in einer bestimmten webanforderung verwendet werden soll?</span><span class="sxs-lookup"><span data-stu-id="23982-192">Should one instance be used throughout a given web request?</span></span> <span data-ttu-id="23982-193">Oder sollte für die Lebensdauer der Anwendung eine einzelne Instanz verwendet werden?</span><span class="sxs-lookup"><span data-stu-id="23982-193">Or should a single instance be used for the lifetime of the application?</span></span>

<span data-ttu-id="23982-194">Im Beispiel für diesen Artikel ein einfachen Controller, der Zeichennamen aufgerufen zeigt besteht `CharactersController`.</span><span class="sxs-lookup"><span data-stu-id="23982-194">In the sample for this article, there is a simple controller that displays character names, called `CharactersController`.</span></span> <span data-ttu-id="23982-195">Die `Index` Methode zeigt die aktuelle Liste von Zeichen, die in der Anwendung gespeichert worden sind, und initialisiert die Auflistung mit einer Reihe von Zeichen, wenn kein Wert vorhanden ist.</span><span class="sxs-lookup"><span data-stu-id="23982-195">Its `Index` method displays the current list of characters that have been stored in the application, and initializes the collection with a handful of characters if none exist.</span></span> <span data-ttu-id="23982-196">Beachten Sie, dass, obwohl diese Anwendung verwendet die Entity Framework Core und die `ApplicationDbContext` Klasse für die Beibehaltung, none, ist offensichtlich, im Controller.</span><span class="sxs-lookup"><span data-stu-id="23982-196">Note that although this application uses Entity Framework Core and the `ApplicationDbContext` class for its persistence, none of that is apparent in the controller.</span></span> <span data-ttu-id="23982-197">Stattdessen wurde die spezifischen Daten Zugriffsmechanismus hinter einer Schnittstelle abstrahiert `ICharacterRepository`, folgt die [Repositorymusters](http://deviq.com/repository-pattern/).</span><span class="sxs-lookup"><span data-stu-id="23982-197">Instead, the specific data access mechanism has been abstracted behind an interface, `ICharacterRepository`, which follows the [repository pattern](http://deviq.com/repository-pattern/).</span></span> <span data-ttu-id="23982-198">Eine Instanz von `ICharacterRepository` angefordert wird, über den Konstruktor und die dann verwendet wird, Zeichen nach Bedarf den Zugriff auf ein privates Feld zugewiesen wird.</span><span class="sxs-lookup"><span data-stu-id="23982-198">An instance of `ICharacterRepository` is requested via the constructor and assigned to a private field, which is then used to access characters as necessary.</span></span>

[!code-csharp[Main](../fundamentals/dependency-injection/sample/DependencyInjectionSample/Controllers/CharactersController.cs?highlight=3,5,6,7,8,14,21-27&range=8-36)]

<span data-ttu-id="23982-199">Die `ICharacterRepository` definiert die zwei Methoden, die der Controller zur Bearbeitung muss `Character` Instanzen.</span><span class="sxs-lookup"><span data-stu-id="23982-199">The `ICharacterRepository` defines the two methods the controller needs to work with `Character` instances.</span></span>

[!code-csharp[Main](../fundamentals/dependency-injection/sample/DependencyInjectionSample/Interfaces/ICharacterRepository.cs?highlight=8,9)]

<span data-ttu-id="23982-200">Diese Schnittstelle wird wiederum von einem konkreten Typ implementiert `CharacterRepository`, d. h. zur Laufzeit verwendet.</span><span class="sxs-lookup"><span data-stu-id="23982-200">This interface is in turn implemented by a concrete type, `CharacterRepository`, that is used at runtime.</span></span>

> [!NOTE]
> <span data-ttu-id="23982-201">Die Möglichkeit DI wird verwendet, mit der `CharacterRepository` Klasse ist ein allgemeines Modell können Sie für alle Anwendungsdienste, nicht nur in "Repositorys" oder Datenzugriffsklassen befolgen.</span><span class="sxs-lookup"><span data-stu-id="23982-201">The way DI is used with the `CharacterRepository` class is a general model you can follow for all of your application services, not just in "repositories" or data access classes.</span></span>

[!code-csharp[Main](../fundamentals/dependency-injection/sample/DependencyInjectionSample/Models/CharacterRepository.cs?highlight=9,11,12,13,14)]

<span data-ttu-id="23982-202">Beachten Sie, dass `CharacterRepository` Anforderungen ein `ApplicationDbContext` in seinem Konstruktor.</span><span class="sxs-lookup"><span data-stu-id="23982-202">Note that `CharacterRepository` requests an `ApplicationDbContext` in its constructor.</span></span> <span data-ttu-id="23982-203">Es ist nicht ungewöhnlich, dass Abhängigkeitsinjektion in einen verketteten Weise wie folgt, mit jeder angeforderte Abhängigkeit, die wiederum anfordern eigene Abhängigkeiten verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="23982-203">It is not unusual for dependency injection to be used in a chained fashion like this, with each requested dependency in turn requesting its own dependencies.</span></span> <span data-ttu-id="23982-204">Der Container ist verantwortlich für alle Abhängigkeiten im Diagramm zu beheben und Zurückgeben des Diensts vollständig aufgelösten.</span><span class="sxs-lookup"><span data-stu-id="23982-204">The container is responsible for resolving all of the dependencies in the graph and returning the fully resolved service.</span></span>

> [!NOTE]
> <span data-ttu-id="23982-205">Erstellen des angeforderten Objekts und aller Objekte, die dafür sowie alle Objekte, die erforderlich ist, wird manchmal als bezeichnet ein *Objektdiagramm*.</span><span class="sxs-lookup"><span data-stu-id="23982-205">Creating the requested object, and all of the objects it requires, and all of the objects those require, is sometimes referred to as an *object graph*.</span></span> <span data-ttu-id="23982-206">Ebenso die Gesamtheit der Abhängigkeiten, die behoben werden müssen ist in der Regel als bezeichnet eine *Abhängigkeitsstruktur* oder *Abhängigkeitsdiagramm*.</span><span class="sxs-lookup"><span data-stu-id="23982-206">Likewise, the collective set of dependencies that must be resolved is typically referred to as a *dependency tree* or *dependency graph*.</span></span>

<span data-ttu-id="23982-207">In diesem Fall beide `ICharacterRepository` und im Gegenzug `ApplicationDbContext` muss registriert werden, mit der Dienstecontainer in `ConfigureServices` in `Startup`.</span><span class="sxs-lookup"><span data-stu-id="23982-207">In this case, both `ICharacterRepository` and in turn `ApplicationDbContext` must be registered with the services container in `ConfigureServices` in `Startup`.</span></span> <span data-ttu-id="23982-208">`ApplicationDbContext`ist mit dem Aufruf der Erweiterungsmethode konfiguriert `AddDbContext<T>`.</span><span class="sxs-lookup"><span data-stu-id="23982-208">`ApplicationDbContext` is configured with the call to the extension method `AddDbContext<T>`.</span></span> <span data-ttu-id="23982-209">Der folgende Code zeigt die Registrierung der `CharacterRepository` Typ.</span><span class="sxs-lookup"><span data-stu-id="23982-209">The following code shows the registration of the `CharacterRepository` type.</span></span>

[!code-csharp[Main](dependency-injection/sample/DependencyInjectionSample/Startup.cs?highlight=3-5,11&range=16-32)]

<span data-ttu-id="23982-210">Entity Framework Kontexten hinzugefügt werden sollen, die Dienste Container über die `Scoped` Lebensdauer.</span><span class="sxs-lookup"><span data-stu-id="23982-210">Entity Framework contexts should be added to the services container using the `Scoped` lifetime.</span></span> <span data-ttu-id="23982-211">Dies wird automatisch durchgeführt, wenn die Hilfemethoden verwenden, wie oben gezeigt.</span><span class="sxs-lookup"><span data-stu-id="23982-211">This is taken care of automatically if you use the helper methods as shown above.</span></span> <span data-ttu-id="23982-212">Repositorys werden, die von Entity Framework nutzen, sollten dieselbe Lebensdauer verwenden.</span><span class="sxs-lookup"><span data-stu-id="23982-212">Repositories that will make use of Entity Framework should use the same lifetime.</span></span>

>[!WARNING]
> <span data-ttu-id="23982-213">Die wichtigsten Gefahr vorsichtig sein behebt ein `Scoped` -Dienst von einem Singleton.</span><span class="sxs-lookup"><span data-stu-id="23982-213">The main danger to be wary of is resolving a `Scoped` service from a singleton.</span></span> <span data-ttu-id="23982-214">Es ist wahrscheinlich in einem solchen Fall, dass der Dienst bei der Verarbeitung der nachfolgender Anforderungen falschen Status aufweist.</span><span class="sxs-lookup"><span data-stu-id="23982-214">It's likely in such a case that the service will have incorrect state when processing subsequent requests.</span></span>

<span data-ttu-id="23982-215">Dienste mit Abhängigkeiten, sollten sie im Container registrieren.</span><span class="sxs-lookup"><span data-stu-id="23982-215">Services that have dependencies should register them in the container.</span></span> <span data-ttu-id="23982-216">Wenn ein Dienst-Konstruktor wie z. B. ein primitiver erfordert eine `string`, dadurch kann eingegeben werden, mithilfe der [Optionen Muster und Konfiguration](configuration.md).</span><span class="sxs-lookup"><span data-stu-id="23982-216">If a service's constructor requires a primitive, such as a `string`, this can be injected by using the [options pattern and configuration](configuration.md).</span></span>

## <a name="service-lifetimes-and-registration-options"></a><span data-ttu-id="23982-217">Dienst-Lebensdauer und Registrierungsoptionen</span><span class="sxs-lookup"><span data-stu-id="23982-217">Service Lifetimes and Registration Options</span></span>

<span data-ttu-id="23982-218">ASP.NET-Dienste können mit den folgenden Lebensdauer konfiguriert werden:</span><span class="sxs-lookup"><span data-stu-id="23982-218">ASP.NET services can be configured with the following lifetimes:</span></span>

<span data-ttu-id="23982-219">**Vorübergehend**</span><span class="sxs-lookup"><span data-stu-id="23982-219">**Transient**</span></span>

<span data-ttu-id="23982-220">Vorübergehender Lebensdauerdienste werden jedes Mal erstellt, die sie angefordert werden.</span><span class="sxs-lookup"><span data-stu-id="23982-220">Transient lifetime services are created each time they are requested.</span></span> <span data-ttu-id="23982-221">Diese Lebensdauer funktioniert am besten geeignet für einfache, zustandslose Dienste.</span><span class="sxs-lookup"><span data-stu-id="23982-221">This lifetime works best for lightweight, stateless services.</span></span>

<span data-ttu-id="23982-222">**Im Bereich**</span><span class="sxs-lookup"><span data-stu-id="23982-222">**Scoped**</span></span>

<span data-ttu-id="23982-223">Bereichsbezogene Lebensdauerdienste werden einmal pro Anforderung erstellt.</span><span class="sxs-lookup"><span data-stu-id="23982-223">Scoped lifetime services are created once per request.</span></span>

<span data-ttu-id="23982-224">**Singleton**</span><span class="sxs-lookup"><span data-stu-id="23982-224">**Singleton**</span></span>

<span data-ttu-id="23982-225">Singleton-Lebensdauerdienste werden beim ersten angefordert werden erstellt (oder wenn `ConfigureServices` ausgeführt wird, wenn Sie angeben, dass es eine Instanz) und verwenden Sie dann jede nachfolgende Anforderung wird dieselbe Instanz.</span><span class="sxs-lookup"><span data-stu-id="23982-225">Singleton lifetime services are created the first time they are requested (or when `ConfigureServices` is run if you specify an instance there) and then every subsequent request will use the same instance.</span></span> <span data-ttu-id="23982-226">Wenn Ihre Anwendung Laufzeitverhalten von Singleton erfordert, wird ermöglicht den Container zum Verwalten der Lebensdauer des Diensts empfohlen, statt Implementieren des Entwurfsmusters Singleton und Objektlebensdauer in der Klasse selbst verwalten.</span><span class="sxs-lookup"><span data-stu-id="23982-226">If your application requires singleton behavior, allowing the services container to manage the service's lifetime is recommended instead of implementing the singleton design pattern and managing your object's lifetime in the class yourself.</span></span>

<span data-ttu-id="23982-227">Dienste können mit dem Container auf verschiedene Arten registriert werden.</span><span class="sxs-lookup"><span data-stu-id="23982-227">Services can be registered with the container in several ways.</span></span> <span data-ttu-id="23982-228">Wir haben bereits gesehen, wie eine dienstimplementierung mit einem angegebenen Typ registrieren, indem der konkrete Typ verwenden.</span><span class="sxs-lookup"><span data-stu-id="23982-228">We have already seen how to register a service implementation with a given type by specifying the concrete type to use.</span></span> <span data-ttu-id="23982-229">Darüber hinaus kann eine Factory angegeben werden, die zum Erstellen der Instanz bei Bedarf verwendet werden soll.</span><span class="sxs-lookup"><span data-stu-id="23982-229">In addition, a factory can be specified, which will then be used to create the instance on demand.</span></span> <span data-ttu-id="23982-230">Der dritte Ansatz darin ist die Instanz des Typs zu verwenden, direkt angeben, in dem Fall Container versucht nie zum Erstellen einer Instanz (noch dispose der Instanz wird).</span><span class="sxs-lookup"><span data-stu-id="23982-230">The third approach is to directly specify the instance of the type to use, in which case the container will never attempt to create an instance (nor will it dispose of the instance).</span></span>

<span data-ttu-id="23982-231">Um den Unterschied zwischen diesen Optionen Lebensdauer und Registrierung zu veranschaulichen, betrachten Sie eine einfache Oberfläche, die eine oder mehrere Aufgaben als darstellt ein *Vorgang* mit einem eindeutigen Bezeichner `OperationId`.</span><span class="sxs-lookup"><span data-stu-id="23982-231">To demonstrate the difference between these lifetime and registration options, consider a simple interface that represents one or more tasks as an *operation* with a unique identifier, `OperationId`.</span></span> <span data-ttu-id="23982-232">Je nachdem, wie wir die Lebensdauer für diesen Dienst konfigurieren gebe der Container die gleichen oder unterschiedliche Instanzen des Diensts, der die anfordernde-Klasse.</span><span class="sxs-lookup"><span data-stu-id="23982-232">Depending on how we configure the lifetime for this service, the container will provide either the same or different instances of the service to the requesting class.</span></span> <span data-ttu-id="23982-233">Um unmissverständlich welche Lebensdauer angefordert wird, erstellen wir einen Typ pro Lifetime-Option:</span><span class="sxs-lookup"><span data-stu-id="23982-233">To make it clear which lifetime is being requested, we will create one type per lifetime option:</span></span>

[!code-csharp[Main](../fundamentals/dependency-injection/sample/DependencyInjectionSample/Interfaces/IOperation.cs?highlight=5-8)]

<span data-ttu-id="23982-234">Wir implementieren diese Schnittstellen, die über eine einzelne Klasse `Operation`, nimmt ein `Guid` in seinem Konstruktor oder verwendet eine neue `Guid` Wenn kein.</span><span class="sxs-lookup"><span data-stu-id="23982-234">We implement these interfaces using a single class, `Operation`, that accepts a `Guid` in its constructor, or uses a new `Guid` if none is provided.</span></span>

<span data-ttu-id="23982-235">Im nächsten Schritt in `ConfigureServices`, jeden Typ des Containers entsprechend benannten Lebensdauer hinzugefügt:</span><span class="sxs-lookup"><span data-stu-id="23982-235">Next, in `ConfigureServices`, each type is added to the container according to its named lifetime:</span></span>

[!code-csharp[Main](dependency-injection/sample/DependencyInjectionSample/Startup.cs?range=26-32)]

<span data-ttu-id="23982-236">Beachten Sie, dass die `IOperationSingletonInstance` Service verwendet eine bestimmte Instanz mit einer bekannten ID `Guid.Empty` so klar sein wird, wenn dieser Typ verwendet wird (eine Guid werden ausschließlich Nullen enthält).</span><span class="sxs-lookup"><span data-stu-id="23982-236">Note that the `IOperationSingletonInstance` service is using a specific instance with a known ID of `Guid.Empty` so it will be clear when this type is in use (its Guid will be all zeroes).</span></span> <span data-ttu-id="23982-237">Wir haben auch registriert eine `OperationService` , abhängig ist, auf jedem der anderen `Operation` Argumenttypen, das, damit er eindeutig innerhalb einer Anforderung kann, ob dieser Dienst die gleiche Instanz wie der Controller oder eine neue, für jeden Vorgangstyp abruft.</span><span class="sxs-lookup"><span data-stu-id="23982-237">We have also registered an `OperationService` that depends on each of the other `Operation` types, so that it will be clear within a request whether this service is getting the same instance as the controller, or a new one, for each operation type.</span></span> <span data-ttu-id="23982-238">Alles, was dieses Diensts wird die abhängigen Elemente als Eigenschaften verfügbar machen, damit sie in der Ansicht angezeigt werden können.</span><span class="sxs-lookup"><span data-stu-id="23982-238">All this service does is expose its dependencies as properties, so they can be displayed in the view.</span></span>

[!code-csharp[Main](dependency-injection/sample/DependencyInjectionSample/Services/OperationService.cs)]

<span data-ttu-id="23982-239">Zur Veranschaulichung der Objektlebensdauer innerhalb und zwischen separaten einzelne Anforderungen an die Anwendung das Beispiel umfasst ein `OperationsController` , die Anforderungen jeder Art von `IOperation` Typ sowie einen `OperationService`.</span><span class="sxs-lookup"><span data-stu-id="23982-239">To demonstrate the object lifetimes within and between separate individual requests to the application, the sample includes an `OperationsController` that requests each kind of `IOperation` type as well as an `OperationService`.</span></span> <span data-ttu-id="23982-240">Die `Index` Aktion werden dann zeigt alle des Controllers und des Diensts `OperationId` Werte.</span><span class="sxs-lookup"><span data-stu-id="23982-240">The `Index` action then displays all of the controller's and service's `OperationId` values.</span></span>

[!code-csharp[Main](dependency-injection/sample/DependencyInjectionSample/Controllers/OperationsController.cs)]

<span data-ttu-id="23982-241">Jetzt sind zwei separate Anforderungen an diese Controlleraktion vorgenommen:</span><span class="sxs-lookup"><span data-stu-id="23982-241">Now two separate requests are made to this controller action:</span></span>

![Die Operations-Ansicht der Dependency Injection-Beispiel-Webanwendung in Microsoft Edge mit der Vorgangs-ID-Werten (GUID) für vorübergehend, ausgelegte, Singleton, Instanz-Controller und Dienstvorgänge Vorgang, bei der ersten Anforderung ausgeführt werden soll.](dependency-injection/_static/lifetimes_request1.png)

![Die Vorgänge anzeigen, in dem die Vorgangs-ID-Werte für eine zweite Anforderung.](dependency-injection/_static/lifetimes_request2.png)

<span data-ttu-id="23982-244">Beachten Sie die von der `OperationId` verändern Sie die Werte in einer Anforderung und zwischen den Anforderungen.</span><span class="sxs-lookup"><span data-stu-id="23982-244">Observe which of the `OperationId` values vary within a request, and between requests.</span></span>

* <span data-ttu-id="23982-245">*Vorübergehender* Objekte sind immer unterschiedliche; eine neue Instanz wird an jedem Controller und jeden Dienst bereitgestellt.</span><span class="sxs-lookup"><span data-stu-id="23982-245">*Transient* objects are always different; a new instance is provided to every controller and every service.</span></span>

* <span data-ttu-id="23982-246">*Im Bereich einer* -Objekte innerhalb einer Anforderung, jedoch nicht für andere Anforderungen identisch sind</span><span class="sxs-lookup"><span data-stu-id="23982-246">*Scoped* objects are the same within a request, but different across different requests</span></span>

* <span data-ttu-id="23982-247">*Singleton* -Objekte für jedes Objekt und jede Anforderung identisch sind (unabhängig davon, ob eine Instanz, im bereitgestellt wird `ConfigureServices`)</span><span class="sxs-lookup"><span data-stu-id="23982-247">*Singleton* objects are the same for every object and every request (regardless of whether an instance is provided in `ConfigureServices`)</span></span>

## <a name="request-services"></a><span data-ttu-id="23982-248">Dienste anfordern</span><span class="sxs-lookup"><span data-stu-id="23982-248">Request Services</span></span>

<span data-ttu-id="23982-249">Fordern Sie die Dienste innerhalb einer ASP.NET-Anwendung zur Verfügung, von `HttpContext` werden verfügbar gemacht, durch die `RequestServices` Auflistung.</span><span class="sxs-lookup"><span data-stu-id="23982-249">The services available within an ASP.NET request from `HttpContext` are exposed through the `RequestServices` collection.</span></span>

![Kontextabhängige HttpContext Anforderung Services Intellisense-Dialogfeld angezeigt, die besagt, dass Anforderung-Dienste Ruft ab oder legt ihn fest, die Zugriff auf die Anforderung Dienstcontainer bietet IServiceProvider.](dependency-injection/_static/request-services.png)

<span data-ttu-id="23982-251">Anforderung Dienste darstellen, die Dienste, die Sie konfigurieren und als Teil Ihrer Anwendung anfordern.</span><span class="sxs-lookup"><span data-stu-id="23982-251">Request Services represent the services you configure and request as part of your application.</span></span> <span data-ttu-id="23982-252">Wenn die Objekte Abhängigkeiten angeben, werden diese Typen in erfüllt `RequestServices`, nicht `ApplicationServices`.</span><span class="sxs-lookup"><span data-stu-id="23982-252">When your objects specify dependencies, these are satisfied by the types found in `RequestServices`, not `ApplicationServices`.</span></span>

<span data-ttu-id="23982-253">Sie sollten nicht im Allgemeinen verwenden diese Eigenschaften direkt, stattdessen den Typen Ihrer Klassen anfordern, die Sie über Ihre-Klassenkonstruktor benötigen ausgehandelt, und lassen das Framework diese Abhängigkeiten einfügen.</span><span class="sxs-lookup"><span data-stu-id="23982-253">Generally, you shouldn't use these properties directly, preferring instead to request the types your classes you require via your class's constructor, and letting the framework inject these dependencies.</span></span> <span data-ttu-id="23982-254">Dadurch wird die Klassen, die leichter zu testen sind (finden Sie unter [Test](../testing/index.md)) und sind lose gekoppelt.</span><span class="sxs-lookup"><span data-stu-id="23982-254">This yields classes that are easier to test (see [Testing](../testing/index.md)) and are more loosely coupled.</span></span>

> [!NOTE]
> <span data-ttu-id="23982-255">Es vorziehen, Anfordern von Abhängigkeiten als Konstruktorparameter für den Zugriff auf die `RequestServices` Auflistung.</span><span class="sxs-lookup"><span data-stu-id="23982-255">Prefer requesting dependencies as constructor parameters to accessing the `RequestServices` collection.</span></span>

## <a name="designing-your-services-for-dependency-injection"></a><span data-ttu-id="23982-256">Entwerfen Ihre Dienste für Zielabhängigkeit</span><span class="sxs-lookup"><span data-stu-id="23982-256">Designing Your Services For Dependency Injection</span></span>

<span data-ttu-id="23982-257">Entwerfen Sie Ihre Dienste Abhängigkeitsinjektion verwenden, um ihre Mitarbeiter zu erhalten.</span><span class="sxs-lookup"><span data-stu-id="23982-257">You should design your services to use dependency injection to get their collaborators.</span></span> <span data-ttu-id="23982-258">Dies bedeutet, dass die Verwendung von zustandsbehafteten statische Methodenaufrufe vermeiden (die in anderen Code genannt führen [Fensterdekorationen](http://deviq.com/static-cling/)) und die direkte Instanziierung von abhängige Klassen in Ihre Dienste.</span><span class="sxs-lookup"><span data-stu-id="23982-258">This means avoiding the use of stateful static method calls (which result in a code smell known as [static cling](http://deviq.com/static-cling/)) and the direct instantiation of dependent classes within your services.</span></span> <span data-ttu-id="23982-259">Es kann nützlich sein, den Ausdruck zu merken [Gerätekontenverzeichnisses neue ist](https://ardalis.com/new-is-glue), bei der Auswahl, ob Sie einen Typ zu instanziieren oder es über die Abhängigkeitsinjektion angefordert werden.</span><span class="sxs-lookup"><span data-stu-id="23982-259">It may help to remember the phrase, [New is Glue](https://ardalis.com/new-is-glue), when choosing whether to instantiate a type or to request it via dependency injection.</span></span> <span data-ttu-id="23982-260">Anhand der [EINFARBIG Prinzipien der Object Oriented Design](http://deviq.com/solid/), Ihren Klassen werden natürlich tendenziell klein, gut ausgearbeitete und einfache Weise getestet werden.</span><span class="sxs-lookup"><span data-stu-id="23982-260">By following the [SOLID Principles of Object Oriented Design](http://deviq.com/solid/), your classes will naturally tend to be small, well-factored, and easily tested.</span></span>

<span data-ttu-id="23982-261">Was geschieht, wenn Sie feststellen, dass Ihre Klassen haben meist Weise zu viele Abhängigkeiten eingefügt wird?</span><span class="sxs-lookup"><span data-stu-id="23982-261">What if you find that your classes tend to have way too many dependencies being injected?</span></span> <span data-ttu-id="23982-262">Dies ist im Allgemeinen ein Zeichen dafür, dass Ihre Klasse versucht, zu viele Vorgänge und wird wahrscheinlich SRP - Verletzung der [Prinzip einzigen Verantwortung](http://deviq.com/single-responsibility-principle/).</span><span class="sxs-lookup"><span data-stu-id="23982-262">This is generally a sign that your class is trying to do too much, and is probably violating SRP - the [Single Responsibility Principle](http://deviq.com/single-responsibility-principle/).</span></span> <span data-ttu-id="23982-263">Angezeigt, wenn Sie die Klasse Umgestalten können, indem Sie einige der entsprechenden Aufgaben in eine neue Klasse verschieben.</span><span class="sxs-lookup"><span data-stu-id="23982-263">See if you can refactor the class by moving some of its responsibilities into a new class.</span></span> <span data-ttu-id="23982-264">Beachten Sie, dass Ihre `Controller` Klassen sollten mit Schwerpunkt auf UI bedenken, damit Unternehmen und Zugriff Implementierungsdetails in Klassen, die diese beibehalten werden soll [trennen Bedenken](http://deviq.com/separation-of-concerns/).</span><span class="sxs-lookup"><span data-stu-id="23982-264">Keep in mind that your `Controller` classes should be focused on UI concerns, so business rules and data access implementation details should be kept in classes appropriate to these [separate concerns](http://deviq.com/separation-of-concerns/).</span></span>

<span data-ttu-id="23982-265">Im Hinblick auf den Datenzugriff insbesondere können Sie Einfügen der `DbContext` in Ihren Domänencontrollern (vorausgesetzt, Sie auf den Dienstecontainer im EF hinzugefügt haben `ConfigureServices`).</span><span class="sxs-lookup"><span data-stu-id="23982-265">With regards to data access specifically, you can inject the `DbContext` into your controllers (assuming you've added EF to the services container in `ConfigureServices`).</span></span> <span data-ttu-id="23982-266">Einige Entwickler eine Repository-Schnittstelle, um die Datenbank verwenden möchten, anstatt Räumen der `DbContext` direkt.</span><span class="sxs-lookup"><span data-stu-id="23982-266">Some developers prefer to use a repository interface to the database rather than injecting the `DbContext` directly.</span></span> <span data-ttu-id="23982-267">Über eine Schnittstelle zum Kapseln von Daten kann Zugriffslogik an einem Ort wie vielen Stellen minimieren, wird geändert, wenn die Datenbank geändert werden müssen.</span><span class="sxs-lookup"><span data-stu-id="23982-267">Using an interface to encapsulate the data access logic in one place can minimize how many places you will have to change when your database changes.</span></span>

### <a name="disposing-of-services"></a><span data-ttu-id="23982-268">Freigeben von Diensten</span><span class="sxs-lookup"><span data-stu-id="23982-268">Disposing of services</span></span>

<span data-ttu-id="23982-269">Ruft der Container `Dispose` für `IDisposable` Typen erstellt.</span><span class="sxs-lookup"><span data-stu-id="23982-269">The container will call `Dispose` for `IDisposable` types it creates.</span></span> <span data-ttu-id="23982-270">Jedoch wenn Sie eine Instanz der Container selbst hinzugefügt haben, wird er nicht gelöscht.</span><span class="sxs-lookup"><span data-stu-id="23982-270">However, if you add an instance to the container yourself, it will not be disposed.</span></span>

<span data-ttu-id="23982-271">Beispiel:</span><span class="sxs-lookup"><span data-stu-id="23982-271">Example:</span></span>

```csharp
// Services implement IDisposable:
public class Service1 : IDisposable {}
public class Service2 : IDisposable {}
public class Service3 : IDisposable {}

public void ConfigureServices(IServiceCollection services)
{
    // container will create the instance(s) of these types and will dispose them
    services.AddScoped<Service1>();
    services.AddSingleton<Service2>();

    // container did not create instance so it will NOT dispose it
    services.AddSingleton<Service3>(new Service3());
    services.AddSingleton(new Service3());
}
```

> [!NOTE]
> <span data-ttu-id="23982-272">In Version 1.0 der Container Dispose für aufgerufen *alle* `IDisposable` Objekte, einschließlich der er erstellt wurde.</span><span class="sxs-lookup"><span data-stu-id="23982-272">In version 1.0, the container called dispose on *all* `IDisposable` objects, including those it did not create.</span></span>

## <a name="replacing-the-default-services-container"></a><span data-ttu-id="23982-273">Ersetzen der Standardcontainer für Dienste</span><span class="sxs-lookup"><span data-stu-id="23982-273">Replacing the default services container</span></span>

<span data-ttu-id="23982-274">Der integrierte Dienstecontainer soll die grundlegenden Anforderungen von Framework und die meisten Consumer-Anwendungen, die darauf aufgebauten dienen.</span><span class="sxs-lookup"><span data-stu-id="23982-274">The built-in services container is meant to serve the basic needs of the framework and most consumer applications built on it.</span></span> <span data-ttu-id="23982-275">Allerdings können Entwickler den integrierten Container durch ihre bevorzugte Container ersetzen.</span><span class="sxs-lookup"><span data-stu-id="23982-275">However, developers can replace the built-in container with their preferred container.</span></span> <span data-ttu-id="23982-276">Die `ConfigureServices` in der Regel Methodenrückgabe `void`, aber wenn die Signatur geändert wird, um zurückzukehren `IServiceProvider`, ein anderen Container konfiguriert und zurückgegeben werden kann.</span><span class="sxs-lookup"><span data-stu-id="23982-276">The `ConfigureServices` method typically returns `void`, but if its signature is changed to return `IServiceProvider`, a different container can be configured and returned.</span></span> <span data-ttu-id="23982-277">Es sind viele IOC-Container für .NET verfügbar.</span><span class="sxs-lookup"><span data-stu-id="23982-277">There are many IOC containers available for .NET.</span></span> <span data-ttu-id="23982-278">In diesem Beispiel wird die [Autofac](https://autofac.org/) Paket verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="23982-278">In this example, the [Autofac](https://autofac.org/) package is used.</span></span>

<span data-ttu-id="23982-279">Installieren Sie zunächst die entsprechenden Container Pakete:</span><span class="sxs-lookup"><span data-stu-id="23982-279">First, install the appropriate container package(s):</span></span>

* `Autofac`
* `Autofac.Extensions.DependencyInjection`

<span data-ttu-id="23982-280">Als Nächstes konfigurieren Sie den Container in `ConfigureServices` und Zurückgeben einer `IServiceProvider`:</span><span class="sxs-lookup"><span data-stu-id="23982-280">Next, configure the container in `ConfigureServices` and return an `IServiceProvider`:</span></span>

```csharp
public IServiceProvider ConfigureServices(IServiceCollection services)
{
    services.AddMvc();
    // Add other framework services

    // Add Autofac
    var containerBuilder = new ContainerBuilder();
    containerBuilder.RegisterModule<DefaultModule>();
    containerBuilder.Populate(services);
    var container = containerBuilder.Build();
    return new AutofacServiceProvider(container);
}
```

> [!NOTE]
> <span data-ttu-id="23982-281">Wenn Sie einen Drittanbieter-DI-Container verwenden, müssen Sie ändern `ConfigureServices` sodass Rückgabe `IServiceProvider` anstelle von `void`.</span><span class="sxs-lookup"><span data-stu-id="23982-281">When using a third-party DI container, you must change `ConfigureServices` so that it returns `IServiceProvider` instead of `void`.</span></span>

<span data-ttu-id="23982-282">Konfigurieren Sie abschließend Autofac wie gewohnt in `DefaultModule`:</span><span class="sxs-lookup"><span data-stu-id="23982-282">Finally, configure Autofac as normal in `DefaultModule`:</span></span>

```csharp
public class DefaultModule : Module
{
    protected override void Load(ContainerBuilder builder)
    {
        builder.RegisterType<CharacterRepository>().As<ICharacterRepository>();
    }
}
```

<span data-ttu-id="23982-283">Zur Laufzeit wird Autofac verwendet werden, zum Auflösen von Typen und zum Einfügen von Abhängigkeiten.</span><span class="sxs-lookup"><span data-stu-id="23982-283">At runtime, Autofac will be used to resolve types and inject dependencies.</span></span> <span data-ttu-id="23982-284">[Weitere Informationen zur Verwendung von Autofac und ASP.NET Core](http://docs.autofac.org/en/latest/integration/aspnetcore.html).</span><span class="sxs-lookup"><span data-stu-id="23982-284">[Learn more about using Autofac and ASP.NET Core](http://docs.autofac.org/en/latest/integration/aspnetcore.html).</span></span>

### <a name="thread-safety"></a><span data-ttu-id="23982-285">Threadsicherheit</span><span class="sxs-lookup"><span data-stu-id="23982-285">Thread safety</span></span>

<span data-ttu-id="23982-286">Singleton-Dienste müssen threadsicher sein.</span><span class="sxs-lookup"><span data-stu-id="23982-286">Singleton services need to be thread safe.</span></span> <span data-ttu-id="23982-287">Wenn ein Singleton-Dienst eine vorübergehende Dienst abhängt, müssen der vorübergehende Dienst möglicherweise auch threadsicher je nachdem, wie diese verwendet werden, indem Sie den Singleton sein.</span><span class="sxs-lookup"><span data-stu-id="23982-287">If a singleton service has a dependency on a transient service, the transient service may also need to be thread safe depending how it’s used by the singleton.</span></span>

## <a name="recommendations"></a><span data-ttu-id="23982-288">Empfehlungen</span><span class="sxs-lookup"><span data-stu-id="23982-288">Recommendations</span></span>

<span data-ttu-id="23982-289">Bei der Arbeit mit Abhängigkeitsinjektion Bedenken Sie die folgenden Empfehlungen:</span><span class="sxs-lookup"><span data-stu-id="23982-289">When working with dependency injection, keep the following recommendations in mind:</span></span>

* <span data-ttu-id="23982-290">DI wird für Objekte, die komplexe Abhängigkeiten aufweisen.</span><span class="sxs-lookup"><span data-stu-id="23982-290">DI is for objects that have complex dependencies.</span></span> <span data-ttu-id="23982-291">Domänencontroller, Dienste, Adapter und Repositorys sind Beispiele für Objekte, die zum DI hinzugefügt werden.</span><span class="sxs-lookup"><span data-stu-id="23982-291">Controllers, services, adapters, and repositories are all examples of objects that might be added to DI.</span></span>

* <span data-ttu-id="23982-292">Vermeiden Sie das Speichern von Daten und Konfigurationsinformationen direkt in DI.</span><span class="sxs-lookup"><span data-stu-id="23982-292">Avoid storing data and configuration directly in DI.</span></span> <span data-ttu-id="23982-293">Beispielsweise darf keine Einkaufswagen eines Benutzers in der Regel auf den Container hinzugefügt werden.</span><span class="sxs-lookup"><span data-stu-id="23982-293">For example, a user's shopping cart shouldn't typically be added to the services container.</span></span> <span data-ttu-id="23982-294">Konfiguration verwenden, sollten die [Optionen Modell](configuration.md#options-config-objects).</span><span class="sxs-lookup"><span data-stu-id="23982-294">Configuration should use the [Options Model](configuration.md#options-config-objects).</span></span> <span data-ttu-id="23982-295">Auf ähnliche Weise vermeiden Sie "Daten Inhaber"-Objekte, die nur für den Zugriff auf ein anderes Objekt vorhanden.</span><span class="sxs-lookup"><span data-stu-id="23982-295">Similarly, avoid "data holder" objects that only exist to allow access to some other object.</span></span> <span data-ttu-id="23982-296">Es ist besser, Anfordern von dem tatsächlichen Element nach Möglichkeit über DI, erforderlich.</span><span class="sxs-lookup"><span data-stu-id="23982-296">It's better to request the actual item needed via DI, if possible.</span></span>

* <span data-ttu-id="23982-297">Vermeiden Sie statische Zugriff auf Dienste.</span><span class="sxs-lookup"><span data-stu-id="23982-297">Avoid static access to services.</span></span>

* <span data-ttu-id="23982-298">Vermeiden Sie die dienstidentifizierung in Ihrem Anwendungscode.</span><span class="sxs-lookup"><span data-stu-id="23982-298">Avoid service location in your application code.</span></span>

* <span data-ttu-id="23982-299">Vermeiden Sie statische Zugriff auf `HttpContext`.</span><span class="sxs-lookup"><span data-stu-id="23982-299">Avoid static access to `HttpContext`.</span></span>

> [!NOTE]
> <span data-ttu-id="23982-300">Wie alle Sätze von Empfehlungen kann es Situationen, in denen ignorieren einer erforderlich ist.</span><span class="sxs-lookup"><span data-stu-id="23982-300">Like all sets of recommendations, you may encounter situations where ignoring one is required.</span></span> <span data-ttu-id="23982-301">Wir haben Ausnahmen selten--größtenteils sehr spezielle Fälle im Framework selbst gefunden werden.</span><span class="sxs-lookup"><span data-stu-id="23982-301">We have found exceptions to be rare -- mostly very special cases within the framework itself.</span></span>

<span data-ttu-id="23982-302">Beachten Sie, dass Dependency Injection-Angriff wird ein *alternative* , Zugriffsmuster statischen/global-Objekt.</span><span class="sxs-lookup"><span data-stu-id="23982-302">Remember, dependency injection is an *alternative* to static/global object access patterns.</span></span> <span data-ttu-id="23982-303">Sie werden nicht kann die Vorzüge des DI Wenn Sie es mit Zugriff auf statische Objekte kombinieren.</span><span class="sxs-lookup"><span data-stu-id="23982-303">You will not be able to realize the benefits of DI if you mix it with static object access.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="23982-304">Zusätzliche Ressourcen</span><span class="sxs-lookup"><span data-stu-id="23982-304">Additional Resources</span></span>

* [<span data-ttu-id="23982-305">Application Startup (Starten von Anwendungen)</span><span class="sxs-lookup"><span data-stu-id="23982-305">Application Startup</span></span>](startup.md)

* [<span data-ttu-id="23982-306">Testen</span><span class="sxs-lookup"><span data-stu-id="23982-306">Testing</span></span>](../testing/index.md)

* [<span data-ttu-id="23982-307">Schreiben von sauberen Code in ASP.NET Core mit Abhängigkeiteneinschleusung (MSDN)</span><span class="sxs-lookup"><span data-stu-id="23982-307">Writing Clean Code in ASP.NET Core with Dependency Injection (MSDN)</span></span>](https://msdn.microsoft.com/magazine/mt703433.aspx)

* [<span data-ttu-id="23982-308">Container-Managed Anwendungsentwurf, Einführung:, In dem Container gehören unterstützt?</span><span class="sxs-lookup"><span data-stu-id="23982-308">Container-Managed Application Design, Prelude: Where does the Container Belong?</span></span>](https://blogs.msdn.microsoft.com/nblumhardt/2008/12/26/container-managed-application-design-prelude-where-does-the-container-belong/)

* [<span data-ttu-id="23982-309">Expliziten Abhängigkeiten Prinzip</span><span class="sxs-lookup"><span data-stu-id="23982-309">Explicit Dependencies Principle</span></span>](http://deviq.com/explicit-dependencies-principle/)

* <span data-ttu-id="23982-310">[Die Umkehrung der Steuerelementcontainer und dem Dependency Injection Muster](https://www.martinfowler.com/articles/injection.html) (Fowler)</span><span class="sxs-lookup"><span data-stu-id="23982-310">[Inversion of Control Containers and the Dependency Injection Pattern](https://www.martinfowler.com/articles/injection.html) (Fowler)</span></span>
