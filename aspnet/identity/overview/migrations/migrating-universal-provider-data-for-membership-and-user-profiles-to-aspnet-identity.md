---
uid: identity/overview/migrations/migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity
title: Migrieren von universellen Anbieterdaten Mitgliedschaft und Benutzerprofilen zu ASP.NET Identity (c#) | Microsoft Docs
author: rustd
description: In diesem Lernprogramm werden die Schritte beschrieben, die erforderlich sind, um Benutzer und Daten der Rolle und erstellt mithilfe einer vorhandenen App Universal Providers Benutzerprofildaten migrieren...
ms.author: aspnetcontent
manager: wpickett
ms.date: 12/13/2013
ms.topic: article
ms.assetid: 2e260430-d13c-4658-bd05-e256fc0d63b8
ms.technology: 
ms.prod: .net-framework
msc.legacyurl: /identity/overview/migrations/migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity
msc.type: authoredcontent
ms.openlocfilehash: e00bcfc111425d5dd26c7ff341eaf87fd969e089
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 11/10/2017
---
<a name="migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity-c"></a><span data-ttu-id="8b3e6-103">Migrieren von universellen Anbieterdaten Mitgliedschaft und Benutzerprofilen zu ASP.NET Identity (c#)</span><span class="sxs-lookup"><span data-stu-id="8b3e6-103">Migrating Universal Provider Data for Membership and User Profiles to ASP.NET Identity (C#)</span></span>
====================
<span data-ttu-id="8b3e6-104">durch [Pranav Rastogi](https://github.com/rustd), [Rick Anderson](https://github.com/Rick-Anderson), [Robert McMurray](https://github.com/rmcmurray), [Suhas Joshi](https://github.com/suhasj)</span><span class="sxs-lookup"><span data-stu-id="8b3e6-104">by [Pranav Rastogi](https://github.com/rustd), [Rick Anderson](https://github.com/Rick-Anderson), [Robert McMurray](https://github.com/rmcmurray), [Suhas Joshi](https://github.com/suhasj)</span></span>

> <span data-ttu-id="8b3e6-105">In diesem Lernprogramm wird beschrieben, die zum Migrieren von Benutzer- und Daten der Rolle und Benutzerprofildaten, die mithilfe von einer vorhandenen Anwendung und das Identitätsmodell ASP.NET Universal Providers erstellt werden.</span><span class="sxs-lookup"><span data-stu-id="8b3e6-105">This tutorial describes the steps that are necessary to migrate user and role data and user profile data created using Universal Providers of an existing application to the ASP.NET Identity model.</span></span> <span data-ttu-id="8b3e6-106">Der Ansatz wird hier genannten, in einer Anwendung mit SQL-Mitgliedschaft sowie Informationen zum Migrieren von Benutzerprofildaten verwendet werden können.</span><span class="sxs-lookup"><span data-stu-id="8b3e6-106">The approach mentioned here to migrate user profile data can be used in an application with SQL membership as well.</span></span>


<span data-ttu-id="8b3e6-107">Mit der Version von Visual Studio 2013, das ASP.NET-Team ein neues ASP.NET Identity-System eingeführt, und erfahren Sie mehr über diese Version [hier](../../index.md).</span><span class="sxs-lookup"><span data-stu-id="8b3e6-107">With the release of Visual Studio 2013, the ASP.NET team introduced a new ASP.NET Identity system, and you can read more about that release [here](../../index.md).</span></span> <span data-ttu-id="8b3e6-108">Befolgen Sie für den Artikel zum Migrieren von Webanwendungen aus [SQL Mitgliedschaft auf die neue Identitätssystem](migrating-an-existing-website-from-sql-membership-to-aspnet-identity.md), in diesem Artikel werden die Schritte zum Migrieren von vorhandener Anwendungen, die das Anbieter-Modell für die Verwaltung von Benutzern und Rollen folgen veranschaulicht. um das neue Identitätsmodell.</span><span class="sxs-lookup"><span data-stu-id="8b3e6-108">Following up on the article to migrate web applications from [SQL Membership to the new Identity system](migrating-an-existing-website-from-sql-membership-to-aspnet-identity.md), this article illustrates the steps to migrate existing applications that follow the Providers model for user and role management to the new Identity model.</span></span> <span data-ttu-id="8b3e6-109">Der Schwerpunkt dieses Lernprogramms werden in erster Linie auf die Migration der Benutzerprofildaten es nahtlos in das neue System zu verknüpfen.</span><span class="sxs-lookup"><span data-stu-id="8b3e6-109">The focus of this tutorial will be primarily on migrating the user profile data to seamlessly hook it into the new system.</span></span> <span data-ttu-id="8b3e6-110">Migrieren von Informationen für Benutzer und Rollen ist für die Mitgliedschaft in SQL vergleichbar.</span><span class="sxs-lookup"><span data-stu-id="8b3e6-110">Migrating user and role information is similar for SQL membership.</span></span> <span data-ttu-id="8b3e6-111">Die Vorgehensweise zum Migrieren von Profildaten gefolgt kann in einer Anwendung mit SQL-Mitgliedschaft sowie verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="8b3e6-111">The approach followed to migrate profile data can be used in an application with SQL membership as well.</span></span>

<span data-ttu-id="8b3e6-112">Als Beispiel wird zunächst mit einer Web-app mit Visual Studio 2012 verwendet das Anbieter-Modell erstellt.</span><span class="sxs-lookup"><span data-stu-id="8b3e6-112">As an example, we will start with a web app created using Visual Studio 2012 which uses the Providers model.</span></span> <span data-ttu-id="8b3e6-113">Wir müssen dann fügen Sie Code für die Verwaltung von Profilen, einen Benutzer registrieren, Profildaten für den Benutzer, migrieren das Datenbankschema und ändern Sie die Anwendung das Identitätssystem für die Verwaltung von Benutzern und Rollen zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="8b3e6-113">We'll then add code for profile management, register a user, add profile data for the users, migrate the database schema, and then change the application to use the Identity system for user and role management.</span></span> <span data-ttu-id="8b3e6-114">Migration zu testen Benutzer erstellt wurden, mithilfe der Universal Providers sollte in der Lage, melden Sie sich, und neue Benutzer sollten in der Lage, zu registrieren.</span><span class="sxs-lookup"><span data-stu-id="8b3e6-114">As a test of migration, users created using Universal Providers should be able to log in and new users should be able to register.</span></span>

> [!NOTE]
> <span data-ttu-id="8b3e6-115">Sie finden das vollständige Beispiel am [https://github.com/suhasj/UniversalProviders-Identity-Migrations](https://github.com/suhasj/UniversalProviders-Identity-Migrations).</span><span class="sxs-lookup"><span data-stu-id="8b3e6-115">You can find the complete sample at [https://github.com/suhasj/UniversalProviders-Identity-Migrations](https://github.com/suhasj/UniversalProviders-Identity-Migrations).</span></span>


## <a name="profile-data-migration-summary"></a><span data-ttu-id="8b3e6-116">Zusammenfassung von Daten-migration</span><span class="sxs-lookup"><span data-stu-id="8b3e6-116">Profile data migration summary</span></span>

<span data-ttu-id="8b3e6-117">Vor dem Beginn der Migration, betrachten Sie wir die Erfahrung des Speicherns von Profildaten im Anbieter-Modell.</span><span class="sxs-lookup"><span data-stu-id="8b3e6-117">Before starting with the migrations, let us look at the experience of storing profile data in the Providers model.</span></span> <span data-ttu-id="8b3e6-118">Profildaten für die Anwendung, die Benutzer auf verschiedene Weise gespeichert werden können, die am häufigsten verwendeten zwischen ihnen wird Verwendung des integrierte Profilanbieter zusammen mit dem Universal Providers geliefert.</span><span class="sxs-lookup"><span data-stu-id="8b3e6-118">Profile data for application users can be stored in multiple ways, the most common among them being using the inbuilt profile providers shipped along with the Universal Providers.</span></span> <span data-ttu-id="8b3e6-119">Die Schritte umfassen würde</span><span class="sxs-lookup"><span data-stu-id="8b3e6-119">The steps would include</span></span>

1. <span data-ttu-id="8b3e6-120">Fügen Sie eine Klasse, die Eigenschaften, die zum Speichern von Profildaten verwendet wurde.</span><span class="sxs-lookup"><span data-stu-id="8b3e6-120">Add a class that has properties used to store Profile data.</span></span>
2. <span data-ttu-id="8b3e6-121">Fügen Sie eine Klasse, die 'ProfileBase' erweitert und implementiert die Methoden zum Abrufen der oben genannten Profildaten für den Benutzer hinzu.</span><span class="sxs-lookup"><span data-stu-id="8b3e6-121">Add a class that extends 'ProfileBase' and implements methods to get the above profile data for the user.</span></span>
3. <span data-ttu-id="8b3e6-122">Die Aktivierung mit Profil Standardanbieter in der *"Web.config"* Datei, und definieren Sie die Klasse, die in Schritt #2 verwendet werden, beim Zugriff auf die Profilinformationen deklariert.</span><span class="sxs-lookup"><span data-stu-id="8b3e6-122">Enable using default profile providers in the *web.config* file and define the class declared in step #2 to be used in accessing profile information.</span></span>

<span data-ttu-id="8b3e6-123">Die Profilinformationen wird als serialisierten XML-Code und die binären Daten in der Tabelle "Profile" in der Datenbank gespeichert.</span><span class="sxs-lookup"><span data-stu-id="8b3e6-123">The profile information is stored as serialized xml and binary data in the 'Profiles' table in the database.</span></span>

<span data-ttu-id="8b3e6-124">Nach der Migration der Anwendung zur Verwendung der neuen ASP.NET Identity-Systems an, die Profilinformationen deserialisiert und als Eigenschaften auf der Klasse gespeichert.</span><span class="sxs-lookup"><span data-stu-id="8b3e6-124">After migrating the application to use the new ASP.NET Identity system, the profile information is deserialized and stored as properties on the user class.</span></span> <span data-ttu-id="8b3e6-125">Jede Eigenschaft können Sie dann auf Spalten in der Benutzertabelle zugeordnet werden.</span><span class="sxs-lookup"><span data-stu-id="8b3e6-125">Each property can then be mapped onto columns in the user table.</span></span> <span data-ttu-id="8b3e6-126">Hat der Vorteil ist, dass die Eigenschaften bearbeitet werden können, direkt in die Klasse in Ergänzung nicht auf die Serialisierung/Deserialisierung der Dateninformationen Zeit bei darauf zugreift.</span><span class="sxs-lookup"><span data-stu-id="8b3e6-126">The advantage here is that the properties can be worked on directly using the user class in addition to not having to serialize/deserialize data information each time when accessing it.</span></span>

## <a name="getting-started"></a><span data-ttu-id="8b3e6-127">Erste Schritte</span><span class="sxs-lookup"><span data-stu-id="8b3e6-127">Getting Started</span></span>

1. <span data-ttu-id="8b3e6-128">Erstellen Sie eine neue ASP.NET 4.5 Web Forms-Anwendung in Visual Studio 2012.</span><span class="sxs-lookup"><span data-stu-id="8b3e6-128">Create a new ASP.NET 4.5 Web Forms application in Visual Studio 2012.</span></span> <span data-ttu-id="8b3e6-129">Im aktuellen Beispiel verwendet die Web Forms-Vorlage, jedoch können Sie MVC-Anwendung auch.</span><span class="sxs-lookup"><span data-stu-id="8b3e6-129">The current sample uses the Web Forms template, but you could use MVC Application as well.</span></span>  
    ![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image1.jpg)
2. <span data-ttu-id="8b3e6-130">Erstellen Sie einen neuen Ordner "Modelle", um Profilinformationen zu speichern.</span><span class="sxs-lookup"><span data-stu-id="8b3e6-130">Create a new folder 'Models' to store profile information</span></span>  
    ![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image1.png)
3. <span data-ttu-id="8b3e6-131">Beispielsweise können wir kein speichern Sie Datum Geburtsdatum, City, Höhe und die Gewichtung des Benutzers im Profil.</span><span class="sxs-lookup"><span data-stu-id="8b3e6-131">As an example, let us store the date of birth, city, height and weight of the user in profile.</span></span> <span data-ttu-id="8b3e6-132">Die Höhe und Breite werden als eine benutzerdefinierte Klasse mit dem Namen "PersonalStats" gespeichert.</span><span class="sxs-lookup"><span data-stu-id="8b3e6-132">The height and weight are stored as a custom class called 'PersonalStats'.</span></span> <span data-ttu-id="8b3e6-133">Zum Speichern und Abrufen des Profils, benötigen wir eine Klasse, die "ProfileBase" Erweitert.</span><span class="sxs-lookup"><span data-stu-id="8b3e6-133">To store and retrieve the profile, we need a class that extends 'ProfileBase'.</span></span> <span data-ttu-id="8b3e6-134">Erstellen wir eine neue Klasse "AppProfile" abgerufen und Profilinformationen zu speichern.</span><span class="sxs-lookup"><span data-stu-id="8b3e6-134">Let's create a new class 'AppProfile' to get and store profile information.</span></span>

    [!code-csharp[Main](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/samples/sample1.cs)]
4. <span data-ttu-id="8b3e6-135">Aktivieren des Profils in der *"Web.config"* Datei.</span><span class="sxs-lookup"><span data-stu-id="8b3e6-135">Enable profile in the *web.config* file.</span></span> <span data-ttu-id="8b3e6-136">Geben Sie den Namen der Klasse, die verwendet werden, um den Store/Abrufen von Benutzerinformationen in Schritt #3 erstellt haben.</span><span class="sxs-lookup"><span data-stu-id="8b3e6-136">Enter the class name to be used to store/retrieve user information created in step #3.</span></span>

    [!code-xml[Main](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/samples/sample2.xml)]
5. <span data-ttu-id="8b3e6-137">Fügen Sie im Ordner "Account", die Profildaten aus der Benutzer abrufen und speichern Sie sie einer Web Forms-Seite hinzu.</span><span class="sxs-lookup"><span data-stu-id="8b3e6-137">Add a web forms page in 'Account' folder to get the profile data from the user and store it.</span></span> <span data-ttu-id="8b3e6-138">Klicken Sie mit der rechten Maustaste auf das Projekt, und wählen Sie "Neues Element hinzufügen".</span><span class="sxs-lookup"><span data-stu-id="8b3e6-138">Right click on project and select 'Add new Item'.</span></span> <span data-ttu-id="8b3e6-139">Fügen Sie eine neue Web Forms-Seite mit Gestaltungsvorlage "AddProfileData.aspx".</span><span class="sxs-lookup"><span data-stu-id="8b3e6-139">Add a new webforms page with master page 'AddProfileData.aspx'.</span></span> <span data-ttu-id="8b3e6-140">Kopieren Sie im Abschnitt "MainContent" Folgendes ein:</span><span class="sxs-lookup"><span data-stu-id="8b3e6-140">Copy the following in the 'MainContent' section:</span></span>

    [!code-html[Main](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/samples/sample3.html)]

 <span data-ttu-id="8b3e6-141">Fügen Sie im Code hinter den folgenden Code hinzu:</span><span class="sxs-lookup"><span data-stu-id="8b3e6-141">Add the following code in the code behind:</span></span>

    [!code-csharp[Main](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/samples/sample4.cs)]

 <span data-ttu-id="8b3e6-142">Fügen Sie den Namespace, die unter der, den appprofile Klasse definiert ist, um Kompilierungsfehler zu entfernen.</span><span class="sxs-lookup"><span data-stu-id="8b3e6-142">Add the namespace under which AppProfile class is defined to remove the compilation errors.</span></span>
6. <span data-ttu-id="8b3e6-143">Führen Sie die app, und erstellen Sie einen neuen Benutzer mit dem Benutzernamen "**Olduser".**</span><span class="sxs-lookup"><span data-stu-id="8b3e6-143">Run the app and create a new user with username '**olduser'.**</span></span> <span data-ttu-id="8b3e6-144">Navigieren Sie zur Seite "AddProfileData", und fügen Sie Profilinformationen für den Benutzer.</span><span class="sxs-lookup"><span data-stu-id="8b3e6-144">Navigate to the 'AddProfileData' page and add profile information for the user.</span></span>  
    ![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image2.png)

<span data-ttu-id="8b3e6-145">Sie können überprüfen, ob die Daten im serialisierten XML-Format in der Tabelle "Profile" mit dem Server-Explorer-Fenster gespeichert werden.</span><span class="sxs-lookup"><span data-stu-id="8b3e6-145">You can verify that the data is stored as serialized xml in the 'Profiles' table using the Server Explorer window.</span></span> <span data-ttu-id="8b3e6-146">Wählen Sie in Visual Studio im Menü "Anzeige", "Server-Explorer" ein.</span><span class="sxs-lookup"><span data-stu-id="8b3e6-146">In Visual Studio, from 'View' menu, choose 'Server Explorer'.</span></span> <span data-ttu-id="8b3e6-147">Muss eine Datenverbindung für die Datenbank definiert, der *"Web.config"* Datei.</span><span class="sxs-lookup"><span data-stu-id="8b3e6-147">There should be a data connection for the database defined in the *web.config* file.</span></span> <span data-ttu-id="8b3e6-148">Durch Klicken auf die Datenverbindung zeigt verschiedene Unterkategorien.</span><span class="sxs-lookup"><span data-stu-id="8b3e6-148">Clicking on the data connection shows different sub categories.</span></span> <span data-ttu-id="8b3e6-149">Erweitern Sie "Tabellen", um die verschiedenen Tabellen in der Datenbank anzeigen und dann klicken Sie mit der rechten Maustaste auf 'Profile' aus, und wählen "Tabellendaten anzeigen", die in der Tabelle Profile gespeicherten Profildaten anzeigen.</span><span class="sxs-lookup"><span data-stu-id="8b3e6-149">Expand 'Tables' to show the different tables in your database, then right click on 'Profiles' and choose 'Show Table Data' to view the profile data stored in the Profiles table.</span></span>

![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image3.png)

![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image4.png)

## <a name="migrating-database-schema"></a><span data-ttu-id="8b3e6-150">Migrieren des Datenbankschemas</span><span class="sxs-lookup"><span data-stu-id="8b3e6-150">Migrating database schema</span></span>

<span data-ttu-id="8b3e6-151">Um die vorhandene Datenbank, die Arbeit mit der Identität des Systems zu machen, müssen Sie das Schema in der Datenbank Identität, um die Felder unterstützt werden, die wir, die ursprüngliche Datenbank hinzugefügt aktualisieren.</span><span class="sxs-lookup"><span data-stu-id="8b3e6-151">To make the existing database work with the Identity system, we need to update the schema in the Identity database to support the fields we added to the original database.</span></span> <span data-ttu-id="8b3e6-152">Dies kann mithilfe von SQL-Skripts zum Erstellen neuer Tabellen, und kopieren Sie die vorhandene Informationen.</span><span class="sxs-lookup"><span data-stu-id="8b3e6-152">This can be done using SQL scripts to create new tables and copy the existing information.</span></span> <span data-ttu-id="8b3e6-153">Erweitern Sie im Fenster "Server-Explorer" "DefaultConnection", um die Tabellen anzuzeigen.</span><span class="sxs-lookup"><span data-stu-id="8b3e6-153">In the 'Server Explorer' window, expand the 'DefaultConnection' to display the tables.</span></span> <span data-ttu-id="8b3e6-154">Klicken Sie mit der rechten Maustaste auf die Tabellen, und wählen Sie "Neue Abfrage"</span><span class="sxs-lookup"><span data-stu-id="8b3e6-154">Right click Tables and select 'New Query'</span></span>

![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image5.png)

<span data-ttu-id="8b3e6-155">Fügen Sie das SQL-Skript aus [https://raw.github.com/suhasj/UniversalProviders-Identity-Migrations/master/Migration.txt](https://raw.github.com/suhasj/UniversalProviders-Identity-Migrations/master/Migration.txt) und führen Sie sie.</span><span class="sxs-lookup"><span data-stu-id="8b3e6-155">Paste the SQL script from [https://raw.github.com/suhasj/UniversalProviders-Identity-Migrations/master/Migration.txt](https://raw.github.com/suhasj/UniversalProviders-Identity-Migrations/master/Migration.txt) and run it.</span></span> <span data-ttu-id="8b3e6-156">Wenn die "DefaultConnection" aktualisiert wird, sehen wir, dass die neuen Tabellen hinzugefügt werden.</span><span class="sxs-lookup"><span data-stu-id="8b3e6-156">If the 'DefaultConnection' is refreshed, we can see that the new tables are added.</span></span> <span data-ttu-id="8b3e6-157">Sie können überprüfen, dass die Daten innerhalb der Tabellen aus, um anzuzeigen, dass die Daten migriert wurden.</span><span class="sxs-lookup"><span data-stu-id="8b3e6-157">You can check the data inside the tables to see that the information has been migrated.</span></span>

![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image6.png)

## <a name="migrating-the-application-to-use-aspnet-identity"></a><span data-ttu-id="8b3e6-158">Migrieren Sie die Anwendung für die Verwendung von ASP.NET Identity</span><span class="sxs-lookup"><span data-stu-id="8b3e6-158">Migrating the application to use ASP.NET Identity</span></span>

1. <span data-ttu-id="8b3e6-159">Installieren Sie die NuGet-Pakete, die für ASP.NET Identity erforderlich sind:</span><span class="sxs-lookup"><span data-stu-id="8b3e6-159">Install the Nuget packages needed for ASP.NET Identity:</span></span>

    - <span data-ttu-id="8b3e6-160">Microsoft.AspNet.Identity.EntityFramework</span><span class="sxs-lookup"><span data-stu-id="8b3e6-160">Microsoft.AspNet.Identity.EntityFramework</span></span>
    - <span data-ttu-id="8b3e6-161">Microsoft.AspNet.Identity.Owin</span><span class="sxs-lookup"><span data-stu-id="8b3e6-161">Microsoft.AspNet.Identity.Owin</span></span>
    - <span data-ttu-id="8b3e6-162">"Microsoft.owin.Host.systemweb"</span><span class="sxs-lookup"><span data-stu-id="8b3e6-162">Microsoft.Owin.Host.SystemWeb</span></span>
    - <span data-ttu-id="8b3e6-163">"Microsoft.owin.Security.Facebook"</span><span class="sxs-lookup"><span data-stu-id="8b3e6-163">Microsoft.Owin.Security.Facebook</span></span>
    - <span data-ttu-id="8b3e6-164">"Microsoft.owin.Security.Google"</span><span class="sxs-lookup"><span data-stu-id="8b3e6-164">Microsoft.Owin.Security.Google</span></span>
    - <span data-ttu-id="8b3e6-165">"Microsoft.owin.Security.MicrosoftAccount"</span><span class="sxs-lookup"><span data-stu-id="8b3e6-165">Microsoft.Owin.Security.MicrosoftAccount</span></span>
    - <span data-ttu-id="8b3e6-166">"Microsoft.owin.Security.Twitter"</span><span class="sxs-lookup"><span data-stu-id="8b3e6-166">Microsoft.Owin.Security.Twitter</span></span>

 <span data-ttu-id="8b3e6-167">Weitere Informationen zum Verwalten von NuGet-Pakete verwendbaren [hier](http://docs.nuget.org/docs/start-here/Managing-NuGet-Packages-Using-The-Dialog)</span><span class="sxs-lookup"><span data-stu-id="8b3e6-167">More information on managing Nuget packages can be found [here](http://docs.nuget.org/docs/start-here/Managing-NuGet-Packages-Using-The-Dialog)</span></span>
2. <span data-ttu-id="8b3e6-168">Zum Arbeiten mit vorhandenen Daten in der Tabelle müssen wir Modellklassen zu erstellen, das die Tabellen zugeordnet und in das Identitätssystem einbinden.</span><span class="sxs-lookup"><span data-stu-id="8b3e6-168">To work with existing data in the table, we need to create model classes which map back to the tables and hook them up in the Identity system.</span></span> <span data-ttu-id="8b3e6-169">Im Rahmen des Vertrags Identität die Modellklassen sollten entweder in der Dll Identity.Core Schnittstellen implementieren oder können erweitern, die vorhandene Implementierung dieser Schnittstellen in Microsoft.AspNet.Identity.EntityFramework verfügbar.</span><span class="sxs-lookup"><span data-stu-id="8b3e6-169">As part of the Identity contract, the model classes should either implement the interfaces defined in the Identity.Core dll or can extend the existing implementation of these interfaces available in Microsoft.AspNet.Identity.EntityFramework.</span></span> <span data-ttu-id="8b3e6-170">Wir wird die vorhandenen Klassen für Rollen, Benutzernamen und Benutzeransprüche verwenden.</span><span class="sxs-lookup"><span data-stu-id="8b3e6-170">We will be using the existing classes for role, user logins and user claims.</span></span> <span data-ttu-id="8b3e6-171">Wir müssen einen eigenen Benutzer für das Beispiel zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="8b3e6-171">We need to use a custom user for our sample.</span></span> <span data-ttu-id="8b3e6-172">Klicken Sie mit der rechten Maustaste auf das Projekt, und erstellen Sie neue Ordner "IdentityModels".</span><span class="sxs-lookup"><span data-stu-id="8b3e6-172">Right click on the project and create new folder 'IdentityModels'.</span></span> <span data-ttu-id="8b3e6-173">Fügen Sie eine neue 'User'-Klasse hinzu, wie unten dargestellt:</span><span class="sxs-lookup"><span data-stu-id="8b3e6-173">Add a new 'User' class as shown below:</span></span>

    [!code-csharp[Main](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/samples/sample5.cs)]

 <span data-ttu-id="8b3e6-174">Beachten Sie, dass die "ProfileInfo" jetzt eine Eigenschaft für die Klasse ist.</span><span class="sxs-lookup"><span data-stu-id="8b3e6-174">Notice that the 'ProfileInfo' is now a property on the user class.</span></span> <span data-ttu-id="8b3e6-175">Daher können wir die Klasse verwenden, direkt mit Profildaten arbeiten.</span><span class="sxs-lookup"><span data-stu-id="8b3e6-175">Hence we can use the user class to directly work with profile data.</span></span>

<span data-ttu-id="8b3e6-176">Kopieren Sie die Dateien in den **IdentityModels** und **IdentityAccount** Ordner aus der Downloadquelle ( [https://github.com/suhasj/UniversalProviders-Identity-Migrations/tree/master/ UniversalProviders-Identity-Migrations](https://github.com/suhasj/UniversalProviders-Identity-Migrations/tree/master/UniversalProviders-Identity-Migrations) ).</span><span class="sxs-lookup"><span data-stu-id="8b3e6-176">Copy the files in the **IdentityModels** and **IdentityAccount** folders from the download source ( [https://github.com/suhasj/UniversalProviders-Identity-Migrations/tree/master/UniversalProviders-Identity-Migrations](https://github.com/suhasj/UniversalProviders-Identity-Migrations/tree/master/UniversalProviders-Identity-Migrations) ).</span></span> <span data-ttu-id="8b3e6-177">Sie verfügen über die verbleibenden Modellklassen und die neue Seiten, die für Benutzer- und Rollenverwaltung mithilfe der ASP.NET Identity-APIs benötigt.</span><span class="sxs-lookup"><span data-stu-id="8b3e6-177">These have the remaining model classes and the new pages needed for user and role management using the ASP.NET Identity APIs.</span></span> <span data-ttu-id="8b3e6-178">Ansatz wird die Mitgliedschaft in SQL ähnelt und finden Sie ausführliche erläuterungen [hier](migrating-an-existing-website-from-sql-membership-to-aspnet-identity.md).</span><span class="sxs-lookup"><span data-stu-id="8b3e6-178">The approach used is similar to the SQL Membership and the detailed explanation can be found [here](migrating-an-existing-website-from-sql-membership-to-aspnet-identity.md).</span></span>

## <a name="copying-profile-data-to-the-new-tables"></a><span data-ttu-id="8b3e6-179">Kopieren den neuen Tabellen Profildaten</span><span class="sxs-lookup"><span data-stu-id="8b3e6-179">Copying Profile data to the new tables</span></span>

<span data-ttu-id="8b3e6-180">Wie bereits erwähnt, müssen wir deserialisieren Sie die XML-Daten in den Tabellen Profile, und speichern Sie sie in den Spalten der Tabelle AspNetUsers.</span><span class="sxs-lookup"><span data-stu-id="8b3e6-180">As mentioned earlier, we need to deserialize the xml data in the Profiles tables and store it in the columns of the AspNetUsers table.</span></span> <span data-ttu-id="8b3e6-181">Die neuen Spalten wurden in der Tabelle "Benutzer" im vorherigen Schritt erstellt, also noch die Spalten mit den erforderlichen Daten zu füllen.</span><span class="sxs-lookup"><span data-stu-id="8b3e6-181">The new columns were created in the users table in the previous step so all that is left is to populate those columns with the necessary data.</span></span> <span data-ttu-id="8b3e6-182">Zu diesem Zweck verwenden wir eine Konsolenanwendung das einmal ausgeführt wird, um die neu erstellten Spalten in der Benutzertabelle aufzufüllen.</span><span class="sxs-lookup"><span data-stu-id="8b3e6-182">To do this, we will use a console application which is run once to populate the newly created columns in the users table.</span></span>

1. <span data-ttu-id="8b3e6-183">Erstellen Sie eine neue Konsolenanwendung in der vorhandenen Projektmappe ein.</span><span class="sxs-lookup"><span data-stu-id="8b3e6-183">Create a new console application in the exiting solution.</span></span>  
    ![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image2.jpg)
2. <span data-ttu-id="8b3e6-184">Installieren Sie die neueste Version des Entity Framework-Pakets.</span><span class="sxs-lookup"><span data-stu-id="8b3e6-184">Install the latest version of the Entity Framework package.</span></span>
3. <span data-ttu-id="8b3e6-185">Fügen Sie die Webanwendung, die als Verweis auf die Konsolenanwendung zuvor erstellte hinzu.</span><span class="sxs-lookup"><span data-stu-id="8b3e6-185">Add the web application created above as a reference to the console application.</span></span> <span data-ttu-id="8b3e6-186">Klicken Sie hierzu mit der rechten Maustaste auf Projekt, und klicken Sie dann "Verweis hinzufügen", klicken Sie dann die Projektmappe, klicken Sie auf das Projekt, und klicken Sie auf OK.</span><span class="sxs-lookup"><span data-stu-id="8b3e6-186">To do this right click on Project, then 'Add References', then Solution, then click on the project and click OK.</span></span>
4. <span data-ttu-id="8b3e6-187">Kopieren der folgenden Code in der Datei "Program.cs"-Klasse.</span><span class="sxs-lookup"><span data-stu-id="8b3e6-187">Copy the below code in the Program.cs class.</span></span> <span data-ttu-id="8b3e6-188">Diese Logik liest Profildaten für jeden Benutzer, als "ProfileInfo"-Objekt serialisiert und speichert es wieder in der Datenbank.</span><span class="sxs-lookup"><span data-stu-id="8b3e6-188">This logic reads profile data for each user, serializes it as 'ProfileInfo' object and stores it back to the database.</span></span>

    [!code-csharp[Main](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/samples/sample6.cs)]

 <span data-ttu-id="8b3e6-189">Einige Modelle verwendet werden, damit Sie die entsprechende Namespaces gehören müssen im Ordner "IdentityModels" "" das Webanwendungsprojekt definiert.</span><span class="sxs-lookup"><span data-stu-id="8b3e6-189">Some of the models used are defined in the 'IdentityModels' folder of the web application project, so you must include the corresponding namespaces.</span></span>
5. <span data-ttu-id="8b3e6-190">Der obige Code funktioniert auf die Datenbankdatei in der App\_Datenordner der das Webanwendungsprojekt, die in den vorherigen Schritten erstellt haben.</span><span class="sxs-lookup"><span data-stu-id="8b3e6-190">The above code works on the database file in the App\_Data folder of the web application project created in the previous steps.</span></span> <span data-ttu-id="8b3e6-191">Aktualisieren Sie die Verbindungszeichenfolge in der Datei "App.config" der Konsolenanwendung, die auf verweisen möchten, mit der Verbindungszeichenfolge in der Datei "Web.config" der Webanwendung.</span><span class="sxs-lookup"><span data-stu-id="8b3e6-191">To reference that, update the connection string in the app.config file of the console application with the connection string in the web.config of the web application.</span></span> <span data-ttu-id="8b3e6-192">Geben Sie auch den vollständigen physischen Pfad in der Eigenschaft "AttachDbFilename" ein.</span><span class="sxs-lookup"><span data-stu-id="8b3e6-192">Also provide the complete physical path in the 'AttachDbFilename' property.</span></span>
6. <span data-ttu-id="8b3e6-193">Öffnen Sie ein Eingabeaufforderungsfenster, und navigieren Sie zu dem Ordner "Bin", der oben genannten Konsolenanwendung.</span><span class="sxs-lookup"><span data-stu-id="8b3e6-193">Open a command prompt and navigate to the bin folder of the above console application.</span></span> <span data-ttu-id="8b3e6-194">Führen Sie die ausführbare Datei, und überprüfen Sie die Ausgabe des Protokolls, wie in der folgenden Abbildung dargestellt.</span><span class="sxs-lookup"><span data-stu-id="8b3e6-194">Run the executable and review the log output as shown in the following image.</span></span>  
    ![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image3.jpg)
7. <span data-ttu-id="8b3e6-195">Öffnen Sie die Tabelle "AspNetUsers" im Server-Explorer, und überprüfen Sie die Daten in die neuen Spalten, die die Eigenschaften enthalten.</span><span class="sxs-lookup"><span data-stu-id="8b3e6-195">Open the 'AspNetUsers' table in the Server Explorer and verify the data in the new columns that hold the properties.</span></span> <span data-ttu-id="8b3e6-196">Sie sollten mit den entsprechenden Eigenschaftswerte aktualisiert werden.</span><span class="sxs-lookup"><span data-stu-id="8b3e6-196">They should be updated with the corresponding property values.</span></span>

## <a name="verify-functionality"></a><span data-ttu-id="8b3e6-197">Überprüfen Sie die Funktionalität</span><span class="sxs-lookup"><span data-stu-id="8b3e6-197">Verify functionality</span></span>

<span data-ttu-id="8b3e6-198">Verwenden Sie die neu hinzugefügte Mitgliedschaftsseiten, die mithilfe von ASP.NET Identity bei der Anmeldung eines Benutzers von der alten Datenbank implementiert werden.</span><span class="sxs-lookup"><span data-stu-id="8b3e6-198">Use the newly added membership pages that are implemented using ASP.NET Identity to login a user from the old database.</span></span> <span data-ttu-id="8b3e6-199">Der Benutzer sollte mit den gleichen Anmeldeinformationen anmelden können.</span><span class="sxs-lookup"><span data-stu-id="8b3e6-199">The user should be able to log in using the same credentials.</span></span> <span data-ttu-id="8b3e6-200">Hinzufügen von Benutzern zu Rollen usw. andere Funktionen wie das Hinzufügen von OAuth, erstellen einen neuen Benutzer, das Ändern des Kennworts, Hinzufügen von Rollen, versuchen Sie es.</span><span class="sxs-lookup"><span data-stu-id="8b3e6-200">Try the other functionalities like adding OAuth, creating a new user, changing a password, adding roles, add users to roles, etc.</span></span>

<span data-ttu-id="8b3e6-201">Die Profildaten für den alten Benutzer sowie die neuen Benutzer sollten abgerufen und in der Benutzertabelle gespeichert werden.</span><span class="sxs-lookup"><span data-stu-id="8b3e6-201">The Profile data for the old user and the new users should be retrieved and stored in the users table.</span></span> <span data-ttu-id="8b3e6-202">Die alte Tabelle sollte nicht mehr verwiesen werden.</span><span class="sxs-lookup"><span data-stu-id="8b3e6-202">The old table should no longer be referenced.</span></span>

## <a name="conclusion"></a><span data-ttu-id="8b3e6-203">Schlussfolgerung</span><span class="sxs-lookup"><span data-stu-id="8b3e6-203">Conclusion</span></span>

<span data-ttu-id="8b3e6-204">Im Artikel beschrieben, wie Migrieren von Webanwendungen, die das Anbietermodell für die Mitgliedschaft in ASP.NET Identity verwendet.</span><span class="sxs-lookup"><span data-stu-id="8b3e6-204">The article described the process of migrating web applications that used the provider model for membership to ASP.NET Identity.</span></span> <span data-ttu-id="8b3e6-205">Im Artikel beschriebenen darüber Migrieren von Profildaten für Benutzer in das Identitätssystem eingebunden werden soll.</span><span class="sxs-lookup"><span data-stu-id="8b3e6-205">The article additionally outlined migrating profile data for users to be hooked into the Identity system.</span></span> <span data-ttu-id="8b3e6-206">Lassen Sie Kommentare unten für Fragen und Probleme bei der Migration Ihrer app.</span><span class="sxs-lookup"><span data-stu-id="8b3e6-206">Please leave comments below for questions and issues encountered when you migrate your app.</span></span>

<span data-ttu-id="8b3e6-207">*Unser Dank gilt Rick Anderson und Robert McMurray zum Überprüfen des Artikels.*</span><span class="sxs-lookup"><span data-stu-id="8b3e6-207">*Thanks to Rick Anderson and Robert McMurray for reviewing the article.*</span></span>
