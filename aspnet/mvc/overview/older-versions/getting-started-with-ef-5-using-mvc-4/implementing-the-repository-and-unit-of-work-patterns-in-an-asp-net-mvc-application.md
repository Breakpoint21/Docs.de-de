---
uid: mvc/overview/older-versions/getting-started-with-ef-5-using-mvc-4/implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application
title: Implementieren das Repository und die Einheit der Arbeit Muster in einer ASP.NET MVC-Anwendung (9 von 10) | Microsoft Docs
author: tdykstra
description: Die Contoso-University Beispielwebanwendung veranschaulicht, wie ASP.NET MVC 4-Anwendungen, die mit dem Entity Framework 5 Code First und Visual Studio erstellen...
ms.author: aspnetcontent
manager: wpickett
ms.date: 07/30/2013
ms.topic: article
ms.assetid: 44761193-04ba-4990-9f90-145d3c10a716
ms.technology: dotnet-mvc
ms.prod: .net-framework
msc.legacyurl: /mvc/overview/older-versions/getting-started-with-ef-5-using-mvc-4/implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application
msc.type: authoredcontent
ms.openlocfilehash: 1f870b61658686769304a7809bde62e66da3bd0c
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 04/06/2018
---
<a name="implementing-the-repository-and-unit-of-work-patterns-in-an-aspnet-mvc-application-9-of-10"></a><span data-ttu-id="6e525-103">Implementieren das Repository und die Einheit der Arbeit Muster in einer ASP.NET MVC-Anwendung (9 von 10)</span><span class="sxs-lookup"><span data-stu-id="6e525-103">Implementing the Repository and Unit of Work Patterns in an ASP.NET MVC Application (9 of 10)</span></span>
====================
<span data-ttu-id="6e525-104">durch [Tom Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="6e525-104">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

[<span data-ttu-id="6e525-105">Herunterladen des abgeschlossenen Projekts</span><span class="sxs-lookup"><span data-stu-id="6e525-105">Download Completed Project</span></span>](http://code.msdn.microsoft.com/Getting-Started-with-dd0e2ed8)

> <span data-ttu-id="6e525-106">Die Contoso-University Beispielwebanwendung veranschaulicht, wie ASP.NET MVC 4-Anwendungen, die mit dem Entity Framework 5 Code First und Visual Studio 2012.</span><span class="sxs-lookup"><span data-stu-id="6e525-106">The Contoso University sample web application demonstrates how to create ASP.NET MVC 4 applications using the Entity Framework 5 Code First and Visual Studio 2012.</span></span> <span data-ttu-id="6e525-107">Informationen zu dieser Tutorialreihe finden Sie im [ersten Tutorial der Reihe](creating-an-entity-framework-data-model-for-an-asp-net-mvc-application.md).</span><span class="sxs-lookup"><span data-stu-id="6e525-107">For information about the tutorial series, see [the first tutorial in the series](creating-an-entity-framework-data-model-for-an-asp-net-mvc-application.md).</span></span> <span data-ttu-id="6e525-108">Sie können die Reihe von Lernprogrammen vom Anfang starten oder [Herunterladen eines Startprojekts für dieses Kapitel](building-the-ef5-mvc4-chapter-downloads.md) und beginnen Sie hier.</span><span class="sxs-lookup"><span data-stu-id="6e525-108">You can start the tutorial series from the beginning or [download a starter project for this chapter](building-the-ef5-mvc4-chapter-downloads.md) and start here.</span></span>
> 
> > [!NOTE] 
> > 
> > <span data-ttu-id="6e525-109">Wenn ein Problem Sie können nicht aufgelöst auftreten, [herunterladen im Kapitel über das abgeschlossene](building-the-ef5-mvc4-chapter-downloads.md) und versuchen Sie, das Problem zu reproduzieren.</span><span class="sxs-lookup"><span data-stu-id="6e525-109">If you run into a problem you can't resolve, [download the completed chapter](building-the-ef5-mvc4-chapter-downloads.md) and try to reproduce your problem.</span></span> <span data-ttu-id="6e525-110">Die Lösung des Problems finden in der Regel durch Vergleich des Codes den fertigen Code.</span><span class="sxs-lookup"><span data-stu-id="6e525-110">You can generally find the solution to the problem by comparing your code to the completed code.</span></span> <span data-ttu-id="6e525-111">Einige häufige Fehler und deren Lösung finden Sie unter [Fehler und Problemumgehungen.](advanced-entity-framework-scenarios-for-an-mvc-web-application.md#errors)</span><span class="sxs-lookup"><span data-stu-id="6e525-111">For some common errors and how to solve them, see [Errors and Workarounds.](advanced-entity-framework-scenarios-for-an-mvc-web-application.md#errors)</span></span>


<span data-ttu-id="6e525-112">Im vorherigen Lernprogramm verwenden Vererbung, reduzieren Sie redundanten Code in der `Student` und `Instructor` Entitätsklassen.</span><span class="sxs-lookup"><span data-stu-id="6e525-112">In the previous tutorial you used inheritance to reduce redundant code in the `Student` and `Instructor` entity classes.</span></span> <span data-ttu-id="6e525-113">In diesem Lernprogramm sehen Sie einige Möglichkeiten, um das Repository und die Einheit der Arbeit Muster für CRUD-Vorgänge verwenden.</span><span class="sxs-lookup"><span data-stu-id="6e525-113">In this tutorial you'll see some ways to use the repository and unit of work patterns for CRUD operations.</span></span> <span data-ttu-id="6e525-114">Wie das vorherige Lernprogramm in diesem ändern wie Sie der Code mit Seiten funktioniert Sie bereits erstellt und nicht als neue Seiten erstellen.</span><span class="sxs-lookup"><span data-stu-id="6e525-114">As in the previous tutorial, in this one you'll change the way your code works with pages you already created rather than creating new pages.</span></span>

## <a name="the-repository-and-unit-of-work-patterns"></a><span data-ttu-id="6e525-115">Das Repository und die Einheit der Arbeit-Muster</span><span class="sxs-lookup"><span data-stu-id="6e525-115">The Repository and Unit of Work Patterns</span></span>

<span data-ttu-id="6e525-116">Das Repository und die Einheit der Arbeit Muster, soll eine Abstraktionsebene zwischen der Datenzugriffsebene und den Geschäftslogikschicht einer Anwendung zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="6e525-116">The repository and unit of work patterns are intended to create an abstraction layer between the data access layer and the business logic layer of an application.</span></span> <span data-ttu-id="6e525-117">Die Implementierung dieser Muster unterstützt die Isolation Ihrer Anwendung vor Änderungen im Datenspeicher und kann automatisierte Komponententests oder eine testgesteuerte Entwicklung (Test-Driven Development, TDD) erleichtern.</span><span class="sxs-lookup"><span data-stu-id="6e525-117">Implementing these patterns can help insulate your application from changes in the data store and can facilitate automated unit testing or test-driven development (TDD).</span></span>

<span data-ttu-id="6e525-118">In diesem Lernprogramm implementieren Sie eine Repository-Klasse für jeden Entitätstyp.</span><span class="sxs-lookup"><span data-stu-id="6e525-118">In this tutorial you'll implement a repository class for each entity type.</span></span> <span data-ttu-id="6e525-119">Für die `Student` Entitätstyp erstellen Sie ein Repository-Schnittstelle und eine Repository-Klasse.</span><span class="sxs-lookup"><span data-stu-id="6e525-119">For the `Student` entity type you'll create a repository interface and a repository class.</span></span> <span data-ttu-id="6e525-120">Wenn Sie das Repository in Ihr Controller instanziieren, verwenden Sie die Schnittstelle, damit der Controller einen Verweis auf ein Objekt akzeptiert, der Repository-Schnittstelle implementiert.</span><span class="sxs-lookup"><span data-stu-id="6e525-120">When you instantiate the repository in your controller, you'll use the interface so that the controller will accept a reference to any object that implements the repository interface.</span></span> <span data-ttu-id="6e525-121">Wenn der Controller unter einer Webserver ausgeführt wird, erhält sie ein Repository, das mit dem Entity Framework zusammenarbeitet.</span><span class="sxs-lookup"><span data-stu-id="6e525-121">When the controller runs under a web server, it receives a repository that works with the Entity Framework.</span></span> <span data-ttu-id="6e525-122">Wenn der Controller unter einer Testklasse Einheit ausgeführt wird, erhält sie ein Repository, das zusammen mit Daten in einer Weise, die Sie, zum Testen bearbeiten können, wie z. B. eine Auflistung im Arbeitsspeicher gespeichert.</span><span class="sxs-lookup"><span data-stu-id="6e525-122">When the controller runs under a unit test class, it receives a repository that works with data stored in a way that you can easily manipulate for testing, such as an in-memory collection.</span></span>

<span data-ttu-id="6e525-123">Später in diesem Lernprogramm verwenden Sie mehrere Repositorys und eine Einheit der Arbeit-Klasse für die `Course` und `Department` Entität Typen in den `Course` Controller.</span><span class="sxs-lookup"><span data-stu-id="6e525-123">Later in the tutorial you'll use multiple repositories and a unit of work class for the `Course` and `Department` entity types in the `Course` controller.</span></span> <span data-ttu-id="6e525-124">Die Einheit der Arbeit Klasse koordiniert die Arbeit von mehreren Repositorys durch das Erstellen einer einzelnen Datenbank Context-Klasse, die von allen von ihnen freigegebenen.</span><span class="sxs-lookup"><span data-stu-id="6e525-124">The unit of work class coordinates the work of multiple repositories by creating a single database context class shared by all of them.</span></span> <span data-ttu-id="6e525-125">Falls gewünscht, um automatisierte Komponententests ausführen kann, würde Sie erstellen und für diese Klassen Schnittstellen verwenden, auf die gleiche Weise, die Sie ausgeführt, für haben die `Student` Repository.</span><span class="sxs-lookup"><span data-stu-id="6e525-125">If you wanted to be able to perform automated unit testing, you'd create and use interfaces for these classes in the same way you did for the `Student` repository.</span></span> <span data-ttu-id="6e525-126">Um das Lernprogramm einfach zu halten, müssen Sie jedoch erstellen und verwenden Sie diese Klassen ohne Schnittstellen.</span><span class="sxs-lookup"><span data-stu-id="6e525-126">However, to keep the tutorial simple, you'll create and use these classes without interfaces.</span></span>

<span data-ttu-id="6e525-127">Die folgende Abbildung zeigt eine Möglichkeit, die Beziehungen zwischen dem Controller und Kontextklassen, die im Vergleich zu nicht mit dem Repository oder die Einheit der Arbeit Muster überhaupt beschrieben vorzustellen.</span><span class="sxs-lookup"><span data-stu-id="6e525-127">The following illustration shows one way to conceptualize the relationships between the controller and context classes compared to not using the repository or unit of work pattern at all.</span></span>

![Repository_pattern_diagram](https://asp.net/media/2578149/Windows-Live-Writer_8c4963ba1fa3_CE3B_Repository_pattern_diagram_1df790d3-bdf2-4c11-9098-946ddd9cd884.png)

<span data-ttu-id="6e525-129">Sie wird nicht in diesem Lernprogramm Reihe Komponententests erstellen.</span><span class="sxs-lookup"><span data-stu-id="6e525-129">You won't create unit tests in this tutorial series.</span></span> <span data-ttu-id="6e525-130">Eine Einführung in die testgesteuerte Entwicklung mit einer MVC-Anwendung, des Repositorymusters verwendet, werden soll, finden Sie unter [Exemplarische Vorgehensweise: Verwenden von TDD mit ASP.NET MVC](https://msdn.microsoft.com/library/ff847525.aspx).</span><span class="sxs-lookup"><span data-stu-id="6e525-130">For an introduction to TDD with an MVC application that uses the repository pattern, see [Walkthrough: Using TDD with ASP.NET MVC](https://msdn.microsoft.com/library/ff847525.aspx).</span></span> <span data-ttu-id="6e525-131">Weitere Informationen über das Repositorymuster finden Sie unter den folgenden Ressourcen:</span><span class="sxs-lookup"><span data-stu-id="6e525-131">For more information about the repository pattern, see the following resources:</span></span>

- <span data-ttu-id="6e525-132">[Das Repositorymuster](https://msdn.microsoft.com/library/ff649690.aspx) auf MSDN.</span><span class="sxs-lookup"><span data-stu-id="6e525-132">[The Repository Pattern](https://msdn.microsoft.com/library/ff649690.aspx) on MSDN.</span></span>
- <span data-ttu-id="6e525-133">[Entity Framework 4.0-Repository und Unit of Work Muster mit](https://blogs.msdn.com/b/adonet/archive/2009/06/16/using-repository-and-unit-of-work-patterns-with-entity-framework-4-0.aspx) im Entity Framework-Team-Blog.</span><span class="sxs-lookup"><span data-stu-id="6e525-133">[Using Repository and Unit of Work patterns with Entity Framework 4.0](https://blogs.msdn.com/b/adonet/archive/2009/06/16/using-repository-and-unit-of-work-patterns-with-entity-framework-4-0.aspx) on the Entity Framework team blog.</span></span>
- <span data-ttu-id="6e525-134">[Agile Entity Framework 4-Repository](http://thedatafarm.com/blog/data-access/agile-entity-framework-4-repository-part-1-model-and-poco-classes/) Reihe von Beiträge zu Julie Lerman Blog.</span><span class="sxs-lookup"><span data-stu-id="6e525-134">[Agile Entity Framework 4 Repository](http://thedatafarm.com/blog/data-access/agile-entity-framework-4-repository-part-1-model-and-poco-classes/) series of posts on Julie Lerman's blog.</span></span>
- <span data-ttu-id="6e525-135">[Erstellen das Konto auf einen Blick HTML5/jQuery-Anwendung](https://weblogs.asp.net/dwahlin/archive/2011/08/15/building-the-account-at-a-glance-html5-jquery-application.aspx) Dan Wahlin Blog.</span><span class="sxs-lookup"><span data-stu-id="6e525-135">[Building the Account at a Glance HTML5/jQuery Application](https://weblogs.asp.net/dwahlin/archive/2011/08/15/building-the-account-at-a-glance-html5-jquery-application.aspx) on Dan Wahlin's blog.</span></span>

> [!NOTE]
> <span data-ttu-id="6e525-136">Es gibt viele Möglichkeiten, das Repository und die Einheit der Arbeit Muster zu implementieren.</span><span class="sxs-lookup"><span data-stu-id="6e525-136">There are many ways to implement the repository and unit of work patterns.</span></span> <span data-ttu-id="6e525-137">Sie können Repositoryklassen mit oder ohne eine Einheit der Arbeit-Klasse.</span><span class="sxs-lookup"><span data-stu-id="6e525-137">You can use repository classes with or without a unit of work class.</span></span> <span data-ttu-id="6e525-138">Sie können ein einzelnes Repository für alle Entitätstypen oder one für jeden Typ implementieren.</span><span class="sxs-lookup"><span data-stu-id="6e525-138">You can implement a single repository for all entity types, or one for each type.</span></span> <span data-ttu-id="6e525-139">Wenn Sie einen für jeden Typ implementieren, können Sie separate Klassen, eine generische Basisklasse und abgeleiteten Klassen oder einer abstrakten Klasse und abgeleitete Klassen.</span><span class="sxs-lookup"><span data-stu-id="6e525-139">If you implement one for each type, you can use separate classes, a generic base class and derived classes, or an abstract base class and derived classes.</span></span> <span data-ttu-id="6e525-140">Sie Geschäftslogik in Ihrem Repository ein- bzw. um Datenzugriffslogik zu beschränken.</span><span class="sxs-lookup"><span data-stu-id="6e525-140">You can include business logic in your repository or restrict it to data access logic.</span></span> <span data-ttu-id="6e525-141">Sie können auch eine Abstraktionsebene in Ihrer Datenbank Context-Klasse erstellen, mit [IDbSet](https://msdn.microsoft.com/library/gg679233(v=vs.103).aspx) es anstelle von Schnittstellen [DbSet](https://msdn.microsoft.com/library/system.data.entity.dbset(v=vs.103).aspx) -Typen für Ihre Entitätenmengen.</span><span class="sxs-lookup"><span data-stu-id="6e525-141">You can also build an abstraction layer into your database context class by using [IDbSet](https://msdn.microsoft.com/library/gg679233(v=vs.103).aspx) interfaces there instead of [DbSet](https://msdn.microsoft.com/library/system.data.entity.dbset(v=vs.103).aspx) types for your entity sets.</span></span> <span data-ttu-id="6e525-142">Der Ansatz für die Implementierung einer Abstraktionsebene, die in diesem Lernprogramm gezeigt ist eine Option, die Sie berücksichtigen müssen, nicht auf eine Empfehlung für alle Szenarien und Umgebungen.</span><span class="sxs-lookup"><span data-stu-id="6e525-142">The approach to implementing an abstraction layer shown in this tutorial is one option for you to consider, not a recommendation for all scenarios and environments.</span></span>


## <a name="creating-the-student-repository-class"></a><span data-ttu-id="6e525-143">Erstellen der Student-Repository-Klasse</span><span class="sxs-lookup"><span data-stu-id="6e525-143">Creating the Student Repository Class</span></span>

<span data-ttu-id="6e525-144">In der *DAL* Ordner, erstellen Sie eine Klassendatei namens *IStudentRepository.cs* und Ersetzen Sie den vorhandenen Code durch folgenden Code:</span><span class="sxs-lookup"><span data-stu-id="6e525-144">In the *DAL* folder, create a class file named *IStudentRepository.cs* and replace the existing code with the following code:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample1.cs)]

<span data-ttu-id="6e525-145">Dieser Code deklariert eine Reihe von CRUD-Methoden, einschließlich zwei schreibgeschützte Methoden – eine, die alle zurückgibt `Student` Entitäten, und eine, die eine einzelne findet `Student` Entität nach ID auf.</span><span class="sxs-lookup"><span data-stu-id="6e525-145">This code declares a typical set of CRUD methods, including two read methods — one that returns all `Student` entities, and one that finds a single `Student` entity by ID.</span></span>

<span data-ttu-id="6e525-146">In der *DAL* Ordner, erstellen Sie eine Klassendatei namens *StudentRepository.cs* Datei.</span><span class="sxs-lookup"><span data-stu-id="6e525-146">In the *DAL* folder, create a class file named *StudentRepository.cs* file.</span></span> <span data-ttu-id="6e525-147">Ersetzen Sie den vorhandenen Code durch den folgenden Code, der implementiert die `IStudentRepository` Schnittstelle:</span><span class="sxs-lookup"><span data-stu-id="6e525-147">Replace the existing code with the following code, which implements the `IStudentRepository` interface:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample2.cs)]

<span data-ttu-id="6e525-148">Der Datenbankkontext in einer Klassenvariablen definiert ist und der Konstruktor erwartet das aufrufende Objekt um eine Instanz des Kontexts zu übergeben:</span><span class="sxs-lookup"><span data-stu-id="6e525-148">The database context is defined in a class variable, and the constructor expects the calling object to pass in an instance of the context:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample3.cs)]

<span data-ttu-id="6e525-149">Instanziieren Sie einen neuen Kontext in das Repository, aber dann, wenn Sie mehrere Repositorys in einen Controller verwendet, jede würde am Ende mit einem separaten Kontext.</span><span class="sxs-lookup"><span data-stu-id="6e525-149">You could instantiate a new context in the repository, but then if you used multiple repositories in one controller, each would end up with a separate context.</span></span> <span data-ttu-id="6e525-150">Später verwenden Sie mehrere Repositorys in den `Course` Controller, und Sie sehen wie eine Einheit der Arbeit Klasse sicherstellen kann, dass alle Repositorys, die denselben Kontext verwenden.</span><span class="sxs-lookup"><span data-stu-id="6e525-150">Later you'll use multiple repositories in the `Course` controller, and you'll see how a unit of work class can ensure that all repositories use the same context.</span></span>

<span data-ttu-id="6e525-151">Implementiert das Repository [IDisposable](https://msdn.microsoft.com/library/system.idisposable.aspx) und verwirft den Datenbankkontext aus, wie Sie gesehen, weiter oben in der Controller haben und deren CRUD-Methoden Aufrufe an den Datenbankkontext auf die gleiche Weise, den Sie zuvor gesehen haben.</span><span class="sxs-lookup"><span data-stu-id="6e525-151">The repository implements [IDisposable](https://msdn.microsoft.com/library/system.idisposable.aspx) and disposes the database context as you saw earlier in the controller, and its CRUD methods make calls to the database context in the same way that you saw earlier.</span></span>

## <a name="change-the-student-controller-to-use-the-repository"></a><span data-ttu-id="6e525-152">Ändern Sie den Student-Controller, um das Repository</span><span class="sxs-lookup"><span data-stu-id="6e525-152">Change the Student Controller to Use the Repository</span></span>

<span data-ttu-id="6e525-153">In *StudentController.cs*, ersetzen Sie den Code derzeit in der Klasse, durch den folgenden Code.</span><span class="sxs-lookup"><span data-stu-id="6e525-153">In *StudentController.cs*, replace the code currently in the class with the following code.</span></span> <span data-ttu-id="6e525-154">Die Änderungen werden hervorgehoben.</span><span class="sxs-lookup"><span data-stu-id="6e525-154">The changes are highlighted.</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample4.cs?highlight=13-18,44,75,77,102-103,120,137-138,159,172-174,186)]

<span data-ttu-id="6e525-155">Deklariert der Controller jetzt eine Klassenvariable für ein Objekt, implementiert die `IStudentRepository` Schnittstelle anstelle der Context-Klasse:</span><span class="sxs-lookup"><span data-stu-id="6e525-155">The controller now declares a class variable for an object that implements the `IStudentRepository` interface instead of the context class:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample5.cs)]

<span data-ttu-id="6e525-156">Der (parameterlose) Standardkonstruktor erstellt eine neue Kontextinstanz und ein optionaler Konstruktor ermöglicht den Aufrufer die Übergabe in einem Kontextinstanz.</span><span class="sxs-lookup"><span data-stu-id="6e525-156">The default (parameterless) constructor creates a new context instance, and an optional constructor allows the caller to pass in a context instance.</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample6.cs)]

<span data-ttu-id="6e525-157">(Wenn Sie verwendeten *Abhängigkeitsinjektion*, oder DI, wäre nicht Sie den Standardkonstruktor erforderlich, da die Software DI müssen sicherstellen, dass, dass das richtige Repositoryobjekt immer angegeben wird.)</span><span class="sxs-lookup"><span data-stu-id="6e525-157">(If you were using *dependency injection*, or DI, you wouldn't need the default constructor because the DI software would ensure that the correct repository object would always be provided.)</span></span>

<span data-ttu-id="6e525-158">In den CRUD-Methoden heißt das Repository jetzt anstelle des Kontexts</span><span class="sxs-lookup"><span data-stu-id="6e525-158">In the CRUD methods, the repository is now called instead of the context:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample7.cs)]

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample8.cs)]

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample9.cs)]

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample10.cs)]

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample11.cs)]

<span data-ttu-id="6e525-159">Und die `Dispose` Methode jetzt das Repository anstelle des Kontexts entfernt:</span><span class="sxs-lookup"><span data-stu-id="6e525-159">And the `Dispose` method now disposes the repository instead of the context:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample12.cs)]

<span data-ttu-id="6e525-160">Führen Sie den Standort aus, und klicken Sie auf die **Studenten** Registerkarte.</span><span class="sxs-lookup"><span data-stu-id="6e525-160">Run the site and click the **Students** tab.</span></span>

![Students_Index_page](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/_static/image1.png)

<span data-ttu-id="6e525-162">Die Seite sieht und funktioniert genauso wie vor der Sie den Code, um das Repository geändert, und die anderen Student-Seiten arbeiten auch identisch.</span><span class="sxs-lookup"><span data-stu-id="6e525-162">The page looks and works the same as it did before you changed the code to use the repository, and the other Student pages also work the same.</span></span> <span data-ttu-id="6e525-163">Es ist jedoch ein wichtiger Unterschied bei der Datenerfassung die `Index` -Methode des Controllers verfügt, Filterung und Sortierung.</span><span class="sxs-lookup"><span data-stu-id="6e525-163">However, there's an important difference in the way the `Index` method of the controller does filtering and ordering.</span></span> <span data-ttu-id="6e525-164">Die ursprüngliche Version dieser Methode enthält den folgenden Code:</span><span class="sxs-lookup"><span data-stu-id="6e525-164">The original version of this method contained the following code:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample13.cs?highlight=1)]

<span data-ttu-id="6e525-165">Die aktualisierte `Index` -Methode enthält den folgenden Code:</span><span class="sxs-lookup"><span data-stu-id="6e525-165">The updated `Index` method contains the following code:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample14.cs?highlight=1)]

<span data-ttu-id="6e525-166">Nur der hervorgehobene Code hat sich geändert.</span><span class="sxs-lookup"><span data-stu-id="6e525-166">Only the highlighted code has changed.</span></span>

<span data-ttu-id="6e525-167">In der ursprünglichen Version des Codes `students` als typisiert ist, ein `IQueryable` Objekt.</span><span class="sxs-lookup"><span data-stu-id="6e525-167">In the original version of the code, `students` is typed as an `IQueryable` object.</span></span> <span data-ttu-id="6e525-168">Die Abfrage wird nicht an die Datenbank gesendet, bis er in eine Auflistung mit einer Methode wie konvertiert wird `ToList`, dem tritt nicht auf, bis die Indexansicht Student Modell zugreift.</span><span class="sxs-lookup"><span data-stu-id="6e525-168">The query isn't sent to the database until it's converted into a collection using a method such as `ToList`, which doesn't occur until the Index view accesses the student model.</span></span> <span data-ttu-id="6e525-169">Die `Where` Methode in den ursprünglichen Code oben wird eine `WHERE` -Klausel in der SQL-Abfrage, die an die Datenbank gesendet wird.</span><span class="sxs-lookup"><span data-stu-id="6e525-169">The `Where` method in the original code above becomes a `WHERE` clause in the SQL query that is sent to the database.</span></span> <span data-ttu-id="6e525-170">Dies bedeutet wiederum, dass nur die ausgewählten Entitäten von der Datenbank zurückgegeben werden.</span><span class="sxs-lookup"><span data-stu-id="6e525-170">That in turn means that only the selected entities are returned by the database.</span></span> <span data-ttu-id="6e525-171">Allerdings Folge der Änderung `context.Students` auf `studentRepository.GetStudents()`, `students` Variablen, nachdem diese Anweisung ist ein `IEnumerable` -Auflistung, die alle Teilnehmer in der Datenbank enthält.</span><span class="sxs-lookup"><span data-stu-id="6e525-171">However, as a result of changing `context.Students` to `studentRepository.GetStudents()`, the `students` variable after this statement is an `IEnumerable` collection that includes all students in the database.</span></span> <span data-ttu-id="6e525-172">Das Ergebnis des Anwendens der `Where` Methode ist identisch, aber jetzt die Arbeit im Arbeitsspeicher auf dem Webserver und nicht von der Datenbank erfolgt.</span><span class="sxs-lookup"><span data-stu-id="6e525-172">The end result of applying the `Where` method is the same, but now the work is done in memory on the web server and not by the database.</span></span> <span data-ttu-id="6e525-173">Für Abfragen, die große Mengen an Daten zurückgeben, kann dies ineffizient sein.</span><span class="sxs-lookup"><span data-stu-id="6e525-173">For queries that return large volumes of data, this can be inefficient.</span></span>

> [!TIP]
> 
> <span data-ttu-id="6e525-174">**IQueryable-Objekt im Vergleich zu IEnumerable**</span><span class="sxs-lookup"><span data-stu-id="6e525-174">**IQueryable vs. IEnumerable**</span></span>
> 
> <span data-ttu-id="6e525-175">Nachdem Sie das Repository implementiert wie hier gezeigt, selbst wenn Sie ein Element im eingeben der **Suche** Feld der Abfrage an SQL Server gesendet werden alle Student Zeilen zurückgegeben, da Ihre Suchkriterien nicht berücksichtigt:</span><span class="sxs-lookup"><span data-stu-id="6e525-175">After you implement the repository as shown here, even if you enter something in the **Search** box the query sent to SQL Server returns all Student rows because it doesn't include your search criteria:</span></span>
> 
> ![](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/_static/image2.png)
> 
> [!code-sql[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample15.sql)]
> 
> <span data-ttu-id="6e525-176">Diese Abfrage gibt alle Student Daten zurück, da Repository die Abfrage ausgeführt, ohne zu wissen zu den Suchkriterien entsprechen.</span><span class="sxs-lookup"><span data-stu-id="6e525-176">This query returns all of the student data because the repository executed the query without knowing about the search criteria.</span></span> <span data-ttu-id="6e525-177">Der Prozess der Sortierung, Suchkriterien angewendet werden und eine Teilmenge der Daten auswählen, für Auslagerungsdatei (anzeigt, in diesem Fall nur 3 Zeilen) im Arbeitsspeicher erfolgt höher bei der `ToPagedList` Methode wird aufgerufen, auf der `IEnumerable` Auflistung.</span><span class="sxs-lookup"><span data-stu-id="6e525-177">The process of sorting, applying search criteria, and selecting a subset of the data for paging (showing only 3 rows in this case) is done in memory later when the `ToPagedList` method is called on the `IEnumerable` collection.</span></span>
> 
> <span data-ttu-id="6e525-178">In der vorherigen Version des Codes (bevor Sie das Repository implementiert), die Abfrage wird nicht an die Datenbank gesendet erst nach dem Anwenden der Suchkriterien beim `ToPagedList` aufgerufen wird, auf die `IQueryable` Objekt.</span><span class="sxs-lookup"><span data-stu-id="6e525-178">In the previous version of the code (before you implemented the repository), the query is not sent to the database until after you apply the search criteria, when `ToPagedList` is called on the `IQueryable` object.</span></span>
> 
> ![](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/_static/image3.png)
> 
> <span data-ttu-id="6e525-179">Wenn ToPagedList aufgerufen wird, auf ein `IQueryable` Objekt, an SQL Server gesendete Abfrage gibt die Suchzeichenfolge daher nur Zeilen zurückgegeben, die den Suchkriterien entsprechen, und keine Filterung im Arbeitsspeicher ausgeführt werden muss.</span><span class="sxs-lookup"><span data-stu-id="6e525-179">When ToPagedList is called on an `IQueryable` object, the query sent to SQL Server specifies the search string, and as a result only rows that meet the search criteria are returned, and no filtering needs to be done in memory.</span></span>
> 
> [!code-sql[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample16.sql)]
> 
> <span data-ttu-id="6e525-180">(Im folgende Lernprogramm wird erläutert, wie Abfragen an SQL Server gesendet zu untersuchen.)</span><span class="sxs-lookup"><span data-stu-id="6e525-180">(The following tutorial explains how to examine queries sent to SQL Server.)</span></span>


<span data-ttu-id="6e525-181">Der folgende Abschnitt zeigt, wie Repository-Methoden implementiert, mit denen Sie angeben, dass diese Arbeit von der Datenbank ausgeführt werden soll.</span><span class="sxs-lookup"><span data-stu-id="6e525-181">The following section shows how to implement repository methods that enable you to specify that this work should be done by the database.</span></span>

<span data-ttu-id="6e525-182">Sie haben jetzt eine Abstraktionsebene zwischen dem Controller und den Kontext der Entity Framework-Datenbank erstellt.</span><span class="sxs-lookup"><span data-stu-id="6e525-182">You've now created an abstraction layer between the controller and the Entity Framework database context.</span></span> <span data-ttu-id="6e525-183">Bei einer geplanten wurden, um automatisierte Komponententests, die mit dieser Anwendung ausführen konnten Sie eine alternative Repository-Klasse erstellen, in ein Komponententestprojekt, die implementiert `IStudentRepository` *.*</span><span class="sxs-lookup"><span data-stu-id="6e525-183">If you were going to perform automated unit testing with this application, you could create an alternative repository class in a unit test project that implements `IStudentRepository`*.*</span></span> <span data-ttu-id="6e525-184">Anstelle von aufrufen und den Kontext zum Lesen und Schreiben von Daten, konnte dieser Klasse pseudorepository Auflistungen im Arbeitsspeicher bearbeiten, zum Testen der Controllerfunktionen.</span><span class="sxs-lookup"><span data-stu-id="6e525-184">Instead of calling the context to read and write data, this mock repository class could manipulate in-memory collections in order to test controller functions.</span></span>

## <a name="implement-a-generic-repository-and-a-unit-of-work-class"></a><span data-ttu-id="6e525-185">Implementieren Sie eine generische Repository und eine Einheit der Arbeit-Klasse</span><span class="sxs-lookup"><span data-stu-id="6e525-185">Implement a Generic Repository and a Unit of Work Class</span></span>

<span data-ttu-id="6e525-186">Erstellen einer Klasse Repository für jeden Entitätstyp kann zu viele redundanter Code, und es könnte die teilweise Updates zu.</span><span class="sxs-lookup"><span data-stu-id="6e525-186">Creating a repository class for each entity type could result in a lot of redundant code, and it could result in partial updates.</span></span> <span data-ttu-id="6e525-187">Angenommen Sie, Sie verfügen über zwei verschiedene Entitätstypen als Teil der gleichen Transaktion zu aktualisieren.</span><span class="sxs-lookup"><span data-stu-id="6e525-187">For example, suppose you have to update two different entity types as part of the same transaction.</span></span> <span data-ttu-id="6e525-188">Wenn jeweils eine separate Datenbank Kontextinstanz verwendet wird, eine zwar erfolgreich sein und den anderen möglicherweise nicht.</span><span class="sxs-lookup"><span data-stu-id="6e525-188">If each uses a separate database context instance, one might succeed and the other might fail.</span></span> <span data-ttu-id="6e525-189">Eine Möglichkeit zum Minimieren von redundanten Codes ist die Verwendung einer generischen Repository und eine Möglichkeit, sicherzustellen, dass alle Repositorys den gleichen Datenbankkontext verwenden (und somit alle Updates zu koordinieren) ist die Verwendung eine Einheit der Arbeit-Klasse.</span><span class="sxs-lookup"><span data-stu-id="6e525-189">One way to minimize redundant code is to use a generic repository, and one way to ensure that all repositories use the same database context (and thus coordinate all updates) is to use a unit of work class.</span></span>

<span data-ttu-id="6e525-190">In diesem Abschnitt des Lernprogramms erstellen Sie eine `GenericRepository` Klasse und ein `UnitOfWork` Klasse, und verwenden sie in der `Course` Controller aus, um den Zugriff auf die `Department` und `Course` Entitätenmengen.</span><span class="sxs-lookup"><span data-stu-id="6e525-190">In this section of the tutorial, you'll create a `GenericRepository` class and a `UnitOfWork` class, and use them in the `Course` controller to access both the `Department` and the `Course` entity sets.</span></span> <span data-ttu-id="6e525-191">Wie zuvor erläutert, sind nicht zur Vereinfachung der in diesem Teil des Lernprogramms Sie Schnittstellen für diese Klassen erstellen.</span><span class="sxs-lookup"><span data-stu-id="6e525-191">As explained earlier, to keep this part of the tutorial simple, you aren't creating interfaces for these classes.</span></span> <span data-ttu-id="6e525-192">Aber bei einer geplanten wurden, deren Verwendung zur testgesteuerten Entwicklung zu ermöglichen würden normalerweise implementieren Sie diese mit Schnittstellen die gleiche Weise wie Sie verwendet haben die `Student` Repository.</span><span class="sxs-lookup"><span data-stu-id="6e525-192">But if you were going to use them to facilitate TDD, you'd typically implement them with interfaces the same way you did the `Student` repository.</span></span>

### <a name="create-a-generic-repository"></a><span data-ttu-id="6e525-193">Erstellen Sie eine generische Repository</span><span class="sxs-lookup"><span data-stu-id="6e525-193">Create a Generic Repository</span></span>

<span data-ttu-id="6e525-194">In der *DAL* Ordner erstellen *GenericRepository.cs* und Ersetzen Sie den vorhandenen Code durch folgenden Code:</span><span class="sxs-lookup"><span data-stu-id="6e525-194">In the *DAL* folder, create *GenericRepository.cs* and replace the existing code with the following code:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample17.cs)]

<span data-ttu-id="6e525-195">Klassenvariablen deklariert werden, für den Datenbankkontext und der Entitätenmenge, die im Repository für die instanziiert wird:</span><span class="sxs-lookup"><span data-stu-id="6e525-195">Class variables are declared for the database context and for the entity set that the repository is instantiated for:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample18.cs)]

<span data-ttu-id="6e525-196">Der Konstruktor akzeptiert eine Kontext-Datenbankinstanz und der Entität Set-Variable initialisiert:</span><span class="sxs-lookup"><span data-stu-id="6e525-196">The constructor accepts a database context instance and initializes the entity set variable:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample19.cs)]

<span data-ttu-id="6e525-197">Die `Get` Methode Lambda-Ausdrücke verwendet, um eine filterbedingung und eine Spalte zum Sortieren der Ergebnisse von an den aufrufenden Code zu ermöglichen und ein Zeichenfolgenparameter ermöglicht den Aufrufer, geben Sie eine durch Trennzeichen getrennte Liste der Navigationseigenschaften für unverzüglichem Laden:</span><span class="sxs-lookup"><span data-stu-id="6e525-197">The `Get` method uses lambda expressions to allow the calling code to specify a filter condition and a column to order the results by, and a string parameter lets the caller provide a comma-delimited list of navigation properties for eager loading:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample20.cs)]

<span data-ttu-id="6e525-198">Der Code `Expression<Func<TEntity, bool>> filter` bedeutet, dass der Aufrufer gebe ein Lambda-Ausdrucks auf der Grundlage der `TEntity` Typ, und dieser Ausdruck gibt einen booleschen Wert zurück.</span><span class="sxs-lookup"><span data-stu-id="6e525-198">The code `Expression<Func<TEntity, bool>> filter` means the caller will provide a lambda expression based on the `TEntity` type, and this expression will return a Boolean value.</span></span> <span data-ttu-id="6e525-199">Z. B., wenn das Repository für die instanziiert wird die `Student` Entitätstyp, der Code in der aufrufenden Methode möglicherweise geben `student => student.LastName == "Smith` &quot; für die `filter` Parameter.</span><span class="sxs-lookup"><span data-stu-id="6e525-199">For example, if the repository is instantiated for the `Student` entity type, the code in the calling method might specify `student => student.LastName == "Smith`&quot; for the `filter` parameter.</span></span>

<span data-ttu-id="6e525-200">Der Code `Func<IQueryable<TEntity>, IOrderedQueryable<TEntity>> orderBy` bedeutet auch, dass der Aufrufer wird einen Lambda-Ausdruck bereitstellen.</span><span class="sxs-lookup"><span data-stu-id="6e525-200">The code `Func<IQueryable<TEntity>, IOrderedQueryable<TEntity>> orderBy` also means the caller will provide a lambda expression.</span></span> <span data-ttu-id="6e525-201">In diesem Fall die Eingabe für den Ausdruck ist jedoch ein `IQueryable` -Objekt für die `TEntity` Typ.</span><span class="sxs-lookup"><span data-stu-id="6e525-201">But in this case, the input to the expression is an `IQueryable` object for the `TEntity` type.</span></span> <span data-ttu-id="6e525-202">Der Ausdruck wird eine sortierte Version dieses zurückgeben `IQueryable` Objekt.</span><span class="sxs-lookup"><span data-stu-id="6e525-202">The expression will return an ordered version of that `IQueryable` object.</span></span> <span data-ttu-id="6e525-203">Z. B., wenn das Repository für die instanziiert wird die `Student` Entitätstyp, der Code in der aufrufenden Methode möglicherweise geben `q => q.OrderBy(s => s.LastName)` für die `orderBy` Parameter.</span><span class="sxs-lookup"><span data-stu-id="6e525-203">For example, if the repository is instantiated for the `Student` entity type, the code in the calling method might specify `q => q.OrderBy(s => s.LastName)` for the `orderBy` parameter.</span></span>

<span data-ttu-id="6e525-204">Der Code in der `Get` Methode erstellt ein `IQueryable` Objekt, und klicken Sie dann den Filterausdruck gilt, sofern vorhanden:</span><span class="sxs-lookup"><span data-stu-id="6e525-204">The code in the `Get` method creates an `IQueryable` object and then applies the filter expression if there is one:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample21.cs)]

<span data-ttu-id="6e525-205">Als Nächstes wird die Eager Automatisches Laden von Ausdrücke nach der Analyse der durch Trennzeichen getrennte Liste angewendet:</span><span class="sxs-lookup"><span data-stu-id="6e525-205">Next it applies the eager-loading expressions after parsing the comma-delimited list:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample22.cs)]

<span data-ttu-id="6e525-206">Schließlich gilt es die `orderBy` Ausdruck, sofern vorhanden und gibt die Ergebnisse; andernfalls wird von der Abfrage nicht sortiert die Ergebnisse zurückgegeben:</span><span class="sxs-lookup"><span data-stu-id="6e525-206">Finally, it applies the `orderBy` expression if there is one and returns the results; otherwise it returns the results from the unordered query:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample23.cs)]

<span data-ttu-id="6e525-207">Beim Aufrufen der `Get` -Methode, könnten Sie tun, Filterung und Sortierung auf die `IEnumerable` Auflistung zurückgegeben, die von der Methode, anstatt den Parameter für diese Funktionen bereitzustellen.</span><span class="sxs-lookup"><span data-stu-id="6e525-207">When you call the `Get` method, you could do filtering and sorting on the `IEnumerable` collection returned by the method instead of providing parameters for these functions.</span></span> <span data-ttu-id="6e525-208">Aber das Sortieren und Filtern von Arbeitsaufgaben würden dann im Arbeitsspeicher auf dem Webserver ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="6e525-208">But the sorting and filtering work would then be done in memory on the web server.</span></span> <span data-ttu-id="6e525-209">Verwenden Sie diese Parameter an, stellen Sie sicher, dass die selbst von der Datenbank statt auf dem Webserver ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="6e525-209">By using these parameters, you ensure that the work is done by the database rather than the web server.</span></span> <span data-ttu-id="6e525-210">Eine Alternative besteht darin, erstellen Sie abgeleitete Klassen für bestimmte Entitätstypen und fügen spezielle `Get` Methoden, wie z. B. `GetStudentsInNameOrder` oder `GetStudentsByName`.</span><span class="sxs-lookup"><span data-stu-id="6e525-210">An alternative is to create derived classes for specific entity types and add specialized `Get` methods, such as `GetStudentsInNameOrder` or `GetStudentsByName`.</span></span> <span data-ttu-id="6e525-211">Allerdings kann in einer komplexen Anwendung kann dies dazu führen eine große Anzahl solcher abgeleitete Klassen und spezielle Methoden, die Arbeit zu verwalten sein könnte.</span><span class="sxs-lookup"><span data-stu-id="6e525-211">However, in a complex application, this can result in a large number of such derived classes and specialized methods, which could be more work to maintain.</span></span>

<span data-ttu-id="6e525-212">Der Code in der `GetByID`, `Insert`, und `Update` Methoden ähnelt der im Repository nicht generische gesehen haben.</span><span class="sxs-lookup"><span data-stu-id="6e525-212">The code in the `GetByID`, `Insert`, and `Update` methods is similar to what you saw in the non-generic repository.</span></span> <span data-ttu-id="6e525-213">(Sie sind nicht zur Verfügung eines unverzüglichem Laden-Parameters in der `GetByID` Signatur, da Sie mit unverzüglichem Laden nicht möglich die `Find` Methode.)</span><span class="sxs-lookup"><span data-stu-id="6e525-213">(You aren't providing an eager loading parameter in the `GetByID` signature, because you can't do eager loading with the `Find` method.)</span></span>

<span data-ttu-id="6e525-214">Zwei Überladungen werden bereitgestellt, für die `Delete` Methode:</span><span class="sxs-lookup"><span data-stu-id="6e525-214">Two overloads are provided for the `Delete` method:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample24.cs)]

<span data-ttu-id="6e525-215">Übergeben eines diese können in der nur die ID der Entität gelöscht werden soll, und eine Überladung einer Entitätsinstanz.</span><span class="sxs-lookup"><span data-stu-id="6e525-215">One of these lets you pass in just the ID of the entity to be deleted, and one takes an entity instance.</span></span> <span data-ttu-id="6e525-216">In haben Sie gesehen der [Behandeln von Parallelität](../../getting-started/getting-started-with-ef-using-mvc/handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application.md) Tutorial, Parallelität, die Sie behandeln müssen eine `Delete` Methode, die einer Entitätsinstanz, die akzeptiert enthält den ursprünglichen Wert einer Eigenschaft für die Überwachung.</span><span class="sxs-lookup"><span data-stu-id="6e525-216">As you saw in the [Handling Concurrency](../../getting-started/getting-started-with-ef-using-mvc/handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application.md) tutorial, for concurrency handling you need a `Delete` method that takes an entity instance that includes the original value of a tracking property.</span></span>

<span data-ttu-id="6e525-217">Dieses generischen Repository werden typische CRUD-Anforderungen verarbeitet.</span><span class="sxs-lookup"><span data-stu-id="6e525-217">This generic repository will handle typical CRUD requirements.</span></span> <span data-ttu-id="6e525-218">Bei bestimmten Entitätstyps besondere Anforderungen, z. B. komplexer Filterung oder Sortierung, hat können Sie eine abgeleitete Klasse erstellen, die zusätzliche Methoden für diesen Typ enthält.</span><span class="sxs-lookup"><span data-stu-id="6e525-218">When a particular entity type has special requirements, such as more complex filtering or ordering, you can create a derived class that has additional methods for that type.</span></span>

## <a name="creating-the-unit-of-work-class"></a><span data-ttu-id="6e525-219">Erstellen die Einheit der Arbeit-Klasse</span><span class="sxs-lookup"><span data-stu-id="6e525-219">Creating the Unit of Work Class</span></span>

<span data-ttu-id="6e525-220">Die Einheit der Arbeit Klasse dient ein bestimmter Zweck: um sicherzustellen, dass bei der Verwendung von mehreren Repositorys, teilen sie einen einzelnen Datenbankkontext.</span><span class="sxs-lookup"><span data-stu-id="6e525-220">The unit of work class serves one purpose: to make sure that when you use multiple repositories, they share a single database context.</span></span> <span data-ttu-id="6e525-221">Auf diese Weise, wenn eine Arbeitseinheit abgeschlossen ist Sie erreichen die `SaveChanges` Methode für diese Instanz des Kontexts und sicher sein, dass alle zugehörigen Änderungen koordiniert werden.</span><span class="sxs-lookup"><span data-stu-id="6e525-221">That way, when a unit of work is complete you can call the `SaveChanges` method on that instance of the context and be assured that all related changes will be coordinated.</span></span> <span data-ttu-id="6e525-222">Die Klasse erfordert, wird eine `Save` -Methode und eine Eigenschaft für jedes Repository.</span><span class="sxs-lookup"><span data-stu-id="6e525-222">All that the class needs is a `Save` method and a property for each repository.</span></span> <span data-ttu-id="6e525-223">Jede Repository-Eigenschaft gibt eine Repository-Instanz, die dieselbe Datenbank Kontextinstanz als die anderen Repository-Instanzen mit instanziiert wurde.</span><span class="sxs-lookup"><span data-stu-id="6e525-223">Each repository property returns a repository instance that has been instantiated using the same database context instance as the other repository instances.</span></span>

<span data-ttu-id="6e525-224">In der *DAL* Ordner, erstellen Sie eine Klassendatei namens *UnitOfWork.cs* , und Ersetzen Sie den Code durch den folgenden Code:</span><span class="sxs-lookup"><span data-stu-id="6e525-224">In the *DAL* folder, create a class file named *UnitOfWork.cs* and replace the template code with the following code:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample25.cs)]

<span data-ttu-id="6e525-225">Der Code erstellt Klassenvariablen für den Datenbankkontext als auch jedes Repository.</span><span class="sxs-lookup"><span data-stu-id="6e525-225">The code creates class variables for the database context and each repository.</span></span> <span data-ttu-id="6e525-226">Für die `context` Variable, ein neuer Kontext instanziiert wird:</span><span class="sxs-lookup"><span data-stu-id="6e525-226">For the `context` variable, a new context is instantiated:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample26.cs)]

<span data-ttu-id="6e525-227">Jede Repository-Eigenschaft überprüft, ob das Repository ist bereits vorhanden.</span><span class="sxs-lookup"><span data-stu-id="6e525-227">Each repository property checks whether the repository already exists.</span></span> <span data-ttu-id="6e525-228">Wenn dies nicht der Fall ist, wird das Repository, übergeben die Kontextinstanz instanziiert.</span><span class="sxs-lookup"><span data-stu-id="6e525-228">If not, it instantiates the repository, passing in the context instance.</span></span> <span data-ttu-id="6e525-229">Daher verwenden alle Repositorys dieselbe Kontextinstanz.</span><span class="sxs-lookup"><span data-stu-id="6e525-229">As a result, all repositories share the same context instance.</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample27.cs)]

<span data-ttu-id="6e525-230">Die `Save` Methodenaufrufe `SaveChanges` im Kontext Datenbank.</span><span class="sxs-lookup"><span data-stu-id="6e525-230">The `Save` method calls `SaveChanges` on the database context.</span></span>

<span data-ttu-id="6e525-231">Wie bei jeder Klasse, die einen Datenbankkontext in einer Klassenvariablen instanziiert die `UnitOfWork` -Klasse implementiert `IDisposable` und gibt den Kontext frei.</span><span class="sxs-lookup"><span data-stu-id="6e525-231">Like any class that instantiates a database context in a class variable, the `UnitOfWork` class implements `IDisposable` and disposes the context.</span></span>

### <a name="changing-the-course-controller-to-use-the-unitofwork-class-and-repositories"></a><span data-ttu-id="6e525-232">Ändern den Kurs-Controller, um die UnitOfWork-Klasse und Repositorys verwenden</span><span class="sxs-lookup"><span data-stu-id="6e525-232">Changing the Course Controller to use the UnitOfWork Class and Repositories</span></span>

<span data-ttu-id="6e525-233">Ersetzen Sie den Code, Sie derzeit im haben *CourseController.cs* durch den folgenden Code:</span><span class="sxs-lookup"><span data-stu-id="6e525-233">Replace the code you currently have in *CourseController.cs* with the following code:</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample28.cs?highlight=15,20,22,31,54-55,70,85-86,101-102,122-124,130)]

<span data-ttu-id="6e525-234">Dieser Code Fügt eine Klassenvariablen für die `UnitOfWork` Klasse.</span><span class="sxs-lookup"><span data-stu-id="6e525-234">This code adds a class variable for the `UnitOfWork` class.</span></span> <span data-ttu-id="6e525-235">(Wenn Sie hier Schnittstellen verwendet haben, wäre nicht, initialisieren Sie die Variable hier; stattdessen würden Sie ein Muster von zwei Konstruktoren implementiert wird, wie Sie für die `Student` Repository.)</span><span class="sxs-lookup"><span data-stu-id="6e525-235">(If you were using interfaces here, you wouldn't initialize the variable here; instead, you'd implement a pattern of two constructors just as you did for the `Student` repository.)</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample29.cs)]

<span data-ttu-id="6e525-236">In den Rest der Klasse, werden alle Verweise auf den Datenbankkontext durch Verweise auf die entsprechenden Repository ersetzt mit `UnitOfWork` Eigenschaften auf das Repository zugreifen.</span><span class="sxs-lookup"><span data-stu-id="6e525-236">In the rest of the class, all references to the database context are replaced by references to the appropriate repository, using `UnitOfWork` properties to access the repository.</span></span> <span data-ttu-id="6e525-237">Die `Dispose` -Methode verwirft die `UnitOfWork` Instanz.</span><span class="sxs-lookup"><span data-stu-id="6e525-237">The `Dispose` method disposes the `UnitOfWork` instance.</span></span>

[!code-csharp[Main](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/samples/sample30.cs)]

<span data-ttu-id="6e525-238">Führen Sie den Standort aus, und klicken Sie auf die **Kurse** Registerkarte.</span><span class="sxs-lookup"><span data-stu-id="6e525-238">Run the site and click the **Courses** tab.</span></span>

![Courses_Index_page](implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application/_static/image4.png)

<span data-ttu-id="6e525-240">Die Seite sieht und funktioniert genauso wie Ihre Änderungen gewohnt und die anderen Seiten der Kurs auch identisch arbeiten.</span><span class="sxs-lookup"><span data-stu-id="6e525-240">The page looks and works the same as it did before your changes, and the other Course pages also work the same.</span></span>

## <a name="summary"></a><span data-ttu-id="6e525-241">Zusammenfassung</span><span class="sxs-lookup"><span data-stu-id="6e525-241">Summary</span></span>

<span data-ttu-id="6e525-242">Sie haben nun das Repository und die Einheit der Arbeit Muster implementiert.</span><span class="sxs-lookup"><span data-stu-id="6e525-242">You have now implemented both the repository and unit of work patterns.</span></span> <span data-ttu-id="6e525-243">Sie haben die Lambda-Ausdrücke als Parameter im Repository generischen Methode verwendet.</span><span class="sxs-lookup"><span data-stu-id="6e525-243">You have used lambda expressions as method parameters in the generic repository.</span></span> <span data-ttu-id="6e525-244">Weitere Informationen zur Verwendung von diesen Ausdrücken mit einem `IQueryable` Objekt, finden Sie unter [IQueryable(T)-Schnittstelle ("System.Linq")](https://msdn.microsoft.com/library/bb351562.aspx) in der MSDN Library.</span><span class="sxs-lookup"><span data-stu-id="6e525-244">For more information about how to use these expressions with an `IQueryable` object, see [IQueryable(T) Interface (System.Linq)](https://msdn.microsoft.com/library/bb351562.aspx) in the MSDN Library.</span></span> <span data-ttu-id="6e525-245">In den nächsten erweiterte Lernprogramm erfahren Sie, wie einige behandelt datentransformationsschritte Szenarien.</span><span class="sxs-lookup"><span data-stu-id="6e525-245">In the next tutorial you'll learn how to handle some advanced scenarios.</span></span>

<span data-ttu-id="6e525-246">Links zu anderen Entity Framework-Ressourcen finden Sie in der [ASP.NET Data Access Content Map](../../../../whitepapers/aspnet-data-access-content-map.md).</span><span class="sxs-lookup"><span data-stu-id="6e525-246">Links to other Entity Framework resources can be found in the [ASP.NET Data Access Content Map](../../../../whitepapers/aspnet-data-access-content-map.md).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="6e525-247">[Zurück](implementing-inheritance-with-the-entity-framework-in-an-asp-net-mvc-application.md)
> [Weiter](advanced-entity-framework-scenarios-for-an-mvc-web-application.md)</span><span class="sxs-lookup"><span data-stu-id="6e525-247">[Previous](implementing-inheritance-with-the-entity-framework-in-an-asp-net-mvc-application.md)
[Next](advanced-entity-framework-scenarios-for-an-mvc-web-application.md)</span></span>
