---
title: Zweck Hierarchie und mehrinstanzenfähigkeit in ASP.NET Core
author: rick-anderson
description: Erfahren Sie Zweck Zeichenfolge Hierarchie und mehrinstanzenfähigkeit in Bezug auf die ASP.NET Core Data Protection-APIs.
manager: wpickett
ms.author: riande
ms.date: 10/14/2016
ms.prod: asp.net-core
ms.technology: aspnet
ms.topic: article
uid: security/data-protection/consumer-apis/purpose-strings-multitenancy
ms.openlocfilehash: a1ca2c32f95a86b877cbbe94d106d23b86800443
ms.sourcegitcommit: 48beecfe749ddac52bc79aa3eb246a2dcdaa1862
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 03/22/2018
---
# <a name="purpose-hierarchy-and-multi-tenancy-in-aspnet-core"></a><span data-ttu-id="9e9e7-103">Zweck Hierarchie und mehrinstanzenfähigkeit in ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="9e9e7-103">Purpose hierarchy and multi-tenancy in ASP.NET Core</span></span>

<span data-ttu-id="9e9e7-104">Da ein `IDataProtector` ist implizit auch eine `IDataProtectionProvider`, Zwecke können miteinander verkettet werden.</span><span class="sxs-lookup"><span data-stu-id="9e9e7-104">Since an `IDataProtector` is also implicitly an `IDataProtectionProvider`, purposes can be chained together.</span></span> <span data-ttu-id="9e9e7-105">In diesem Sinn `provider.CreateProtector([ "purpose1", "purpose2" ])` entspricht `provider.CreateProtector("purpose1").CreateProtector("purpose2")`.</span><span class="sxs-lookup"><span data-stu-id="9e9e7-105">In this sense, `provider.CreateProtector([ "purpose1", "purpose2" ])` is equivalent to `provider.CreateProtector("purpose1").CreateProtector("purpose2")`.</span></span>

<span data-ttu-id="9e9e7-106">Dadurch für einige interessanten hierarchischen Beziehungen durch das Data Protection-System.</span><span class="sxs-lookup"><span data-stu-id="9e9e7-106">This allows for some interesting hierarchical relationships through the data protection system.</span></span> <span data-ttu-id="9e9e7-107">Im vorangehenden Beispiel der [Contoso.Messaging.SecureMessage](xref:security/data-protection/consumer-apis/purpose-strings#data-protection-contoso-purpose), kann die Komponente SecureMessage Aufrufen `provider.CreateProtector("Contoso.Messaging.SecureMessage")` einmal im Vorfeld und das Ergebnis in einer privaten zwischenspeichern `_myProvide` Feld.</span><span class="sxs-lookup"><span data-stu-id="9e9e7-107">In the earlier example of [Contoso.Messaging.SecureMessage](xref:security/data-protection/consumer-apis/purpose-strings#data-protection-contoso-purpose), the SecureMessage component can call `provider.CreateProtector("Contoso.Messaging.SecureMessage")` once up-front and cache the result into a private `_myProvide` field.</span></span> <span data-ttu-id="9e9e7-108">Zukünftige Schutzvorrichtungen können dann erstellt werden, über Aufrufe von `_myProvider.CreateProtector("User: username")`, und diese Schutzvorrichtungen für die einzelnen Nachrichten sichern verwendet werden würde.</span><span class="sxs-lookup"><span data-stu-id="9e9e7-108">Future protectors can then be created via calls to `_myProvider.CreateProtector("User: username")`, and these protectors would be used for securing the individual messages.</span></span>

<span data-ttu-id="9e9e7-109">Dies kann auch umgekehrt werden.</span><span class="sxs-lookup"><span data-stu-id="9e9e7-109">This can also be flipped.</span></span> <span data-ttu-id="9e9e7-110">Erwägen Sie eine einzelne logische Anwendung Hosten mehrerer Mandanten (CMS scheint sinnvoll), und jeder Mandant mit eigenen Verwaltungssystem Authentifizierung und Status konfiguriert werden kann.</span><span class="sxs-lookup"><span data-stu-id="9e9e7-110">Consider a single logical application which hosts multiple tenants (a CMS seems reasonable), and each tenant can be configured with its own authentication and state management system.</span></span> <span data-ttu-id="9e9e7-111">Die Dach-Anwendung hat einen einzelnen master-Anbieter, und er ruft `provider.CreateProtector("Tenant 1")` und `provider.CreateProtector("Tenant 2")` jeder Mandant einen eigenen isolierten Segment des Systems Data Protection gewähren.</span><span class="sxs-lookup"><span data-stu-id="9e9e7-111">The umbrella application has a single master provider, and it calls `provider.CreateProtector("Tenant 1")` and `provider.CreateProtector("Tenant 2")` to give each tenant its own isolated slice of the data protection system.</span></span> <span data-ttu-id="9e9e7-112">Mandanten konnte dann ihre eigenen einzelne Schutzvorrichtungen, die je nach ihren eigenen Anforderungen ableiten, aber unabhängig davon, wie starke wiederholen sie dann keine sie Schutzvorrichtungen, die in Konflikt stehen mit keinem anderen Mandanten erstellen, im System.</span><span class="sxs-lookup"><span data-stu-id="9e9e7-112">The tenants could then derive their own individual protectors based on their own needs, but no matter how hard they try they cannot create protectors which collide with any other tenant in the system.</span></span> <span data-ttu-id="9e9e7-113">Dies wird grafisch dargestellt, wie im folgenden dargestellt.</span><span class="sxs-lookup"><span data-stu-id="9e9e7-113">Graphically, this is represented as below.</span></span>

![Mehrere Mandanten Zwecke](purpose-strings-multitenancy/_static/purposes-multi-tenancy.png)

>[!WARNING]
> <span data-ttu-id="9e9e7-115">Dabei wird vorausgesetzt die Schirm Anwendungssteuerelemente, die APIs für die einzelnen Mandanten zur Verfügung stehen, sodass Mandanten beliebigen Code auf dem Server nicht ausgeführt werden können.</span><span class="sxs-lookup"><span data-stu-id="9e9e7-115">This assumes the umbrella application controls which APIs are available to individual tenants and that tenants cannot execute arbitrary code on the server.</span></span> <span data-ttu-id="9e9e7-116">Wenn ein Mandant beliebigen Code ausgeführt werden kann, sie private Reflektion führen konnte, um die Isolation Garantien zu unterbrechen, oder sie einfach das Schlüsselmaterial direkt lesen und leiten Sie den Unterschlüssel konnte wünschen sie.</span><span class="sxs-lookup"><span data-stu-id="9e9e7-116">If a tenant can execute arbitrary code, they could perform private reflection to break the isolation guarantees, or they could just read the master keying material directly and derive whatever subkeys they desire.</span></span>

<span data-ttu-id="9e9e7-117">Die Datenschutzsystem wird tatsächlich eine Sortierung der mehrinstanzenfähigkeit in der Out-of-Box-Standardkonfiguration verwendet.</span><span class="sxs-lookup"><span data-stu-id="9e9e7-117">The data protection system actually uses a sort of multi-tenancy in its default out-of-the-box configuration.</span></span> <span data-ttu-id="9e9e7-118">Standardmäßig wird die Schlüsselmaterial in Benutzerprofilordner das Arbeitsprozesskonto (oder der Registrierung für IIS-Anwendungspoolidentitäten) gespeichert.</span><span class="sxs-lookup"><span data-stu-id="9e9e7-118">By default master keying material is stored in the worker process account's user profile folder (or the registry, for IIS application pool identities).</span></span> <span data-ttu-id="9e9e7-119">Jedoch wird tatsächlich relativ häufig ein einzelnes Konto verwenden, um mehrere Anwendungen auszuführen und somit alle diese Anwendungen gemeinsam verwenden das Schlüsselmaterial Master enden würde.</span><span class="sxs-lookup"><span data-stu-id="9e9e7-119">But it's actually fairly common to use a single account to run multiple applications, and thus all these applications would end up sharing the master keying material.</span></span> <span data-ttu-id="9e9e7-120">Um dieses Problem zu lösen, fügt die Datenschutzsystem automatisch einen Bezeichner der eindeutigen pro Anwendung als erstes Element in der Kette für allgemeine Zwecke.</span><span class="sxs-lookup"><span data-stu-id="9e9e7-120">To solve this, the data protection system automatically inserts a unique-per-application identifier as the first element in the overall purpose chain.</span></span> <span data-ttu-id="9e9e7-121">Diese implizite Zweck dient, [isolieren einzelanwendungen](xref:security/data-protection/configuration/overview#per-application-isolation) voneinander, indem Sie jede Anwendung effektiv behandeln, wie eine eindeutige Mandant innerhalb des Systems und der Erstellungsvorgang Schutzvorrichtung identisch mit der Abbildung oben dargestellt wird.</span><span class="sxs-lookup"><span data-stu-id="9e9e7-121">This implicit purpose serves to [isolate individual applications](xref:security/data-protection/configuration/overview#per-application-isolation) from one another by effectively treating each application as a unique tenant within the system, and the protector creation process looks identical to the image above.</span></span>
