---
uid: web-forms/overview/older-versions-getting-started/continuing-with-ef/using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started
title: 'Verwenden das Entity Framework 4.0 und das ObjectDataSource-Steuerelement, Teil 1: Erste Schritte | Microsoft Docs'
author: tdykstra
description: Diese Reihe von Lernprogrammen baut auf der Contoso-University-Webanwendung, die von den ersten Schritten mit dem Lernprogramm Entity Framework-Reihe erstellt wird. Wenn Handelsversion...
ms.author: aspnetcontent
manager: wpickett
ms.date: 01/26/2011
ms.topic: article
ms.assetid: 244278c1-fec8-4255-8a8a-13bde491c4f5
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/older-versions-getting-started/continuing-with-ef/using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started
msc.type: authoredcontent
ms.openlocfilehash: 6584767418c898913777b3b1549a816679c8430d
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 04/06/2018
---
<a name="using-the-entity-framework-40-and-the-objectdatasource-control-part-1-getting-started"></a><span data-ttu-id="a68a8-104">Verwenden das Entity Framework 4.0 und das ObjectDataSource-Steuerelement, Teil 1: Erste Schritte</span><span class="sxs-lookup"><span data-stu-id="a68a8-104">Using the Entity Framework 4.0 and the ObjectDataSource Control, Part 1: Getting Started</span></span>
====================
<span data-ttu-id="a68a8-105">durch [Tom Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="a68a8-105">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

> <span data-ttu-id="a68a8-106">Diese Reihe von Lernprogrammen in der Contoso-University Webanwendung durch die erstellte builds der [erste Schritte mit dem Entity Framework 4.0](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md) Reihe von Lernprogrammen.</span><span class="sxs-lookup"><span data-stu-id="a68a8-106">This tutorial series builds on the Contoso University web application that is created by the [Getting Started with the Entity Framework 4.0](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md) tutorial series.</span></span> <span data-ttu-id="a68a8-107">Wenn Sie die frühere Lernprogramme nicht abgeschlossen wurde, als Ausgangspunkt für dieses Lernprogramm können Sie [Herunterladen der Anwendung](https://code.msdn.microsoft.com/ASPNET-Web-Forms-97f8ee9a) , die Sie erstellt haben würden.</span><span class="sxs-lookup"><span data-stu-id="a68a8-107">If you didn't complete the earlier tutorials, as a starting point for this tutorial you can [download the application](https://code.msdn.microsoft.com/ASPNET-Web-Forms-97f8ee9a) that you would have created.</span></span> <span data-ttu-id="a68a8-108">Sie können auch [Herunterladen der Anwendung](https://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa) , die durch das vollständige Lernprogramm Reihe erstellt wird.</span><span class="sxs-lookup"><span data-stu-id="a68a8-108">You can also [download the application](https://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa) that is created by the complete tutorial series.</span></span>
> 
> <span data-ttu-id="a68a8-109">Die Contoso-University Beispielwebanwendung veranschaulicht, wie ASP.NET Web Forms-Anwendungen, die mit dem Entity Framework 4.0 und Visual Studio 2010.</span><span class="sxs-lookup"><span data-stu-id="a68a8-109">The Contoso University sample web application demonstrates how to create ASP.NET Web Forms applications using the Entity Framework 4.0 and Visual Studio 2010.</span></span> <span data-ttu-id="a68a8-110">Die beispielanwendung ist eine Website für eine fiktive Contoso-Universität.</span><span class="sxs-lookup"><span data-stu-id="a68a8-110">The sample application is a website for a fictional Contoso University.</span></span> <span data-ttu-id="a68a8-111">Sie enthält Funktionen wie die Zulassung von Studenten, die Erstellung von Kursen und Aufgaben von Dozenten.</span><span class="sxs-lookup"><span data-stu-id="a68a8-111">It includes functionality such as student admission, course creation, and instructor assignments.</span></span>
> 
> <span data-ttu-id="a68a8-112">Im Lernprogramm werden Beispiele für in c#.</span><span class="sxs-lookup"><span data-stu-id="a68a8-112">The tutorial shows examples in C#.</span></span> <span data-ttu-id="a68a8-113">Die [herunterladbaren Beispiel](https://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa) enthält Code in c# und Visual Basic.</span><span class="sxs-lookup"><span data-stu-id="a68a8-113">The [downloadable sample](https://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa) contains code in both C# and Visual Basic.</span></span>
> 
> ## <a name="database-first"></a><span data-ttu-id="a68a8-114">Zuerst Datenbank</span><span class="sxs-lookup"><span data-stu-id="a68a8-114">Database First</span></span>
> 
> <span data-ttu-id="a68a8-115">Es gibt drei Möglichkeiten, die Sie mit Daten im Entity Framework arbeiten können: *Database First*, *Model First*, und *Code First*.</span><span class="sxs-lookup"><span data-stu-id="a68a8-115">There are three ways you can work with data in the Entity Framework: *Database First*, *Model First*, and *Code First*.</span></span> <span data-ttu-id="a68a8-116">Dieses Lernprogramm ist für Database First.</span><span class="sxs-lookup"><span data-stu-id="a68a8-116">This tutorial is for Database First.</span></span> <span data-ttu-id="a68a8-117">Informationen zu den Unterschieden zwischen den Workflows und einer Anleitung zum Auswählen der besten für Ihr Szenario finden Sie unter [Entity Framework-Entwicklungsworkflows](https://msdn.microsoft.com/library/ms178359.aspx#dbfmfcf).</span><span class="sxs-lookup"><span data-stu-id="a68a8-117">For information about the differences between these workflows and guidance on how to choose the best one for your scenario, see [Entity Framework Development Workflows](https://msdn.microsoft.com/library/ms178359.aspx#dbfmfcf).</span></span>
> 
> ## <a name="web-forms"></a><span data-ttu-id="a68a8-118">Web Forms</span><span class="sxs-lookup"><span data-stu-id="a68a8-118">Web Forms</span></span>
> 
> <span data-ttu-id="a68a8-119">Wie die Reihe Einstieg diese Reihe von Lernprogrammen verwendet die ASP.NET Web Forms-Modell und setzt voraus, dass Sie wissen, dass zum Arbeiten mit ASP.NET Web Forms in Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="a68a8-119">Like the Getting Started series, this tutorial series uses the ASP.NET Web Forms model and assumes you know how to work with ASP.NET Web Forms in Visual Studio.</span></span> <span data-ttu-id="a68a8-120">Wenn dies nicht tun, werden dort [erste Schritte mit ASP.NET 4.5 Web Forms](../../getting-started/getting-started-with-aspnet-45-web-forms/introduction-and-overview.md).</span><span class="sxs-lookup"><span data-stu-id="a68a8-120">If you don't, see [Getting Started with ASP.NET 4.5 Web Forms](../../getting-started/getting-started-with-aspnet-45-web-forms/introduction-and-overview.md).</span></span> <span data-ttu-id="a68a8-121">Wenn Sie mit ASP.NET MVC-Framework arbeiten lieber, finden Sie unter [erste Schritte mit dem Entity Framework mit ASP.NET MVC](../../../../mvc/overview/getting-started/getting-started-with-ef-using-mvc/creating-an-entity-framework-data-model-for-an-asp-net-mvc-application.md).</span><span class="sxs-lookup"><span data-stu-id="a68a8-121">If you prefer to work with the ASP.NET MVC framework, see [Getting Started with the Entity Framework using ASP.NET MVC](../../../../mvc/overview/getting-started/getting-started-with-ef-using-mvc/creating-an-entity-framework-data-model-for-an-asp-net-mvc-application.md).</span></span>
> 
> ## <a name="software-versions"></a><span data-ttu-id="a68a8-122">Versionen der Software</span><span class="sxs-lookup"><span data-stu-id="a68a8-122">Software versions</span></span>
> 
> | <span data-ttu-id="a68a8-123">**In diesem Lernprogramm gezeigt**</span><span class="sxs-lookup"><span data-stu-id="a68a8-123">**Shown in the tutorial**</span></span> | <span data-ttu-id="a68a8-124">**Funktioniert auch mit**</span><span class="sxs-lookup"><span data-stu-id="a68a8-124">**Also works with**</span></span> |
> | --- | --- |
> | <span data-ttu-id="a68a8-125">Windows 7</span><span class="sxs-lookup"><span data-stu-id="a68a8-125">Windows 7</span></span> | <span data-ttu-id="a68a8-126">Windows 8</span><span class="sxs-lookup"><span data-stu-id="a68a8-126">Windows 8</span></span> |
> | <span data-ttu-id="a68a8-127">Visual Studio 2010</span><span class="sxs-lookup"><span data-stu-id="a68a8-127">Visual Studio 2010</span></span> | <span data-ttu-id="a68a8-128">Visual Studio 2010 Express für Web.</span><span class="sxs-lookup"><span data-stu-id="a68a8-128">Visual Studio 2010 Express for Web.</span></span> <span data-ttu-id="a68a8-129">Das Lernprogramm wurde nicht mit späteren Versionen von Visual Studio getestet.</span><span class="sxs-lookup"><span data-stu-id="a68a8-129">The tutorial has not been tested with later versions of Visual Studio.</span></span> <span data-ttu-id="a68a8-130">Es gibt viele Unterschiede in Menüs, Dialogfelder und Vorlagen aus.</span><span class="sxs-lookup"><span data-stu-id="a68a8-130">There are many differences in menu selections, dialog boxes, and templates.</span></span> |
> | <span data-ttu-id="a68a8-131">.NET 4</span><span class="sxs-lookup"><span data-stu-id="a68a8-131">.NET 4</span></span> | <span data-ttu-id="a68a8-132">.NET 4.5 ist abwärtskompatibel mit .NET 4, aber im Lernprogramm wurde mit .NET 4.5 nicht getestet.</span><span class="sxs-lookup"><span data-stu-id="a68a8-132">.NET 4.5 is backward compatible with .NET 4, but the tutorial has not been tested with .NET 4.5.</span></span> |
> | <span data-ttu-id="a68a8-133">Entity Framework 4</span><span class="sxs-lookup"><span data-stu-id="a68a8-133">Entity Framework 4</span></span> | <span data-ttu-id="a68a8-134">Das Lernprogramm wurde mit höheren Versionen von Entity Framework nicht getestet.</span><span class="sxs-lookup"><span data-stu-id="a68a8-134">The tutorial has not been tested with later versions of Entity Framework.</span></span> <span data-ttu-id="a68a8-135">Ab Entity Framework 5, EF verwendet standardmäßig die `DbContext API` , EF 4.1 eingeführt wurde.</span><span class="sxs-lookup"><span data-stu-id="a68a8-135">Starting with Entity Framework 5, EF uses by default the `DbContext API` that was introduced with EF 4.1.</span></span> <span data-ttu-id="a68a8-136">EntityDataSource-Steuerelements wurde entworfen, um mithilfe der `ObjectContext` API.</span><span class="sxs-lookup"><span data-stu-id="a68a8-136">The EntityDataSource control was designed to use the `ObjectContext` API.</span></span> <span data-ttu-id="a68a8-137">Informationen zur Verwendung von EntityDataSource steuern, mit der `DbContext` -API finden Sie unter [diesem Blogbeitrag](https://blogs.msdn.com/b/webdev/archive/2012/09/13/how-to-use-the-entitydatasource-control-with-entity-framework-code-first.aspx).</span><span class="sxs-lookup"><span data-stu-id="a68a8-137">For information about how to use the EntityDataSource control with the `DbContext` API, see [this blog post](https://blogs.msdn.com/b/webdev/archive/2012/09/13/how-to-use-the-entitydatasource-control-with-entity-framework-code-first.aspx).</span></span> |
> 
> ## <a name="questions"></a><span data-ttu-id="a68a8-138">Fragen</span><span class="sxs-lookup"><span data-stu-id="a68a8-138">Questions</span></span>
> 
> <span data-ttu-id="a68a8-139">Wenn Sie Fragen, die nicht direkt mit dem Lernprogramm verknüpft sind haben, bereitstellen können, die [ASP.NET Entity Framework-Forum](https://forums.asp.net/1227.aspx), [Entity Framework und LINQ to Entities-Forum](https://social.msdn.microsoft.com/forums/adodotnetentityframework/threads/), oder [ StackOverflow.com](http://stackoverflow.com/).</span><span class="sxs-lookup"><span data-stu-id="a68a8-139">If you have questions that are not directly related to the tutorial, you can post them to the [ASP.NET Entity Framework forum](https://forums.asp.net/1227.aspx), the [Entity Framework and LINQ to Entities forum](https://social.msdn.microsoft.com/forums/adodotnetentityframework/threads/), or [StackOverflow.com](http://stackoverflow.com/).</span></span>


<span data-ttu-id="a68a8-140">Die `EntityDataSource` Steuerelement können Sie eine Anwendung sehr schnell zu erstellen, aber in der Regel müssen Sie eine beträchtliche Menge an von Geschäftslogik und Datenzugriffslogik in behalten Ihre *aspx* Seiten.</span><span class="sxs-lookup"><span data-stu-id="a68a8-140">The `EntityDataSource` control enables you to create an application very quickly, but it typically requires you to keep a significant amount of business logic and data-access logic in your *.aspx* pages.</span></span> <span data-ttu-id="a68a8-141">Wenn Sie erwarten, die Anwendung dass an Komplexität zunehmen und laufende Wartung erforderlich ist, können Sie weitere Entwicklungszeit vorab investieren, um das Erstellen einer *n-Tier-* oder *überlappende* Anwendungsstruktur Das ist sind besser verwaltbar.</span><span class="sxs-lookup"><span data-stu-id="a68a8-141">If you expect your application to grow in complexity and to require ongoing maintenance, you can invest more development time up front in order to create an *n-tier* or *layered* application structure that's more maintainable.</span></span> <span data-ttu-id="a68a8-142">Um diese Architektur zu implementieren, trennen Sie die Darstellungsschicht von Logik der Geschäftsebene (BLL) und die Datenzugriffsebene (DAL).</span><span class="sxs-lookup"><span data-stu-id="a68a8-142">To implement this architecture, you separate the presentation layer from the business logic layer (BLL) and the data access layer (DAL).</span></span> <span data-ttu-id="a68a8-143">Eine Möglichkeit, implementieren diese Struktur ist die Verwendung der `ObjectDataSource` anstelle von steuern die `EntityDataSource` Steuerelement.</span><span class="sxs-lookup"><span data-stu-id="a68a8-143">One way to implement this structure is to use the `ObjectDataSource` control instead of the `EntityDataSource` control.</span></span> <span data-ttu-id="a68a8-144">Bei Verwendung der `ObjectDataSource` -Steuerelement, implementieren Sie einen eigene Datenzugriffs-Code und anschließend in Aufrufen *aspx* Seiten, die ein Steuerelement, das viele der gleichen wurde mit Funktionen wie bei anderen Datenquellen-Steuerelementen.</span><span class="sxs-lookup"><span data-stu-id="a68a8-144">When you use the `ObjectDataSource` control, you implement your own data-access code and then invoke it in *.aspx* pages using a control that has many of the same features as other data-source controls.</span></span> <span data-ttu-id="a68a8-145">Dadurch können Sie die Vorteile einer n-Tier-Ansatz mit den Vorteilen der Verwendung einer Web Forms-Steuerelement für den Datenzugriff zu kombinieren.</span><span class="sxs-lookup"><span data-stu-id="a68a8-145">This lets you combine the advantages of an n-tier approach with the benefits of using a Web Forms control for data access.</span></span>

<span data-ttu-id="a68a8-146">Die `ObjectDataSource` Steuerelement können Sie flexibler auf andere Weise als auch.</span><span class="sxs-lookup"><span data-stu-id="a68a8-146">The `ObjectDataSource` control gives you more flexibility in other ways as well.</span></span> <span data-ttu-id="a68a8-147">Da Sie Datenzugriff Code schreiben, es ist einfacher, mehr als nur lesen, einfügen, aktualisieren oder Löschen einen bestimmten Typ, dem sind die Aufgaben, die die `EntityDataSource` Steuerelement ausführen soll.</span><span class="sxs-lookup"><span data-stu-id="a68a8-147">Because you write your own data-access code, it's easier to do more than just read, insert, update, or delete a specific entity type, which are the tasks that the `EntityDataSource` control is designed to perform.</span></span> <span data-ttu-id="a68a8-148">Sie können z. B. Führen Sie die Protokollierung wird jedes Mal, wenn eine Entität aktualisiert wird, Daten archivieren, wenn eine Entität gelöscht wird oder automatisch Check- und Update-Daten bezogene nach Bedarf, wenn Sie eine Zeile mit einem Fremdschlüsselwert einfügen.</span><span class="sxs-lookup"><span data-stu-id="a68a8-148">For example, you can perform logging every time an entity is updated, archive data whenever an entity is deleted, or automatically check and update related data as needed when inserting a row with a foreign key value.</span></span>

## <a name="business-logic-and-repository-classes"></a><span data-ttu-id="a68a8-149">Geschäftslogik und Repositoryklassen</span><span class="sxs-lookup"><span data-stu-id="a68a8-149">Business Logic and Repository Classes</span></span>

<span data-ttu-id="a68a8-150">Ein `ObjectDataSource` -Steuerelement funktioniert durch den Aufruf einer Klasse, die Sie erstellen.</span><span class="sxs-lookup"><span data-stu-id="a68a8-150">An `ObjectDataSource` control works by invoking a class that you create.</span></span> <span data-ttu-id="a68a8-151">Die Klasse enthält Methoden, die Daten abgerufen und aktualisiert, und Sie die Namen dieser Methoden zum Bereitstellen der `ObjectDataSource` Steuerelement im Markup.</span><span class="sxs-lookup"><span data-stu-id="a68a8-151">The class includes methods that retrieve and update data, and you provide the names of those methods to the `ObjectDataSource` control in markup.</span></span> <span data-ttu-id="a68a8-152">Beim Rendern oder postback Verarbeitung der `ObjectDataSource` Ruft die Methoden, die Sie angegeben haben.</span><span class="sxs-lookup"><span data-stu-id="a68a8-152">During rendering or postback processing, the `ObjectDataSource` calls the methods that you've specified.</span></span>

<span data-ttu-id="a68a8-153">Neben grundlegende CRUD-Vorgänge, die Klasse, die Sie erstellen, für die Verwendung mit der `ObjectDataSource` Steuerelement zum Ausführen der Geschäftslogik müssen möglicherweise bei der `ObjectDataSource` liest Daten oder darin aktualisiert.</span><span class="sxs-lookup"><span data-stu-id="a68a8-153">Besides basic CRUD operations, the class that you create to use with the `ObjectDataSource` control might need to execute business logic when the `ObjectDataSource` reads or updates data.</span></span> <span data-ttu-id="a68a8-154">Wenn Sie eine Abteilung aktualisieren, müssen Sie überprüfen, dass keine anderen Abteilungen derselben Administrator verfügen, da eine Person Administrator der mehr als eine Abteilung sein darf.</span><span class="sxs-lookup"><span data-stu-id="a68a8-154">For example, when you update a department, you might need to validate that no other departments have the same administrator because one person cannot be administrator of more than one department.</span></span>

<span data-ttu-id="a68a8-155">In einigen `ObjectDataSource` Dokumentation, z. B. die [ObjectDataSource-Klassenübersicht](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.aspx), ruft das Steuerelement eine Klasse, die als bezeichnet eine *Geschäftsobjekt* , Geschäftslogik und Datenzugriffslogik enthält .</span><span class="sxs-lookup"><span data-stu-id="a68a8-155">In some `ObjectDataSource` documentation, such as the [ObjectDataSource Class overview](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.aspx), the control calls a class referred to as a *business object* that includes both business logic and data-access logic.</span></span> <span data-ttu-id="a68a8-156">In diesem Lernprogramm erstellen Sie separate Klassen für Geschäftslogik und Datenzugriffslogik.</span><span class="sxs-lookup"><span data-stu-id="a68a8-156">In this tutorial you will create separate classes for business logic and for data-access logic.</span></span> <span data-ttu-id="a68a8-157">Die Klasse, die Datenzugriffslogik kapselt heißt ein *Repository*.</span><span class="sxs-lookup"><span data-stu-id="a68a8-157">The class that encapsulates data-access logic is called a *repository*.</span></span> <span data-ttu-id="a68a8-158">Die Business Logic-Klasse enthält Methoden Geschäftslogik und Datenzugriff Methoden, aber die Datenzugriffs-Methoden aufrufen, das Repository, sodass die Datenzugriffs-Aufgaben ausführen.</span><span class="sxs-lookup"><span data-stu-id="a68a8-158">The business logic class includes both business-logic methods and data-access methods, but the data-access methods call the repository to perform data-access tasks.</span></span>

<span data-ttu-id="a68a8-159">Erstellen Sie auch eine Abstraktionsebene zwischen Ihrem BLL und der DAL, die die automatisierte Komponententests erleichtert die BLL testen.</span><span class="sxs-lookup"><span data-stu-id="a68a8-159">You will also create an abstraction layer between your BLL and DAL that facilitates automated unit testing of the BLL.</span></span> <span data-ttu-id="a68a8-160">Diese Abstraktionsebene wird durch Erstellen einer Schnittstelle und die Benutzeroberfläche verwenden, wenn Sie das Repository in der Geschäftslogik Klasse instanziieren implementiert.</span><span class="sxs-lookup"><span data-stu-id="a68a8-160">This abstraction layer is implemented by creating an interface and using the interface when you instantiate the repository in the business-logic class.</span></span> <span data-ttu-id="a68a8-161">Dies ermöglicht es Ihnen, die Geschäftslogik Klasse mit einem Verweis auf ein Objekt zu senden, der Repository-Schnittstelle implementiert.</span><span class="sxs-lookup"><span data-stu-id="a68a8-161">This makes it possible for you to provide the business-logic class with a reference to any object that implements the repository interface.</span></span> <span data-ttu-id="a68a8-162">Für den normalen Betrieb Geben Sie ein Repository-Objekt, das mit dem Entity Framework zusammenarbeitet.</span><span class="sxs-lookup"><span data-stu-id="a68a8-162">For normal operation, you provide a repository object that works with the Entity Framework.</span></span> <span data-ttu-id="a68a8-163">Zum Testen, geben Sie ein Repository-Objekt, das zusammen mit den Daten gespeichert, mit denen Sie problemlos ändern können, z. B. Klassenvariablen als Sammlungen definiert.</span><span class="sxs-lookup"><span data-stu-id="a68a8-163">For testing, you provide a repository object that works with data stored in a way that you can easily manipulate, such as class variables defined as collections.</span></span>

<span data-ttu-id="a68a8-164">Die folgende Abbildung zeigt den Unterschied zwischen einer Geschäftslogik-Klasse, die Datenzugriffslogik ohne ein Repository enthält und die andere ein Repository verwendet.</span><span class="sxs-lookup"><span data-stu-id="a68a8-164">The following illustration shows the difference between a business-logic class that includes data-access logic without a repository and one that uses a repository.</span></span>

<span data-ttu-id="a68a8-165">[![Image05](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image2.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="a68a8-165">[![Image05](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image2.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image1.png)</span></span>

<span data-ttu-id="a68a8-166">Sie können jetzt durch das Erstellen von Webseiten in der die `ObjectDataSource` -Steuerelement direkt in einem Repository gebunden ist, da es nur grundlegende Datenzugriffs-Aufgaben ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="a68a8-166">You will begin by creating web pages in which the `ObjectDataSource` control is bound directly to a repository because it only performs basic data-access tasks.</span></span> <span data-ttu-id="a68a8-167">Im nächsten Lernprogramm erstellen Sie eine Business Logic-Klasse mit der Validierungslogik und Binden der `ObjectDataSource` Steuerelement für diese Klasse anstelle von der Repository-Klasse.</span><span class="sxs-lookup"><span data-stu-id="a68a8-167">In the next tutorial you will create a business logic class with validation logic and bind the `ObjectDataSource` control to that class instead of to the repository class.</span></span> <span data-ttu-id="a68a8-168">Außerdem erstellen Sie Komponententests für die Validierungslogik.</span><span class="sxs-lookup"><span data-stu-id="a68a8-168">You will also create unit tests for the validation logic.</span></span> <span data-ttu-id="a68a8-169">Fügen Sie in das dritte Lernprogramm dieser Reihe Sortier- und Filterfunktionen zur Anwendung.</span><span class="sxs-lookup"><span data-stu-id="a68a8-169">In the third tutorial in this series you will add sorting and filtering functionality to the application.</span></span>

<span data-ttu-id="a68a8-170">Die Seiten, die Sie in diesem Lernprogramm erstellen, arbeiten mit der `Departments` Entitätenmenge des Datenmodells, die Sie in erstellt die [Getting Started Tutorial Reihe](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md).</span><span class="sxs-lookup"><span data-stu-id="a68a8-170">The pages you create in this tutorial work with the `Departments` entity set of the data model that you created in the [Getting Started tutorial series](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md).</span></span>

<span data-ttu-id="a68a8-171">[![Image01 abgerufen wird](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image4.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="a68a8-171">[![Image01](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image4.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image3.png)</span></span>

<span data-ttu-id="a68a8-172">[![Image02](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image6.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="a68a8-172">[![Image02](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image6.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image5.png)</span></span>

## <a name="updating-the-database-and-the-data-model"></a><span data-ttu-id="a68a8-173">Aktualisieren der Datenbank und des Datenmodells</span><span class="sxs-lookup"><span data-stu-id="a68a8-173">Updating the Database and the Data Model</span></span>

<span data-ttu-id="a68a8-174">Sie werden in diesem Lernprogramm beginnen, durch zwei Änderungen an der Datenbank, die beides erforderlich, dass entsprechende Änderungen an das Datenmodell, das Sie in erstellt die [erste Schritte mit dem Entity Framework und Web Forms](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md) Lernprogramme.</span><span class="sxs-lookup"><span data-stu-id="a68a8-174">You will begin this tutorial by making two changes to the database, both of which require corresponding changes to the data model that you created in the [Getting Started with the Entity Framework and Web Forms](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md) tutorials.</span></span> <span data-ttu-id="a68a8-175">In einem diese Lernprogramme wurden Sie Änderungen an, in den Designer manuell in das Datenmodell mit der Datenbank nach dem Ändern einer Datenbank zu synchronisieren.</span><span class="sxs-lookup"><span data-stu-id="a68a8-175">In one of those tutorials, you made changes in the designer manually to synchronize the data model with the database after a database change.</span></span> <span data-ttu-id="a68a8-176">In diesem Lernprogramm verwenden Sie des Designers **Aktualisieren von Modelldatenbank** Tool, um das Datenmodell automatisch zu aktualisieren.</span><span class="sxs-lookup"><span data-stu-id="a68a8-176">In this tutorial, you will use the designer's **Update Model From Database** tool to update the data model automatically.</span></span>

### <a name="adding-a-relationship-to-the-database"></a><span data-ttu-id="a68a8-177">Hinzufügen einer Beziehung mit der Datenbank</span><span class="sxs-lookup"><span data-stu-id="a68a8-177">Adding a Relationship to the Database</span></span>

<span data-ttu-id="a68a8-178">Öffnen Sie in Visual Studio die Contoso University-Webanwendung, die Sie erstellt, in haben der [erste Schritte mit dem Entity Framework und Web Forms](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md) Reihe von Lernprogrammen, und öffnen Sie dann die `SchoolDiagram` Datenbankdiagramm.</span><span class="sxs-lookup"><span data-stu-id="a68a8-178">In Visual Studio, open the Contoso University web application you created in the [Getting Started with the Entity Framework and Web Forms](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md) tutorial series, and then open the `SchoolDiagram` database diagram.</span></span>

<span data-ttu-id="a68a8-179">Bei Betrachtung der `Department` Tabelle im Datenbankdiagramm, sehen Sie, dass es wurde eine `Administrator` Spalte.</span><span class="sxs-lookup"><span data-stu-id="a68a8-179">If you look at the `Department` table in the database diagram, you will see that it has an `Administrator` column.</span></span> <span data-ttu-id="a68a8-180">Diese Spalte ist ein Fremdschlüssel für die `Person` Tabelle, aber keine Fremdschlüssel-Beziehung in der Datenbank definiert ist.</span><span class="sxs-lookup"><span data-stu-id="a68a8-180">This column is a foreign key to the `Person` table, but no foreign key relationship is defined in the database.</span></span> <span data-ttu-id="a68a8-181">Sie müssen die Beziehung zu erstellen und Aktualisieren des Datenmodells, damit Entity Framework automatisch diese Beziehung behandeln können.</span><span class="sxs-lookup"><span data-stu-id="a68a8-181">You need to create the relationship and update the data model so that the Entity Framework can automatically handle this relationship.</span></span>

<span data-ttu-id="a68a8-182">Das Datenbankdiagramm mit der Maustaste die `Department` Tabelle, und wählen Sie **Beziehungen**.</span><span class="sxs-lookup"><span data-stu-id="a68a8-182">In the database diagram, right-click the `Department` table, and select **Relationships**.</span></span>

<span data-ttu-id="a68a8-183">[![Image80](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image8.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="a68a8-183">[![Image80](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image8.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image7.png)</span></span>

<span data-ttu-id="a68a8-184">In der **Foreign Key Relationships** auf **hinzufügen**, klicken Sie dann auf die Schaltfläche für **Tabellen- und Spaltenspezifikation**.</span><span class="sxs-lookup"><span data-stu-id="a68a8-184">In the **Foreign Key Relationships** box click **Add**, then click the ellipsis for **Tables and Columns Specification**.</span></span>

<span data-ttu-id="a68a8-185">[![Image81](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image10.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="a68a8-185">[![Image81](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image10.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image9.png)</span></span>

<span data-ttu-id="a68a8-186">In der **Tabellen und Spalten** Dialogfeld Feld, legen Sie die Primärschlüsseltabelle und Datumsfeld in `Person` und `PersonID`, und legen Sie die Fremdschlüsseltabelle, und das Feld auf `Department` und `Administrator`.</span><span class="sxs-lookup"><span data-stu-id="a68a8-186">In the **Tables and Columns** dialog box, set the primary key table and field to `Person` and `PersonID`, and set the foreign key table and field to `Department` and `Administrator`.</span></span> <span data-ttu-id="a68a8-187">(Wenn Sie dies tun, ändert sich der Name der Beziehung aus `FK_Department_Department` auf `FK_Department_Person`.)</span><span class="sxs-lookup"><span data-stu-id="a68a8-187">(When you do this, the relationship name will change from `FK_Department_Department` to `FK_Department_Person`.)</span></span>

<span data-ttu-id="a68a8-188">[![Image82](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image12.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="a68a8-188">[![Image82](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image12.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image11.png)</span></span>

<span data-ttu-id="a68a8-189">Klicken Sie auf **OK** in der **Tabellen und Spalten** auf **schließen** in der **Foreign Key Relationships** ein, und speichern Sie die Änderungen.</span><span class="sxs-lookup"><span data-stu-id="a68a8-189">Click **OK** in the **Tables and Columns** box, click **Close** in the **Foreign Key Relationships** box, and save the changes.</span></span> <span data-ttu-id="a68a8-190">Wenn Sie gefragt werden, ob Sie speichern möchten die `Person` und `Department` Tabellen, klicken Sie auf **Ja**.</span><span class="sxs-lookup"><span data-stu-id="a68a8-190">If you're asked if you want to save the `Person` and `Department` tables, click **Yes**.</span></span>

> [!NOTE]
> <span data-ttu-id="a68a8-191">Wenn Sie gelöscht haben `Person` Zeilen, die Daten entsprechen, die bereits in der `Administrator` Spalte, Sie ist nicht möglich, diese Änderung zu speichern.</span><span class="sxs-lookup"><span data-stu-id="a68a8-191">If you've deleted `Person` rows that correspond to data that's already in the `Administrator` column, you will not be able to save this change.</span></span> <span data-ttu-id="a68a8-192">In diesem Fall verwenden Sie die Tabellen-Editor in **Server-Explorer** sicherstellen, dass die `Administrator` Wert in jeder `Department` Zeile enthält die ID eines Datensatzes, der im tatsächlich vorhanden ist die `Person` Tabelle.</span><span class="sxs-lookup"><span data-stu-id="a68a8-192">In that case, use the table editor in **Server Explorer** to make sure that the `Administrator` value in every `Department` row contains the ID of a record that actually exists in the `Person` table.</span></span>
> 
> <span data-ttu-id="a68a8-193">Nachdem Sie die Änderung zu speichern, Sie ist nicht möglich, löschen Sie eine Zeile aus der `Person` Tabelle, wenn diese Person ein Abteilung-Administrator ist.</span><span class="sxs-lookup"><span data-stu-id="a68a8-193">After you save the change, you will not be able to delete a row from the `Person` table if that person is a department administrator.</span></span> <span data-ttu-id="a68a8-194">In einer produktionsanwendung würde Sie eine entsprechende Fehlermeldung bereitstellen, wenn eine Datenbank-Einschränkung wird verhindert, einen Löschvorgang dass, oder Sie eine Löschweitergabe geben.</span><span class="sxs-lookup"><span data-stu-id="a68a8-194">In a production application, you would provide a specific error message when a database constraint prevents a deletion, or you would specify a cascading delete.</span></span> <span data-ttu-id="a68a8-195">Ein Beispiel zum Angeben einer Löschweitergabe, finden Sie unter [das Entity Framework und ASP.NET – erste Schritte Teil 2](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-2.md).</span><span class="sxs-lookup"><span data-stu-id="a68a8-195">For an example of how to specify a cascading delete, see [The Entity Framework and ASP.NET – Getting Started Part 2](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-2.md).</span></span>


### <a name="adding-a-view-to-the-database"></a><span data-ttu-id="a68a8-196">Hinzufügen einer Ansicht mit der Datenbank</span><span class="sxs-lookup"><span data-stu-id="a68a8-196">Adding a View to the Database</span></span>

<span data-ttu-id="a68a8-197">In der neuen *Departments.aspx* Seite, die Sie erstellen, Dropdownlisten Trainern mit Namen im Format "zuerst letzten" bieten, sodass Benutzer, Abteilung Administratoren auswählen können werden sollen.</span><span class="sxs-lookup"><span data-stu-id="a68a8-197">In the new *Departments.aspx* page that you will be creating, you want to provide a drop-down list of instructors, with names in "last, first" format so that users can select department administrators.</span></span> <span data-ttu-id="a68a8-198">Um dies zu vereinfachen, erstellen Sie eine Ansicht in der Datenbank.</span><span class="sxs-lookup"><span data-stu-id="a68a8-198">To make it easier to do that, you will create a view in the database.</span></span> <span data-ttu-id="a68a8-199">Die Sicht wird nur die Daten, die von der Dropdown Liste benötigt bestehen: der vollständige Name (ordnungsgemäß formatiert) und Datensatzschlüssel.</span><span class="sxs-lookup"><span data-stu-id="a68a8-199">The view will consist of just the data needed by the drop-down list: the full name (properly formatted) and the record key.</span></span>

<span data-ttu-id="a68a8-200">In **Server-Explorer**, erweitern Sie *School.mdf*, mit der rechten Maustaste die **Ansichten** Ordner, und wählen **neue Sicht hinzufügen**.</span><span class="sxs-lookup"><span data-stu-id="a68a8-200">In **Server Explorer**, expand *School.mdf*, right-click the **Views** folder, and select **Add New View**.</span></span>

<span data-ttu-id="a68a8-201">[![Image06](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image14.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="a68a8-201">[![Image06](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image14.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image13.png)</span></span>

<span data-ttu-id="a68a8-202">Klicken Sie auf **schließen** bei der **Tabelle hinzufügen** Dialogfeld wird angezeigt, und fügen Sie die folgende SQL-Anweisung in der SQL-Bereich:</span><span class="sxs-lookup"><span data-stu-id="a68a8-202">Click **Close** when the **Add Table** dialog box appears, and paste the following SQL statement into the SQL pane:</span></span>

[!code-sql[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample1.sql)]

<span data-ttu-id="a68a8-203">Speichern Sie die Ansicht als `vInstructorName`.</span><span class="sxs-lookup"><span data-stu-id="a68a8-203">Save the view as `vInstructorName`.</span></span>

### <a name="updating-the-data-model"></a><span data-ttu-id="a68a8-204">Aktualisieren das Datenmodell</span><span class="sxs-lookup"><span data-stu-id="a68a8-204">Updating the Data Model</span></span>

<span data-ttu-id="a68a8-205">In der *DAL* Ordner die *SchoolModel.edmx* Datei, mit der rechten Maustaste in der Entwurfsoberfläche, und wählen **Modell aus der Datenbank aktualisieren**.</span><span class="sxs-lookup"><span data-stu-id="a68a8-205">In the *DAL* folder, open the *SchoolModel.edmx* file, right-click the design surface, and select **Update Model from Database**.</span></span>

<span data-ttu-id="a68a8-206">[![Image07](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image16.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="a68a8-206">[![Image07](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image16.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image15.png)</span></span>

<span data-ttu-id="a68a8-207">In der **Datenbankobjekte auswählen** wählen Sie im Dialogfeld die **hinzufügen** Registerkarte, und wählen Sie die Ansicht, die Sie gerade erstellt haben.</span><span class="sxs-lookup"><span data-stu-id="a68a8-207">In the **Choose Your Database Objects** dialog box, select the **Add** tab and select the view you just created.</span></span>

<span data-ttu-id="a68a8-208">[![Image08](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image18.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="a68a8-208">[![Image08](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image18.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image17.png)</span></span>

<span data-ttu-id="a68a8-209">Klicken Sie auf **Fertig stellen**.</span><span class="sxs-lookup"><span data-stu-id="a68a8-209">Click **Finish**.</span></span>

<span data-ttu-id="a68a8-210">Im Designer angezeigt, dass das Tool erstellt eine `vInstructorName` Entität und eine neue Zuordnung zwischen der `Department` und `Person` Entitäten.</span><span class="sxs-lookup"><span data-stu-id="a68a8-210">In the designer, you see that the tool created a `vInstructorName` entity and a new association between the `Department` and `Person` entities.</span></span>

<span data-ttu-id="a68a8-211">[![image13](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image20.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="a68a8-211">[![Image13](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image20.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image19.png)</span></span>

> [!NOTE]
> <span data-ttu-id="a68a8-212">In der **Ausgabe** und **Fehlerliste** Windows möglicherweise eine Warnung darüber informiert, dass das Tool automatisch, einen primären erstellt Schlüssel für die neue `vInstructorName` anzeigen.</span><span class="sxs-lookup"><span data-stu-id="a68a8-212">In the **Output** and **Error List** windows you might see a warning message informing you that the tool automatically created a primary key for the new `vInstructorName` view.</span></span> <span data-ttu-id="a68a8-213">Dabei handelt es sich um ein erwartetes Verhalten.</span><span class="sxs-lookup"><span data-stu-id="a68a8-213">This is expected behavior.</span></span>


<span data-ttu-id="a68a8-214">Bei Verweisen auf die neue `vInstructorName` Entität im Code, nicht die Datenbank-Konvention vom voranstellen von eines Kleinbuchstaben "V" darauf verwenden möchten.</span><span class="sxs-lookup"><span data-stu-id="a68a8-214">When you refer to the new `vInstructorName` entity in code, you don't want to use the database convention of prefixing a lower-case "v" to it.</span></span> <span data-ttu-id="a68a8-215">Aus diesem Grund werden Sie die Entität und zur Entitätssammlung im Modell umbenannt.</span><span class="sxs-lookup"><span data-stu-id="a68a8-215">Therefore, you will rename the entity and entity set in the model.</span></span>

<span data-ttu-id="a68a8-216">Öffnen der **Model-Browser**.</span><span class="sxs-lookup"><span data-stu-id="a68a8-216">Open the **Model Browser**.</span></span> <span data-ttu-id="a68a8-217">Sie finden Sie unter `vInstructorName` als Entitätstyp und einer Ansicht aufgeführt.</span><span class="sxs-lookup"><span data-stu-id="a68a8-217">You see `vInstructorName` listed as an entity type and a view.</span></span>

<span data-ttu-id="a68a8-218">[![image14](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image22.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="a68a8-218">[![Image14](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image22.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image21.png)</span></span>

<span data-ttu-id="a68a8-219">Klicken Sie unter **SchoolModel** (nicht **SchoolModel.Store**), mit der rechten Maustaste **vInstructorName** , und wählen Sie **Eigenschaften**.</span><span class="sxs-lookup"><span data-stu-id="a68a8-219">Under **SchoolModel** (not **SchoolModel.Store**), right-click **vInstructorName** and select **Properties**.</span></span> <span data-ttu-id="a68a8-220">In der **Eigenschaften** Ändern der **Namen** -Eigenschaft auf "InstructorName", und Ändern der **Entitätsname festgelegt** -Eigenschaft auf "InstructorNames".</span><span class="sxs-lookup"><span data-stu-id="a68a8-220">In the **Properties** window, change the **Name** property to "InstructorName" and change the **Entity Set Name** property to "InstructorNames".</span></span>

<span data-ttu-id="a68a8-221">[![image15](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image24.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="a68a8-221">[![Image15](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image24.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image23.png)</span></span>

<span data-ttu-id="a68a8-222">Speichern und schließen Sie das Datenmodell, und klicken Sie dann das Projekt neu.</span><span class="sxs-lookup"><span data-stu-id="a68a8-222">Save and close the data model, and then rebuild the project.</span></span>

## <a name="using-a-repository-class-and-an-objectdatasource-control"></a><span data-ttu-id="a68a8-223">Verwenden eine Repository-Klasse und einem ObjectDataSource-Steuerelement</span><span class="sxs-lookup"><span data-stu-id="a68a8-223">Using a Repository Class and an ObjectDataSource Control</span></span>

<span data-ttu-id="a68a8-224">Erstellen Sie eine neue Klassendatei in der *DAL* Ordner, nennen Sie sie *SchoolRepository.cs*, und Ersetzen Sie den vorhandenen Code durch folgenden Code:</span><span class="sxs-lookup"><span data-stu-id="a68a8-224">Create a new class file in the *DAL* folder, name it *SchoolRepository.cs*, and replace the existing code with the following code:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample2.cs)]

<span data-ttu-id="a68a8-225">Dieser Code stellt eine einzelne `GetDepartments` Methode, die alle Entitäten in Objekte die `Departments` Entitätenmenge.</span><span class="sxs-lookup"><span data-stu-id="a68a8-225">This code provides a single `GetDepartments` method that returns all of the entities in the `Departments` entity set.</span></span> <span data-ttu-id="a68a8-226">Da Sie wissen, dass der Zugriff auf die wird die `Person` Navigationseigenschaft für jede Zeile zurückgegeben, Sie geben unverzüglichem Laden von für diese Eigenschaft mit dem `Include` Methode.</span><span class="sxs-lookup"><span data-stu-id="a68a8-226">Because you know that you will be accessing the `Person` navigation property for every row returned, you specify eager loading for that property by using the `Include` method.</span></span> <span data-ttu-id="a68a8-227">Die Klasse implementiert auch die `IDisposable` Schnittstelle, um sicherzustellen, dass die Verbindung mit der Datenbank freigegeben wird, wenn das Objekt freigegeben wurde.</span><span class="sxs-lookup"><span data-stu-id="a68a8-227">The class also implements the `IDisposable` interface to ensure that the database connection is released when the object is disposed.</span></span>

> [!NOTE]
> <span data-ttu-id="a68a8-228">Üblicherweise wird zum Erstellen einer Klasse Repository für jeden Entitätstyp.</span><span class="sxs-lookup"><span data-stu-id="a68a8-228">A common practice is to create a repository class for each entity type.</span></span> <span data-ttu-id="a68a8-229">In diesem Lernprogramm wird eine Repository-Klasse für mehrere Entitätstypen verwendet.</span><span class="sxs-lookup"><span data-stu-id="a68a8-229">In this tutorial, one repository class for multiple entity types is used.</span></span> <span data-ttu-id="a68a8-230">Weitere Informationen über das Repositorymuster finden Sie unter den Beiträgen in [das Entity Framework-Team-Blog](https://blogs.msdn.com/b/adonet/archive/2009/06/16/using-repository-and-unit-of-work-patterns-with-entity-framework-4-0.aspx) und [Julie Lermans Blog](http://thedatafarm.com/blog/data-access/agile-ef4-repository-part-3-fine-tuning-the-repository/).</span><span class="sxs-lookup"><span data-stu-id="a68a8-230">For more information about the repository pattern, see the posts in [the Entity Framework team's blog](https://blogs.msdn.com/b/adonet/archive/2009/06/16/using-repository-and-unit-of-work-patterns-with-entity-framework-4-0.aspx) and [Julie Lerman's blog](http://thedatafarm.com/blog/data-access/agile-ef4-repository-part-3-fine-tuning-the-repository/).</span></span>


<span data-ttu-id="a68a8-231">Die `GetDepartments` Methode gibt ein `IEnumerable` Objekt anstelle einer `IQueryable` Objekt, um sicherzustellen, dass die zurückgegebene Auflistung verwendet werden, selbst wenn das Repositoryobjekt selbst freigegeben wurde.</span><span class="sxs-lookup"><span data-stu-id="a68a8-231">The `GetDepartments` method returns an `IEnumerable` object rather than an `IQueryable` object in order to ensure that the returned collection is usable even after the repository object itself is disposed.</span></span> <span data-ttu-id="a68a8-232">Ein `IQueryable` Objekt kann dazu führen, dass Zugriff auf die Datenbank bei jedem Zugriff darauf ist möglich, aber das Repositoryobjekt möglicherweise nach der Zeit, die einem datengebundenen Steuerelement zum Rendern der Daten versucht verworfen werden.</span><span class="sxs-lookup"><span data-stu-id="a68a8-232">An `IQueryable` object can cause database access whenever it's accessed, but the repository object might be disposed by the time a databound control attempts to render the data.</span></span> <span data-ttu-id="a68a8-233">Sie können einen anderen Sammlungstyp wie zurückgeben ein `IList` -Objekt anstelle von ein `IEnumerable` Objekt.</span><span class="sxs-lookup"><span data-stu-id="a68a8-233">You could return another collection type, such as an `IList` object instead of an `IEnumerable` object.</span></span> <span data-ttu-id="a68a8-234">Allerdings Zurückgeben einer `IEnumerable` Objekt wird sichergestellt, wie z. B. typischen schreibgeschützten Liste Verarbeitungsaufgaben ausführen können `foreach` Schleifen und LINQ-Abfragen, aber Sie können nicht zum Hinzufügen oder Entfernen von Elementen in der Auflistung, die impliziert, dass solche Änderungen ist in der Datenbank gespeichert.</span><span class="sxs-lookup"><span data-stu-id="a68a8-234">However, returning an `IEnumerable` object ensures that you can perform typical read-only list processing tasks such as `foreach` loops and LINQ queries, but you cannot add to or remove items in the collection, which might imply that such changes would be persisted to the database.</span></span>

<span data-ttu-id="a68a8-235">Erstellen einer *Departments.aspx* Seite, verwendet der *Site.Master* Masterseite, und fügen Sie das folgende Markup in der `Content` -Steuerelement namens `Content2`:</span><span class="sxs-lookup"><span data-stu-id="a68a8-235">Create a *Departments.aspx* page that uses the *Site.Master* master page, and add the following markup in the `Content` control named `Content2`:</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample3.aspx)]

<span data-ttu-id="a68a8-236">Dieses Markup erstellt einen `ObjectDataSource` Steuerelement, das die Repository-Klasse Sie gerade erstellt haben verwendet, und ein `GridView` Steuerelement zum Anzeigen der Daten.</span><span class="sxs-lookup"><span data-stu-id="a68a8-236">This markup creates an `ObjectDataSource` control that uses the repository class you just created, and a `GridView` control to display the data.</span></span> <span data-ttu-id="a68a8-237">Die `GridView` Steuerelement gibt **bearbeiten** und **löschen** Befehle, aber Sie noch nicht Code hinzugefügt, um diese noch zu unterstützen.</span><span class="sxs-lookup"><span data-stu-id="a68a8-237">The `GridView` control specifies **Edit** and **Delete** commands, but you haven't added code to support them yet.</span></span>

<span data-ttu-id="a68a8-238">Verwenden Sie mehrere Spalten `DynamicField` Steuerelemente, sodass Sie automatische Formatierung und Validierung Funktionen nutzen können.</span><span class="sxs-lookup"><span data-stu-id="a68a8-238">Several columns use `DynamicField` controls so that you can take advantage of automatic data formatting and validation functionality.</span></span> <span data-ttu-id="a68a8-239">Für diese arbeiten, müssen Sie anrufen der `EnableDynamicData` Methode in der `Page_Init` -Ereignishandler.</span><span class="sxs-lookup"><span data-stu-id="a68a8-239">For these to work, you will have to call the `EnableDynamicData` method in the `Page_Init` event handler.</span></span> <span data-ttu-id="a68a8-240">(`DynamicControl` -Steuerelementen wird nicht der `Administrator` -Feld verwendet wird, weil sie nicht mit Navigationseigenschaften unterstützt.)</span><span class="sxs-lookup"><span data-stu-id="a68a8-240">(`DynamicControl` controls are not used in the `Administrator` field because they don't work with navigation properties.)</span></span>

<span data-ttu-id="a68a8-241">Die `Vertical-Align="Top"` Attribute werden wichtige später, wenn Sie eine Spalte hinzufügen, die eine geschachtelte hat `GridView` Steuerelement in den Entwurfsbereich.</span><span class="sxs-lookup"><span data-stu-id="a68a8-241">The `Vertical-Align="Top"` attributes will become important later when you add a column that has a nested `GridView` control to the grid.</span></span>

<span data-ttu-id="a68a8-242">Öffnen der *Departments.aspx.cs* Datei, und fügen Sie die folgenden `using` Anweisung:</span><span class="sxs-lookup"><span data-stu-id="a68a8-242">Open the *Departments.aspx.cs* file and add the following `using` statement:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample4.cs)]

<span data-ttu-id="a68a8-243">Fügen Sie dann den folgenden Ereignishandler für der Seite `Init` Ereignis:</span><span class="sxs-lookup"><span data-stu-id="a68a8-243">Then add the following handler for the page's `Init` event:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample5.cs)]

<span data-ttu-id="a68a8-244">In der *DAL* Ordner, erstellen Sie eine neue Klassendatei mit dem Namen *Department.cs* und Ersetzen Sie den vorhandenen Code durch folgenden Code:</span><span class="sxs-lookup"><span data-stu-id="a68a8-244">In the *DAL* folder, create a new class file named *Department.cs* and replace the existing code with the following code:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample6.cs)]

<span data-ttu-id="a68a8-245">Dieser Code fügt die Metadaten des Datenmodells.</span><span class="sxs-lookup"><span data-stu-id="a68a8-245">This code adds metadata to the data model.</span></span> <span data-ttu-id="a68a8-246">Gibt an, dass die `Budget` Eigenschaft von der `Department` Entität tatsächlich Währung darstellt, obwohl die Angabe des Datentyps ist `Decimal`, und gibt an, dass der Wert muss zwischen 0 und $1,000,000.00 liegen.</span><span class="sxs-lookup"><span data-stu-id="a68a8-246">It specifies that the `Budget` property of the `Department` entity actually represents currency although its data type is `Decimal`, and it specifies that the value must be between 0 and $1,000,000.00.</span></span> <span data-ttu-id="a68a8-247">Es gibt auch an, die die `StartDate` Eigenschaft als Datum im Format mm/tt/jjjj formatiert werden sollen.</span><span class="sxs-lookup"><span data-stu-id="a68a8-247">It also specifies that the `StartDate` property should be formatted as a date in the format mm/dd/yyyy.</span></span>

<span data-ttu-id="a68a8-248">Führen Sie die *Departments.aspx* Seite.</span><span class="sxs-lookup"><span data-stu-id="a68a8-248">Run the *Departments.aspx* page.</span></span>

<span data-ttu-id="a68a8-249">[![Image01 abgerufen wird](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image26.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="a68a8-249">[![Image01](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image26.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image25.png)</span></span>

<span data-ttu-id="a68a8-250">Beachten Sie, dass, obwohl Sie nicht in eine Formatzeichenfolge angegeben haben die *Departments.aspx* Seitenmarkup für die **Budget** oder **Startdatum** Spalten, Standard, Datum und Währung Formatierung verwendet wurde, durch die `DynamicField` Steuerelemente, die mithilfe der Metadaten, die Sie, in angegeben der *Department.cs* Datei.</span><span class="sxs-lookup"><span data-stu-id="a68a8-250">Notice that although you did not specify a format string in the *Departments.aspx* page markup for the **Budget** or **Start Date** columns, default currency and date formatting has been applied to them by the `DynamicField` controls, using the metadata that you supplied in the *Department.cs* file.</span></span>

## <a name="adding-insert-and-delete-functionality"></a><span data-ttu-id="a68a8-251">Hinzufügen von INSERT- und Delete-Funktionen</span><span class="sxs-lookup"><span data-stu-id="a68a8-251">Adding Insert and Delete Functionality</span></span>

<span data-ttu-id="a68a8-252">Open *SchoolRepository.cs*, fügen Sie den folgenden Code zum Erstellen einer `Insert` Methode und eine `Delete` Methode.</span><span class="sxs-lookup"><span data-stu-id="a68a8-252">Open *SchoolRepository.cs*, add the following code in order to create an `Insert` method and a `Delete` method.</span></span> <span data-ttu-id="a68a8-253">Der Code umfasst auch eine Methode namens `GenerateDepartmentID` , berechnet den nächsten verfügbaren Datensatz Schlüsselwert für die Verwendung durch die `Insert` Methode.</span><span class="sxs-lookup"><span data-stu-id="a68a8-253">The code also includes a method named `GenerateDepartmentID` that calculates the next available record key value for use by the `Insert` method.</span></span> <span data-ttu-id="a68a8-254">Dies ist erforderlich, da die Datenbank nicht, zum Berechnen der dies automatisch für konfiguriert ist die `Department` Tabelle.</span><span class="sxs-lookup"><span data-stu-id="a68a8-254">This is required because the database is not configured to calculate this automatically for the `Department` table.</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample7.cs)]

### <a name="the-attach-method"></a><span data-ttu-id="a68a8-255">Die Attach-Methode</span><span class="sxs-lookup"><span data-stu-id="a68a8-255">The Attach Method</span></span>

<span data-ttu-id="a68a8-256">Die `DeleteDepartment` Methodenaufrufe der `Attach` Methode, um den Link, der beibehalten wird in den Objektkontext Objektstatus-Manager zwischen der Entität im Arbeitsspeicher und die Datenbank wiederherstellen Zeile darstellt.</span><span class="sxs-lookup"><span data-stu-id="a68a8-256">The `DeleteDepartment` method calls the `Attach` method in order to re-establish the link that's maintained in the object context's object state manager between the entity in memory and the database row it represents.</span></span> <span data-ttu-id="a68a8-257">Dies vorkommen muss, bevor die Methode ruft die `SaveChanges` Methode.</span><span class="sxs-lookup"><span data-stu-id="a68a8-257">This must occur before the method calls the `SaveChanges` method.</span></span>

<span data-ttu-id="a68a8-258">Der Begriff *Objektkontext* bezieht sich auf die Entity Framework-Klasse, abgeleitet wird, die `ObjectContext` -Klasse, die Sie verwenden, um Ihre Entitätenmengen und Entitäten zugreifen.</span><span class="sxs-lookup"><span data-stu-id="a68a8-258">The term *object context* refers to the Entity Framework class that derives from the `ObjectContext` class that you use to access your entity sets and entities.</span></span> <span data-ttu-id="a68a8-259">Im Code für dieses Projekt ist die Klasse heißt `SchoolEntities`, und eine Instanz wird immer mit dem Namen `context`.</span><span class="sxs-lookup"><span data-stu-id="a68a8-259">In the code for this project, the class is named `SchoolEntities`, and an instance of it is always named `context`.</span></span> <span data-ttu-id="a68a8-260">Der Objektkontext *Objektstatus-Manager* ist eine Klasse, abgeleitet wird, die `ObjectStateManager` Klasse.</span><span class="sxs-lookup"><span data-stu-id="a68a8-260">The object context's *object state manager* is a class that derives from the `ObjectStateManager` class.</span></span> <span data-ttu-id="a68a8-261">Der Objekt-Kontakt verwendet den Objektstatus-Manager zum Speichern von Entitätsobjekten und zum Nachverfolgen, ob jeweils mit der entsprechenden Zeile der Tabelle oder Zeilen in der Datenbank synchronisiert ist.</span><span class="sxs-lookup"><span data-stu-id="a68a8-261">The object contact uses the object state manager to store entity objects and to keep track of whether each one is in sync with its corresponding table row or rows in the database.</span></span>

<span data-ttu-id="a68a8-262">Wenn Sie eine Entität lesen, Objektkontext speichert diesen in den Objektstatus-Manager und verfolgt, ob diese Darstellung des Objekts mit dem die Datenbank synchronisiert wurde.</span><span class="sxs-lookup"><span data-stu-id="a68a8-262">When you read an entity, the object context stores it in the object state manager and keeps track of whether that representation of the object is in sync with the database.</span></span> <span data-ttu-id="a68a8-263">Wenn Sie einen Eigenschaftswert ändern, wird z. B. ein Flag festgelegt, um anzugeben, dass die Eigenschaft, die Sie geändert haben, nicht mehr mit der Datenbank synchronisiert ist.</span><span class="sxs-lookup"><span data-stu-id="a68a8-263">For example, if you change a property value, a flag is set to indicate that the property you changed is no longer in sync with the database.</span></span> <span data-ttu-id="a68a8-264">Klicken Sie dann beim Aufrufen der `SaveChanges` -Methode, den Objektkontext weiß, was in der Datenbank zu tun, denn der Objektstatus-Manager weiß, was unterschieden zwischen den aktuellen Zustand der Entität und den Status der Datenbank wird.</span><span class="sxs-lookup"><span data-stu-id="a68a8-264">Then when you call the `SaveChanges` method, the object context knows what to do in the database because the object state manager knows exactly what's different between the current state of the entity and the state of the database.</span></span>

<span data-ttu-id="a68a8-265">Dieser Prozess in der Regel funktioniert nicht in einer Web-Anwendung jedoch, da die Kontext-Objektinstanz, die eine Entität gehören, sowie alle Elemente in der Objekt-Status-Manager liest verworfen wird, nachdem eine Seite gerendert wird.</span><span class="sxs-lookup"><span data-stu-id="a68a8-265">However, this process typically does not work in a web application, because the object context instance that reads an entity, along with everything in its object state manager, is disposed after a page is rendered.</span></span> <span data-ttu-id="a68a8-266">Die Kontext-Objektinstanz, die Änderungen zu übernehmen, muss ist ein neues Konto, das für Postbacks Verarbeitung instanziiert wird.</span><span class="sxs-lookup"><span data-stu-id="a68a8-266">The object context instance that must apply changes is a new one that's instantiated for postback processing.</span></span> <span data-ttu-id="a68a8-267">Im Fall von der `DeleteDepartment` -Methode, die `ObjectDataSource` Steuerelement erstellt erneut die ursprüngliche Version der Entität für Sie aus Werten im Ansichtszustand Angaben, aber dies neu erstellt `Department` Entität in den Objektstatus-Manager nicht vorhanden.</span><span class="sxs-lookup"><span data-stu-id="a68a8-267">In the case of the `DeleteDepartment` method, the `ObjectDataSource` control re-creates the original version of the entity for you from values in view state, but this re-created `Department` entity does not exist in the object state manager.</span></span> <span data-ttu-id="a68a8-268">Bei einem Aufruf der `DeleteObject` Methode für diese Entität neu erstellt, der Aufruf fehl, weil der Objektkontext nicht weiß, ob die Entität mit der Datenbank synchronisiert ist.</span><span class="sxs-lookup"><span data-stu-id="a68a8-268">If you called the `DeleteObject` method on this re-created entity, the call would fail because the object context does not know whether the entity is in sync with the database.</span></span> <span data-ttu-id="a68a8-269">Bei Aufruf der `Attach` Methode stellt die gleiche Überwachung zwischen der neu erstellte Entität und die Werte in der Datenbank, die ursprünglich automatisch durchgeführt wurde, wenn die Entität in einer früheren Instanz, von dem Objektkontext gelesen wurde.</span><span class="sxs-lookup"><span data-stu-id="a68a8-269">However, calling the `Attach` method re-establishes the same tracking between the re-created entity and the values in the database that was originally done automatically when the entity was read in an earlier instance of the object context.</span></span>

<span data-ttu-id="a68a8-270">Es gibt Situationen, wenn Sie möchten schließlich nicht den Objektkontext zum Nachverfolgen von Entitäten in den Objektstatus-Manager, und Sie können Flags, um zu verhindern, dass auf diese Weise festlegen.</span><span class="sxs-lookup"><span data-stu-id="a68a8-270">There are times when you don't want the object context to track entities in the object state manager, and you can set flags to prevent it from doing that.</span></span> <span data-ttu-id="a68a8-271">Beispiele hierfür sind in späteren Lernprogrammen dieser Reihe angezeigt.</span><span class="sxs-lookup"><span data-stu-id="a68a8-271">Examples of this are shown in later tutorials in this series.</span></span>

### <a name="the-savechanges-method"></a><span data-ttu-id="a68a8-272">Die SaveChanges-Methode</span><span class="sxs-lookup"><span data-stu-id="a68a8-272">The SaveChanges Method</span></span>

<span data-ttu-id="a68a8-273">Diese Klasse einfaches Repository veranschaulicht grundlegende Prinzipien der zum Ausführen von CRUD-Vorgänge.</span><span class="sxs-lookup"><span data-stu-id="a68a8-273">This simple repository class illustrates basic principles of how to perform CRUD operations.</span></span> <span data-ttu-id="a68a8-274">In diesem Beispiel wird die `SaveChanges` Methode wird aufgerufen, unmittelbar nach jeder Aktualisierung.</span><span class="sxs-lookup"><span data-stu-id="a68a8-274">In this example, the `SaveChanges` method is called immediately after each update.</span></span> <span data-ttu-id="a68a8-275">In einer produktionsanwendung kann aufgerufen werden soll die `SaveChanges` Methode über eine separate Methode bieten mehr Kontrolle über, wenn die Datenbank aktualisiert wird.</span><span class="sxs-lookup"><span data-stu-id="a68a8-275">In a production application you might want to call the `SaveChanges` method from a separate method to give you more control over when the database is updated.</span></span> <span data-ttu-id="a68a8-276">(Am Ende des nächsten Lernprogramms wird einen Link zur ein Whitepaper, die die Einheit der Arbeit Muster erläutert wird, also ein Ansatz zum Koordinieren der entsprechenden Updates suchen.) Beachten Sie auch, dass im Beispiel die `DeleteDepartment` Methode keinen Code Parallelitätskonflikte; Code dazu wird in einem späteren Lernprogramm dieser Reihe hinzugefügt werden.</span><span class="sxs-lookup"><span data-stu-id="a68a8-276">(At the end of the next tutorial you will find a link to a white paper that discusses the unit of work pattern which is one approach to coordinating related updates.) Notice also that in the example, the `DeleteDepartment` method does not include code for handling concurrency conflicts; code to do that will be added in a later tutorial in this series.</span></span>

### <a name="retrieving-instructor-names-to-select-when-inserting"></a><span data-ttu-id="a68a8-277">Abrufen von Instructor-Namen auswählen, wenn einfügen</span><span class="sxs-lookup"><span data-stu-id="a68a8-277">Retrieving Instructor Names to Select When Inserting</span></span>

<span data-ttu-id="a68a8-278">Benutzer muss einen Administrator aus einer Liste von Kursleiter eine Dropdown-Liste auswählen, für die Erstellung neue Abteilungen.</span><span class="sxs-lookup"><span data-stu-id="a68a8-278">Users must be able to select an administrator from a list of instructors in a drop-down list when creating new departments.</span></span> <span data-ttu-id="a68a8-279">Deshalb fügen Sie folgenden Code zum *SchoolRepository.cs* zum Erstellen einer Methode zum Abrufen der Liste der Lehrkräfte mithilfe der Ansicht, die Sie zuvor erstellt haben:</span><span class="sxs-lookup"><span data-stu-id="a68a8-279">Therefore, add the following code to *SchoolRepository.cs* to create a method to retrieve the list of instructors using the view that you created earlier:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample8.cs)]

### <a name="creating-a-page-for-inserting-departments"></a><span data-ttu-id="a68a8-280">Erstellen eine Seite zum Einfügen von Abteilungen</span><span class="sxs-lookup"><span data-stu-id="a68a8-280">Creating a Page for Inserting Departments</span></span>

<span data-ttu-id="a68a8-281">Erstellen einer *DepartmentsAdd.aspx* Seite, verwendet der *Site.Master* Seite, und fügen Sie das folgende Markup in der `Content` -Steuerelement namens `Content2`:</span><span class="sxs-lookup"><span data-stu-id="a68a8-281">Create a *DepartmentsAdd.aspx* page that uses the *Site.Master* page, and add the following markup in the `Content` control named `Content2`:</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample9.aspx)]

<span data-ttu-id="a68a8-282">Dieses Markup erstellt zwei `ObjectDataSource` Steuerelemente, die für das Einfügen von neuen `Department` Entitäten und eine zum Abrufen von Instructor-Namen für die `DropDownList` für die Auswahl der Abteilung Administratoren verwendeten Steuerelements ab.</span><span class="sxs-lookup"><span data-stu-id="a68a8-282">This markup creates two `ObjectDataSource` controls, one for inserting new `Department` entities and one for retrieving instructor names for the `DropDownList` control that's used for selecting department administrators.</span></span> <span data-ttu-id="a68a8-283">Das Markup erstellt einen `DetailsView` Steuern für einen Handler für des Steuerelements eingeben neuer Abteilungen, und es gibt an, `ItemInserting` Ereignis, damit Sie festlegen können, die `Administrator` Fremdschlüsselwert.</span><span class="sxs-lookup"><span data-stu-id="a68a8-283">The markup creates a `DetailsView` control for entering new departments, and it specifies a handler for the control's `ItemInserting` event so that you can set the `Administrator` foreign key value.</span></span> <span data-ttu-id="a68a8-284">Wird am Ende einer `ValidationSummary` -Steuerelement zum Anzeigen von Fehlermeldungen.</span><span class="sxs-lookup"><span data-stu-id="a68a8-284">At the end is a `ValidationSummary` control to display error messages.</span></span>

<span data-ttu-id="a68a8-285">Open *DepartmentsAdd.aspx.cs* und fügen Sie die folgenden `using` Anweisung:</span><span class="sxs-lookup"><span data-stu-id="a68a8-285">Open *DepartmentsAdd.aspx.cs* and add the following `using` statement:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample10.cs)]

<span data-ttu-id="a68a8-286">Fügen Sie die folgenden Klassenvariable und Methoden:</span><span class="sxs-lookup"><span data-stu-id="a68a8-286">Add the following class variable and methods:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample11.cs)]

<span data-ttu-id="a68a8-287">Die `Page_Init` Methode ermöglicht die Dynamic Data-Funktionen.</span><span class="sxs-lookup"><span data-stu-id="a68a8-287">The `Page_Init` method enables Dynamic Data functionality.</span></span> <span data-ttu-id="a68a8-288">Der Handler für die `DropDownList` des Steuerelements `Init` Ereignis speichert einen Verweis auf das Steuerelement und den Handler für die `DetailsView` des Steuerelements `Inserting` Ereignis verwendet diesen Verweis zum Abrufen der `PersonID` Wert des ausgewählten Kursleiter und aktualisieren die `Administrator` Fremdschlüsseleigenschaft von der `Department` Entität.</span><span class="sxs-lookup"><span data-stu-id="a68a8-288">The handler for the `DropDownList` control's `Init` event saves a reference to the control, and the handler for the `DetailsView` control's `Inserting` event uses that reference to get the `PersonID` value of the selected instructor and update the `Administrator` foreign key property of the `Department` entity.</span></span>

<span data-ttu-id="a68a8-289">Führen Sie die Seite, Hinzufügen von Informationen für eine neue Abteilung, und klicken Sie dann auf die **einfügen** Link.</span><span class="sxs-lookup"><span data-stu-id="a68a8-289">Run the page, add information for a new department, and then click the **Insert** link.</span></span>

<span data-ttu-id="a68a8-290">[![Image04](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image28.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image27.png)</span><span class="sxs-lookup"><span data-stu-id="a68a8-290">[![Image04](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image28.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image27.png)</span></span>

<span data-ttu-id="a68a8-291">Geben Sie Werte für eine andere neue Abteilung ein.</span><span class="sxs-lookup"><span data-stu-id="a68a8-291">Enter values for another new department.</span></span> <span data-ttu-id="a68a8-292">Geben Sie eine Zahl größer als 1,000,000.00 in der **Budget** Feld und Tab, um das nächste Feld.</span><span class="sxs-lookup"><span data-stu-id="a68a8-292">Enter a number greater than 1,000,000.00 in the **Budget** field and tab to the next field.</span></span> <span data-ttu-id="a68a8-293">Ein Sternchen im Feld angezeigt wird, und wenn Sie den Mauszeiger darüber halten, sehen Sie die Fehlermeldung, die Sie in den Metadaten für das Feld eingegeben haben.</span><span class="sxs-lookup"><span data-stu-id="a68a8-293">An asterisk appears in the field, and if you hold the mouse pointer over it, you can see the error message that you entered in the metadata for that field.</span></span>

<span data-ttu-id="a68a8-294">[![Image03](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image30.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image29.png)</span><span class="sxs-lookup"><span data-stu-id="a68a8-294">[![Image03](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image30.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image29.png)</span></span>

<span data-ttu-id="a68a8-295">Klicken Sie auf **einfügen**, und Sie sehen die Fehlermeldung angezeigt, indem die `ValidationSummary` Steuerelement am unteren Rand der Seite.</span><span class="sxs-lookup"><span data-stu-id="a68a8-295">Click **Insert**, and you see the error message displayed by the `ValidationSummary` control at the bottom of the page.</span></span>

<span data-ttu-id="a68a8-296">[![image12](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image32.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="a68a8-296">[![Image12](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image32.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image31.png)</span></span>

<span data-ttu-id="a68a8-297">Als Nächstes den Browser schließen und öffnen Sie die *Departments.aspx* Seite.</span><span class="sxs-lookup"><span data-stu-id="a68a8-297">Next, close the browser and open the *Departments.aspx* page.</span></span> <span data-ttu-id="a68a8-298">Delete-Funktion zum Hinzufügen der *Departments.aspx* Seite durch Hinzufügen einer `DeleteMethod` -Attribut auf die `ObjectDataSource` -Steuerelement, und ein `DataKeyNames` -Attribut auf die `GridView` Steuerelement.</span><span class="sxs-lookup"><span data-stu-id="a68a8-298">Add delete capability to the *Departments.aspx* page by adding a `DeleteMethod` attribute to the `ObjectDataSource` control, and a `DataKeyNames` attribute to the `GridView` control.</span></span> <span data-ttu-id="a68a8-299">Die öffnenden Tags für diese Steuerelemente werden jetzt im folgende Beispiel ähneln:</span><span class="sxs-lookup"><span data-stu-id="a68a8-299">The opening tags for these controls will now resemble the following example:</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample12.aspx)]

<span data-ttu-id="a68a8-300">Führen Sie die Seite.</span><span class="sxs-lookup"><span data-stu-id="a68a8-300">Run the page.</span></span>

<span data-ttu-id="a68a8-301">[![Image09](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image34.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image33.png)</span><span class="sxs-lookup"><span data-stu-id="a68a8-301">[![Image09](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image34.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image33.png)</span></span>

<span data-ttu-id="a68a8-302">Löschen Sie die Abteilung, die Sie hinzugefügt haben, bei der Ausführung der *DepartmentsAdd.aspx* Seite.</span><span class="sxs-lookup"><span data-stu-id="a68a8-302">Delete the department you added when you ran the *DepartmentsAdd.aspx* page.</span></span>

## <a name="adding-update-functionality"></a><span data-ttu-id="a68a8-303">Hinzufügen einer Updatefunktion</span><span class="sxs-lookup"><span data-stu-id="a68a8-303">Adding Update Functionality</span></span>

<span data-ttu-id="a68a8-304">Open *SchoolRepository.cs* und fügen Sie die folgenden `Update` Methode:</span><span class="sxs-lookup"><span data-stu-id="a68a8-304">Open *SchoolRepository.cs* and add the following `Update` method:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample13.cs)]

<span data-ttu-id="a68a8-305">Beim Klicken auf **Update** in der *Departments.aspx* Seite der `ObjectDataSource` Steuerelement erstellt zwei `Department` Entitäten Übergabe an die `UpdateDepartment` Methode.</span><span class="sxs-lookup"><span data-stu-id="a68a8-305">When you click **Update** in the *Departments.aspx* page, the `ObjectDataSource` control creates two `Department` entities to pass to the `UpdateDepartment` method.</span></span> <span data-ttu-id="a68a8-306">Eine enthält die ursprünglichen Werte, die im Ansichtszustand gespeichert wurden, und die andere die neuen Werte, die eingegeben wurden die `GridView` Steuerelement.</span><span class="sxs-lookup"><span data-stu-id="a68a8-306">One contains the original values that have been stored in view state, and the other contains the new values that were entered in the `GridView` control.</span></span> <span data-ttu-id="a68a8-307">Der Code in der `UpdateDepartment` -Methode übergibt die `Department` Entität mit den ursprünglichen Werten auf der `Attach` Methode gewahrt die Verfolgung zwischen der Entität und was in der Datenbank ist.</span><span class="sxs-lookup"><span data-stu-id="a68a8-307">The code in the `UpdateDepartment` method passes the `Department` entity that has the original values to the `Attach` method in order to establish the tracking between the entity and what's in the database.</span></span> <span data-ttu-id="a68a8-308">Dann der Code übergibt die `Department` Entität mit den neuen Werten zu den `ApplyCurrentValues` Methode.</span><span class="sxs-lookup"><span data-stu-id="a68a8-308">Then the code passes the `Department` entity that has the new values to the `ApplyCurrentValues` method.</span></span> <span data-ttu-id="a68a8-309">Der Objektkontext vergleicht die alten und neuen Werte.</span><span class="sxs-lookup"><span data-stu-id="a68a8-309">The object context compares the old and new values.</span></span> <span data-ttu-id="a68a8-310">Wenn Sie ein neuer Wert aus einer alten Wert unterscheidet, ändert der Objektkontext den Wert der Eigenschaft.</span><span class="sxs-lookup"><span data-stu-id="a68a8-310">If a new value is different from an old value, the object context changes the property value.</span></span> <span data-ttu-id="a68a8-311">Die `SaveChanges` Methode wird dann nur die geänderten Spalten in der Datenbank aktualisiert.</span><span class="sxs-lookup"><span data-stu-id="a68a8-311">The `SaveChanges` method then updates only the changed columns in the database.</span></span> <span data-ttu-id="a68a8-312">(Jedoch, wenn die Update-Funktion für diese Entität an eine gespeicherte Prozedur zugeordnet wurden, würde die gesamte Zeile aktualisiert werden unabhängig davon, welche Spalten geändert wurden.)</span><span class="sxs-lookup"><span data-stu-id="a68a8-312">(However, if the update function for this entity were mapped to a stored procedure, the entire row would be updated regardless of which columns were changed.)</span></span>

<span data-ttu-id="a68a8-313">Öffnen der *Departments.aspx* Datei, und fügen Sie die folgenden Attribute, die `DepartmentsObjectDataSource` Steuerelement:</span><span class="sxs-lookup"><span data-stu-id="a68a8-313">Open the *Departments.aspx* file and add the following attributes to the `DepartmentsObjectDataSource` control:</span></span>

- `UpdateMethod="UpdateDepartment"`
- `ConflictDetection="CompareAllValues"`   
 <span data-ttu-id="a68a8-314">Diese Ursachen für die alten Werte werden im Ansichtszustand gespeichert, damit sie mit den neuen Werten verglichen werden, können die `Update` Methode.</span><span class="sxs-lookup"><span data-stu-id="a68a8-314">This causes old values to be stored in view state so that they can be compared with the new values in the `Update` method.</span></span>
- `OldValuesParameterFormatString="orig{0}"`   
 <span data-ttu-id="a68a8-315">Damit wird das Steuerelement, das der Namen des ursprünglichen Werte Parameters wird mitgeteilt `origDepartment` .</span><span class="sxs-lookup"><span data-stu-id="a68a8-315">This informs the control that the name of the original values parameter is `origDepartment` .</span></span>

<span data-ttu-id="a68a8-316">Das Markup für das Anfangstag des der `ObjectDataSource` -Steuerelement jetzt im folgende Beispiel ähnelt:</span><span class="sxs-lookup"><span data-stu-id="a68a8-316">The markup for the opening tag of the `ObjectDataSource` control now resembles the following example:</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample14.aspx)]

<span data-ttu-id="a68a8-317">Hinzufügen einer `OnRowUpdating="DepartmentsGridView_RowUpdating"` -Attribut auf die `GridView` Steuerelement.</span><span class="sxs-lookup"><span data-stu-id="a68a8-317">Add an `OnRowUpdating="DepartmentsGridView_RowUpdating"` attribute to the `GridView` control.</span></span> <span data-ttu-id="a68a8-318">Verwenden Sie dies zum Festlegen der `Administrator` Eigenschaftswert auf Grundlage der Zeile, die der Benutzer, die in einer Dropdownliste auswählt.</span><span class="sxs-lookup"><span data-stu-id="a68a8-318">You will use this to set the `Administrator` property value based on the row the user selects in a drop-down list.</span></span> <span data-ttu-id="a68a8-319">Die `GridView` öffnungstag jetzt etwa wie folgt:</span><span class="sxs-lookup"><span data-stu-id="a68a8-319">The `GridView` opening tag now resembles the following example:</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample15.aspx)]

<span data-ttu-id="a68a8-320">Hinzufügen einer `EditItemTemplate` für steuern die `Administrator` Spalte die `GridView` steuern, unmittelbar nach dem die `ItemTemplate` Steuerelement für diese Spalte:</span><span class="sxs-lookup"><span data-stu-id="a68a8-320">Add an `EditItemTemplate` control for the `Administrator` column to the `GridView` control, immediately after the `ItemTemplate` control for that column:</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample16.aspx)]

<span data-ttu-id="a68a8-321">Dies `EditItemTemplate` Steuerelement ähnelt dem `InsertItemTemplate` steuern, der *DepartmentsAdd.aspx* Seite.</span><span class="sxs-lookup"><span data-stu-id="a68a8-321">This `EditItemTemplate` control is similar to the `InsertItemTemplate` control in the *DepartmentsAdd.aspx* page.</span></span> <span data-ttu-id="a68a8-322">Der Unterschied besteht darin, dass der Anfangswert des Steuerelements festgelegt ist, mit der `SelectedValue` Attribut.</span><span class="sxs-lookup"><span data-stu-id="a68a8-322">The difference is that the initial value of the control is set using the `SelectedValue` attribute.</span></span>

<span data-ttu-id="a68a8-323">Vor der `GridView` steuern, fügen Sie eine `ValidationSummary` steuern, wie in der *DepartmentsAdd.aspx* Seite.</span><span class="sxs-lookup"><span data-stu-id="a68a8-323">Before the `GridView` control, add a `ValidationSummary` control as you did in the *DepartmentsAdd.aspx* page.</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample17.aspx)]

<span data-ttu-id="a68a8-324">Open *Departments.aspx.cs* und unmittelbar nach der Deklaration der partiellen Klasse fügen Sie den folgenden Code zum Erstellen eines privaten Felds zum Verweisen auf die `DropDownList` Steuerelement:</span><span class="sxs-lookup"><span data-stu-id="a68a8-324">Open *Departments.aspx.cs* and immediately after the partial-class declaration, add the following code to create a private field to reference the `DropDownList` control:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample18.cs)]

<span data-ttu-id="a68a8-325">Fügen Sie dann den Handler für das `DropDownList` des Steuerelements `Init` Ereignis und die `GridView` des Steuerelements `RowUpdating` Ereignis:</span><span class="sxs-lookup"><span data-stu-id="a68a8-325">Then add handlers for the `DropDownList` control's `Init` event and the `GridView` control's `RowUpdating` event:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample19.cs)]

<span data-ttu-id="a68a8-326">Der Handler für das `Init` Ereignis speichert einen Verweis auf die `DropDownList` Steuerelement im Feld "Klasse".</span><span class="sxs-lookup"><span data-stu-id="a68a8-326">The handler for the `Init` event saves a reference to the `DropDownList` control in the class field.</span></span> <span data-ttu-id="a68a8-327">Der Handler für die `RowUpdating` Ereignis verwendet die Referenz, rufen Sie den Wert der Benutzer eingegeben hat, und wenden Sie es auf die `Administrator` Eigenschaft von der `Department` Entität.</span><span class="sxs-lookup"><span data-stu-id="a68a8-327">The handler for the `RowUpdating` event uses the reference to get the value the user entered and apply it to the `Administrator` property of the `Department` entity.</span></span>

<span data-ttu-id="a68a8-328">Verwenden der *DepartmentsAdd.aspx* Seite, um eine neue Abteilung hinzuzufügen, und führen Sie die *Departments.aspx* Seite, und klicken Sie auf **bearbeiten** auf die Zeile, die Sie hinzugefügt haben.</span><span class="sxs-lookup"><span data-stu-id="a68a8-328">Use the *DepartmentsAdd.aspx* page to add a new department, then run the *Departments.aspx* page and click **Edit** on the row that you added.</span></span>

> [!NOTE]
> <span data-ttu-id="a68a8-329">Sie werden nicht in der Lage, Bearbeiten von Zeilen, die Sie nicht hinzugefügt haben (d. h., die bereits in der Datenbank wurden), aufgrund ungültiger Daten in der Datenbank; die Administratoren für die Zeilen, die mit der Datenbank erstellt wurden, sind Studenten.</span><span class="sxs-lookup"><span data-stu-id="a68a8-329">You will not be able to edit rows that you did not add (that is, that were already in the database), because of invalid data in the database; the administrators for the rows that were created with the database are students.</span></span> <span data-ttu-id="a68a8-330">Wenn Sie versuchen, eine davon zu bearbeiten, erhalten eine Fehlerseite Sie, die einen Fehler wie meldet `'InstructorsDropDownList' has a SelectedValue which is invalid because it does not exist in the list of items.`</span><span class="sxs-lookup"><span data-stu-id="a68a8-330">If you try to edit one of them, you will get an error page that reports an error like `'InstructorsDropDownList' has a SelectedValue which is invalid because it does not exist in the list of items.`</span></span>


<span data-ttu-id="a68a8-331">[![image10](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image36.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image35.png)</span><span class="sxs-lookup"><span data-stu-id="a68a8-331">[![Image10](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image36.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image35.png)</span></span>

<span data-ttu-id="a68a8-332">Bei der Eingabe eines ungültiges **Budget** Betrag, und klicken Sie dann auf **Update**, sehen die gleichen Sternchen und eine Fehlermeldung angezeigt, die Sie in gesehen haben die *Departments.aspx* Seite.</span><span class="sxs-lookup"><span data-stu-id="a68a8-332">If you enter an invalid **Budget** amount and then click **Update**, you see the same asterisk and error message that you saw in the *Departments.aspx* page.</span></span>

<span data-ttu-id="a68a8-333">Ändern Sie einen Feldwert angibt, oder wählen Sie einen anderen Administrator, und klicken Sie auf **Update**.</span><span class="sxs-lookup"><span data-stu-id="a68a8-333">Change a field value or select a different administrator and click **Update**.</span></span> <span data-ttu-id="a68a8-334">Die Änderung wird angezeigt.</span><span class="sxs-lookup"><span data-stu-id="a68a8-334">The change is displayed.</span></span>

<span data-ttu-id="a68a8-335">[![Image09](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image38.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="a68a8-335">[![Image09](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image38.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image37.png)</span></span>

<span data-ttu-id="a68a8-336">Dies schließt die Einführung in die Verwendung der `ObjectDataSource` -Steuerelement für grundlegende CRUD (erstellen, lesen, aktualisieren und löschen) Vorgänge mit dem Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="a68a8-336">This completes the introduction to using the `ObjectDataSource` control for basic CRUD (create, read, update, delete) operations with the Entity Framework.</span></span> <span data-ttu-id="a68a8-337">Sie haben eine einfache n-Tier-Anwendung erstellt, aber die Geschäftslogik Ebene ist immer noch eng verbunden, der Datenzugriffs--Ebene, die automatisierte Komponententests etwas komplizierter macht.</span><span class="sxs-lookup"><span data-stu-id="a68a8-337">You've built a simple n-tier application, but the business-logic layer is still tightly coupled to the data-access layer, which complicates automated unit testing.</span></span> <span data-ttu-id="a68a8-338">Im folgenden Lernprogramm sehen Sie zum Implementieren des Repositorymusters, um Komponententests zu ermöglichen.</span><span class="sxs-lookup"><span data-stu-id="a68a8-338">In the following tutorial you'll see how to implement the repository pattern to facilitate unit testing.</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="a68a8-339">Nächste</span><span class="sxs-lookup"><span data-stu-id="a68a8-339">Next</span></span>](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests.md)
