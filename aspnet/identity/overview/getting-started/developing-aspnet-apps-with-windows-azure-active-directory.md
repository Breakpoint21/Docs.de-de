---
uid: identity/overview/getting-started/developing-aspnet-apps-with-windows-azure-active-directory
title: Entwickeln von ASP.NET-Apps mit Azure Active Directory | Microsoft Docs
author: Rick-Anderson
description: Microsoft ASP.NET-Tools für Azure Active Directory vereinfacht die Authentifizierung für auf Azure gehostete Webanwendungen zu aktivieren. Sie können Azure authentifizieren...
ms.author: aspnetcontent
manager: wpickett
ms.date: 08/14/2014
ms.topic: article
ms.assetid: 457d7eaf-ee76-4ceb-9082-c7c1721435ad
ms.technology: ''
ms.prod: .net-framework
msc.legacyurl: /identity/overview/getting-started/developing-aspnet-apps-with-windows-azure-active-directory
msc.type: authoredcontent
ms.openlocfilehash: 9b2dc05089126fd5f4c1b0a0bd85b8a39f3041dc
ms.sourcegitcommit: 477d38e33530a305405eaf19faa29c6d805273aa
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 05/07/2018
ms.locfileid: "33838497"
---
<a name="developing-aspnet-apps-with-azure-active-directory"></a><span data-ttu-id="c6111-104">Entwickeln von ASP.NET-Apps mit Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="c6111-104">Developing ASP.NET Apps with Azure Active Directory</span></span>
====================
<span data-ttu-id="c6111-105">durch [Rick Anderson](https://github.com/Rick-Anderson)</span><span class="sxs-lookup"><span data-stu-id="c6111-105">by [Rick Anderson](https://github.com/Rick-Anderson)</span></span>

<span data-ttu-id="c6111-106">Microsoft ASP.NET tools für Azure Active Directory Aktivieren der Authentifizierung für Web-apps auf gehostete vereinfacht [Azure](https://www.windowsazure.com/home/features/web-sites/).</span><span class="sxs-lookup"><span data-stu-id="c6111-106">Microsoft ASP.NET tools for Azure Active Directory simplifies enabling authentication for web apps hosted on [Azure](https://www.windowsazure.com/home/features/web-sites/).</span></span> <span data-ttu-id="c6111-107">Sie können Azure-Authentifizierung verwenden, Office 365-Benutzer aus Ihrer Organisation, Unternehmenskonten aus Ihrem lokalen Active Directory synchronisiert oder in Ihrer eigenen benutzerdefinierten Azure Active Directory-Domäne erstellten Benutzer zu authentifizieren.</span><span class="sxs-lookup"><span data-stu-id="c6111-107">You can use Azure Authentication to authenticate Office 365 users from your organization, corporate accounts synced from your on-premise Active Directory or users created in your own custom Azure Active Directory domain.</span></span> <span data-ttu-id="c6111-108">Aktivieren von Windows Azure-Authentifizierung konfiguriert Ihre Anwendung zum Authentifizieren von Benutzern, die mit einem einzigen [Azure Active Directory](https://docs.microsoft.com/azure/active-directory/) Mandanten.</span><span class="sxs-lookup"><span data-stu-id="c6111-108">Enabling Windows Azure Authentication configures your application to authenticate users using a single [Azure Active Directory](https://docs.microsoft.com/azure/active-directory/) tenant.</span></span>

<span data-ttu-id="c6111-109">In diesem Lernprogramm erfahren Sie, wie Sie eine ASP.NET-Anwendung erstellen, die für die Anmeldung bei konfiguriert ist [Azure Active Directory](https://msdn.microsoft.com/library/azure/mt168838.aspx) (Azure AD).</span><span class="sxs-lookup"><span data-stu-id="c6111-109">This tutorial will show you how to create an ASP.NET application that is configured for sign-on with [Azure Active Directory](https://msdn.microsoft.com/library/azure/mt168838.aspx) (Azure AD).</span></span> <span data-ttu-id="c6111-110">Außerdem erfahren Sie, wie der Graph-API zum Abrufen von Informationen über den derzeit angemeldeten Benutzer aufrufen und die Anwendung in Azure bereitzustellen.</span><span class="sxs-lookup"><span data-stu-id="c6111-110">You will also learn how to call the Graph API to get information about the currently signed-in user and how to deploy the application to Azure.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="c6111-111">Erforderliche Komponenten</span><span class="sxs-lookup"><span data-stu-id="c6111-111">Prerequisites</span></span>

1. <span data-ttu-id="c6111-112">[Visual Studio Express 2013 für Web](https://www.microsoft.com/visualstudio/eng/2013-downloads#d-2013-express) oder [Visual Studio 2013](https://www.microsoft.com/visualstudio/eng/2013-downloads).</span><span class="sxs-lookup"><span data-stu-id="c6111-112">[Visual Studio Express 2013 for Web](https://www.microsoft.com/visualstudio/eng/2013-downloads#d-2013-express) or [Visual Studio 2013](https://www.microsoft.com/visualstudio/eng/2013-downloads).</span></span>
2. <span data-ttu-id="c6111-113">[Visual Studio 2013 Update 4](https://www.microsoft.com/download/details.aspx?id=44921) -Update 3 oder höher ist erforderlich.</span><span class="sxs-lookup"><span data-stu-id="c6111-113">[Visual Studio 2013 Update 4](https://www.microsoft.com/download/details.aspx?id=44921) - Update 3 or higher is required.</span></span>
3. <span data-ttu-id="c6111-114">Ein Azure-Konto.</span><span class="sxs-lookup"><span data-stu-id="c6111-114">An Azure account.</span></span> <span data-ttu-id="c6111-115">[Klicken Sie hier](https://azure.microsoft.com/pricing/free-trial/) für eine kostenlose Testversion, wenn Sie nicht bereits ein Konto verfügen.</span><span class="sxs-lookup"><span data-stu-id="c6111-115">[Click here](https://azure.microsoft.com/pricing/free-trial/) for a free trial if you do not already have an account.</span></span>

## <a name="add-a-global-administrator-to-your-active-directory"></a><span data-ttu-id="c6111-116">Fügen Sie einen globalen Administrator zu Active Directory</span><span class="sxs-lookup"><span data-stu-id="c6111-116">Add a Global Administrator to your Active Directory</span></span>

1. <span data-ttu-id="c6111-117">Melden Sie sich bei der [Azure-Verwaltungsportal](https://manage.windowsazure.com/).</span><span class="sxs-lookup"><span data-stu-id="c6111-117">Sign in to the [Azure Management Portal](https://manage.windowsazure.com/).</span></span>
2. <span data-ttu-id="c6111-118">Alle Azure-Konten enthalten eine **Standardverzeichnis** – klicken Sie darauf, und klicken Sie auf die **Benutzer** Registerkarte am oberen Rand der Seite (siehe folgende Abbildung).</span><span class="sxs-lookup"><span data-stu-id="c6111-118">All Azure accounts contain a **Default Directory** -- click on it, then click the **Users** tab at the top of the page (see image below).</span></span>
3. <span data-ttu-id="c6111-119">Klicken Sie hier fügen Benutzer hinzu.</span><span class="sxs-lookup"><span data-stu-id="c6111-119">Click Add User.</span></span>  
    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image1.png)
4. <span data-ttu-id="c6111-120">Erstellen eines neuen Benutzers mit dem **Globaladministrator** Rolle.</span><span class="sxs-lookup"><span data-stu-id="c6111-120">Create a new user with the **Global Administrator** role.</span></span> <span data-ttu-id="c6111-121">Klicken Sie auf **Benutzer** aus der oberen Menüleiste, und klicken Sie dann auf die **Add User** auf der Befehlsleiste auf die Schaltfläche.</span><span class="sxs-lookup"><span data-stu-id="c6111-121">Click **Users** from the top menu, and then click the **Add User** button on the command bar.</span></span>
5. <span data-ttu-id="c6111-122">In der **Add User** Dialogfeld, geben Sie einen Namen für den neuen Benutzer, und klicken Sie dann auf den Pfeil nach rechts.</span><span class="sxs-lookup"><span data-stu-id="c6111-122">In the **Add User** dialog, enter a name for the new user and then click the right arrow.</span></span>  
  
    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image2.png)
6. <span data-ttu-id="c6111-123">Geben Sie den Benutzernamen ein, und legen Sie die Rolle auf **Globaladministrator**.</span><span class="sxs-lookup"><span data-stu-id="c6111-123">Enter the user name and set the role to **Global Administrator**.</span></span> <span data-ttu-id="c6111-124">Globale Administratoren benötigen eine alternative e-Mail-Adresse zu Wiederherstellungszwecken Kennwort an.</span><span class="sxs-lookup"><span data-stu-id="c6111-124">Global administrators require an alternate email address for password recovery purposes.</span></span> <span data-ttu-id="c6111-125">Wenn Sie fertig sind, klicken Sie auf den Pfeil nach rechts.</span><span class="sxs-lookup"><span data-stu-id="c6111-125">After you're finished, click the right arrow.</span></span>  
  
    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image3.png)
7. <span data-ttu-id="c6111-126">Klicken Sie auf der nächsten Seite des Dialogfelds auf **erstellen**.</span><span class="sxs-lookup"><span data-stu-id="c6111-126">On the next page of the dialog, click **Create**.</span></span> <span data-ttu-id="c6111-127">Ein temporäres Kennwort für den neuen Benutzer erstellt und im Dialogfeld angezeigt.</span><span class="sxs-lookup"><span data-stu-id="c6111-127">A temporary password will be created for the new user and displayed in the dialog.</span></span>   
  
    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image4.png)  
  
   <span data-ttu-id="c6111-128">Speichern Sie das Kennwort werden Sie zum Ändern des Kennworts nach der ersten Anmeldung in benötigt.</span><span class="sxs-lookup"><span data-stu-id="c6111-128">Save the password, you will be required to change the password after the first log in.</span></span> <span data-ttu-id="c6111-129">Die folgende Abbildung zeigt das neue Administratorkonto ein.</span><span class="sxs-lookup"><span data-stu-id="c6111-129">The following image shows the new admin account.</span></span> <span data-ttu-id="c6111-130">Sie müssen die Azure Active Directory verwenden, bei der app, und nicht die Microsoft-Konto, das auch auf dieser Seite angezeigten anmelden.</span><span class="sxs-lookup"><span data-stu-id="c6111-130">You must use the Azure Active Directory to log into your app, not the Microsoft account also shown on this page.</span></span>  
  
    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image5.png)

## <a name="create-an-aspnet-application"></a><span data-ttu-id="c6111-131">Erstellen einer ASP.NET-Anwendung</span><span class="sxs-lookup"><span data-stu-id="c6111-131">Create an ASP.NET Application</span></span>

<span data-ttu-id="c6111-132">Die folgenden Schritte verwenden [Visual Studio Express 2013 für Web](https://www.microsoft.com/download/details.aspx?id=40747), und erfordert [Visual Studio 2013 Update 3](https://www.microsoft.com/download/details.aspx?id=43721).</span><span class="sxs-lookup"><span data-stu-id="c6111-132">The following steps use [Visual Studio Express 2013 for Web](https://www.microsoft.com/download/details.aspx?id=40747), and requires [Visual Studio 2013 Update 3](https://www.microsoft.com/download/details.aspx?id=43721).</span></span>

1. <span data-ttu-id="c6111-133">Klicken Sie in Visual Studio auf **Datei** und dann **neues Projekt**.</span><span class="sxs-lookup"><span data-stu-id="c6111-133">In Visual Studio, click **File** and then **New Project**.</span></span> <span data-ttu-id="c6111-134">Auf der **neues Projekt** Dialog, wählen Sie die Visual C#-Web im linken Menü Projekt, und klicken Sie auf **OK**.</span><span class="sxs-lookup"><span data-stu-id="c6111-134">On the **New Project** dialog, select the Visual C# Web project from the left menu and click **OK**.</span></span> <span data-ttu-id="c6111-135">Sie sollten auch deaktivieren die **Application Insights zu Projekt hinzufügen** Wenn Sie nicht die Funktionalität für Ihre Anwendung möchten.</span><span class="sxs-lookup"><span data-stu-id="c6111-135">You may also want to uncheck the **Add Application Insights to Project** if you don't want the functionality for your application.</span></span>
2. <span data-ttu-id="c6111-136">In der **neues ASP.NET-Projekt** wählen Sie im Dialogfeld **MVC**, und klicken Sie dann auf **Authentifizierung ändern**.</span><span class="sxs-lookup"><span data-stu-id="c6111-136">In the **New ASP.NET Project** dialog, select **MVC**, and then click **Change Authentication**.</span></span>   
  
    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image6.png)
3. <span data-ttu-id="c6111-137">Auf der **Authentifizierung ändern** wählen Sie im Dialogfeld **Organisationskonten**.</span><span class="sxs-lookup"><span data-stu-id="c6111-137">On the **Change Authentication** dialog, select **Organizational Accounts**.</span></span> <span data-ttu-id="c6111-138">Diese Optionen können automatisch registrieren Ihrer Anwendung in Azure AD als auch automatisch Konfigurieren der Anwendung zur Integration in Azure AD verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="c6111-138">These options can be used to automatically register your application with Azure AD as well as automatically configure your application to integrate with Azure AD.</span></span> <span data-ttu-id="c6111-139">Sie müssen nicht verwenden die **Authentifizierung ändern** Dialogfeld zum Registrieren und konfigurieren die Anwendung, sondern kann es viel einfacher.</span><span class="sxs-lookup"><span data-stu-id="c6111-139">You don't have to use the **Change Authentication** dialog to register and configure your application, but it makes it much easier.</span></span> <span data-ttu-id="c6111-140">Wenn Sie z. B. Visual Studio 2012 verwenden, können Sie dennoch manuell registrieren Sie die Anwendung im Azure-Verwaltungsportal und aktualisieren Sie die Konfiguration für die Integration von Azure AD.</span><span class="sxs-lookup"><span data-stu-id="c6111-140">If you are using Visual Studio 2012 for example, you can still manually register the application in the Azure Management Portal and update its configuration to integrate with Azure AD.</span></span>  
   <span data-ttu-id="c6111-141">Wählen Sie in der Dropdown-Menüs **Cloud – einzelne Organisation** und **einmaliges Anmelden, Verzeichnisdaten lesen**.</span><span class="sxs-lookup"><span data-stu-id="c6111-141">In the drop-down menus, select **Cloud - Single Organization** and **Single Sign On, Read directory data**.</span></span> <span data-ttu-id="c6111-142">Geben Sie die Domäne für Ihr Azure AD-Verzeichnis, z. B. (in der folgenden Images) *aricka0yahoo.onmicrosoft.com*, und klicken Sie dann auf **OK**.</span><span class="sxs-lookup"><span data-stu-id="c6111-142">Enter the domain for your Azure AD directory, for example (in the images below) *aricka0yahoo.onmicrosoft.com*, and then click **OK**.</span></span> <span data-ttu-id="c6111-143">Sie können den Domänennamen aus der Registerkarte "Domänen" abrufen, für das Standard-Verzeichnis im Azure-Portal (finden Sie in der nächsten Abbildung unten).</span><span class="sxs-lookup"><span data-stu-id="c6111-143">You can get the domain name from the Domains tab for the Default Directory on the azure portal (see the next image down).</span></span>   
  
    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image7.png)  
  
   <span data-ttu-id="c6111-144">Die folgende Abbildung zeigt den Domänennamen vom Azure-Portal.</span><span class="sxs-lookup"><span data-stu-id="c6111-144">The following image shows the domain name from the Azure portal.</span></span>  
  
    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image8.png)  

    > [!NOTE]
    > <span data-ttu-id="c6111-145">Optional können Sie die Anwendung-ID-URI, der durch Klicken auf in Azure AD registriert werden, konfigurieren **Weitere Optionen**.</span><span class="sxs-lookup"><span data-stu-id="c6111-145">You can optionally configure the Application ID URI that will be registered in Azure AD by clicking **More Options**.</span></span> <span data-ttu-id="c6111-146">Die App-ID-URI ist der eindeutige Bezeichner für eine Anwendung, die in Azure AD registriert und von der Anwendung verwendet werden, um sich bei der Kommunikation mit Azure AD identifizieren.</span><span class="sxs-lookup"><span data-stu-id="c6111-146">The App ID URI is the unique identifier for an application, which is registered in Azure AD and used by the application to identify itself when communicating with Azure AD.</span></span> <span data-ttu-id="c6111-147">Weitere Informationen zu den App-ID-URI und andere Eigenschaften der registrierten Anwendungen, finden Sie unter [in diesem Thema](https://msdn.microsoft.com/library/azure/dn499820.aspx#BKMK_Registering).</span><span class="sxs-lookup"><span data-stu-id="c6111-147">For more information about the App ID URI and other properties of registered applications, see [this topic](https://msdn.microsoft.com/library/azure/dn499820.aspx#BKMK_Registering).</span></span> <span data-ttu-id="c6111-148">Indem Sie das Kontrollkästchen unter dem Feld "App-ID-URI" aktivieren, können Sie auch auswählen, um eine vorhandene Registrierung in Azure AD zu überschreiben, die die gleiche App-ID-URI verwendet.</span><span class="sxs-lookup"><span data-stu-id="c6111-148">By clicking the checkbox below the App ID URI field, you can also choose to overwrite an existing registration in Azure AD that uses the same App ID URI.</span></span>
4. <span data-ttu-id="c6111-149">Nach dem Klicken auf **OK**, ein Anmeldedialogfeld wird angezeigt, und Sie müssen über ein globales Administratorkonto (nicht die Microsoft-Konto mit Ihrem Abonnement verknüpft ist) anmelden.</span><span class="sxs-lookup"><span data-stu-id="c6111-149">After clicking **OK**, a sign-in dialog will appear, and you'll need to sign in using a Global Administrator account (not the Microsoft account associated with your subscription).</span></span> <span data-ttu-id="c6111-150">Wenn Sie ein neues Administratorkonto ein zuvor erstellt haben, müssen Sie dazu das Kennwort ändern, und klicken Sie dann erneut mit dem neuen Kennwort anmelden.</span><span class="sxs-lookup"><span data-stu-id="c6111-150">If you created a new Administrator account earlier, you'll be required to change the password and then sign in again using the new password.</span></span>   
  
    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image9.png)
5. <span data-ttu-id="c6111-151">Nachdem Sie erfolgreich authentifiziert haben, die **neues ASP.NET-Projekt** Dialogfeld zeigt Ihrer authentifizierungswahl (**organisationsweite** ) und das Verzeichnis, in dem die neue Anwendung wird, registriert (*aricka0yahoo.onmicrosoft.com* in der folgenden Abbildung).</span><span class="sxs-lookup"><span data-stu-id="c6111-151">After you've successfully authenticated, the **New ASP.NET Project** dialog will show your authentication choice (**Organizational** ) and the directory where the new application will be registered (*aricka0yahoo.onmicrosoft.com* in the image below).</span></span> <span data-ttu-id="c6111-152">Unterhalb dieser Informationen das Kontrollkästchen mit der Bezeichnung **Host in der Cloud**.</span><span class="sxs-lookup"><span data-stu-id="c6111-152">Below this information, select the checkbox labeled **Host in the cloud**.</span></span> <span data-ttu-id="c6111-153">Wenn dieses Kontrollkästchen aktiviert ist, wird das Projekt wird als eine Azure-Web-app bereitgestellt werden und wird für einfache später veröffentlichen aktiviert werden.</span><span class="sxs-lookup"><span data-stu-id="c6111-153">If this checkbox is selected, the project will be provisioned as an Azure web app and will be enabled for easy publishing later.</span></span> <span data-ttu-id="c6111-154">Klicken Sie auf **OK**.</span><span class="sxs-lookup"><span data-stu-id="c6111-154">Click **OK**.</span></span>   
  
    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image10.png)
6. <span data-ttu-id="c6111-155">Die **Azure-Website konfigurieren** Dialogfeld wird angezeigt, mit einem automatisch generierten Standortnamen und Region.</span><span class="sxs-lookup"><span data-stu-id="c6111-155">The **Configure Azure Website** dialog will appear, using an auto-generated site name and region.</span></span> <span data-ttu-id="c6111-156">Beachten Sie außerdem das Konto, das Sie gerade in das Dialogfeld "angemeldet sind.</span><span class="sxs-lookup"><span data-stu-id="c6111-156">Also note the account you're currently signed into in the dialog.</span></span> <span data-ttu-id="c6111-157">Sie möchten sicherstellen, dass dieses Konto ist, der Ihrem Azure-Abonnement zugeordnet ist, in der Regel ein Microsoft-Konto.</span><span class="sxs-lookup"><span data-stu-id="c6111-157">You want to make sure that this account is the one that your Azure subscription is attached to, typically a Microsoft account.</span></span>

    > [!NOTE]
    > <span data-ttu-id="c6111-158">Dieses Projekt ist eine Datenbank erforderlich.</span><span class="sxs-lookup"><span data-stu-id="c6111-158">This project requires a database.</span></span> <span data-ttu-id="c6111-159">Wählen Sie eine der vorhandenen Datenbanken aus, oder erstellen Sie eine neue werden müssen.</span><span class="sxs-lookup"><span data-stu-id="c6111-159">You need to select one of your existing databases, or create a new one.</span></span> <span data-ttu-id="c6111-160">Eine Datenbank ist erforderlich, da das Projekt bereits eine lokale Datenbankdatei verwendet, um eine kleine Menge von Authentifizierungsdaten für die Konfiguration zu speichern.</span><span class="sxs-lookup"><span data-stu-id="c6111-160">A database is required because the project already uses a local database file to store a small amount of authentication configuration data.</span></span> <span data-ttu-id="c6111-161">Wenn Sie die Anwendung für eine Azure-Website bereitstellen, ist nicht mit der Bereitstellung dieser Datenbank verpackt, daher müssen Sie eine davon auszuwählen, die in der Cloud zugänglich ist.</span><span class="sxs-lookup"><span data-stu-id="c6111-161">When you deploy the application to an Azure Website, this database isn't packaged with the deployment, so you need to choose one that's accessible in the cloud.</span></span> <span data-ttu-id="c6111-162">Klicken Sie auf **OK**.</span><span class="sxs-lookup"><span data-stu-id="c6111-162">Click **OK**.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image11.png)
7. <span data-ttu-id="c6111-163">Das Projekt wird erstellt, und die Authentifizierungsoptionen und Optionen für Web-app werden automatisch mit dem Projekt konfiguriert werden.</span><span class="sxs-lookup"><span data-stu-id="c6111-163">The project will be created, and your authentication options and web app options will be automatically configured with the project.</span></span> <span data-ttu-id="c6111-164">Nachdem dieser Vorgang abgeschlossen wurde, führen Sie das Projekt lokal durch Drücken von **^ F5**.</span><span class="sxs-lookup"><span data-stu-id="c6111-164">Once this process has completed, run the project locally by pressing **^F5**.</span></span> <span data-ttu-id="c6111-165">Sie müssen sich mit Ihrem Unternehmenskonto anmelden.</span><span class="sxs-lookup"><span data-stu-id="c6111-165">You will be required to sign in using your organizational account.</span></span> <span data-ttu-id="c6111-166">Geben Sie den Benutzernamen und das Kennwort für das Konto, das Sie zuvor erstellt haben, und klicken Sie auf **anmelden**.</span><span class="sxs-lookup"><span data-stu-id="c6111-166">Provide the username and password for the account you created earlier and click **Sign in**.</span></span>   
  
    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image12.png)
8. <span data-ttu-id="c6111-167">Nach der erfolgreichen Anmeldung wird die ASP.NET-Website angezeigt, dass Sie authentifiziert haben, indem der Benutzername in der oberen rechten Ecke der Seite angezeigt.</span><span class="sxs-lookup"><span data-stu-id="c6111-167">After successful sign in, the ASP.NET site will show that you've authenticated by displaying the username in the top right corner of the page.</span></span>  
  
    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image13.png)  
  
   <span data-ttu-id="c6111-168">Wenn Sie eine Fehlermeldung erhalten, müssen Sie Folgendes tun:</span><span class="sxs-lookup"><span data-stu-id="c6111-168">If you get the error:</span></span>  
   <span data-ttu-id="c6111-169">Wert darf nicht null oder leer sein.</span><span class="sxs-lookup"><span data-stu-id="c6111-169">Value cannot be null or empty.</span></span> <span data-ttu-id="c6111-170">Parametername: LinkText</span><span class="sxs-lookup"><span data-stu-id="c6111-170">Parameter name: linkText</span></span>   
    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image14.png)  
  
   <span data-ttu-id="c6111-171">finden Sie unter der [Debuggen](#dbg) Abschnitt am Ende des Lernprogramms.</span><span class="sxs-lookup"><span data-stu-id="c6111-171">see the [debug](#dbg) section at the end of the tutorial.</span></span>

## <a name="basics-of-the-graph-api"></a><span data-ttu-id="c6111-172">Grundlagen der Graph-API</span><span class="sxs-lookup"><span data-stu-id="c6111-172">Basics of the Graph API</span></span>

<span data-ttu-id="c6111-173">[Der Graph-API](https://msdn.microsoft.com/library/azure/hh974476.aspx) ist die programmgesteuerte Schnittstelle, die zum Ausführen von CRUD und andere Vorgänge für Objekte in Ihrem Azure AD-Verzeichnis verwendet.</span><span class="sxs-lookup"><span data-stu-id="c6111-173">[The Graph API](https://msdn.microsoft.com/library/azure/hh974476.aspx) is the programmatic interface used to perform CRUD and other operations on objects in your Azure AD directory.</span></span> <span data-ttu-id="c6111-174">Wenn Sie eine Option Organisations-Konto für die Authentifizierung beim Erstellen eines neuen Projekts in Visual Studio 2013 auswählen, wird die Anwendung bereits konfiguriert sein, zum Aufrufen der Graph-API.</span><span class="sxs-lookup"><span data-stu-id="c6111-174">If you select an Organizational Account option for authentication when creating a new project in Visual Studio 2013, your application will already be configured to call the Graph API.</span></span> <span data-ttu-id="c6111-175">Dieser Abschnitt wird kurz Funktionsweise der Graph-API.</span><span class="sxs-lookup"><span data-stu-id="c6111-175">This section briefly shows you how the Graph API works.</span></span>

1. <span data-ttu-id="c6111-176">Klicken Sie in der ausgeführten Anwendung auf, auf den Namen des angemeldeten Benutzers oben rechts auf der Seite.</span><span class="sxs-lookup"><span data-stu-id="c6111-176">In your running application, click on the name of the signed-in user at the top right of the page.</span></span> <span data-ttu-id="c6111-177">Dadurch gelangen Sie zu der Seite "Benutzerprofil", also eine Aktion auf dem Home-Controller.</span><span class="sxs-lookup"><span data-stu-id="c6111-177">This will take you to the User Profile page, which is an action on the Home Controller.</span></span> <span data-ttu-id="c6111-178">Sie werden bemerken, dass die Tabelle enthält die Benutzerinformationen zu dem Administratorkonto an, dass Sie zuvor erstellt haben.</span><span class="sxs-lookup"><span data-stu-id="c6111-178">You'll notice that the table contains user information about the administrator account you created earlier.</span></span> <span data-ttu-id="c6111-179">Diese Informationen werden in Ihrem Verzeichnis gespeichert, und der Graph-API zum Abrufen dieser Informationen beim Laden der Seite aufgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="c6111-179">This information is stored in your directory, and the Graph API is called to retrieve this information when the page loads.</span></span>   
  
    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image15.png)
2. <span data-ttu-id="c6111-180">Wechseln Sie zurück zu Visual Studio, und erweitern Sie die **Controller** Ordner, und öffnen Sie dann die **HomeController.cs** Datei.</span><span class="sxs-lookup"><span data-stu-id="c6111-180">Go back to Visual Studio and expand the **Controllers** folder and then open the **HomeController.cs** file.</span></span> <span data-ttu-id="c6111-181">Sehen Sie eine **UserProfile()** Aktion, die Code zum Abrufen eines Tokens, und rufen Sie dann auf die Graph-API enthält.</span><span class="sxs-lookup"><span data-stu-id="c6111-181">You'll see a **UserProfile()** action that contains code to retrieve a token and then call the Graph API.</span></span> <span data-ttu-id="c6111-182">Dieser Code wird unten dupliziert:</span><span class="sxs-lookup"><span data-stu-id="c6111-182">This code is duplicated below:</span></span> 

    [!code-csharp[Main](developing-aspnet-apps-with-windows-azure-active-directory/samples/sample1.cs?highlight=22)]

    <span data-ttu-id="c6111-183">Um die Graph-API aufzurufen, müssen Sie zunächst ein Token abgerufen.</span><span class="sxs-lookup"><span data-stu-id="c6111-183">To call the Graph API, you first need to retrieve a token.</span></span> <span data-ttu-id="c6111-184">Wenn das Token abgerufen wird, muss der Zeichenfolgenwert in der Authorization-Header für alle nachfolgenden Anforderungen an die Graph-API angefügt werden.</span><span class="sxs-lookup"><span data-stu-id="c6111-184">When the token is retrieved, its string value must be appended in the Authorization header for all subsequent requests to the Graph API.</span></span> <span data-ttu-id="c6111-185">Die meisten Code über behandelt die Details der Authentifizierung in Azure AD, um ein Token abzurufen, verwenden das Token, einen Aufruf der Graph-API und Transformieren die Antwort, damit sie in der Ansicht angezeigt werden kann.</span><span class="sxs-lookup"><span data-stu-id="c6111-185">Most of the code above handles the details of authenticating to Azure AD to get a token, using the token to make a call to the Graph API, and then transforming the response so that it can be presented in the View.</span></span>

    <span data-ttu-id="c6111-186">Erläuterung der wichtigsten Teil ist die folgende hervorgehobene Zeile: `UserProfile profile = JsonConvert.DeserializeObject<UserProfile>(responseString);`.</span><span class="sxs-lookup"><span data-stu-id="c6111-186">The most relevant portion for discussion is the following highlighted line: `UserProfile profile = JsonConvert.DeserializeObject<UserProfile>(responseString);`.</span></span> <span data-ttu-id="c6111-187">Diese Zeile stellt den Namen des Benutzers, die aus der JSON-Antwort deserialisiert wurde, und wird in der Ansicht angezeigt.</span><span class="sxs-lookup"><span data-stu-id="c6111-187">This line represents the name of the user, which has been deserialized from the JSON response and is presented in the View.</span></span>

    <span data-ttu-id="c6111-188">Rufen Sie die Graph-API, die mit "HttpClient" und die unformatierten Daten zu behandeln, jedoch eine einfachere Möglichkeit ist die Verwendung der [Graph-Clientbibliothek, die über NuGet verfügbar ist](http://www.nuget.org/packages/Microsoft.Azure.ActiveDirectory.GraphClient/).</span><span class="sxs-lookup"><span data-stu-id="c6111-188">You can call the Graph API using HttpClient and handle the raw data yourself, but an easier way is to use the [Graph Client Library which is available via NuGet](http://www.nuget.org/packages/Microsoft.Azure.ActiveDirectory.GraphClient/).</span></span> <span data-ttu-id="c6111-189">Die Clientbibliothek behandelt die unformatierten HTTP-Anforderungen und die Transformation der zurückgegebenen Daten für Sie und kann es viel einfacher, mit der Graph-API in einer Umgebung mit .NET arbeiten.</span><span class="sxs-lookup"><span data-stu-id="c6111-189">The Client Library handles the raw HTTP requests and the transformation of the returned data for you, and makes it much easier to work with the Graph API in a .NET environment.</span></span> <span data-ttu-id="c6111-190">Verwandte Codebeispiele für die Graph-API finden Sie [GitHub.](https://github.com/AzureADSamples)</span><span class="sxs-lookup"><span data-stu-id="c6111-190">See the related Graph API code samples on [GitHub.](https://github.com/AzureADSamples)</span></span>

## <a name="deploy-the-application-to-azure"></a><span data-ttu-id="c6111-191">Bereitstellen der Anwendung in Azure</span><span class="sxs-lookup"><span data-stu-id="c6111-191">Deploy the Application to Azure</span></span>

<span data-ttu-id="c6111-192">Die folgenden Schritte aus erfahren Sie, wie Sie die Anwendung in Azure bereitzustellen.</span><span class="sxs-lookup"><span data-stu-id="c6111-192">The following steps will show you how to deploy the application to Azure.</span></span> <span data-ttu-id="c6111-193">In den vorherigen Schritten verbunden Sie das neue Projekt mit einer Web-app in Azure, damit es in wenigen Schritten veröffentlicht werden kann.</span><span class="sxs-lookup"><span data-stu-id="c6111-193">In the earlier steps, you connected your new project with a web app on Azure, so it's ready to be published in just a few steps.</span></span>

1. <span data-ttu-id="c6111-194">Visual Studio mit der Maustaste auf das Projekt und wählen Sie **veröffentlichen**.</span><span class="sxs-lookup"><span data-stu-id="c6111-194">In Visual Studio, right-click on the project and select **Publish**.</span></span> <span data-ttu-id="c6111-195">Die **Web veröffentlichen** wird ein Dialogfeld angezeigt, bei dem jede Einstellung, die bereits konfiguriert.</span><span class="sxs-lookup"><span data-stu-id="c6111-195">The **Publish Web** dialog will appear with each setting already configured.</span></span> <span data-ttu-id="c6111-196">Klicken Sie auf die **Weiter** Schaltfläche fahren Sie mit der **Einstellungen** Seite.</span><span class="sxs-lookup"><span data-stu-id="c6111-196">Click on the **Next** button to go to the **Settings** page.</span></span> <span data-ttu-id="c6111-197">Möglicherweise werden Sie zur Authentifizierung aufgefordert; Stellen Sie sicher, dass Sie zur Authentifizierung verwenden, Ihre Azure-Abonnementkontos (in der Regel ein Microsoft-Konto) und nicht die Organisations-Konto, das Sie zuvor erstellt haben.</span><span class="sxs-lookup"><span data-stu-id="c6111-197">You may be prompted to authenticate; make sure you authenticate using your Azure subscription account (typically a Microsoft account) and not the organizational account you created earlier.</span></span>  
  
    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image16.png)
2. <span data-ttu-id="c6111-198">Überprüfen Sie die **Organisations-Authentifizierung aktivieren** Option.</span><span class="sxs-lookup"><span data-stu-id="c6111-198">Check the **Enable Organizational Authentication** option.</span></span> <span data-ttu-id="c6111-199">In der **Domäne** Feld, geben Sie die Domäne für Ihr Verzeichnis.</span><span class="sxs-lookup"><span data-stu-id="c6111-199">In the **Domain** field, enter the domain for your directory.</span></span> <span data-ttu-id="c6111-200">Aus der **Zugriffsebene** Dropdownliste, wählen **einmaliges Anmelden, Verzeichnisdaten lesen**.</span><span class="sxs-lookup"><span data-stu-id="c6111-200">From the **Access Level** drop-down, select **Single Sign On, Read directory data**.</span></span> <span data-ttu-id="c6111-201">Sie werden feststellen, dass die vorherige Datenbank, die Sie verwendet bereits aufgefüllt wird die **Datenbanken** Abschnitt.</span><span class="sxs-lookup"><span data-stu-id="c6111-201">You'll notice that the previous database you used is already populated in the **Databases** section.</span></span> <span data-ttu-id="c6111-202">Klicken Sie auf **Veröffentlichen**.</span><span class="sxs-lookup"><span data-stu-id="c6111-202">Click **Publish**.</span></span>  
  
    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image17.png)
3. <span data-ttu-id="c6111-203">Visual Studio wird Ihrer Website bereitstellen, und klicken Sie dann ein neues Browserfenster angezeigt wird.</span><span class="sxs-lookup"><span data-stu-id="c6111-203">Visual Studio will begin deploying your website, and then a new browser window will appear.</span></span> <span data-ttu-id="c6111-204">Sie werden möglicherweise aufgefordert, auf Ihr Verzeichnis erneut zu authentifizieren.</span><span class="sxs-lookup"><span data-stu-id="c6111-204">You may be prompted to authenticate to your directory once again.</span></span> <span data-ttu-id="c6111-205">Nachdem Sie authentifiziert haben, müssen Sie auf die neu veröffentlichte Website in Azure umgeleitet werden.</span><span class="sxs-lookup"><span data-stu-id="c6111-205">Once you've authenticated, you'll be redirected to your newly published website on Azure.</span></span>  
  
    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image18.png)

<a id="dbg"></a>
## <a name="debugging-the-app"></a><span data-ttu-id="c6111-206">Debuggen der app</span><span class="sxs-lookup"><span data-stu-id="c6111-206">Debugging the app</span></span>

<span data-ttu-id="c6111-207">Wenn Sie die folgende Fehlermeldung angezeigt:</span><span class="sxs-lookup"><span data-stu-id="c6111-207">If you get the following error:</span></span>   
 <span data-ttu-id="c6111-208">Wert darf nicht null oder leer sein.</span><span class="sxs-lookup"><span data-stu-id="c6111-208">Value cannot be null or empty.</span></span> <span data-ttu-id="c6111-209">Parametername: LinkText</span><span class="sxs-lookup"><span data-stu-id="c6111-209">Parameter name: linkText</span></span>   
   
![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image19.png)  
  

<span data-ttu-id="c6111-210">Ersetzen Sie den Code in der *Views\Shared\\_LoginPartial.cshtml* Datei durch Folgendes:</span><span class="sxs-lookup"><span data-stu-id="c6111-210">Replace the code in the *Views\Shared\\_LoginPartial.cshtml* file with the following:</span></span>

[!code-cshtml[Main](developing-aspnet-apps-with-windows-azure-active-directory/samples/sample2.cshtml?highlight=1-8,15-16)]

<span data-ttu-id="c6111-211">Nach dem Ausführen der app, wenn der angemeldete Benutzer "Null-Benutzer" angezeigt wird, melden Sie sich ab, und melden Sie sich wieder mit der Active Directory-Konto, das Sie zuvor erstellt haben.</span><span class="sxs-lookup"><span data-stu-id="c6111-211">After running the app, if the logged in user shows "Null User", sign out, and sign back in with the Active Directory account you created earlier.</span></span>

<span data-ttu-id="c6111-212">Eine hervorragende Lernprogramm anzuwendendes ist Rick Rainey des [Deep Dive: Azure-Websites und organisatorische Authentifizierung mithilfe von Azure AD](http://rickrainey.com/2014/08/19/deep-dive-azure-websites-and-organizational-authentication-using-azure-ad/).</span><span class="sxs-lookup"><span data-stu-id="c6111-212">An excellent tutorial to follow is Rick Rainey's [Deep Dive: Azure Websites and Organizational Authentication using Azure AD](http://rickrainey.com/2014/08/19/deep-dive-azure-websites-and-organizational-authentication-using-azure-ad/).</span></span>

## <a name="more-information"></a><span data-ttu-id="c6111-213">Weitere Informationen</span><span class="sxs-lookup"><span data-stu-id="c6111-213">More Information</span></span>

- [<span data-ttu-id="c6111-214">Deep Dive: Azure-Websites und Organisationseinheit mithilfe von Azure AD-Authentifizierung</span><span class="sxs-lookup"><span data-stu-id="c6111-214">Deep Dive: Azure Websites and Organizational Authentication using Azure AD</span></span>](http://rickrainey.com/2014/08/19/deep-dive-azure-websites-and-organizational-authentication-using-azure-ad/)
- [<span data-ttu-id="c6111-215">Übersicht über Azure AD Graph-API</span><span class="sxs-lookup"><span data-stu-id="c6111-215">Azure AD Graph API Overview</span></span>](https://msdn.microsoft.com/library/azure/hh974476.aspx)
- [<span data-ttu-id="c6111-216">Authentifizierungsszenarien in Azure AD</span><span class="sxs-lookup"><span data-stu-id="c6111-216">Authentication Scenarios in Azure AD</span></span>](https://msdn.microsoft.com/library/azure/dn499820.aspx)
- [<span data-ttu-id="c6111-217">Azure AD-Codebeispiele auf GitHub</span><span class="sxs-lookup"><span data-stu-id="c6111-217">Azure AD Code Samples on GitHub</span></span>](https://github.com/AzureADSamples)
