---
uid: identity/overview/features-api/account-confirmation-and-password-recovery-with-aspnet-identity
title: Konto zur Bestätigung und Kennwortwiederherstellung mit ASP.NET Identity (c#) | Microsoft Docs
author: HaoK
description: Erstellen Sie eine sichere ASP.NET MVC 5-Web-app mit anmelden, e-Mail-Bestätigung und das Kennwort zurücksetzen, vor dem Durchführen des Lernprogramms zuerst abgeschlossen werden soll. In diesem Lernprogramm...
ms.author: aspnetcontent
manager: wpickett
ms.date: 03/26/2015
ms.topic: article
ms.assetid: 8d54180d-f826-4df7-b503-7debf5ed9fb3
ms.technology: ''
ms.prod: .net-framework
msc.legacyurl: /identity/overview/features-api/account-confirmation-and-password-recovery-with-aspnet-identity
msc.type: authoredcontent
ms.openlocfilehash: 0167388cf6b488b72ca36f583a7794690dbf9900
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 04/06/2018
ms.locfileid: "30876032"
---
<a name="account-confirmation-and-password-recovery-with-aspnet-identity-c"></a><span data-ttu-id="3f73f-104">Kontobestätigung und Kennwortwiederherstellung mit ASP.NET Identity (c#)</span><span class="sxs-lookup"><span data-stu-id="3f73f-104">Account Confirmation and Password Recovery with ASP.NET Identity (C#)</span></span>
====================
<span data-ttu-id="3f73f-105">durch [Hao Kung](https://github.com/HaoK), [Pranav Rastogi](https://github.com/rustd), [Rick Anderson](https://github.com/Rick-Anderson), [Suhas Joshi](https://github.com/suhasj)</span><span class="sxs-lookup"><span data-stu-id="3f73f-105">by [Hao Kung](https://github.com/HaoK), [Pranav Rastogi](https://github.com/rustd), [Rick Anderson](https://github.com/Rick-Anderson), [Suhas Joshi](https://github.com/suhasj)</span></span>

> <span data-ttu-id="3f73f-106">Vor dem Ausführen dieses Lernprogramms führen Sie zuerst [erstellen Sie eine sichere ASP.NET MVC 5-Web-app mit anmelden, e-Mail-Bestätigung und das Kennwort zurücksetzen](../../../mvc/overview/security/create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset.md).</span><span class="sxs-lookup"><span data-stu-id="3f73f-106">Before doing this tutorial you should first complete [Create a secure ASP.NET MVC 5 web app with log in, email confirmation and password reset](../../../mvc/overview/security/create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset.md).</span></span> <span data-ttu-id="3f73f-107">Dieses Lernprogramm enthält weitere Informationen und erfahren Sie, wie e-Mail zur kontobestätigung der lokalen einrichten und ermöglichen Benutzern die vergessene Kennwort in ASP.NET Identity zurückgesetzt.</span><span class="sxs-lookup"><span data-stu-id="3f73f-107">This tutorial contains more details and will show you how to set up email for local account confirmation and allow users to reset their forgotten password in ASP.NET Identity.</span></span> <span data-ttu-id="3f73f-108">In diesem Artikel von Rick Anderson geschrieben wurde ([@RickAndMSFT](https://twitter.com/#!/RickAndMSFT)), Pranav Rastogi ([@rustd](https://twitter.com/rustd)), Hao Kung und Suhas Joshi.</span><span class="sxs-lookup"><span data-stu-id="3f73f-108">This article was written by Rick Anderson ([@RickAndMSFT](https://twitter.com/#!/RickAndMSFT)), Pranav Rastogi ([@rustd](https://twitter.com/rustd)), Hao Kung, and Suhas Joshi.</span></span> <span data-ttu-id="3f73f-109">Das NuGet-Beispiel wurde in erster Linie durch Hao Kung geschrieben.</span><span class="sxs-lookup"><span data-stu-id="3f73f-109">The NuGet sample was written primarily by Hao Kung.</span></span>


<span data-ttu-id="3f73f-110">Ein lokales Benutzerkonto verweisen, muss der Benutzer ein Kennwort für das Konto zu erstellen und dieses Kennwort wird in der Web-app (sichere) gespeichert.</span><span class="sxs-lookup"><span data-stu-id="3f73f-110">A local user account requires the user to create a password for the account, and that password is stored (securely) in the web app.</span></span> <span data-ttu-id="3f73f-111">Außerdem unterstützt ASP.NET Identity soziale Konten den Benutzer ein Kennwort für die app zu erstellen, die nicht erforderlich ist.</span><span class="sxs-lookup"><span data-stu-id="3f73f-111">ASP.NET Identity also supports social accounts, which don't require the user to create a password for the app.</span></span> <span data-ttu-id="3f73f-112">[Soziale Konten](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md) einen Drittanbieter (z. B. Google, Twitter, Facebook oder Microsoft) zum Authentifizieren von Benutzern verwenden.</span><span class="sxs-lookup"><span data-stu-id="3f73f-112">[Social accounts](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md) use a third party (such as Google, Twitter, Facebook or Microsoft) to authenticate users.</span></span> <span data-ttu-id="3f73f-113">In diesem Thema werden die folgenden Themen behandelt:</span><span class="sxs-lookup"><span data-stu-id="3f73f-113">This topic covers the following:</span></span>

- <span data-ttu-id="3f73f-114">[Erstellen einer ASP.NET MVC-app](#createMvc) und Untersuchen von ASP.NET Identity-Funktionen.</span><span class="sxs-lookup"><span data-stu-id="3f73f-114">[Create an ASP.NET MVC app](#createMvc) and explore ASP.NET Identity features.</span></span>
- [<span data-ttu-id="3f73f-115">Erstellen des Beispiels Identität</span><span class="sxs-lookup"><span data-stu-id="3f73f-115">Building the Identity sample</span></span>](#build)
- [<span data-ttu-id="3f73f-116">Richten Sie e-Mail-Bestätigung</span><span class="sxs-lookup"><span data-stu-id="3f73f-116">Set up email confirmation</span></span>](#email)

<span data-ttu-id="3f73f-117">Neue Benutzer registrieren ihre e-Mail-Alias, der ein lokales Konto erstellt.</span><span class="sxs-lookup"><span data-stu-id="3f73f-117">New users register their email alias, which creates a local account.</span></span>

![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image1.png)

<span data-ttu-id="3f73f-118">Klicken auf die Schaltfläche "registrieren" sendet eine e-Mail zur kaufbestätigung, die eine Überprüfungstoken an ihre e-Mail-Adresse enthält.</span><span class="sxs-lookup"><span data-stu-id="3f73f-118">Clicking the Register button sends a confirmation email containing a validation token to their email address.</span></span>

![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image2.png)

<span data-ttu-id="3f73f-119">Der Benutzer wird eine e-Mail mit einem bestätigungstoken für ihr Konto gesendet werden.</span><span class="sxs-lookup"><span data-stu-id="3f73f-119">The user is sent an email with a confirmation token for their account.</span></span>

![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image3.png)

<span data-ttu-id="3f73f-120">Durch Klicken auf den Link klicken, wird das Konto bestätigt.</span><span class="sxs-lookup"><span data-stu-id="3f73f-120">Clicking the link confirms the account.</span></span>

![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image4.png)

<a id="passwordReset"></a>

## <a name="password-recoveryreset"></a><span data-ttu-id="3f73f-121">Zurücksetzen des Kennworts/Wiederherstellung</span><span class="sxs-lookup"><span data-stu-id="3f73f-121">Password recovery/reset</span></span>

<span data-ttu-id="3f73f-122">Lokale Benutzer ihr Kennwort vergessen haben ein Sicherheitstoken an ihre e-Mail-Konto gesendet featuresammlung um sein Kennwort zurückzusetzen.</span><span class="sxs-lookup"><span data-stu-id="3f73f-122">Local users who forget their password can have a security token sent to their email account, enabling them to reset their password.</span></span>  
  
![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image5.png)  
  
<span data-ttu-id="3f73f-123">Der Benutzer erhält eine e-Mail mit einem Link, sodass sie ihr Kennwort zurücksetzen bald.</span><span class="sxs-lookup"><span data-stu-id="3f73f-123">The user will soon get an email with a link allowing them to reset their password.</span></span>  
  
![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image6.png)  
<span data-ttu-id="3f73f-124">Der Link gelangen sie zur Seite "Zurücksetzen".</span><span class="sxs-lookup"><span data-stu-id="3f73f-124">Clicking the link will take them to the Reset page.</span></span>  
  
![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image7.png)  
  
<span data-ttu-id="3f73f-125">Klicken auf die **zurücksetzen** Schaltfläche wird bestätigt das Kennwort zurückgesetzt wurde.</span><span class="sxs-lookup"><span data-stu-id="3f73f-125">Clicking the **Reset** button will confirm the password has been reset.</span></span>  
  
![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image8.png)

<a id="createMvc"></a>

## <a name="create-an-aspnet-web-app"></a><span data-ttu-id="3f73f-126">Erstellen einer ASP.NET Web-app</span><span class="sxs-lookup"><span data-stu-id="3f73f-126">Create an ASP.NET Web app</span></span>

<span data-ttu-id="3f73f-127">Starten, indem Sie installieren und Ausführen von [Visual Studio Express 2013 für Web](https://go.microsoft.com/fwlink/?LinkId=299058) oder [Visual Studio 2013](https://go.microsoft.com/fwlink/?LinkId=306566).</span><span class="sxs-lookup"><span data-stu-id="3f73f-127">Start by installing and running [Visual Studio Express 2013 for Web](https://go.microsoft.com/fwlink/?LinkId=299058) or [Visual Studio 2013](https://go.microsoft.com/fwlink/?LinkId=306566).</span></span> <span data-ttu-id="3f73f-128">Installieren von Visual Studio [2013 Update 2](https://go.microsoft.com/fwlink/?LinkId=390521) oder höher.</span><span class="sxs-lookup"><span data-stu-id="3f73f-128">Install Visual Studio [2013 Update 2](https://go.microsoft.com/fwlink/?LinkId=390521) or higher.</span></span>

> [!NOTE]
> <span data-ttu-id="3f73f-129">Warnung: Sie müssen Visual Studio installieren [2013 Update 2](https://go.microsoft.com/fwlink/?LinkId=390521) dieses Lernprogramms.</span><span class="sxs-lookup"><span data-stu-id="3f73f-129">Warning: You must install Visual Studio [2013 Update 2](https://go.microsoft.com/fwlink/?LinkId=390521) to complete this tutorial.</span></span>


1. <span data-ttu-id="3f73f-130">Erstellen Sie ein neues ASP.NET Web-Projekt, und wählen Sie die MVC-Vorlage.</span><span class="sxs-lookup"><span data-stu-id="3f73f-130">Create a new ASP.NET Web project and select the MVC template.</span></span> <span data-ttu-id="3f73f-131">WebForms unterstützt auch ASP.NET Identity, damit Sie ähnliche Schritte in einer Web Forms-app folgen können.</span><span class="sxs-lookup"><span data-stu-id="3f73f-131">Web Forms also supports ASP.NET Identity, so you could follow similar steps in a web forms app.</span></span>
2. <span data-ttu-id="3f73f-132">Lassen Sie die Standardauthentifizierung als **einzelne Benutzerkonten**.</span><span class="sxs-lookup"><span data-stu-id="3f73f-132">Leave the default authentication as **Individual User Accounts**.</span></span>
3. <span data-ttu-id="3f73f-133">Führen Sie die app, klicken Sie auf die **registrieren** verknüpfen und einen Benutzer registrieren.</span><span class="sxs-lookup"><span data-stu-id="3f73f-133">Run the app, click the **Register** link and register a user.</span></span> <span data-ttu-id="3f73f-134">An diesem Punkt wird die ausschließliche Überprüfung auf die e-Mail-Adresse mit der [[EmailAddress]](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.emailaddressattribute(v=vs.110).aspx) Attribut.</span><span class="sxs-lookup"><span data-stu-id="3f73f-134">At this point, the only validation on the email is with the [[EmailAddress]](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.emailaddressattribute(v=vs.110).aspx) attribute.</span></span>
4. <span data-ttu-id="3f73f-135">Wechseln Sie in Server-Explorer zu **Daten Connections\DefaultConnection\Tables\AspNetUsers**, mit der rechten Maustaste, und wählen Sie **Tabellendefinition öffnen**.</span><span class="sxs-lookup"><span data-stu-id="3f73f-135">In Server Explorer, navigate to **Data Connections\DefaultConnection\Tables\AspNetUsers**, right click and select **Open table definition**.</span></span>

    <span data-ttu-id="3f73f-136">Die folgende Abbildung zeigt die `AspNetUsers` Schema:</span><span class="sxs-lookup"><span data-stu-id="3f73f-136">The following image shows the `AspNetUsers` schema:</span></span>

    ![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image9.png)
5. <span data-ttu-id="3f73f-137">Klicken Sie mit der rechten Maustaste auf die **AspNetUsers** Tabelle, und wählen Sie **Tabellendaten anzeigen**.</span><span class="sxs-lookup"><span data-stu-id="3f73f-137">Right click on the **AspNetUsers** table and select **Show Table Data**.</span></span>  
  
    ![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image10.png)  
  
   <span data-ttu-id="3f73f-138">Die e-Mail wurde an diesem Punkt nicht bestätigt.</span><span class="sxs-lookup"><span data-stu-id="3f73f-138">At this point the email has not been confirmed.</span></span>

<span data-ttu-id="3f73f-139">Sie können ihn zur Verwendung der andere Datenspeicher und zusätzliche Felder hinzufügen, Konfigurieren der Standardspeicher für die Daten für ASP.NET Identity ist Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="3f73f-139">The default data store for ASP.NET Identity is Entity Framework, but you can configure it to use other data stores and to add additional fields.</span></span> <span data-ttu-id="3f73f-140">Finden Sie unter [zusätzliche Ressourcen](#addRes) Abschnitt am Ende dieses Lernprogramms.</span><span class="sxs-lookup"><span data-stu-id="3f73f-140">See [Additional Resources](#addRes) section at the end of this tutorial.</span></span>

<span data-ttu-id="3f73f-141">Die [OWIN-Startklasse](../../../aspnet/overview/owin-and-katana/owin-startup-class-detection.md) ( *Startup.cs* ) wird aufgerufen, wenn die Anwendung gestartet und ruft die `ConfigureAuth` Methode in *App\_Start\Startup.Auth.cs*, die OWIN-Pipeline konfiguriert und initialisiert ASP.NET Identity.</span><span class="sxs-lookup"><span data-stu-id="3f73f-141">The [OWIN startup class](../../../aspnet/overview/owin-and-katana/owin-startup-class-detection.md) ( *Startup.cs* ) is called when the app starts and invokes the `ConfigureAuth` method in *App\_Start\Startup.Auth.cs*, which configures the OWIN pipeline and initializes ASP.NET Identity.</span></span> <span data-ttu-id="3f73f-142">Überprüfen Sie die `ConfigureAuth` Methode.</span><span class="sxs-lookup"><span data-stu-id="3f73f-142">Examine the `ConfigureAuth` method.</span></span> <span data-ttu-id="3f73f-143">Jede `CreatePerOwinContext` Aufruf registriert einen Rückruf (gespeichert der `OwinContext`), wird pro Anforderung zum Erstellen einer Instanz des angegebenen Typs einmal aufgerufen werden.</span><span class="sxs-lookup"><span data-stu-id="3f73f-143">Each `CreatePerOwinContext` call registers a callback (saved in the `OwinContext`) that will be called once per request to create an instance of the specified type.</span></span> <span data-ttu-id="3f73f-144">Sie können einen Haltepunkt im Konstruktor festgelegt und `Create` Methode jeden Typs (`ApplicationDbContext, ApplicationUserManager`) und überprüfen Sie, ob sie bei jeder Anforderung aufgerufen werden.</span><span class="sxs-lookup"><span data-stu-id="3f73f-144">You can set a break point in the constructor and `Create` method of each type (`ApplicationDbContext, ApplicationUserManager`) and verify they are called on each request.</span></span> <span data-ttu-id="3f73f-145">Eine Instanz der `ApplicationDbContext` und `ApplicationUserManager` befindet sich in der OWIN-Kontext, die in der gesamten Anwendung zugegriffen werden kann.</span><span class="sxs-lookup"><span data-stu-id="3f73f-145">A instance of `ApplicationDbContext` and `ApplicationUserManager` is stored in the OWIN context, which can be accessed throughout the application.</span></span> <span data-ttu-id="3f73f-146">ASP.NET Identity hooks in die OWIN-Pipeline über Cookie-Middleware bewirken.</span><span class="sxs-lookup"><span data-stu-id="3f73f-146">ASP.NET Identity hooks into the OWIN pipeline through cookie middleware.</span></span> <span data-ttu-id="3f73f-147">Weitere Informationen finden Sie unter [pro Anforderung Prozesslebensdauer-Verwaltung für UserManager-Klasse in ASP.NET Identity](https://blogs.msdn.com/b/webdev/archive/2014/02/12/per-request-lifetime-management-for-usermanager-class-in-asp-net-identity.aspx).</span><span class="sxs-lookup"><span data-stu-id="3f73f-147">For more information, see [Per request lifetime management for UserManager class in ASP.NET Identity](https://blogs.msdn.com/b/webdev/archive/2014/02/12/per-request-lifetime-management-for-usermanager-class-in-asp-net-identity.aspx).</span></span>

<span data-ttu-id="3f73f-148">Wenn Sie Ihrem Sicherheitsprofil ändern, ein neuen sicherheitsstempel generiert und gespeichert, der `SecurityStamp` Feld der *AspNetUsers* Tabelle.</span><span class="sxs-lookup"><span data-stu-id="3f73f-148">When you change your security profile, a new security stamp is generated and stored in the `SecurityStamp` field of the *AspNetUsers* table.</span></span> <span data-ttu-id="3f73f-149">Beachten Sie, dass die `SecurityStamp` Feld unterscheidet sich das Sicherheitscookie.</span><span class="sxs-lookup"><span data-stu-id="3f73f-149">Note, the `SecurityStamp` field is different from the security cookie.</span></span> <span data-ttu-id="3f73f-150">Das Sicherheitscookie befindet sich nicht in der `AspNetUsers` Tabelle (oder an anderer Stelle in der Identity-Datenbank).</span><span class="sxs-lookup"><span data-stu-id="3f73f-150">The security cookie is not stored in the `AspNetUsers` table (or anywhere else in the Identity DB).</span></span> <span data-ttu-id="3f73f-151">Das Cookie Sicherheitstoken ist selbstsigniert mit [DPAPI](https://msdn.microsoft.com/library/system.security.cryptography.protecteddata.aspx) und wird erstellt, mit der `UserId, SecurityStamp` und Zeitinformationen Ablauf.</span><span class="sxs-lookup"><span data-stu-id="3f73f-151">The security cookie token is self-signed using [DPAPI](https://msdn.microsoft.com/library/system.security.cryptography.protecteddata.aspx) and is created with the `UserId, SecurityStamp` and expiration time information.</span></span>

<span data-ttu-id="3f73f-152">Die Cookie-Middleware überprüft das Cookie bei jeder Anforderung.</span><span class="sxs-lookup"><span data-stu-id="3f73f-152">The cookie middleware checks the cookie on each request.</span></span> <span data-ttu-id="3f73f-153">Die `SecurityStampValidator` Methode in der `Startup` Klasse trifft die-Datenbank und in regelmäßigen Abständen, überprüft der sicherheitsstempel wie angegeben mit der `validateInterval`.</span><span class="sxs-lookup"><span data-stu-id="3f73f-153">The `SecurityStampValidator` method in the `Startup` class hits the DB and checks security stamp periodically, as specified with the `validateInterval`.</span></span> <span data-ttu-id="3f73f-154">Dies geschieht nur alle 30 Minuten (in unserem Beispiel), es sei denn, Sie Ihrem Sicherheitsprofil ändern.</span><span class="sxs-lookup"><span data-stu-id="3f73f-154">This only happens every 30 minutes (in our sample) unless you change your security profile.</span></span> <span data-ttu-id="3f73f-155">Das Intervall von 30 Minuten wurde gewählt, um Roundtrips zur Datenbank zu minimieren.</span><span class="sxs-lookup"><span data-stu-id="3f73f-155">The 30 minute interval was chosen to minimize trips to the database.</span></span> <span data-ttu-id="3f73f-156">Finden Sie unter meinem [zweistufige Authentifizierung Lernprogramm](index.md) Weitere Details.</span><span class="sxs-lookup"><span data-stu-id="3f73f-156">See my [two-factor authentication tutorial](index.md) for more details.</span></span>

<span data-ttu-id="3f73f-157">Pro die Kommentare im Code die `UseCookieAuthentication` Methode unterstützt die Cookieauthentifizierung.</span><span class="sxs-lookup"><span data-stu-id="3f73f-157">Per the comments in the code, the `UseCookieAuthentication` method supports cookie authentication.</span></span> <span data-ttu-id="3f73f-158">Die `SecurityStamp` Feld und zugehörigen Code bietet eine zusätzliche Ebene der Sicherheit Ihrer App, wenn Sie Ihr Kennwort ändern Sie protokolliert aus dem Browser, die Sie sich angemeldet haben.</span><span class="sxs-lookup"><span data-stu-id="3f73f-158">The `SecurityStamp` field and associated code provides an extra layer of security to your app, when you change your password, you will be logged out of the browser you logged in with.</span></span> <span data-ttu-id="3f73f-159">Die `SecurityStampValidator.OnValidateIdentity` Methode ermöglicht die app das Token überprüft werden soll, wenn der Benutzer anmeldet, die verwendet wird, wenn Sie ein Kennwort ändern, oder verwenden die externe Anmeldung.</span><span class="sxs-lookup"><span data-stu-id="3f73f-159">The `SecurityStampValidator.OnValidateIdentity` method enables the app to validate the security token when the user logs in, which is used when you change a password or use the external login.</span></span> <span data-ttu-id="3f73f-160">Dies ist erforderlich, um sicherzustellen, dass alle Token (Cookies) mit dem alten Kennwort generiert ungültig werden.</span><span class="sxs-lookup"><span data-stu-id="3f73f-160">This is needed to ensure that any tokens (cookies) generated with the old password are invalidated.</span></span> <span data-ttu-id="3f73f-161">Im Beispielprojekt, wenn Sie Benutzerkennworts klicken Sie dann ein neues Token für den Benutzer generiert wird, werden alle vorherigen Token für ungültig erklärt und `SecurityStamp` Feld aktualisiert wird.</span><span class="sxs-lookup"><span data-stu-id="3f73f-161">In the sample project, if you change the users password then a new token is generated for the user, any previous tokens are invalidated and the `SecurityStamp` field is updated.</span></span>

<span data-ttu-id="3f73f-162">Das Identitätssystem können Sie zum Konfigurieren Ihrer Anwendung, wenn das Sicherheitsprofil Benutzer ändert (z. B. wenn der Benutzer das Kennwort oder die Änderungen ändert Anmeldung zugeordnete (z.B. vom Facebook, Google, Microsoft-Konto usw.), der Benutzer wird protokolliert, allen Browserinstanzen.</span><span class="sxs-lookup"><span data-stu-id="3f73f-162">The Identity system allow you to configure your app so when the users security profile changes (for example, when the user changes their password or changes associated login (such as from Facebook, Google, Microsoft account, etc.), the user is logged out of all browser instances.</span></span> <span data-ttu-id="3f73f-163">Z. B. die folgende Abbildung zeigt die [einmaliges Abmelden Beispiel](https://aspnet.codeplex.com/SourceControl/latest#Samples/Identity/SingleSignOutSample/readme.txt) app, die dem Benutzer ermöglicht, alle Browserinstanzen (in diesem Fall Internet Explorer, Firefox und Chrome) abmelden, indem Sie auf eine Schaltfläche.</span><span class="sxs-lookup"><span data-stu-id="3f73f-163">For example, the image below shows the [Single signout sample](https://aspnet.codeplex.com/SourceControl/latest#Samples/Identity/SingleSignOutSample/readme.txt) app, which allows the user to sign out of all browser instances (in this case, IE, Firefox and Chrome) by clicking one button.</span></span> <span data-ttu-id="3f73f-164">Alternativ können auf im Beispiel eine bestimmte Browserinstanz nur abmelden.</span><span class="sxs-lookup"><span data-stu-id="3f73f-164">Alternatively, the sample allows you to only log out of a specific browser instance.</span></span>

![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image11.png)

<span data-ttu-id="3f73f-165">Die [einmaliges Abmelden Beispiel](https://aspnet.codeplex.com/SourceControl/latest#Samples/Identity/SingleSignOutSample/readme.txt) -app veranschaulicht, wie Sie beim Neugenerieren des Sicherheitstokens von ASP.NET Identity können.</span><span class="sxs-lookup"><span data-stu-id="3f73f-165">The [Single signout sample](https://aspnet.codeplex.com/SourceControl/latest#Samples/Identity/SingleSignOutSample/readme.txt) app shows how ASP.NET Identity allows you to regenerate the security token.</span></span> <span data-ttu-id="3f73f-166">Dies ist erforderlich, um sicherzustellen, dass alle Token (Cookies) mit dem alten Kennwort generiert ungültig werden.</span><span class="sxs-lookup"><span data-stu-id="3f73f-166">This is needed to ensure that any tokens (cookies) generated with the old password are invalidated.</span></span> <span data-ttu-id="3f73f-167">Diese Funktion bietet eine zusätzliche Sicherheitsebene für Ihre Anwendung. Wenn Sie Ihr Kennwort ändern, werden Sie abgemeldet werden, in dem Sie sich an der Anwendung angemeldet haben.</span><span class="sxs-lookup"><span data-stu-id="3f73f-167">This feature provides an extra layer of security to your application; when you change your password, you will be logged out where you have logged into this application.</span></span>

<span data-ttu-id="3f73f-168">Die *App\_Start\IdentityConfig.cs* -Datei enthält die `ApplicationUserManager`, `EmailService` und `SmsService` Klassen.</span><span class="sxs-lookup"><span data-stu-id="3f73f-168">The *App\_Start\IdentityConfig.cs* file contains the `ApplicationUserManager`, `EmailService` and `SmsService` classes.</span></span> <span data-ttu-id="3f73f-169">Die `EmailService` und `SmsService` Klassen implementieren jeweils die `IIdentityMessageService` Schnittstelle, damit Sie häufig verwendeter Methoden in jeder Klasse zum Konfigurieren von e-Mail und SMS verfügen.</span><span class="sxs-lookup"><span data-stu-id="3f73f-169">The `EmailService` and `SmsService` classes each implement the `IIdentityMessageService` interface, so you have common methods in each class to configure email and SMS.</span></span> <span data-ttu-id="3f73f-170">Obwohl dieses Lernprogramm zeigt nur zum Hinzufügen von e-Mail-Benachrichtigung über [SendGrid](http://sendgrid.com/), können Sie e-Mail-Nachrichten mithilfe von SMTP und andere Mechanismen senden.</span><span class="sxs-lookup"><span data-stu-id="3f73f-170">Although this tutorial only shows how to add email notification through [SendGrid](http://sendgrid.com/), you can send email using SMTP and other mechanisms.</span></span>

<span data-ttu-id="3f73f-171">Die `Startup` Klasse enthält auch eine Textvorlage zum Hinzufügen von soziale Anmeldungen (Facebook, Twitter, usw.), finden Sie unter meinem Lernprogramm [MVC 5-Anwendung mit Facebook, Twitter, LinkedIn und Google OAuth2 anmelden](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md) für Weitere Informationen.</span><span class="sxs-lookup"><span data-stu-id="3f73f-171">The `Startup` class also contains boiler plate to add social logins (Facebook, Twitter, etc.), see my tutorial [MVC 5 App with Facebook, Twitter, LinkedIn and Google OAuth2 Sign-on](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md) for more info.</span></span>

<span data-ttu-id="3f73f-172">Überprüfen Sie die `ApplicationUserManager` Klasse, die die Identitätsinformationen für den Benutzer enthält, und konfiguriert die folgenden Funktionen:</span><span class="sxs-lookup"><span data-stu-id="3f73f-172">Examine the `ApplicationUserManager` class, which contains the users identity information and configures the following features:</span></span>

- <span data-ttu-id="3f73f-173">Für das Domänenkennwort Stärke.</span><span class="sxs-lookup"><span data-stu-id="3f73f-173">Password strength requirements.</span></span>
- <span data-ttu-id="3f73f-174">Benutzer-gesperrt war (Versuche und Uhrzeit).</span><span class="sxs-lookup"><span data-stu-id="3f73f-174">User lock out (attempts and time).</span></span>
- <span data-ttu-id="3f73f-175">Zweistufige Authentifizierung (2FA).</span><span class="sxs-lookup"><span data-stu-id="3f73f-175">Two-factor authentication (2FA).</span></span> <span data-ttu-id="3f73f-176">Ich werde 2FA und SMS in ein weiteres Lernprogramm behandelt.</span><span class="sxs-lookup"><span data-stu-id="3f73f-176">I'll cover 2FA and SMS in another tutorial.</span></span>
- <span data-ttu-id="3f73f-177">Einbinden von e-Mails und SMS-Dienste.</span><span class="sxs-lookup"><span data-stu-id="3f73f-177">Hooking up the email and SMS services.</span></span> <span data-ttu-id="3f73f-178">(Ich werde SMS in ein weiteres Lernprogramm behandelt).</span><span class="sxs-lookup"><span data-stu-id="3f73f-178">(I'll cover SMS in another tutorial).</span></span>

<span data-ttu-id="3f73f-179">Die `ApplicationUserManager` Klasse abgeleitet wird, von der generischen `UserManager<ApplicationUser>` Klasse.</span><span class="sxs-lookup"><span data-stu-id="3f73f-179">The `ApplicationUserManager` class derives from the generic `UserManager<ApplicationUser>` class.</span></span> <span data-ttu-id="3f73f-180">`ApplicationUser` leitet sich von [IdentityUser](https://msdn.microsoft.com/library/microsoft.aspnet.identity.entityframework.identityuser.aspx).</span><span class="sxs-lookup"><span data-stu-id="3f73f-180">`ApplicationUser` derives from [IdentityUser](https://msdn.microsoft.com/library/microsoft.aspnet.identity.entityframework.identityuser.aspx).</span></span> <span data-ttu-id="3f73f-181">`IdentityUser` leitet sich von der generischen `IdentityUser` Klasse:</span><span class="sxs-lookup"><span data-stu-id="3f73f-181">`IdentityUser` derives from the generic `IdentityUser` class:</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample1.cs)]

<span data-ttu-id="3f73f-182">Die oben genannten Eigenschaften zur berichtsausführung die Verarbeitung mit den Eigenschaften in der `AspNetUsers` obigen Tabelle.</span><span class="sxs-lookup"><span data-stu-id="3f73f-182">The properties above coincide with the properties in the `AspNetUsers` table, shown above.</span></span>

<span data-ttu-id="3f73f-183">Generische Argumente auf `IUser` ermöglichen es Ihnen, eine Klasse, die Verwendung verschiedener Typen für den Primärschlüssel abgeleitet werden.</span><span class="sxs-lookup"><span data-stu-id="3f73f-183">Generic arguments on `IUser` enable you to derive a class using different types for the primary key.</span></span> <span data-ttu-id="3f73f-184">Finden Sie unter der [ChangePK](https://aspnet.codeplex.com/SourceControl/latest#Samples/Identity/ChangePK/readme.txt) Beispiel, in dem veranschaulicht, wie den Primärschlüssel von String in Int "oder" GUID zu ändern.</span><span class="sxs-lookup"><span data-stu-id="3f73f-184">See the [ChangePK](https://aspnet.codeplex.com/SourceControl/latest#Samples/Identity/ChangePK/readme.txt) sample which shows how to change the primary key from string to int or GUID.</span></span>

### <a name="applicationuser"></a><span data-ttu-id="3f73f-185">ApplicationUser</span><span class="sxs-lookup"><span data-stu-id="3f73f-185">ApplicationUser</span></span>

<span data-ttu-id="3f73f-186">`ApplicationUser` (`public class ApplicationUserManager : UserManager<ApplicationUser>`) ist definiert *Models\IdentityModels.cs* als:</span><span class="sxs-lookup"><span data-stu-id="3f73f-186">`ApplicationUser` (`public class ApplicationUserManager : UserManager<ApplicationUser>`) is defined in *Models\IdentityModels.cs* as:</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample2.cs?highlight=8-9)]

<span data-ttu-id="3f73f-187">Der hervorgehobene Code oben generiert eine ["ClaimsIdentity"](https://msdn.microsoft.com/library/system.security.claims.claimsidentity.aspx).</span><span class="sxs-lookup"><span data-stu-id="3f73f-187">The highlighted code above generates a [ClaimsIdentity](https://msdn.microsoft.com/library/system.security.claims.claimsidentity.aspx).</span></span> <span data-ttu-id="3f73f-188">ASP.NET Identity und OWIN Cookieauthentifizierung sind anspruchsbasierte, daher das Framework benötigt die app zum Generieren einer `ClaimsIdentity` für den Benutzer.</span><span class="sxs-lookup"><span data-stu-id="3f73f-188">ASP.NET Identity and OWIN Cookie Authentication are claims-based, therefore the framework requires the app to generate a `ClaimsIdentity` for the user.</span></span> <span data-ttu-id="3f73f-189">`ClaimsIdentity` enthält Informationen über alle Ansprüche für den Benutzer, z. B. den Namen des Benutzers, Alter und welche Rollen der Benutzer angehört.</span><span class="sxs-lookup"><span data-stu-id="3f73f-189">`ClaimsIdentity` has information about all the claims for the user, such as the user's name, age and what roles the user belongs to.</span></span> <span data-ttu-id="3f73f-190">Sie können auch weitere Ansprüche für den Benutzer zu diesem Zeitpunkt hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="3f73f-190">You can also add more claims for the user at this stage.</span></span>

<span data-ttu-id="3f73f-191">Die OWIN `AuthenticationManager.SignIn` Methode übergibt der `ClaimsIdentity` und meldet sich der Benutzer:</span><span class="sxs-lookup"><span data-stu-id="3f73f-191">The OWIN `AuthenticationManager.SignIn` method passes in the `ClaimsIdentity` and signs in the user:</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample3.cs?highlight=4-6)]

<span data-ttu-id="3f73f-192">[MVC 5-Anwendung mit Facebook, Twitter, LinkedIn und Google OAuth2 anmelden](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md) zeigt, wie Sie zusätzliche Eigenschaften hinzufügen können die `ApplicationUser` Klasse.</span><span class="sxs-lookup"><span data-stu-id="3f73f-192">[MVC 5 App with Facebook, Twitter, LinkedIn and Google OAuth2 Sign-on](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md) shows how you can add additional properties to the `ApplicationUser` class.</span></span>

## <a name="email-confirmation"></a><span data-ttu-id="3f73f-193">E-Mail-Bestätigung</span><span class="sxs-lookup"><span data-stu-id="3f73f-193">Email confirmation</span></span>

<span data-ttu-id="3f73f-194">Es ist eine gute Idee, bestätigen die e-Mail-Adresse, ein neuer Benutzer mit registrieren, um zu überprüfen, sind sie nicht eine andere Person Identitätswechsel (d. h., sie noch nicht registriert mit einer anderen Person e-Mail-Adresse).</span><span class="sxs-lookup"><span data-stu-id="3f73f-194">It's a good idea to confirm the email a new user register with to verify they are not impersonating someone else (that is, they haven't registered with someone else's email).</span></span> <span data-ttu-id="3f73f-195">Angenommen, Sie ein Diskussionsforum hatten, Sie möchten verhindern `"bob@example.com"` aus der Registrierung als `"joe@contoso.com"`.</span><span class="sxs-lookup"><span data-stu-id="3f73f-195">Suppose you had a discussion forum, you would want to prevent `"bob@example.com"` from registering as `"joe@contoso.com"`.</span></span> <span data-ttu-id="3f73f-196">Ohne e-Mail-Bestätigung `"joe@contoso.com"` konnten unerwünschte e-Mails von Ihrer app abgerufen werden.</span><span class="sxs-lookup"><span data-stu-id="3f73f-196">Without email confirmation, `"joe@contoso.com"` could get unwanted email from your app.</span></span> <span data-ttu-id="3f73f-197">Angenommen, Bob versehentlich als registriert `"bib@example.com"` und hadn't bemerkt, er wäre Kennwort wiederherstellen zu verwenden, da die app hat seine richtige e-Mail-Nachricht nicht.</span><span class="sxs-lookup"><span data-stu-id="3f73f-197">Suppose Bob accidently registered as `"bib@example.com"` and hadn't noticed it, he wouldn't be able to use password recover because the app doesn't have his correct email.</span></span> <span data-ttu-id="3f73f-198">E-Mail-Bestätigung enthält nur begrenzt Schutz von Bots und stellt keinen Schutz vor bestimmt Spammern, sie haben viele arbeiten e-Mail-Aliase, die sie verwenden können, um zu registrieren. Im folgenden Beispiel wird der Benutzer kann nicht für das Ändern seines Kennworts, bis ihr Konto bestätigt wurde (indem sie durch Klicken auf einen Link zur Bestätigung auf das e-Mail-Konto diese registriert empfangen.) Sie können dieser Ablauf auf andere Szenarien anwenden, z. B. senden einen Link, um zu bestätigen und Zurücksetzen des Kennworts auf neue Konten erstellt, durch den Administrator, die dem Benutzer eine e-Mail senden, wenn sie ihr Profil und so weiter geändert wurden.</span><span class="sxs-lookup"><span data-stu-id="3f73f-198">Email confirmation provides only limited protection from bots and doesn't provide protection from determined spammers, they have many working email aliases they can use to register.In the sample below, the user won't be able to change their password until their account has been confirmed (by them clicking on a confirmation link received on the email account they registered with.) You can apply this work flow to other scenarios, for example sending a link to confirm and reset the password on new accounts created by the administrator, sending the user an email when they have changed their profile and so on.</span></span> <span data-ttu-id="3f73f-199">In der Regel möchten verhindern, dass neue Benutzer keine Daten zu Ihrer Website bereitstellen, bevor sie per e-Mail, eine SMS oder einen anderen Mechanismus bestätigt wurden.</span><span class="sxs-lookup"><span data-stu-id="3f73f-199">You generally want to prevent new users from posting any data to your web site before they have been confirmed by email, a SMS text message or another mechanism.</span></span> <a id="build"></a>

## <a name="building-a-more-complete-sample"></a><span data-ttu-id="3f73f-200">Erstellen ein vollständiges Beispiel</span><span class="sxs-lookup"><span data-stu-id="3f73f-200">Building a more complete sample</span></span>

<span data-ttu-id="3f73f-201">In diesem Abschnitt verwenden Sie NuGet Ein ausführlicheres Beispiel herunterzuladen, dem wir mit verwendet werden kann.</span><span class="sxs-lookup"><span data-stu-id="3f73f-201">In this section, you'll use NuGet to download a more complete sample we will work with.</span></span>

1. <span data-ttu-id="3f73f-202">Erstellen Sie ein neues ***leere*** ASP.NET-Webprojekt.</span><span class="sxs-lookup"><span data-stu-id="3f73f-202">Create a new ***empty*** ASP.NET Web project.</span></span>
2. <span data-ttu-id="3f73f-203">Geben Sie den folgenden, in der Paket-Manager-Konsole die folgenden Befehle:</span><span class="sxs-lookup"><span data-stu-id="3f73f-203">In the Package Manager Console, enter the following the following commands:</span></span> 

    [!code-console[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample4.cmd)]

   <span data-ttu-id="3f73f-204">In diesem Lernprogramm verwenden wir [SendGrid](http://sendgrid.com/) zum Senden von e-Mail.</span><span class="sxs-lookup"><span data-stu-id="3f73f-204">In this tutorial, we'll use [SendGrid](http://sendgrid.com/) to send email.</span></span> <span data-ttu-id="3f73f-205">Die `Identity.Samples` Paket wird installiert, den wir arbeiten mit Code.</span><span class="sxs-lookup"><span data-stu-id="3f73f-205">The `Identity.Samples` package installs the code we will be working with.</span></span>
3. <span data-ttu-id="3f73f-206">Legen Sie die [Projekt zur Verwendung von SSL](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md).</span><span class="sxs-lookup"><span data-stu-id="3f73f-206">Set the [project to use SSL](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md).</span></span>
4. <span data-ttu-id="3f73f-207">Testen Sie lokales Konto erstellen, durch Ausführen der app, die durch Klicken auf die **registrieren** verknüpfen, und veröffentlichen Sie das Registrierungsformular.</span><span class="sxs-lookup"><span data-stu-id="3f73f-207">Test local account creation by running the app, clicking on the **Register** link, and posting the registration form.</span></span>
5. <span data-ttu-id="3f73f-208">Klicken Sie auf die Demo-e-Mail, die e-Mail-Bestätigung simuliert.</span><span class="sxs-lookup"><span data-stu-id="3f73f-208">Click the demo email link, which simulates email confirmation.</span></span>
6. <span data-ttu-id="3f73f-209">Entfernen Sie die e-Mail-Link zur Bestätigung Democode aus dem Beispiel (die `ViewBag.Link` Code in die Konto-Controller.</span><span class="sxs-lookup"><span data-stu-id="3f73f-209">Remove the demo email link confirmation code from the sample (The `ViewBag.Link` code in the account controller.</span></span> <span data-ttu-id="3f73f-210">Finden Sie unter der `DisplayEmail` und `ForgotPasswordConfirmation` Aktionsmethoden und Razor-Ansichten).</span><span class="sxs-lookup"><span data-stu-id="3f73f-210">See the `DisplayEmail` and `ForgotPasswordConfirmation` action methods and razor views ).</span></span>

> [!NOTE]
> <span data-ttu-id="3f73f-211">Warnung: Wenn Sie die Sicherheitseinstellungen in diesem Beispiel ändern, Produktionen apps müssen einer sicherheitsüberprüfung unterzogen werden, die die vorgenommenen Änderungen explizit aufruft.</span><span class="sxs-lookup"><span data-stu-id="3f73f-211">Warning: If you change any of the security settings in this sample, productions apps will need to undergo a security audit that explicitly calls the changes made.</span></span>


## <a name="examine-the-code-in-appstartidentityconfigcs"></a><span data-ttu-id="3f73f-212">Überprüfen Sie den Code in der App\_Start\IdentityConfig.cs</span><span class="sxs-lookup"><span data-stu-id="3f73f-212">Examine the code in App\_Start\IdentityConfig.cs</span></span>

<span data-ttu-id="3f73f-213">Im Beispiel wird gezeigt, wie zum Erstellen eines Kontos ein, und fügen Sie diese der *Admin* Rolle.</span><span class="sxs-lookup"><span data-stu-id="3f73f-213">The sample shows how to create an account and add it to the *Admin* role.</span></span> <span data-ttu-id="3f73f-214">Ersetzen Sie die e-Mail im Beispiel durch die e-Mail-Adresse, die Verwendung für das Administratorkonto ein.</span><span class="sxs-lookup"><span data-stu-id="3f73f-214">You should replace the email in the sample with the email you will be using for the admin account.</span></span> <span data-ttu-id="3f73f-215">Die einfachste Möglichkeit jetzt, erstellen Sie ein Administratorkonto wird programmgesteuert in die `Seed` Methode.</span><span class="sxs-lookup"><span data-stu-id="3f73f-215">The easiest way right now to create an administrator account is programmatically in the `Seed` method.</span></span> <span data-ttu-id="3f73f-216">Wir hoffen, ein Tool in der Zukunft haben, mit denen Sie zum Erstellen und Verwalten von Benutzern und Rollen.</span><span class="sxs-lookup"><span data-stu-id="3f73f-216">We hope to have a tool in the future that will allow you to create and administer users and roles.</span></span> <span data-ttu-id="3f73f-217">Der Beispielcode ist möglich, Sie erstellen und Verwalten von Benutzern und Rollen, jedoch benötigen Sie zuerst ein Administratorkonto zum Ausführen von Rollen und Benutzer-Admin-Seiten.</span><span class="sxs-lookup"><span data-stu-id="3f73f-217">The sample code does let you create and manage users and roles, but you must first have an administrators account to run the roles and user admin pages.</span></span> <span data-ttu-id="3f73f-218">In diesem Beispiel wird das Administratorkonto ein erstellt, wenn die Datenbank mit Anfangsdaten gefüllt ist.</span><span class="sxs-lookup"><span data-stu-id="3f73f-218">In this sample, the admin account is created when the DB is seeded.</span></span>

<span data-ttu-id="3f73f-219">Ändern Sie das Kennwort ein, und ändern Sie den Namen in einem Konto an, in denen Sie e-Mail-Benachrichtigungen empfangen kann.</span><span class="sxs-lookup"><span data-stu-id="3f73f-219">Change the password and change the name to an account where you can receive email notifications.</span></span>

> [!WARNING]
> <span data-ttu-id="3f73f-220">Sicherheit – sensible Daten nie im Quellcode speichern.</span><span class="sxs-lookup"><span data-stu-id="3f73f-220">Security - Never store sensitive data in your source code.</span></span>

<span data-ttu-id="3f73f-221">Wie bereits erwähnt, die `app.CreatePerOwinContext` Aufruf in die Startklasse fügt Rückrufe, die `Create` Methode der app DB Inhalten, Benutzer-Manager und die Rolle Manager Klassen.</span><span class="sxs-lookup"><span data-stu-id="3f73f-221">As mentioned previously, the `app.CreatePerOwinContext` call in the startup class adds callbacks to the `Create` method of the app DB content, user manager and role manger classes.</span></span> <span data-ttu-id="3f73f-222">Die OWIN-pipeline Aufrufe der `Create` Methode für diese Klassen für jede Anforderung und speichert den Kontext für jede Klasse.</span><span class="sxs-lookup"><span data-stu-id="3f73f-222">The OWIN pipeline calls the `Create` method on these classes for each request and stores the context for each class.</span></span> <span data-ttu-id="3f73f-223">Die Konto-Controller verfügbar macht, die Benutzer-Manager aus dem HTTP-Kontext (enthält die OWIN-Kontext):</span><span class="sxs-lookup"><span data-stu-id="3f73f-223">The account controller exposes the user manager from the HTTP context (which contains the OWIN context):</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample5.cs)]

<span data-ttu-id="3f73f-224">Wenn ein Benutzer ein lokales Konto registriert die `HTTP Post Register` -Methode aufgerufen wird:</span><span class="sxs-lookup"><span data-stu-id="3f73f-224">When a user registers a local account, the `HTTP Post Register` method is called:</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample6.cs)]

<span data-ttu-id="3f73f-225">Der obige Code verwendet die Modelldaten zum Erstellen eines neuen Benutzerkontos mit der e-Mail- und das Kennwort eingegeben.</span><span class="sxs-lookup"><span data-stu-id="3f73f-225">The code above uses the model data to create a new user account using the email and password entered.</span></span> <span data-ttu-id="3f73f-226">Wenn der e-Mail-Alias im Datenspeicher, kontoerstellung fehlschlägt, und das Formular wird erneut angezeigt.</span><span class="sxs-lookup"><span data-stu-id="3f73f-226">If the email alias is in the data store, account creation fails and the form is displayed again.</span></span> <span data-ttu-id="3f73f-227">Die `GenerateEmailConfirmationTokenAsync` Methode erstellt einen sicheren bestätigungstoken und speichert sie in den ASP.NET Identity-Datenspeicher.</span><span class="sxs-lookup"><span data-stu-id="3f73f-227">The `GenerateEmailConfirmationTokenAsync` method creates a secure confirmation token and stores it in the ASP.NET Identity data store.</span></span> <span data-ttu-id="3f73f-228">Die [Url.Action](https://msdn.microsoft.com/library/dd505232(v=vs.118).aspx) Methode erstellt eine Verknüpfung mit der `UserId` und bestätigungstoken.</span><span class="sxs-lookup"><span data-stu-id="3f73f-228">The [Url.Action](https://msdn.microsoft.com/library/dd505232(v=vs.118).aspx) method creates a link containing the `UserId` and confirmation token.</span></span> <span data-ttu-id="3f73f-229">Dieser Link wird dann an den Benutzer per e-Mail, die der Benutzer kann dann auf den Link in der e-Mail-Anwendung auf das Konto zu bestätigen.</span><span class="sxs-lookup"><span data-stu-id="3f73f-229">This link is then emailed to the user, the user can click on the link in their email app to confirm their account.</span></span>

<a id="email"></a>

## <a name="set-up-email-confirmation"></a><span data-ttu-id="3f73f-230">Richten Sie e-Mail-Bestätigung</span><span class="sxs-lookup"><span data-stu-id="3f73f-230">Set up email confirmation</span></span>

<span data-ttu-id="3f73f-231">Wechseln Sie zu der [Azure SendGrid-Anmeldeseite](https://azure.microsoft.com/gallery/store/sendgrid/sendgrid-azure/) und für den free-Konto registrieren.</span><span class="sxs-lookup"><span data-stu-id="3f73f-231">Go to the [Azure SendGrid sign up page](https://azure.microsoft.com/gallery/store/sendgrid/sendgrid-azure/) and register for free account.</span></span> <span data-ttu-id="3f73f-232">Fügen Sie Code ähnlich dem folgenden SendGrid konfigurieren:</span><span class="sxs-lookup"><span data-stu-id="3f73f-232">Add code similar to the following to configure SendGrid:</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample7.cs?highlight=5)]

> [!NOTE]
> <span data-ttu-id="3f73f-233">E-Mail-Clients akzeptieren häufig nur Textnachrichten (HTML).</span><span class="sxs-lookup"><span data-stu-id="3f73f-233">Email clients frequently accept only text messages (no HTML).</span></span> <span data-ttu-id="3f73f-234">Geben Sie die Nachricht im Text und HTML.</span><span class="sxs-lookup"><span data-stu-id="3f73f-234">You should provide the message in text and HTML.</span></span> <span data-ttu-id="3f73f-235">Im obigen SendGrid-Beispiel ist dies mit der `myMessage.Text` und `myMessage.Html` oben gezeigten Code.</span><span class="sxs-lookup"><span data-stu-id="3f73f-235">In the SendGrid sample above, this is done with the `myMessage.Text` and `myMessage.Html` code shown above.</span></span>


<span data-ttu-id="3f73f-236">Der folgende Code zeigt, wie zum Senden von e-Mail mithilfe der [MailMessage](https://msdn.microsoft.com/library/system.net.mail.mailmessage.aspx) -Klasse Where `message.Body` gibt nur die Verbindung.</span><span class="sxs-lookup"><span data-stu-id="3f73f-236">The following code shows how to send email using the [MailMessage](https://msdn.microsoft.com/library/system.net.mail.mailmessage.aspx) class where `message.Body` returns only the link.</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample8.cs)]

> [!WARNING]
> <span data-ttu-id="3f73f-237">Sicherheit – sensible Daten nie im Quellcode speichern.</span><span class="sxs-lookup"><span data-stu-id="3f73f-237">Security - Never store sensitive data in your source code.</span></span> <span data-ttu-id="3f73f-238">Das Konto und die Anmeldeinformationen werden in der AppSetting gespeichert.</span><span class="sxs-lookup"><span data-stu-id="3f73f-238">The account and credentials are stored in the appSetting.</span></span> <span data-ttu-id="3f73f-239">Sie können auf Azure sicher diese Werte speichern, auf die **[konfigurieren](https://blogs.msdn.com/b/webdev/archive/2014/06/04/queuebackgroundworkitem-to-reliably-schedule-and-run-long-background-process-in-asp-net.aspx)** Registerkarte im Azure-Portal.</span><span class="sxs-lookup"><span data-stu-id="3f73f-239">On Azure, you can securely store these values on the **[Configure](https://blogs.msdn.com/b/webdev/archive/2014/06/04/queuebackgroundworkitem-to-reliably-schedule-and-run-long-background-process-in-asp-net.aspx)** tab in the Azure portal.</span></span> <span data-ttu-id="3f73f-240">Finden Sie unter [bewährte Methoden für die Bereitstellung von Kennwörtern und andere sensible Daten für ASP.NET und Azure](best-practices-for-deploying-passwords-and-other-sensitive-data-to-aspnet-and-azure.md).</span><span class="sxs-lookup"><span data-stu-id="3f73f-240">See [Best practices for deploying passwords and other sensitive data to ASP.NET and Azure](best-practices-for-deploying-passwords-and-other-sensitive-data-to-aspnet-and-azure.md).</span></span>


<span data-ttu-id="3f73f-241">Geben Sie Ihre SendGrid-Anmeldeinformationen, führen Sie die app, beim e-Mail-Alias registriert wird, kann Klicken Sie auf den Link "bestätigen" in Ihre e-Mail-Adresse.</span><span class="sxs-lookup"><span data-stu-id="3f73f-241">Enter your SendGrid credentials, run the app, register with an email alias can click the confirm link in your email.</span></span> <span data-ttu-id="3f73f-242">Sehen Sie hierzu mit der [Outlook.com](http://outlook.com) e-Mail-Konto, finden Sie unter der John Atten [C#-SMTP-Konfiguration für Outlook.Com SMTP-Host](http://typecastexception.com/post/2013/12/20/C-SMTP-Configuration-for-OutlookCom-SMTP-Host.aspx) und seine[ASP.NET Identity 2.0: Festlegen der Kontovalidierung und einer zweistufigen Autorisierung](http://typecastexception.com/post/2014/04/20/ASPNET-Identity-20-Setting-Up-Account-Validation-and-Two-Factor-Authorization.aspx) sendet.</span><span class="sxs-lookup"><span data-stu-id="3f73f-242">To see how to do this with your [Outlook.com](http://outlook.com) email account, see John Atten's [C# SMTP Configuration for Outlook.Com SMTP Host](http://typecastexception.com/post/2013/12/20/C-SMTP-Configuration-for-OutlookCom-SMTP-Host.aspx) and his[ASP.NET Identity 2.0: Setting Up Account Validation and Two-Factor Authorization](http://typecastexception.com/post/2014/04/20/ASPNET-Identity-20-Setting-Up-Account-Validation-and-Two-Factor-Authorization.aspx) posts.</span></span>

<span data-ttu-id="3f73f-243">Sobald ein Benutzer klickt auf die **registrieren** Schaltfläche wird eine e-Mail zur kaufbestätigung, enthält eine Überprüfungstoken an ihre e-Mail-Adresse gesendet.</span><span class="sxs-lookup"><span data-stu-id="3f73f-243">Once a user clicks the **Register** button a confirmation email containing a validation token is sent to their email address.</span></span>

![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image12.png)

<span data-ttu-id="3f73f-244">Der Benutzer wird eine e-Mail mit einem bestätigungstoken für ihr Konto gesendet werden.</span><span class="sxs-lookup"><span data-stu-id="3f73f-244">The user is sent an email with a confirmation token for their account.</span></span>

![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image13.png)

## <a name="examine-the-code"></a><span data-ttu-id="3f73f-245">Überprüfen Sie den code</span><span class="sxs-lookup"><span data-stu-id="3f73f-245">Examine the code</span></span>

<span data-ttu-id="3f73f-246">Der folgende Code veranschaulicht die `POST ForgotPassword`-Methode.</span><span class="sxs-lookup"><span data-stu-id="3f73f-246">The following code shows the `POST ForgotPassword` method.</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample9.cs)]

<span data-ttu-id="3f73f-247">Die Methode fehlschlägt im Hintergrund auf, wenn die e-Mail-Adresse des Benutzers nicht bestätigt wurde.</span><span class="sxs-lookup"><span data-stu-id="3f73f-247">The method fails silently if the user email has not been confirmed.</span></span> <span data-ttu-id="3f73f-248">Wenn ein Fehler für eine ungültige e-Mail-Adresse angezeigt wurde, konnte böswillige Benutzer diese Informationen verwenden, gültige Benutzer-ID (e-Mail-Alias) für Angriffe gefunden.</span><span class="sxs-lookup"><span data-stu-id="3f73f-248">If an error was posted for an invalid email address, malicious users could use that information to find valid userId (email aliases) to attack.</span></span>

<span data-ttu-id="3f73f-249">Der folgende code zeigt die `ConfirmEmail` Methode in den Kontocontroller, die aufgerufen wird, klickt der Benutzer den Bestätigungslink in der e-Mail an Sie gesendet:</span><span class="sxs-lookup"><span data-stu-id="3f73f-249">The following code shows the `ConfirmEmail` method in the account controller that is called when the user clicks the confirmation link in the email sent to them:</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample10.cs)]

<span data-ttu-id="3f73f-250">Sobald ein vergessenes Kennwort-Token verwendet wurde, wird er ungültig.</span><span class="sxs-lookup"><span data-stu-id="3f73f-250">Once a forgotten password token has been used, it's invalidated.</span></span> <span data-ttu-id="3f73f-251">Die folgende Änderung des Codes in der `Create` -Methode (in der *App\_Start\IdentityConfig.cs* Datei) legt die Token läuft in drei Stunden ab.</span><span class="sxs-lookup"><span data-stu-id="3f73f-251">The following code change in the `Create` method (in the *App\_Start\IdentityConfig.cs* file) sets the tokens to expire in 3 hours.</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample11.cs?highlight=6-8)]

<span data-ttu-id="3f73f-252">Mit dem obigen Code läuft das Kennwort vergessen haben und die e-Mail-bestätigungstoken in 3 Stunden.</span><span class="sxs-lookup"><span data-stu-id="3f73f-252">With the code above, the forgotten password and the email confirmation tokens will expire in 3 hours.</span></span> <span data-ttu-id="3f73f-253">Die Standardeinstellung `TokenLifespan` ist ein Tag.</span><span class="sxs-lookup"><span data-stu-id="3f73f-253">The default `TokenLifespan` is one day.</span></span>

<span data-ttu-id="3f73f-254">Der folgende Code zeigt die e-Mail-Bestätigung-Methode:</span><span class="sxs-lookup"><span data-stu-id="3f73f-254">The following code shows the email confirmation method:</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample12.cs)]

 <span data-ttu-id="3f73f-255">Um Ihre app sicherer machen, unterstützt die ASP.NET Identity zweistufige Authentifizierung (2FA).</span><span class="sxs-lookup"><span data-stu-id="3f73f-255">To make your app more secure, ASP.NET Identity supports Two-Factor authentication (2FA).</span></span> <span data-ttu-id="3f73f-256">Finden Sie unter [ASP.NET-Identität 2.0: Einrichten der Überprüfung des Kontos und zweistufige Autorisierung](http://typecastexception.com/post/2014/04/20/ASPNET-Identity-20-Setting-Up-Account-Validation-and-Two-Factor-Authorization.aspx) von John Atten.</span><span class="sxs-lookup"><span data-stu-id="3f73f-256">See [ASP.NET Identity 2.0: Setting Up Account Validation and Two-Factor Authorization](http://typecastexception.com/post/2014/04/20/ASPNET-Identity-20-Setting-Up-Account-Validation-and-Two-Factor-Authorization.aspx) by John Atten.</span></span> <span data-ttu-id="3f73f-257">Obwohl Sie die kontosperrung auf Anmeldung Versuch Kennwortfehler festlegen können, wird dieser Ansatz Ihrer Anmeldename anfällig für [DOS](http://en.wikipedia.org/wiki/Denial-of-service_attack) sperren.</span><span class="sxs-lookup"><span data-stu-id="3f73f-257">Although you can set account lockout on login password attempt failures, that approach makes your login susceptible to [DOS](http://en.wikipedia.org/wiki/Denial-of-service_attack) lockouts.</span></span> <span data-ttu-id="3f73f-258">Es wird empfohlen, dass Sie nur mit 2FA kontosperrung verwenden.</span><span class="sxs-lookup"><span data-stu-id="3f73f-258">We recommend you use account lockout only with 2FA.</span></span>  
<a id="addRes"></a>

## <a name="additional-resources"></a><span data-ttu-id="3f73f-259">Zusätzliche Ressourcen</span><span class="sxs-lookup"><span data-stu-id="3f73f-259">Additional Resources</span></span>

- [<span data-ttu-id="3f73f-260">Übersicht über benutzerdefinierte Speicheranbieter für ASP.NET Identity</span><span class="sxs-lookup"><span data-stu-id="3f73f-260">Overview of Custom Storage Providers for ASP.NET Identity</span></span>](../extensibility/overview-of-custom-storage-providers-for-aspnet-identity.md)
- <span data-ttu-id="3f73f-261">[MVC 5-Anwendung mit Facebook, Twitter, LinkedIn und Google OAuth2 anmelden](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md) zeigt außerdem das Hinzufügen von Profilinformationen zur Users-Tabelle.</span><span class="sxs-lookup"><span data-stu-id="3f73f-261">[MVC 5 App with Facebook, Twitter, LinkedIn and Google OAuth2 Sign-on](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md) also shows how to add profile information to the users table.</span></span>
- <span data-ttu-id="3f73f-262">[ASP.NET MVC und Identität 2.0: Kenntnisse der Grundlagen](http://typecastexception.com/post/2014/04/20/ASPNET-MVC-and-Identity-20-Understanding-the-Basics.aspx) von John Atten.</span><span class="sxs-lookup"><span data-stu-id="3f73f-262">[ASP.NET MVC and Identity 2.0: Understanding the Basics](http://typecastexception.com/post/2014/04/20/ASPNET-MVC-and-Identity-20-Understanding-the-Basics.aspx) by John Atten.</span></span>
- [<span data-ttu-id="3f73f-263">Einführung zu ASP.NET Identity</span><span class="sxs-lookup"><span data-stu-id="3f73f-263">Introduction to ASP.NET Identity</span></span>](../getting-started/introduction-to-aspnet-identity.md)
- <span data-ttu-id="3f73f-264">[Ankündigung der RTM-Version von ASP.NET Identity 2.0.0](https://blogs.msdn.com/b/webdev/archive/2014/03/20/test-announcing-rtm-of-asp-net-identity-2-0-0.aspx) von Pranav Rastogi.</span><span class="sxs-lookup"><span data-stu-id="3f73f-264">[Announcing RTM of ASP.NET Identity 2.0.0](https://blogs.msdn.com/b/webdev/archive/2014/03/20/test-announcing-rtm-of-asp-net-identity-2-0-0.aspx) by Pranav Rastogi.</span></span>
