---
uid: web-forms/overview/data-access/accessing-the-database-directly-from-an-aspnet-page/implementing-optimistic-concurrency-with-the-sqldatasource-vb
title: Implementieren der vollständigen Parallelität mit SqlDataSource-(VB) | Microsoft Docs
author: rick-anderson
description: In diesem Lernprogramm werden die Grundlagen der Steuerung durch vollständige Parallelität überprüfen und sehen Sie sich dann wie sie mithilfe der SqlDataSource-Steuerelement implementiert.
ms.author: aspnetcontent
manager: wpickett
ms.date: 02/20/2007
ms.topic: article
ms.assetid: a8fa72ee-8328-4854-a419-c1b271772303
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/data-access/accessing-the-database-directly-from-an-aspnet-page/implementing-optimistic-concurrency-with-the-sqldatasource-vb
msc.type: authoredcontent
ms.openlocfilehash: 6e7e81b3f3a54596c033caa2cf75e5e3ec01764c
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 04/06/2018
ms.locfileid: "30877550"
---
<a name="implementing-optimistic-concurrency-with-the-sqldatasource-vb"></a><span data-ttu-id="a72b9-103">Implementieren der vollständigen Parallelität mit SqlDataSource-(VB)</span><span class="sxs-lookup"><span data-stu-id="a72b9-103">Implementing Optimistic Concurrency with the SqlDataSource (VB)</span></span>
====================
<span data-ttu-id="a72b9-104">durch [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="a72b9-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="a72b9-105">[Beispiel-App herunterladen](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_50_VB.exe) oder [PDF herunterladen](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/datatutorial50vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="a72b9-105">[Download Sample App](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_50_VB.exe) or [Download PDF](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/datatutorial50vb1.pdf)</span></span>

> <span data-ttu-id="a72b9-106">In diesem Lernprogramm werden die Grundlagen der Steuerung durch vollständige Parallelität überprüfen und sehen Sie sich dann wie sie mithilfe der SqlDataSource-Steuerelement implementiert.</span><span class="sxs-lookup"><span data-stu-id="a72b9-106">In this tutorial we review the essentials of optimistic concurrency control and then explore how to implement it using the SqlDataSource control.</span></span>


## <a name="introduction"></a><span data-ttu-id="a72b9-107">Einführung</span><span class="sxs-lookup"><span data-stu-id="a72b9-107">Introduction</span></span>

<span data-ttu-id="a72b9-108">In dem vorherigen Lernprogramm untersucht wir zum Einfügen, aktualisieren und Löschen von Funktionen, um die SqlDataSource-Steuerelement hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="a72b9-108">In the preceding tutorial we examined how to add inserting, updating, and deleting capabilities to the SqlDataSource control.</span></span> <span data-ttu-id="a72b9-109">Kurz gesagt, die diese Features bieten wir zum erforderlich sind. Geben Sie den entsprechenden `INSERT`, `UPDATE`, oder `DELETE` SQL-Anweisung im Steuerelement s `InsertCommand`, `UpdateCommand`, oder `DeleteCommand` Eigenschaften werden zusammen mit den entsprechenden Parameter in der `InsertParameters`, `UpdateParameters`, und `DeleteParameters` Sammlungen.</span><span class="sxs-lookup"><span data-stu-id="a72b9-109">In short, to provide these features we needed to specify the corresponding `INSERT`, `UPDATE`, or `DELETE` SQL statement in the control s `InsertCommand`, `UpdateCommand`, or `DeleteCommand` properties, along with the appropriate parameters in the `InsertParameters`, `UpdateParameters`, and `DeleteParameters` collections.</span></span> <span data-ttu-id="a72b9-110">Während diese Eigenschaften und Auflistungen manuell angegeben werden können, bietet das Konfigurieren von Datenquellen-Assistenten s Schaltfläche "Erweitert" eine generieren `INSERT`, `UPDATE`, und `DELETE` Anweisungen Kontrollkästchen, das automatisch-erstellen von diesen Anweisungen wird basierend auf der `SELECT` Anweisung.</span><span class="sxs-lookup"><span data-stu-id="a72b9-110">While these properties and collections can be specified manually, the Configure Data Source wizard s Advanced button offers a Generate `INSERT`, `UPDATE`, and `DELETE` statements checkbox that will auto-create these statements based on the `SELECT` statement.</span></span>

<span data-ttu-id="a72b9-111">Zusammen mit der Generierung `INSERT`, `UPDATE`, und `DELETE` Anweisungen Kontrollkästchen, das Dialogfeld Erweiterte SQL-Generierungsoptionen umfasst eine Option zum Verwenden einer Verletzung der vollständigen Parallelität (siehe Abbildung 1).</span><span class="sxs-lookup"><span data-stu-id="a72b9-111">Along with the Generate `INSERT`, `UPDATE`, and `DELETE` statements checkbox, the Advanced SQL Generation Options dialog box includes a Use optimistic concurrency option (see Figure 1).</span></span> <span data-ttu-id="a72b9-112">Wenn dieses Kontrollkästchen aktiviert, die `WHERE` Klauseln in der automatisch generierten `UPDATE` und `DELETE` -Anweisungen werden geändert, damit das Update nur ausgeführt, oder löschen, wenn die zugrunde liegenden Datenbank Daten erkannt t geändert wurde, seit der Benutzer zuletzt geladen die Daten in das Raster.</span><span class="sxs-lookup"><span data-stu-id="a72b9-112">When checked, the `WHERE` clauses in the autogenerated `UPDATE` and `DELETE` statements are modified to only perform the update or delete if the underlying database data hasn t been modified since the user last loaded the data into the grid.</span></span>


![Vollständige Parallelität Unterstützung können Sie hinzufügen, über den erweiterten SQL-Generierungsoptionen (Dialogfeld)](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image1.gif)

<span data-ttu-id="a72b9-114">**Abbildung 1**: vollständige Parallelität Unterstützung können Sie hinzufügen, über den erweiterten SQL-Generierungsoptionen (Dialogfeld)</span><span class="sxs-lookup"><span data-stu-id="a72b9-114">**Figure 1**: You Can Add Optimistic Concurrency Support from the Advanced SQL Generation Options Dialog Box</span></span>


<span data-ttu-id="a72b9-115">In der [optimistische Parallelität implementieren](../editing-inserting-and-deleting-data/implementing-optimistic-concurrency-vb.md) Lernprogramm untersucht die Grundlagen der Steuerung durch vollständige Parallelität und wie sie das ObjectDataSource hinzugefügt.</span><span class="sxs-lookup"><span data-stu-id="a72b9-115">Back in the [Implementing Optimistic Concurrency](../editing-inserting-and-deleting-data/implementing-optimistic-concurrency-vb.md) tutorial we examined the fundamentals of optimistic concurrency control and how to add it to the ObjectDataSource.</span></span> <span data-ttu-id="a72b9-116">In diesem Lernprogramm wir auf die Grundlagen der Steuerung durch vollständige Parallelität Retuschieren und sehen Sie sich dann wie sie mithilfe der SqlDataSource implementiert.</span><span class="sxs-lookup"><span data-stu-id="a72b9-116">In this tutorial we'll retouch on the essentials of optimistic concurrency control and then explore how to implement it using the SqlDataSource.</span></span>

## <a name="a-recap-of-optimistic-concurrency"></a><span data-ttu-id="a72b9-117">Eine Zusammenfassung der vollständigen Parallelität</span><span class="sxs-lookup"><span data-stu-id="a72b9-117">A Recap of Optimistic Concurrency</span></span>

<span data-ttu-id="a72b9-118">Für Webanwendungen, die ermöglichen, mehrere, gleichzeitige Benutzer zum Bearbeiten oder löschen die gleichen Daten vorhanden sind, die Möglichkeit, dass ein Benutzer kann einen anderen s Änderungen versehentlich überschreiben.</span><span class="sxs-lookup"><span data-stu-id="a72b9-118">For web applications that allow multiple, simultaneous users to edit or delete the same data, there exists a possibility that one user may accidentally overwrite another s changes.</span></span> <span data-ttu-id="a72b9-119">In der [optimistische Parallelität implementieren](../editing-inserting-and-deleting-data/implementing-optimistic-concurrency-vb.md) Lernprogramm ich im folgende Beispiel bereitgestellt:</span><span class="sxs-lookup"><span data-stu-id="a72b9-119">In the [Implementing Optimistic Concurrency](../editing-inserting-and-deleting-data/implementing-optimistic-concurrency-vb.md) tutorial I provided the following example:</span></span>

<span data-ttu-id="a72b9-120">Stellen Sie sich vor, dass Benutzern Jisun und Sam, sowohl eine Seite in einer Anwendung, für die zulässige Besucher besuchen wurden zu aktualisieren und Löschen von Produkten über ein GridView-Steuerelement.</span><span class="sxs-lookup"><span data-stu-id="a72b9-120">Imagine that two users, Jisun and Sam, were both visiting a page in an application that allowed visitors to update and delete products through a GridView control.</span></span> <span data-ttu-id="a72b9-121">Beide klicken Sie auf die Schaltfläche "Bearbeiten" für Chai ungefähr zur selben Zeit.</span><span class="sxs-lookup"><span data-stu-id="a72b9-121">Both click the Edit button for Chai around the same time.</span></span> <span data-ttu-id="a72b9-122">Jisun ändert sich der Name des Produkts in Chai Tee und klickt auf die Schaltfläche "Aktualisieren".</span><span class="sxs-lookup"><span data-stu-id="a72b9-122">Jisun changes the product name to Chai Tea and clicks the Update button.</span></span> <span data-ttu-id="a72b9-123">Das Ergebnis ist ein `UPDATE` -Anweisung, die an die Datenbank gesendet wird, die festlegt *alle* der aktualisierbaren Felder Product s (obwohl Jisun nur für ein Feld aktualisiert `ProductName`).</span><span class="sxs-lookup"><span data-stu-id="a72b9-123">The net result is an `UPDATE` statement that is sent to the database, which sets *all* of the product s updateable fields (even though Jisun only updated one field, `ProductName`).</span></span> <span data-ttu-id="a72b9-124">Zu diesem Zeitpunkt benötigt die Datenbank die Werte Chai Tee, der Kategorie Getränke, die Lieferanten Exotic Liquids für dieses bestimmte Produkt und so weiter.</span><span class="sxs-lookup"><span data-stu-id="a72b9-124">At this point in time, the database has the values Chai Tea, the category Beverages, the supplier Exotic Liquids, and so on for this particular product.</span></span> <span data-ttu-id="a72b9-125">Allerdings zeigt die GridView Sam-s-Bildschirm als Chai weiterhin den Produktnamen in der bearbeitbaren GridView-Zeile.</span><span class="sxs-lookup"><span data-stu-id="a72b9-125">However, the GridView on Sam s screen still shows the product name in the editable GridView row as Chai.</span></span> <span data-ttu-id="a72b9-126">Einige Sekunden nach Jisun s Änderungen ein Commit ausgeführt wurde, wurden Sam aktualisiert die Kategorie "Gewürze" und klickt auf Update.</span><span class="sxs-lookup"><span data-stu-id="a72b9-126">A few seconds after Jisun s changes have been committed, Sam updates the category to Condiments and clicks Update.</span></span> <span data-ttu-id="a72b9-127">Dies führt zu einer `UPDATE` Anweisung gesendet, um die Datenbank, die den Namen des Produkts auf Chai, setzt die `CategoryID` auf die entsprechende Kategorie-ID "Gewürze" usw.</span><span class="sxs-lookup"><span data-stu-id="a72b9-127">This results in an `UPDATE` statement sent to the database that sets the product name to Chai, the `CategoryID` to the corresponding Condiments category ID, and so on.</span></span> <span data-ttu-id="a72b9-128">Jisun s Änderungen an den Namen des Produkts wurde überschrieben.</span><span class="sxs-lookup"><span data-stu-id="a72b9-128">Jisun s changes to the product name have been overwritten.</span></span>

<span data-ttu-id="a72b9-129">Abbildung 2 zeigt diese Interaktion.</span><span class="sxs-lookup"><span data-stu-id="a72b9-129">Figure 2 illustrates this interaction.</span></span>


<span data-ttu-id="a72b9-130">[![Wenn zwei Benutzer gleichzeitig einen Datensatz zu aktualisieren ändert es s Potenzial für einen Benutzer zum Überschreiben von anderen](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image2.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="a72b9-130">[![When Two Users Simultaneously Update a Record There s Potential for One User s Changes to Overwrite the Other s](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image2.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image1.png)</span></span>

<span data-ttu-id="a72b9-131">**Abbildung 2**: Wenn zwei Benutzer gleichzeitig Update ein Datensatz vorhanden s Potenzial für einen Benutzer geändert wird, überschreiben die anderen s ([klicken Sie hier, um das Bild in voller Größe angezeigt](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="a72b9-131">**Figure 2**: When Two Users Simultaneously Update a Record There s Potential for One User s Changes to Overwrite the Other s ([Click to view full-size image](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image2.png))</span></span>


<span data-ttu-id="a72b9-132">Um zu verhindern, dass dieses Szenario Herausklappen, eine Form der [parallelitätssteuerung](http://en.wikipedia.org/wiki/Concurrency_control) muss implementiert werden.</span><span class="sxs-lookup"><span data-stu-id="a72b9-132">To prevent this scenario from unfolding, a form of [concurrency control](http://en.wikipedia.org/wiki/Concurrency_control) must be implemented.</span></span> <span data-ttu-id="a72b9-133">[Vollständige Parallelität](http://en.wikipedia.org/wiki/Optimistic_concurrency_control) der Schwerpunkt dieses Lernprogramm funktioniert unter der Annahme, dass es möglicherweise Parallelitätskonflikte und dann vorhanden sein, der Großteil der Zeit, die solche Konflikte/t gewonnen auftreten.</span><span class="sxs-lookup"><span data-stu-id="a72b9-133">[Optimistic concurrency](http://en.wikipedia.org/wiki/Optimistic_concurrency_control) the focus of this tutorial works on the assumption that while there may be concurrency conflicts every now and then, the vast majority of the time such conflicts won t arise.</span></span> <span data-ttu-id="a72b9-134">Daher, wenn ein Konflikt informiert Steuerung durch vollständige Parallelität einfach dem Benutzer, dass ihre Änderungen kann nicht gespeichert werden, weil ein anderer Benutzer die gleichen Daten geändert hat.</span><span class="sxs-lookup"><span data-stu-id="a72b9-134">Therefore, if a conflict does arise, optimistic concurrency control simply informs the user that their changes can t be saved because another user has modified the same data.</span></span>

> [!NOTE]
> <span data-ttu-id="a72b9-135">Für Anwendungen, in denen davon ausgegangen wird, dass sich viele Parallelitätskonflikte oder Konflikte dieser Art nicht tolerierbar sind, kann dann Steuerung durch eingeschränkte Parallelität stattdessen verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="a72b9-135">For applications where it is assumed that there will be many concurrency conflicts or if such conflicts are not tolerable, then pessimistic concurrency control can be used instead.</span></span> <span data-ttu-id="a72b9-136">Verweisen auf die [optimistische Parallelität implementieren](../editing-inserting-and-deleting-data/implementing-optimistic-concurrency-vb.md) Lernprogramm eine ausführlichere Diskussion zur Steuerung durch eingeschränkte Parallelität.</span><span class="sxs-lookup"><span data-stu-id="a72b9-136">Refer back to the [Implementing Optimistic Concurrency](../editing-inserting-and-deleting-data/implementing-optimistic-concurrency-vb.md) tutorial for a more thorough discussion on pessimistic concurrency control.</span></span>


<span data-ttu-id="a72b9-137">Steuerung durch vollständige Parallelität funktioniert, indem Sie sicherstellen, dass der Datensatz aktualisiert oder gelöscht werden die gleichen Werte wie beim Aktualisieren oder Löschen von Prozess gestartet.</span><span class="sxs-lookup"><span data-stu-id="a72b9-137">Optimistic concurrency control works by ensuring that the record being updated or deleted has the same values as it did when the updating or deleting process started.</span></span> <span data-ttu-id="a72b9-138">Z. B. beim Klicken auf die Schaltfläche "Bearbeiten", in einem bearbeitbaren GridView "" Datensatzwerte s aus der Datenbank gelesen und in die Textfelder und anderen Websteuerelementen angezeigt.</span><span class="sxs-lookup"><span data-stu-id="a72b9-138">For example, when clicking the Edit button in an editable GridView, the record s values are read from the database and displayed in TextBoxes and other Web controls.</span></span> <span data-ttu-id="a72b9-139">Diese ursprünglichen Werte werden durch die GridView gespeichert.</span><span class="sxs-lookup"><span data-stu-id="a72b9-139">These original values are saved by the GridView.</span></span> <span data-ttu-id="a72b9-140">Wenn der Benutzer mit der ihre Änderungen und klickt auf die Schaltfläche "Aktualisieren" später die `UPDATE` verwendete Anweisung muss berücksichtigen Sie die ursprünglichen Werte sowie die neuen Werte und nur den zugrunde liegenden Datenbank-Datensatz aktualisieren, wenn die ursprünglichen Werte, dass der Benutzer bearbeiten gestartet sind identisch mit den Werten noch in der Datenbank.</span><span class="sxs-lookup"><span data-stu-id="a72b9-140">Later, after the user makes her changes and clicks the Update button, the `UPDATE` statement used must take into account the original values plus the new values and only update the underlying database record if the original values that the user started editing are identical to the values still in the database.</span></span> <span data-ttu-id="a72b9-141">Abbildung 3 zeigt diese Abfolge von Ereignissen.</span><span class="sxs-lookup"><span data-stu-id="a72b9-141">Figure 3 depicts this sequence of events.</span></span>


<span data-ttu-id="a72b9-142">[![Für die Update- oder Delete erfolgreich ausgeführt werden soll müssen die ursprünglichen Werte der aktuellen Datenbankwerte gleich sein.](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image3.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="a72b9-142">[![For the Update or Delete to Succeed, the Original Values Must Be Equal to the Current Database Values](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image3.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image3.png)</span></span>

<span data-ttu-id="a72b9-143">**Abbildung 3**: für die Update- oder Delete SUCCEED, die ursprünglichen Werte müssen werden gleich der aktuellen Datenbankwerte ([klicken Sie hier, um das Bild in voller Größe angezeigt](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="a72b9-143">**Figure 3**: For the Update or Delete to Succeed, the Original Values Must Be Equal to the Current Database Values ([Click to view full-size image](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image4.png))</span></span>


<span data-ttu-id="a72b9-144">Es gibt verschiedene Ansätze zum Implementieren der vollständigen Parallelität (finden Sie unter [Peter A. Bromberg](http://peterbromberg.net/) s [Optmistic Parallelität aktualisieren Logik](http://www.eggheadcafe.com/articles/20050719.asp) für einen kurzen Blick auf eine Reihe von Optionen).</span><span class="sxs-lookup"><span data-stu-id="a72b9-144">There are various approaches to implementing optimistic concurrency (see [Peter A. Bromberg](http://peterbromberg.net/) s [Optmistic Concurrency Updating Logic](http://www.eggheadcafe.com/articles/20050719.asp) for a brief look at a number of options).</span></span> <span data-ttu-id="a72b9-145">Durch die SqlDataSource (und durch das ADO.NET typisierter DataSets verwendet, in unserem Datenzugriffsebene) verwendete Technik ergänzt die `WHERE` -Klausel, um einen Vergleich aller von den ursprünglichen Werten enthalten.</span><span class="sxs-lookup"><span data-stu-id="a72b9-145">The technique used by the SqlDataSource (as well as by the ADO.NET Typed DataSets used in our Data Access Layer) augments the `WHERE` clause to include a comparison of all of the original values.</span></span> <span data-ttu-id="a72b9-146">Die folgenden `UPDATE` -Anweisung aktualisiert z. B. den Namen und den Preis eines Produkts nur, wenn die aktuellen Datenbankwerte die Werte gleich, die ursprünglich abgerufen wurden sind, wenn den Datensatz in die GridView zu aktualisieren.</span><span class="sxs-lookup"><span data-stu-id="a72b9-146">The following `UPDATE` statement, for example, updates the name and price of a product only if the current database values are equal to the values that were originally retrieved when updating the record in the GridView.</span></span> <span data-ttu-id="a72b9-147">Die `@ProductName` und `@UnitPrice` Parameter enthalten die neuen Werten, die durch den Benutzer eingegeben werden, während `@original_ProductName` und `@original_UnitPrice` enthalten die Werte, die ursprünglich in die GridView geladen wurden, wenn auf die Schaltfläche "Bearbeiten" geklickt wurde:</span><span class="sxs-lookup"><span data-stu-id="a72b9-147">The `@ProductName` and `@UnitPrice` parameters contain the new values entered by the user, whereas `@original_ProductName` and `@original_UnitPrice` contain the values that were originally loaded into the GridView when the Edit button was clicked:</span></span>


[!code-sql[Main](implementing-optimistic-concurrency-with-the-sqldatasource-vb/samples/sample1.sql)]

<span data-ttu-id="a72b9-148">Wie wir in diesem Lernprogramm sehen werden, ist das Aktivieren der Steuerung durch vollständige Parallelität mit der SqlDataSource so einfach wie ein Kontrollkästchen aktivieren.</span><span class="sxs-lookup"><span data-stu-id="a72b9-148">As we'll see in this tutorial, enabling optimistic concurrency control with the SqlDataSource is as simple as checking a checkbox.</span></span>

## <a name="step-1-creating-a-sqldatasource-that-supports-optimistic-concurrency"></a><span data-ttu-id="a72b9-149">Schritt 1: Erstellen einer SqlDataSource, unterstützt optimistische Parallelität</span><span class="sxs-lookup"><span data-stu-id="a72b9-149">Step 1: Creating a SqlDataSource that Supports Optimistic Concurrency</span></span>

<span data-ttu-id="a72b9-150">Öffnen Sie zunächst die `OptimisticConcurrency.aspx` Seite aus der `SqlDataSource` Ordner.</span><span class="sxs-lookup"><span data-stu-id="a72b9-150">Start by opening the `OptimisticConcurrency.aspx` page from the `SqlDataSource` folder.</span></span> <span data-ttu-id="a72b9-151">Ziehen Sie ein SqlDataSource-Steuerelement aus der Toolbox in den Designer, Einstellungen der `ID` Eigenschaft `ProductsDataSourceWithOptimisticConcurrency`.</span><span class="sxs-lookup"><span data-stu-id="a72b9-151">Drag a SqlDataSource control from the Toolbox onto the Designer, settings its `ID` property to `ProductsDataSourceWithOptimisticConcurrency`.</span></span> <span data-ttu-id="a72b9-152">Klicken Sie dann auf den Link "Datenquelle konfigurieren" aus dem Steuerelement s smart Tag auf.</span><span class="sxs-lookup"><span data-stu-id="a72b9-152">Next, click on the Configure Data Source link from the control s smart tag.</span></span> <span data-ttu-id="a72b9-153">Wählen Sie aus dem ersten Bildschirm des Assistenten, mit dem `NORTHWINDConnectionString` , und klicken Sie auf Weiter.</span><span class="sxs-lookup"><span data-stu-id="a72b9-153">From the first screen in the wizard, choose to work with the `NORTHWINDConnectionString` and click Next.</span></span>


<span data-ttu-id="a72b9-154">[![Wählen Sie für die Arbeit mit der NORTHWINDConnectionString](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image4.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="a72b9-154">[![Choose to Work with the NORTHWINDConnectionString](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image4.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image5.png)</span></span>

<span data-ttu-id="a72b9-155">**Abbildung 4**: Wählen Sie für die Arbeit mit der `NORTHWINDConnectionString` ([klicken Sie hier, um das Bild in voller Größe angezeigt](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="a72b9-155">**Figure 4**: Choose to Work with the `NORTHWINDConnectionString` ([Click to view full-size image](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image6.png))</span></span>


<span data-ttu-id="a72b9-156">In diesem Beispiel wir werden hinzufügen eine GridView, die es ermöglicht Benutzern das Bearbeiten der `Products` Tabelle.</span><span class="sxs-lookup"><span data-stu-id="a72b9-156">For this example we'll be adding a GridView that enables users to edit the `Products` table.</span></span> <span data-ttu-id="a72b9-157">Aus diesem Grund, aus dem Bildschirm Select-Anweisung konfigurieren, wählen Sie die `Products` Tabelle aus der Dropdown-Liste, und wählen Sie die `ProductID`, `ProductName`, `UnitPrice`, und `Discontinued` Spalten, wie in Abbildung 5 dargestellt.</span><span class="sxs-lookup"><span data-stu-id="a72b9-157">Therefore, from the Configure the Select Statement screen, choose the `Products` table from the drop-down list and select the `ProductID`, `ProductName`, `UnitPrice`, and `Discontinued` columns, as shown in Figure 5.</span></span>


<span data-ttu-id="a72b9-158">[![Zurückzugeben Sie aus der Tabelle Products, die ProductID, ProductName, UnitPrice und nicht mehr unterstützte Spalten](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image5.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="a72b9-158">[![From the Products Table, Return the ProductID, ProductName, UnitPrice, and Discontinued Columns](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image5.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image7.png)</span></span>

<span data-ttu-id="a72b9-159">**Abbildung 5**: aus der `Products` Tabelle, zum Zurückgeben der `ProductID`, `ProductName`, `UnitPrice`, und `Discontinued` Spalten ([klicken Sie hier, um das Bild in voller Größe angezeigt](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="a72b9-159">**Figure 5**: From the `Products` Table, Return the `ProductID`, `ProductName`, `UnitPrice`, and `Discontinued` Columns ([Click to view full-size image](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image8.png))</span></span>


<span data-ttu-id="a72b9-160">Klicken Sie nach dem Auswählen der Spalten, auf die Schaltfläche "Erweitert", um das Dialogfeld Erweiterte SQL-Generierungsoptionen anzuzeigen.</span><span class="sxs-lookup"><span data-stu-id="a72b9-160">After picking the columns, click the Advanced button to bring up the Advanced SQL Generation Options dialog box.</span></span> <span data-ttu-id="a72b9-161">Überprüfen Sie die generieren `INSERT`, `UPDATE`, und `DELETE` Anweisungen mithilfe der vollständigen Parallelität Kontrollkästchen, und klicken Sie auf OK (siehe Abbildung 1 für einen Screenshot).</span><span class="sxs-lookup"><span data-stu-id="a72b9-161">Check the Generate `INSERT`, `UPDATE`, and `DELETE` statements and Use optimistic concurrency checkboxes and click OK (refer back to Figure 1 for a screenshot).</span></span> <span data-ttu-id="a72b9-162">Schließen Sie den Assistenten, indem Sie auf Weiter, dann auf Fertig stellen.</span><span class="sxs-lookup"><span data-stu-id="a72b9-162">Complete the wizard by clicking Next, then Finish.</span></span>

<span data-ttu-id="a72b9-163">Nehmen Sie nach Abschluss des Assistenten für die Datenquelle konfigurieren einen Moment Zeit, untersuchen Sie das resultierende `DeleteCommand` und `UpdateCommand` Eigenschaften und die `DeleteParameters` und `UpdateParameters` Sammlungen.</span><span class="sxs-lookup"><span data-stu-id="a72b9-163">After completing the Configure Data Source wizard, take a moment to examine the resulting `DeleteCommand` and `UpdateCommand` properties and the `DeleteParameters` and `UpdateParameters` collections.</span></span> <span data-ttu-id="a72b9-164">Die einfachste Möglichkeit hierzu ist, klicken Sie auf der Registerkarte "Datenquelle" in der unteren linken Ecke auf der Seite s deklarative Syntax finden Sie unter auf.</span><span class="sxs-lookup"><span data-stu-id="a72b9-164">The easiest way to do this is to click on the Source tab in the lower left corner to see the page s declarative syntax.</span></span> <span data-ttu-id="a72b9-165">Es wird Ihnen eine `UpdateCommand` Wert:</span><span class="sxs-lookup"><span data-stu-id="a72b9-165">There you will find an `UpdateCommand` value of:</span></span>


[!code-sql[Main](implementing-optimistic-concurrency-with-the-sqldatasource-vb/samples/sample2.sql)]

<span data-ttu-id="a72b9-166">Mit sieben Parameter in der `UpdateParameters` Auflistung:</span><span class="sxs-lookup"><span data-stu-id="a72b9-166">With seven parameters in the `UpdateParameters` collection:</span></span>


[!code-aspx[Main](implementing-optimistic-concurrency-with-the-sqldatasource-vb/samples/sample3.aspx)]

<span data-ttu-id="a72b9-167">Auf ähnliche Weise die `DeleteCommand` Eigenschaft und `DeleteParameters` Auflistung sollte wie folgt aussehen:</span><span class="sxs-lookup"><span data-stu-id="a72b9-167">Similarly, the `DeleteCommand` property and `DeleteParameters` collection should look like the following:</span></span>


[!code-sql[Main](implementing-optimistic-concurrency-with-the-sqldatasource-vb/samples/sample4.sql)]


[!code-aspx[Main](implementing-optimistic-concurrency-with-the-sqldatasource-vb/samples/sample5.aspx)]

<span data-ttu-id="a72b9-168">Zusätzlich zum Erweitern der `WHERE` -Klauseln der `UpdateCommand` und `DeleteCommand` Eigenschaften (und die zusätzlichen Parameter für die jeweiligen Parameter Sammlungen hinzufügen), die vollständige Parallelitätsoption passt zwei andere Verwendung auswählen Eigenschaften:</span><span class="sxs-lookup"><span data-stu-id="a72b9-168">In addition to augmenting the `WHERE` clauses of the `UpdateCommand` and `DeleteCommand` properties (and adding the additional parameters to the respective parameter collections), selecting the Use optimistic concurrency option adjusts two other properties:</span></span>

- <span data-ttu-id="a72b9-169">Ändert die [ `ConflictDetection` Eigenschaft](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.conflictdetection.aspx) aus `OverwriteChanges` (Standard), `CompareAllValues`</span><span class="sxs-lookup"><span data-stu-id="a72b9-169">Changes the [`ConflictDetection` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.conflictdetection.aspx) from `OverwriteChanges` (the default) to `CompareAllValues`</span></span>
- <span data-ttu-id="a72b9-170">Ändert die [ `OldValuesParameterFormatString` Eigenschaft](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.oldvaluesparameterformatstring.aspx) von {0} (Standard) zum ursprünglichen\_{0}.</span><span class="sxs-lookup"><span data-stu-id="a72b9-170">Changes the [`OldValuesParameterFormatString` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.oldvaluesparameterformatstring.aspx) from {0} (the default) to original\_{0} .</span></span>

<span data-ttu-id="a72b9-171">Wenn die Daten Websteuerelement SqlDataSource s aufruft `Update()` oder `Delete()` -Methode, die ursprünglichen Werte übergibt.</span><span class="sxs-lookup"><span data-stu-id="a72b9-171">When the data Web control invokes the SqlDataSource s `Update()` or `Delete()` method, it passes in the original values.</span></span> <span data-ttu-id="a72b9-172">Wenn die SqlDataSource s `ConflictDetection` -Eigenschaftensatz auf `CompareAllValues`, diese ursprünglichen Werte der Befehl hinzugefügt werden.</span><span class="sxs-lookup"><span data-stu-id="a72b9-172">If the SqlDataSource s `ConflictDetection` property is set to `CompareAllValues`, these original values are added to the command.</span></span> <span data-ttu-id="a72b9-173">Die `OldValuesParameterFormatString` Eigenschaft ermöglicht dem Benennungsschema für diese Werteparameter der ursprüngliche verwendet.</span><span class="sxs-lookup"><span data-stu-id="a72b9-173">The `OldValuesParameterFormatString` property provides the naming pattern used for these original value parameters.</span></span> <span data-ttu-id="a72b9-174">Das Konfigurieren von Datenquellen-Assistent verwendet ursprünglichen\_{0} und benennt Sie jeden ursprünglichen Parameter in der `UpdateCommand` und `DeleteCommand` Eigenschaften und `UpdateParameters` und `DeleteParameters` Sammlungen entsprechend.</span><span class="sxs-lookup"><span data-stu-id="a72b9-174">The Configure Data Source wizard uses original\_{0} and names each original parameter in the `UpdateCommand` and `DeleteCommand` properties and `UpdateParameters` and `DeleteParameters` collections accordingly.</span></span>

> [!NOTE]
> <span data-ttu-id="a72b9-175">Da wir re nicht mithilfe der SqlDataSource-Steuerelement s einfügen-Funktionen, die gerne Entfernen der `InsertCommand` Eigenschaft und die zugehörige `InsertParameters` Auflistung.</span><span class="sxs-lookup"><span data-stu-id="a72b9-175">Since we re not using the SqlDataSource control s inserting capabilities, feel free to remove the `InsertCommand` property and its `InsertParameters` collection.</span></span>


## <a name="correctly-handlingnullvalues"></a><span data-ttu-id="a72b9-176">Ordnungsgemäßen Behandlung von`NULL`Werte</span><span class="sxs-lookup"><span data-stu-id="a72b9-176">Correctly Handling`NULL`Values</span></span>

<span data-ttu-id="a72b9-177">Leider die augmented `UPDATE` und `DELETE` Anweisungen automatisch vom Assistenten zum Konfigurieren von Datenquellen bei Verwendung der vollständigen Parallelität führen *nicht* funktionieren mit Datensätzen mit `NULL` Werte.</span><span class="sxs-lookup"><span data-stu-id="a72b9-177">Unfortunately, the augmented `UPDATE` and `DELETE` statements autogenerated by the Configure Data Source wizard when using optimistic concurrency do *not* work with records that contain `NULL` values.</span></span> <span data-ttu-id="a72b9-178">Um festzustellen, warum, sollten Sie unsere SqlDataSource s `UpdateCommand`:</span><span class="sxs-lookup"><span data-stu-id="a72b9-178">To see why, consider our SqlDataSource s `UpdateCommand`:</span></span>


[!code-sql[Main](implementing-optimistic-concurrency-with-the-sqldatasource-vb/samples/sample6.sql)]

<span data-ttu-id="a72b9-179">Die `UnitPrice` Spalte in der `Products` Tabelle möglich `NULL` Werte.</span><span class="sxs-lookup"><span data-stu-id="a72b9-179">The `UnitPrice` column in the `Products` table can have `NULL` values.</span></span> <span data-ttu-id="a72b9-180">Wenn ein bestimmter Datensatz weist ein `NULL` Wert für `UnitPrice`, die `WHERE` Klausel Teil `[UnitPrice] = @original_UnitPrice` wird *immer* auf "false" ausgewertet werden, da `NULL = NULL` gibt immer "false" zurück.</span><span class="sxs-lookup"><span data-stu-id="a72b9-180">If a particular record has a `NULL` value for `UnitPrice`, the `WHERE` clause portion `[UnitPrice] = @original_UnitPrice` will *always* evaluate to False because `NULL = NULL` always returns False.</span></span> <span data-ttu-id="a72b9-181">Aus diesem Grund Datensätze enthalten, die `NULL` Werte können nicht bearbeitet oder gelöscht wird, als der `UPDATE` und `DELETE` Anweisungen `WHERE` Klauseln/t Return gewonnen Zeilen zum Aktualisieren oder löschen.</span><span class="sxs-lookup"><span data-stu-id="a72b9-181">Therefore, records that contain `NULL` values cannot be edited or deleted, as the `UPDATE` and `DELETE` statements `WHERE` clauses won t return any rows to update or delete.</span></span>

> [!NOTE]
> <span data-ttu-id="a72b9-182">Dieser Fehler wurde im Juni von / / 2004 in zuerst an Microsoft gemeldet [SqlDataSource generiert falsche SQL-Anweisungen](https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=93937) und wird daher voraussichtlich in der nächsten Version von ASP.NET behoben werden.</span><span class="sxs-lookup"><span data-stu-id="a72b9-182">This bug was first reported to Microsoft in June of 2004 in [SqlDataSource Generates Incorrect SQL Statements](https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=93937) and is reportedly scheduled to be fixed in the next version of ASP.NET.</span></span>


<span data-ttu-id="a72b9-183">Um dieses Problem zu beheben, müssen Sie manuell aktualisieren, die `WHERE` in beiden Klauseln der `UpdateCommand` und `DeleteCommand` Eigenschaften für **alle** Spalten mit können `NULL` Werte.</span><span class="sxs-lookup"><span data-stu-id="a72b9-183">To fix this, we have to manually update the `WHERE` clauses in both the `UpdateCommand` and `DeleteCommand` properties for **all** columns that can have `NULL` values.</span></span> <span data-ttu-id="a72b9-184">Im Allgemeinen ändern `[ColumnName] = @original_ColumnName` an:</span><span class="sxs-lookup"><span data-stu-id="a72b9-184">In general, change `[ColumnName] = @original_ColumnName` to:</span></span>


[!code-sql[Main](implementing-optimistic-concurrency-with-the-sqldatasource-vb/samples/sample7.sql)]

<span data-ttu-id="a72b9-185">Diese Änderung können direkt über die deklaratives Markup, über die Optionen UpdateQuery oder DeleteQuery über das Eigenschaftenfenster oder über das UPDATE vorgenommen werden, und löschen Registerkarten angeben, eine benutzerdefinierte SQL-Anweisung oder gespeicherte Prozedur-Option in den Daten konfigurieren Datenquellen-Assistenten.</span><span class="sxs-lookup"><span data-stu-id="a72b9-185">This modification can be made directly through the declarative markup, via the UpdateQuery or DeleteQuery options from the Properties window, or through the UPDATE and DELETE tabs in the Specify a custom SQL statement or stored procedure option in the Configure Data Source wizard.</span></span> <span data-ttu-id="a72b9-186">Erneut, diese Änderung muss erfolgen, für *jeder* Spalte in der `UpdateCommand` und `DeleteCommand` s `WHERE` -Klausel, die enthalten kann `NULL` Werte.</span><span class="sxs-lookup"><span data-stu-id="a72b9-186">Again, this modification must be made for *every* column in the `UpdateCommand` and `DeleteCommand` s `WHERE` clause that can contain `NULL` values.</span></span>

<span data-ttu-id="a72b9-187">Die folgende geänderte führt dies zu unserem Beispiel: Anwenden von `UpdateCommand` und `DeleteCommand` Werte:</span><span class="sxs-lookup"><span data-stu-id="a72b9-187">Applying this to our example results in the following modified `UpdateCommand` and `DeleteCommand` values:</span></span>


[!code-sql[Main](implementing-optimistic-concurrency-with-the-sqldatasource-vb/samples/sample8.sql)]

## <a name="step-2-adding-a-gridview-with-edit-and-delete-options"></a><span data-ttu-id="a72b9-188">Schritt 2: Hinzufügen einer GridView mit bearbeiten und Löschoptionen</span><span class="sxs-lookup"><span data-stu-id="a72b9-188">Step 2: Adding a GridView with Edit and Delete Options</span></span>

<span data-ttu-id="a72b9-189">Mit dem SqlDataSource so konfiguriert, dass die Unterstützung der vollständigen Parallelität übrig bleibt zum Hinzufügen von ein Datentyps-Websteuerelement auf der Seite ", der diese parallelitätssteuerung verwendet.</span><span class="sxs-lookup"><span data-stu-id="a72b9-189">With the SqlDataSource configured to support optimistic concurrency, all that remains is to add a data Web control to the page that utilizes this concurrency control.</span></span> <span data-ttu-id="a72b9-190">Können Sie für dieses Lernprogramm s hinzufügen eine GridView, die beide bearbeiten und Löschen von Funktionen.</span><span class="sxs-lookup"><span data-stu-id="a72b9-190">For this tutorial, let s add a GridView that provides both edit and delete functionality.</span></span> <span data-ttu-id="a72b9-191">Um dies zu erreichen, ziehen Sie eine GridView aus der Toolbox auf die Designer, und legen seine `ID` auf `Products`.</span><span class="sxs-lookup"><span data-stu-id="a72b9-191">To accomplish this, drag a GridView from the Toolbox onto the Designer and set its `ID` to `Products`.</span></span> <span data-ttu-id="a72b9-192">Aus den GridView s smart Tag, binden Sie es an die `ProductsDataSourceWithOptimisticConcurrency` SqlDataSource-Steuerelement, die in Schritt 1 hinzugefügt.</span><span class="sxs-lookup"><span data-stu-id="a72b9-192">From the GridView s smart tag, bind it to the `ProductsDataSourceWithOptimisticConcurrency` SqlDataSource control added in Step 1.</span></span> <span data-ttu-id="a72b9-193">Überprüfen Sie schließlich die Optionen für die Bearbeitung aktivieren und löschen aktivieren aus den smart Tag.</span><span class="sxs-lookup"><span data-stu-id="a72b9-193">Finally, check the Enable Editing and Enable Deleting options from the smart tag.</span></span>


<span data-ttu-id="a72b9-194">[![GridView an die SqlDataSource binden und bearbeiten und Löschen von aktivieren](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image6.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="a72b9-194">[![Bind the GridView to the SqlDataSource and Enable Editing and Deleting](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image6.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image9.png)</span></span>

<span data-ttu-id="a72b9-195">**Abbildung 6**: GridView zu binden, SqlDataSource und Bearbeiten aktivieren und löschen ([klicken Sie hier, um das Bild in voller Größe angezeigt](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="a72b9-195">**Figure 6**: Bind the GridView to the SqlDataSource and Enable Editing and Deleting ([Click to view full-size image](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image10.png))</span></span>


<span data-ttu-id="a72b9-196">Konfigurieren Sie nach dem Hinzufügen der GridView, seine Darstellung durch das Entfernen der `ProductID` BoundField, Ändern der `ProductName` BoundField-s `HeaderText` Eigenschaft Produkt, und Aktualisieren der `UnitPrice` BoundField, damit seine `HeaderText` Eigenschaft ist einfach Preis.</span><span class="sxs-lookup"><span data-stu-id="a72b9-196">After adding the GridView, configure its appearance by removing the `ProductID` BoundField, changing the `ProductName` BoundField s `HeaderText` property to Product, and updating the `UnitPrice` BoundField so that its `HeaderText` property is simply Price.</span></span> <span data-ttu-id="a72b9-197">Im Idealfall wir d verbessern, die Bearbeitungsoberfläche Einbeziehung einen RequiredFieldValidator für die `ProductName` Wert und eine CompareValidator für die `UnitPrice` Wert (s eine ordnungsgemäß formatierte numerische Wert sicherzustellen, dass es).</span><span class="sxs-lookup"><span data-stu-id="a72b9-197">Ideally, we d enhance the editing interface to include a RequiredFieldValidator for the `ProductName` value and a CompareValidator for the `UnitPrice` value (to ensure it s a properly formatted numeric value).</span></span> <span data-ttu-id="a72b9-198">Finden Sie in der [Anpassen der Benutzeroberfläche für die Änderung der Daten](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-vb.md) Lernprogramm für eine eingehendere Betrachtung der Schnittstelle bearbeiten GridView s anpassen.</span><span class="sxs-lookup"><span data-stu-id="a72b9-198">Refer to the [Customizing the Data Modification Interface](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-vb.md) tutorial for a more in-depth look at customizing the GridView s editing interface.</span></span>

> [!NOTE]
> <span data-ttu-id="a72b9-199">Die GridView, die Ansichtszustand s aktiviert werden muss, da die ursprünglichen Werte, die von der GridView an die SqlDataSource übergeben werden im Ansichtszustand gespeichert.</span><span class="sxs-lookup"><span data-stu-id="a72b9-199">The GridView s view state must be enabled since the original values passed from the GridView to the SqlDataSource are stored in view state.</span></span>


<span data-ttu-id="a72b9-200">Nachdem Sie diese Änderungen an die GridView haben, sollte die GridView und SqlDataSource deklarative Markup etwa wie folgt aussehen:</span><span class="sxs-lookup"><span data-stu-id="a72b9-200">After making these modifications to the GridView, the GridView and SqlDataSource declarative markup should look similar to the following:</span></span>


[!code-aspx[Main](implementing-optimistic-concurrency-with-the-sqldatasource-vb/samples/sample9.aspx)]

<span data-ttu-id="a72b9-201">Um die Steuerung durch vollständige Parallelität in Aktion zu sehen, zwei Browserfenster zu öffnen, und laden die `OptimisticConcurrency.aspx` Seite in beide.</span><span class="sxs-lookup"><span data-stu-id="a72b9-201">To see the optimistic concurrency control in action, open two browser windows and load the `OptimisticConcurrency.aspx` page in both.</span></span> <span data-ttu-id="a72b9-202">Klicken Sie auf die Schaltflächen "Bearbeiten" für das erste Produkt in beiden Browsern.</span><span class="sxs-lookup"><span data-stu-id="a72b9-202">Click on the Edit buttons for the first product in both browsers.</span></span> <span data-ttu-id="a72b9-203">In einem Browser eingeben ändern Sie den Namen des Produkts, und klicken Sie auf aktualisieren.</span><span class="sxs-lookup"><span data-stu-id="a72b9-203">In one browser, change the product name and click Update.</span></span> <span data-ttu-id="a72b9-204">Der Browser wird postback und GridView wird mit dem neuen Produktnamen für den Datensatz, der gerade bearbeitet in seiner vorab Bearbeitungsmodus zurückgesetzt.</span><span class="sxs-lookup"><span data-stu-id="a72b9-204">The browser will postback and the GridView will return to its pre-editing mode, showing the new product name for the record just edited.</span></span>

<span data-ttu-id="a72b9-205">Im zweiten Browserfenster ändern Sie den Preis (aber lassen Sie den Produktnamen als den ursprünglichen Wert), und klicken Sie auf aktualisieren.</span><span class="sxs-lookup"><span data-stu-id="a72b9-205">In the second browser window, change the price (but leave the product name as its original value) and click Update.</span></span> <span data-ttu-id="a72b9-206">Beim Postback im Raster in die vorab Bearbeitungsmodus gibt, aber die Änderung an der Preis wird nicht aufgezeichnet.</span><span class="sxs-lookup"><span data-stu-id="a72b9-206">On postback, the grid returns to its pre-editing mode, but the change to the price is not recorded.</span></span> <span data-ttu-id="a72b9-207">Der zweite Browser zeigt dem gleichen Wert wie die erste neue Produktnamen mit dem alte Preis.</span><span class="sxs-lookup"><span data-stu-id="a72b9-207">The second browser shows the same value as the first one the new product name with the old price.</span></span> <span data-ttu-id="a72b9-208">Die in der zweiten Browserfenster vorgenommenen Änderungen sind verloren gegangen.</span><span class="sxs-lookup"><span data-stu-id="a72b9-208">The changes made in the second browser window were lost.</span></span> <span data-ttu-id="a72b9-209">Darüber hinaus sind die Änderungen verloren gegangen vielmehr – wie gab es keine Ausnahme oder an, dass nur eine parallelitätsverletzung aufgetreten ist.</span><span class="sxs-lookup"><span data-stu-id="a72b9-209">Moreover, the changes were lost rather quietly, as there was no exception or message indicating that a concurrency violation just occurred.</span></span>


<span data-ttu-id="a72b9-210">[![Die Änderungen in der zweiten Browserfenster sind im Hintergrund verloren gegangen](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image7.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="a72b9-210">[![The Changes in the Second Browser Window Were Silently Lost](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image7.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image11.png)</span></span>

<span data-ttu-id="a72b9-211">**Abbildung 7**: die Änderungen in der zweiten Browser Fenster wurden im Hintergrund verloren geht ([klicken Sie hier, um das Bild in voller Größe angezeigt](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="a72b9-211">**Figure 7**: The Changes in the Second Browser Window Were Silently Lost ([Click to view full-size image](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image12.png))</span></span>


<span data-ttu-id="a72b9-212">Der Grund, warum die zweite Browser s Änderungen nicht ein Commit ausgeführt waren, wurde, da die `UPDATE` Anweisung s `WHERE` -Klausel herausgefiltert, alle Datensätze und daher keine Auswirkungen auf Zeilen.</span><span class="sxs-lookup"><span data-stu-id="a72b9-212">The reason why the second browser s changes were not committed was because the `UPDATE` statement s `WHERE` clause filtered out all records and therefore did not affect any rows.</span></span> <span data-ttu-id="a72b9-213">S betrachten können die `UPDATE` -Anweisung erneut aus:</span><span class="sxs-lookup"><span data-stu-id="a72b9-213">Let s look at the `UPDATE` statement again:</span></span>


[!code-sql[Main](implementing-optimistic-concurrency-with-the-sqldatasource-vb/samples/sample10.sql)]

<span data-ttu-id="a72b9-214">Der zweite Browserfenster zur Aktualisierung des Datensatzes der ursprünglichen Produktname angegeben, der `WHERE` -Klausel verfügt über t Übereinstimmung oben mit dem vorhandenen Produktnamen (da es von der ersten Browser geändert wurde).</span><span class="sxs-lookup"><span data-stu-id="a72b9-214">When the second browser window updates the record, the original product name specified in the `WHERE` clause doesn t match up with the existing product name (since it was changed by the first browser).</span></span> <span data-ttu-id="a72b9-215">Aus diesem Grund die Anweisung `[ProductName] = @original_ProductName` gibt "false", und die `UPDATE` wirkt sich nicht auf alle Datensätze.</span><span class="sxs-lookup"><span data-stu-id="a72b9-215">Therefore, the statement `[ProductName] = @original_ProductName` returns False, and the `UPDATE` does not affect any records.</span></span>

> [!NOTE]
> <span data-ttu-id="a72b9-216">Löschen Sie auf die gleiche Weise funktioniert.</span><span class="sxs-lookup"><span data-stu-id="a72b9-216">Delete works in the same manner.</span></span> <span data-ttu-id="a72b9-217">Starten Sie mit zwei Browserfenster öffnen, indem ein bestimmtes Produkt mit einer bearbeiten und anschließend die Änderungen zu speichern.</span><span class="sxs-lookup"><span data-stu-id="a72b9-217">With two browser windows open, start by editing a given product with one, and then saving its changes.</span></span> <span data-ttu-id="a72b9-218">Nach dem Speichern der Änderungen in einem Browser, klicken Sie auf die Schaltfläche "löschen" für das gleiche Produkt in einer anderen.</span><span class="sxs-lookup"><span data-stu-id="a72b9-218">After saving the changes in the one browser, click the Delete button for the same product in the other.</span></span> <span data-ttu-id="a72b9-219">Da die ursprünglichen Werte Stefan t ordnen Sie der `DELETE` Anweisung s `WHERE` -Klausel, der Löschvorgang im Hintergrund ein Fehler auftritt.</span><span class="sxs-lookup"><span data-stu-id="a72b9-219">Since the original values don t match up in the `DELETE` statement s `WHERE` clause, the delete silently fails.</span></span>


<span data-ttu-id="a72b9-220">Aus der Endbenutzer-s-Perspektive in der zweiten Browserfenster wird nach dem Klicken auf die Schaltfläche "Aktualisieren" im Raster in die vorab Bearbeitungsmodus gibt ihre Änderungen wurden jedoch verloren.</span><span class="sxs-lookup"><span data-stu-id="a72b9-220">From the end user s perspective in the second browser window, after clicking the Update button the grid returns to the pre-editing mode, but their changes were lost.</span></span> <span data-ttu-id="a72b9-221">Allerdings dort s keine visuelle Bestätigung, die ihre Änderungen t bleiben.</span><span class="sxs-lookup"><span data-stu-id="a72b9-221">However, there s no visual feedback that their changes didn t stick.</span></span> <span data-ttu-id="a72b9-222">Im Idealfall benutzeränderungen s auf eine parallelitätsverletzung verloren, d wir benachrichtigen Sie sie und vielleicht, behalten Sie im Raster im Bearbeitungsmodus befindet.</span><span class="sxs-lookup"><span data-stu-id="a72b9-222">Ideally, if a user s changes are lost to a concurrency violation, we d notify them and, perhaps, keep the grid in edit mode.</span></span> <span data-ttu-id="a72b9-223">Lassen Sie s betrachten, wie dies zu erreichen.</span><span class="sxs-lookup"><span data-stu-id="a72b9-223">Let s look at how to accomplish this.</span></span>

## <a name="step-3-determining-when-a-concurrency-violation-has-occurred"></a><span data-ttu-id="a72b9-224">Schritt 3: Bestimmen, wann eine Parallelität verletzt wurde</span><span class="sxs-lookup"><span data-stu-id="a72b9-224">Step 3: Determining When a Concurrency Violation Has Occurred</span></span>

<span data-ttu-id="a72b9-225">Da eine parallelitätsverletzung die Änderungen ablehnt, eine vorgenommen wurde, wäre es gut, um den Benutzer zu warnen, wenn eine parallelitätsverletzung aufgetreten ist.</span><span class="sxs-lookup"><span data-stu-id="a72b9-225">Since a concurrency violation rejects the changes one has made, it would be nice to alert the user when a concurrency violation has occurred.</span></span> <span data-ttu-id="a72b9-226">Damit den Benutzer benachrichtigt werden, können s, fügen Sie ein Label-Websteuerelement am oberen Rand der Seite mit dem Namen `ConcurrencyViolationMessage` , deren `Text` Eigenschaft zeigt die folgende Meldung: Sie haben versucht, aktualisieren oder Löschen eines Datensatzes, die gleichzeitig von einem anderen Benutzer aktualisiert wurde.</span><span class="sxs-lookup"><span data-stu-id="a72b9-226">To alert the user, let s add a Label Web control to the top of the page named `ConcurrencyViolationMessage` whose `Text` property displays the following message: You have attempted to update or delete a record that was simultaneously updated by another user.</span></span> <span data-ttu-id="a72b9-227">Bitte überprüfen Sie die Änderungen des anderen Benutzers und klicken Sie dann wiederholen Sie die Aktualisierung oder löschen.</span><span class="sxs-lookup"><span data-stu-id="a72b9-227">Please review the other user's changes and then redo your update or delete.</span></span> <span data-ttu-id="a72b9-228">Legen Sie das Label-Steuerelement s `CssClass` Eigenschaft in "Warnung", also eine CSS-Klasse definiert, `Styles.css` , die Text in Rot, kursiv, fett und große Schriftart anzeigt.</span><span class="sxs-lookup"><span data-stu-id="a72b9-228">Set the Label control s `CssClass` property to Warning, which is a CSS class defined in `Styles.css` that displays text in a red, italic, bold, and large font.</span></span> <span data-ttu-id="a72b9-229">Legen Sie schließlich die Bezeichnung s `Visible` und `EnableViewState` Eigenschaften `False`.</span><span class="sxs-lookup"><span data-stu-id="a72b9-229">Finally, set the Label s `Visible` and `EnableViewState` properties to `False`.</span></span> <span data-ttu-id="a72b9-230">Dadurch wird die Bezeichnung mit Ausnahme von nur diejenigen, in denen wir explizit festgelegt, Postbacks ausgeblendet seine `Visible` Eigenschaft `True`.</span><span class="sxs-lookup"><span data-stu-id="a72b9-230">This will hide the Label except for only those postbacks where we explicitly set its `Visible` property to `True`.</span></span>


<span data-ttu-id="a72b9-231">[![Fügen Sie ein Bezeichnungsfeld-Steuerelement zur Seite, um die Warnung anzeigen](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image8.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="a72b9-231">[![Add a Label Control to the Page to Display the Warning](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image8.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image13.png)</span></span>

<span data-ttu-id="a72b9-232">**Abbildung 8**: Fügen Sie ein Bezeichnungsfeld-Steuerelement zur Seite, um die Warnung angezeigt ([klicken Sie hier, um das Bild in voller Größe angezeigt](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image14.png))</span><span class="sxs-lookup"><span data-stu-id="a72b9-232">**Figure 8**: Add a Label Control to the Page to Display the Warning ([Click to view full-size image](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image14.png))</span></span>


<span data-ttu-id="a72b9-233">Beim Ausführen eines Updates oder löschen, die GridView s `RowUpdated` und `RowDeleted` Ereignishandler ausgelöst werden, nachdem die Datenquellen-Steuerelements die angeforderte Update- oder Delete ausgeführt hat.</span><span class="sxs-lookup"><span data-stu-id="a72b9-233">When performing an update or delete, the GridView s `RowUpdated` and `RowDeleted` event handlers fire after its data source control has performed the requested update or delete.</span></span> <span data-ttu-id="a72b9-234">Wir können bestimmen, wie viele Zeilen durch den Vorgang aus dieser Ereignishandler betroffen sind.</span><span class="sxs-lookup"><span data-stu-id="a72b9-234">We can determine how many rows were affected by the operation from these event handlers.</span></span> <span data-ttu-id="a72b9-235">Wenn 0 Zeilen betroffen sind, möchten wir Anzeigen der `ConcurrencyViolationMessage` Bezeichnung.</span><span class="sxs-lookup"><span data-stu-id="a72b9-235">If zero rows were affected, we want to display the `ConcurrencyViolationMessage` Label.</span></span>

<span data-ttu-id="a72b9-236">Erstellen Sie einen Ereignishandler für beide die `RowUpdated` und `RowDeleted` Ereignisse und fügen Sie den folgenden Code hinzu:</span><span class="sxs-lookup"><span data-stu-id="a72b9-236">Create an event handler for both the `RowUpdated` and `RowDeleted` events and add the following code:</span></span>


[!code-vb[Main](implementing-optimistic-concurrency-with-the-sqldatasource-vb/samples/sample11.vb)]

<span data-ttu-id="a72b9-237">In beiden Ereignishandler überprüfen wir das `e.AffectedRows` Eigenschaft und, wenn er gleich 0 ist, legen Sie die `ConcurrencyViolationMessage` Bezeichnung s `Visible` Eigenschaft `True`.</span><span class="sxs-lookup"><span data-stu-id="a72b9-237">In both event handlers we check the `e.AffectedRows` property and, if it equals 0, set the `ConcurrencyViolationMessage` Label s `Visible` property to `True`.</span></span> <span data-ttu-id="a72b9-238">In der `RowUpdated` Ereignishandler, d. h. es auch festlegen, dass die GridView im Bearbeitungsmodus befinden muss, durch Festlegen der `KeepInEditMode` Eigenschaft auf "true".</span><span class="sxs-lookup"><span data-stu-id="a72b9-238">In the `RowUpdated` event handler, we also instruct the GridView to stay in edit mode by setting the `KeepInEditMode` property to true.</span></span> <span data-ttu-id="a72b9-239">In diesem Fall müssen wir die Daten in den Entwurfsbereich zu binden, damit die anderen s Benutzerdaten in die Bearbeitungsoberfläche geladen werden.</span><span class="sxs-lookup"><span data-stu-id="a72b9-239">In doing so, we need to rebind the data to the grid so that the other user s data is loaded into the editing interface.</span></span> <span data-ttu-id="a72b9-240">Dies erfolgt durch Aufrufen der GridView s `DataBind()` Methode.</span><span class="sxs-lookup"><span data-stu-id="a72b9-240">This is accomplished by calling the GridView s `DataBind()` method.</span></span>

<span data-ttu-id="a72b9-241">Wie in Abbildung 9 gezeigt, mit diesen beiden Ereignishandler wird eine äußerst bemerkenswerten Meldung angezeigt, wenn eine parallelitätsverletzung liegt vor.</span><span class="sxs-lookup"><span data-stu-id="a72b9-241">As Figure 9 shows, with these two event handlers, a very noticeable message is displayed whenever a concurrency violation occurs.</span></span>


<span data-ttu-id="a72b9-242">[![Bei einer Parallelitätsverletzung wird eine Meldung angezeigt.](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image9.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="a72b9-242">[![A Message is Displayed in the Face of a Concurrency Violation](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image9.gif)](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image15.png)</span></span>

<span data-ttu-id="a72b9-243">**Abbildung 9**: eine Meldung wird angezeigt, bei einer Parallelitätsverletzung ([klicken Sie hier, um das Bild in voller Größe angezeigt](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image16.png))</span><span class="sxs-lookup"><span data-stu-id="a72b9-243">**Figure 9**: A Message is Displayed in the Face of a Concurrency Violation ([Click to view full-size image](implementing-optimistic-concurrency-with-the-sqldatasource-vb/_static/image16.png))</span></span>


## <a name="summary"></a><span data-ttu-id="a72b9-244">Zusammenfassung</span><span class="sxs-lookup"><span data-stu-id="a72b9-244">Summary</span></span>

<span data-ttu-id="a72b9-245">Beim Erstellen einer Webanwendung, in denen mehrere, gleichzeitige Benutzer möglicherweise die gleichen Daten bearbeiten es ist wichtig, die Parallelität Steuerelementoptionen in Betracht ziehen.</span><span class="sxs-lookup"><span data-stu-id="a72b9-245">When creating a web application where multiple, concurrent users may be editing the same data, it is important to consider concurrency control options.</span></span> <span data-ttu-id="a72b9-246">Standardmäßig die Websteuerelemente ASP.NET-Daten und die Datenquellen-Steuerelementen parallelitätssteuerung nicht berücksichtigt.</span><span class="sxs-lookup"><span data-stu-id="a72b9-246">By default, the ASP.NET data Web controls and data source controls do not employ any concurrency control.</span></span> <span data-ttu-id="a72b9-247">Wie wir in diesem Lernprogramm gesehen haben, ist die Implementierung die Steuerung durch vollständige Parallelität mit der SqlDataSource relativ schnell und einfach.</span><span class="sxs-lookup"><span data-stu-id="a72b9-247">As we saw in this tutorial, implementing optimistic concurrency control with the SqlDataSource is relatively quick and easy.</span></span> <span data-ttu-id="a72b9-248">Die SqlDataSource behandelt Großteil der Arbeit für Ihre hinzufügen, sodass die erweiterte `WHERE` -Klauseln zum automatisch generierten `UPDATE` und `DELETE` Anweisungen, aber es sind einige Besonderheiten zur Behandlung `NULL` Wert Spalten, wie beschrieben in der Ordnungsgemäßen Behandlung von `NULL` Abschnitt-Werte.</span><span class="sxs-lookup"><span data-stu-id="a72b9-248">The SqlDataSource handles most of the legwork for your adding augmented `WHERE` clauses to the autogenerated `UPDATE` and `DELETE` statements but there are a few subtleties in handling `NULL` value columns, as discussed in the Correctly Handling `NULL` Values section.</span></span>

<span data-ttu-id="a72b9-249">In diesem Lernprogramm wird unsere Untersuchung der SqlDataSource abgeschlossen.</span><span class="sxs-lookup"><span data-stu-id="a72b9-249">This tutorial concludes our examination of the SqlDataSource.</span></span> <span data-ttu-id="a72b9-250">Unsere verbleibenden Lernprogramme werden zurückgegeben, für die Arbeit mit Daten mit dem ObjectDataSource und Tier-Architektur.</span><span class="sxs-lookup"><span data-stu-id="a72b9-250">Our remaining tutorials will return to working with data using the ObjectDataSource and tiered architecture.</span></span>

<span data-ttu-id="a72b9-251">Viel Spaß beim Programmieren!</span><span class="sxs-lookup"><span data-stu-id="a72b9-251">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="a72b9-252">Informationen zum Autor</span><span class="sxs-lookup"><span data-stu-id="a72b9-252">About the Author</span></span>

<span data-ttu-id="a72b9-253">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), Autor von sieben ASP/ASP.NET-Büchern und Gründer von [4GuysFromRolla.com](http://www.4guysfromrolla.com), Microsoft Web-Technologien seit 1998 arbeitet.</span><span class="sxs-lookup"><span data-stu-id="a72b9-253">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="a72b9-254">Scott fungiert als ein unabhängiger Berater, Trainer und Writer.</span><span class="sxs-lookup"><span data-stu-id="a72b9-254">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="a72b9-255">Sein neueste Buch wird [ *Sams Schulen selbst ASP.NET 2.0 in 24 Stunden*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="a72b9-255">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="a72b9-256">Er die erreicht werden kann, zur [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) oder über seinen Blog die finden Sie unter [ http://ScottOnWriting.NET ](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="a72b9-256">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="a72b9-257">Vorherige</span><span class="sxs-lookup"><span data-stu-id="a72b9-257">Previous</span></span>](inserting-updating-and-deleting-data-with-the-sqldatasource-vb.md)
