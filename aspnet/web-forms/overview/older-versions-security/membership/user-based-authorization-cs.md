---
uid: web-forms/overview/older-versions-security/membership/user-based-authorization-cs
title: Benutzerbasierte Autorisierung (c#) | Microsoft Docs
author: rick-anderson
description: In diesem Lernprogramm betrachten wir Beschränken des Zugriffs auf Seiten und Seitenebene-Funktionalität über eine Vielzahl von Techniken einschränken.
ms.author: aspnetcontent
manager: wpickett
ms.date: 01/18/2008
ms.topic: article
ms.assetid: 3c815a9e-2296-4b9b-b945-776d54989daa
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/older-versions-security/membership/user-based-authorization-cs
msc.type: authoredcontent
ms.openlocfilehash: 9a0d476ffaf1f176c21b245520fa943f66e8c0d5
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 04/10/2018
---
<a name="user-based-authorization-c"></a><span data-ttu-id="53b7f-103">Benutzerbasierte Autorisierung (c#)</span><span class="sxs-lookup"><span data-stu-id="53b7f-103">User-Based Authorization (C#)</span></span>
====================
<span data-ttu-id="53b7f-104">durch [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="53b7f-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="53b7f-105">[Herunterladen von Code](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/ASPNET_Security_Tutorial_07_CS.zip) oder [PDF herunterladen](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/aspnet_tutorial07_UserAuth_cs.pdf)</span><span class="sxs-lookup"><span data-stu-id="53b7f-105">[Download Code](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/ASPNET_Security_Tutorial_07_CS.zip) or [Download PDF](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/aspnet_tutorial07_UserAuth_cs.pdf)</span></span>

> <span data-ttu-id="53b7f-106">In diesem Lernprogramm betrachten wir Beschränken des Zugriffs auf Seiten und Seitenebene-Funktionalität über eine Vielzahl von Techniken einschränken.</span><span class="sxs-lookup"><span data-stu-id="53b7f-106">In this tutorial we will look at limiting access to pages and restricting page-level functionality through a variety of techniques.</span></span>


## <a name="introduction"></a><span data-ttu-id="53b7f-107">Einführung</span><span class="sxs-lookup"><span data-stu-id="53b7f-107">Introduction</span></span>

<span data-ttu-id="53b7f-108">Die meisten Webanwendungen, die Benutzerkonten bieten holen Sie dies im Webpart bestimmte Besucher den Zugriff auf bestimmte Seiten innerhalb der Website einschränken.</span><span class="sxs-lookup"><span data-stu-id="53b7f-108">Most web applications that offer user accounts do so in part to restrict certain visitors from accessing certain pages within the site.</span></span> <span data-ttu-id="53b7f-109">In den meisten online Diskussionsforum ein Standorten z. B. alle Benutzer - anonyme als auch authentifizierte - Diskussionsforum vorhanden ist, wird die ein Beiträge anzeigen werden, aber nur authentifizierte Benutzer besuchen der Webseite, um eine neue Bereitstellung erstellen.</span><span class="sxs-lookup"><span data-stu-id="53b7f-109">In most online messageboard sites, for example, all users - anonymous and authenticated - are able to view the messageboard's posts, but only authenticated users can visit the web page to create a new post.</span></span> <span data-ttu-id="53b7f-110">Und möglicherweise Administratorseiten, die nur für einen bestimmten Benutzer (oder eine bestimmte Gruppe von Benutzern) zugänglich sind.</span><span class="sxs-lookup"><span data-stu-id="53b7f-110">And there may be administrative pages that are only accessible to a particular user (or a particular set of users).</span></span> <span data-ttu-id="53b7f-111">Darüber hinaus kann auf Seitenebene Funktionalität auf Basis von Benutzer unterscheiden.</span><span class="sxs-lookup"><span data-stu-id="53b7f-111">Moreover, page-level functionality can differ on a user-by-user basis.</span></span> <span data-ttu-id="53b7f-112">Beim Anzeigen einer Liste der Beiträge werden authentifizierte Benutzern eine Schnittstelle für die Bewertung jedes Post angezeigt, während diese Schnittstelle nicht anonyme Besucher verfügbar ist.</span><span class="sxs-lookup"><span data-stu-id="53b7f-112">When viewing a list of posts, authenticated users are shown an interface for rating each post, whereas this interface is not available to anonymous visitors.</span></span>

<span data-ttu-id="53b7f-113">ASP.NET vereinfacht die Benutzer-basierten Autorisierungsregeln zu definieren.</span><span class="sxs-lookup"><span data-stu-id="53b7f-113">ASP.NET makes it easy to define user-based authorization rules.</span></span> <span data-ttu-id="53b7f-114">Mit nur einem gewissen Grad Markup in `Web.config`, bestimmte Webseiten oder vollständigen Verzeichnissen können werden gesperrt, damit sie nur für eine angegebene Teilmenge von Benutzern zugänglich sind.</span><span class="sxs-lookup"><span data-stu-id="53b7f-114">With just a bit of markup in `Web.config`, specific web pages or entire directories can be locked down so that they are only accessible to a specified subset of users.</span></span> <span data-ttu-id="53b7f-115">Seitenebene Funktionalität kann ein- oder ausschalten basierend auf den aktuell angemeldeten Benutzers programmgesteuerte und deklarative Weise aktiviert werden.</span><span class="sxs-lookup"><span data-stu-id="53b7f-115">Page-level functionality can be turned on or off based on the currently logged in user through programmatic and declarative means.</span></span>

<span data-ttu-id="53b7f-116">In diesem Lernprogramm betrachten wir Beschränken des Zugriffs auf Seiten und Seitenebene-Funktionalität über eine Vielzahl von Techniken einschränken.</span><span class="sxs-lookup"><span data-stu-id="53b7f-116">In this tutorial we will look at limiting access to pages and restricting page-level functionality through a variety of techniques.</span></span> <span data-ttu-id="53b7f-117">Fangen wir an!</span><span class="sxs-lookup"><span data-stu-id="53b7f-117">Let's get started!</span></span>

## <a name="a-look-at-the-url-authorization-workflow"></a><span data-ttu-id="53b7f-118">Ein Blick auf den URL-Autorisierung-Workflow</span><span class="sxs-lookup"><span data-stu-id="53b7f-118">A Look at the URL Authorization Workflow</span></span>

<span data-ttu-id="53b7f-119">Entsprechend der Anleitung unter dem [ *eine Übersicht der Formularauthentifizierung* ](../introduction/an-overview-of-forms-authentication-cs.md) Lernprogramm, wenn die ASP.NET-Laufzeit eine Anforderung verarbeitet, für eine ASP.NET-Ressource die Anforderung eine Anzahl von Ereignissen während des Lebenszyklus löst.</span><span class="sxs-lookup"><span data-stu-id="53b7f-119">As discussed in the [*An Overview of Forms Authentication*](../introduction/an-overview-of-forms-authentication-cs.md) tutorial, when the ASP.NET runtime processes a request for an ASP.NET resource the request raises a number of events during its lifecycle.</span></span> <span data-ttu-id="53b7f-120">*HTTP-Module* verwaltete Klassen, deren Code wird als Reaktion auf ein bestimmtes Ereignis am Anforderungslebenszyklus ausgeführt, werden.</span><span class="sxs-lookup"><span data-stu-id="53b7f-120">*HTTP Modules* are managed classes whose code is executed in response to a particular event in the request lifecycle.</span></span> <span data-ttu-id="53b7f-121">Im Lieferumfang von ASP.NET sind einer Anzahl von HTTP-Module, die wichtige Aufgaben im Hintergrund ausführen.</span><span class="sxs-lookup"><span data-stu-id="53b7f-121">ASP.NET ships with a number of HTTP Modules that perform essential tasks behind the scenes.</span></span>

<span data-ttu-id="53b7f-122">Eine HTTP-Modul ist [ `FormsAuthenticationModule` ](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx).</span><span class="sxs-lookup"><span data-stu-id="53b7f-122">One such HTTP Module is [`FormsAuthenticationModule`](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx).</span></span> <span data-ttu-id="53b7f-123">Wie im vorherigen Lernprogrammen, die primäre Funktion des erläutert die `FormsAuthenticationModule` besteht darin, die Identität des die aktuelle Anforderung festzulegen.</span><span class="sxs-lookup"><span data-stu-id="53b7f-123">As discussed in previous tutorials, the primary function of the `FormsAuthenticationModule` is to determine the identity of the current request.</span></span> <span data-ttu-id="53b7f-124">Dies geschieht durch Überprüfen das Formularauthentifizierungsticket, mit denen in einem Cookie gespeichert oder in die URL eingebettet ist.</span><span class="sxs-lookup"><span data-stu-id="53b7f-124">This is accomplished by inspecting the forms authentication ticket, which is either located in a cookie or embedded within the URL.</span></span> <span data-ttu-id="53b7f-125">Diese Identifikation findet während der [ `AuthenticateRequest` Ereignis](https://msdn.microsoft.com/library/system.web.httpapplication.authenticaterequest.aspx).</span><span class="sxs-lookup"><span data-stu-id="53b7f-125">This identification takes place during the [`AuthenticateRequest` event](https://msdn.microsoft.com/library/system.web.httpapplication.authenticaterequest.aspx).</span></span>

<span data-ttu-id="53b7f-126">Ein anderes wichtig HTTP-Modul ist die [ `UrlAuthorizationModule` ](https://msdn.microsoft.com/library/system.web.security.urlauthorizationmodule.aspx), dem wird ausgelöst, als Antwort auf die [ `AuthorizeRequest` Ereignis](https://msdn.microsoft.com/library/system.web.httpapplication.authorizerequest.aspx) (die geschieht nach der `AuthenticateRequest` Ereignis).</span><span class="sxs-lookup"><span data-stu-id="53b7f-126">Another important HTTP Module is the [`UrlAuthorizationModule`](https://msdn.microsoft.com/library/system.web.security.urlauthorizationmodule.aspx), which is raised in response to the [`AuthorizeRequest` event](https://msdn.microsoft.com/library/system.web.httpapplication.authorizerequest.aspx) (which happens after the `AuthenticateRequest` event).</span></span> <span data-ttu-id="53b7f-127">Die `UrlAuthorizationModule` untersucht Konfiguration Markup in `Web.config` bestimmen, ob die Identität des aktuelle Autorität für die angegebene Seite besuchen verfügt.</span><span class="sxs-lookup"><span data-stu-id="53b7f-127">The `UrlAuthorizationModule` examines configuration markup in `Web.config` to determine whether the current identity has authority to visit the specified page.</span></span> <span data-ttu-id="53b7f-128">Dieser Prozess wird als bezeichnet *URL-Autorisierung*.</span><span class="sxs-lookup"><span data-stu-id="53b7f-128">This process is referred to as *URL authorization*.</span></span>

<span data-ttu-id="53b7f-129">Untersucht die Syntax für die URL-Autorisierungsregeln in Schritt 1, aber zuerst wir sehen Sie sich, was die `UrlAuthorizationModule` ist abhängig davon, ob die Anforderung oder nicht autorisiert ist.</span><span class="sxs-lookup"><span data-stu-id="53b7f-129">We'll examine the syntax for the URL authorization rules in Step 1, but first let's look at what the `UrlAuthorizationModule` does depending on whether the request is authorized or not.</span></span> <span data-ttu-id="53b7f-130">Wenn die `UrlAuthorizationModule` feststellt, dass die Anforderung autorisiert ist, es keine Aktion ausgeführt wird, und die Anforderung wird, während des Lebenszyklus fortgesetzt.</span><span class="sxs-lookup"><span data-stu-id="53b7f-130">If the `UrlAuthorizationModule` determines that the request is authorized, then it does nothing, and the request continues through its lifecycle.</span></span> <span data-ttu-id="53b7f-131">Allerdings ist die Anforderung *nicht* autorisiert, und dann die `UrlAuthorizationModule` bricht den Lebenszyklus und weist die `Response` zurückzugebenden Objekts ein [HTTP 401 Unauthorized](http://www.checkupdown.com/status/E401.html) Status.</span><span class="sxs-lookup"><span data-stu-id="53b7f-131">However, if the request is *not* authorized, then the `UrlAuthorizationModule` aborts the lifecycle and instructs the `Response` object to return an [HTTP 401 Unauthorized](http://www.checkupdown.com/status/E401.html) status.</span></span> <span data-ttu-id="53b7f-132">Bei Verwendung der Formularauthentifizierung dieser HTTP 401-Status wird nie zurückgegeben, an den Client da Wenn die `FormsAuthenticationModule` erkennt HTTP 401 wird der Status ändert, ein [HTTP 302-Umleitung](http://www.checkupdown.com/status/E302.html) zur Anmeldeseite.</span><span class="sxs-lookup"><span data-stu-id="53b7f-132">When using forms authentication this HTTP 401 status is never returned to the client because if the `FormsAuthenticationModule` detects an HTTP 401 status is modifies it to an [HTTP 302 Redirect](http://www.checkupdown.com/status/E302.html) to the login page.</span></span>

<span data-ttu-id="53b7f-133">Abbildung 1 veranschaulicht den Workflow der ASP.NET-Pipeline die `FormsAuthenticationModule`, und die `UrlAuthorizationModule` bei eine nicht autorisierte Anforderung eingeht.</span><span class="sxs-lookup"><span data-stu-id="53b7f-133">Figure 1 illustrates the workflow of the ASP.NET pipeline, the `FormsAuthenticationModule`, and the `UrlAuthorizationModule` when an unauthorized request arrives.</span></span> <span data-ttu-id="53b7f-134">Abbildung 1 zeigt eine Anforderung von einem anonymen Besucher für `ProtectedPage.aspx`, die eine Seite, die für anonyme Benutzer den Zugriff verweigert wird.</span><span class="sxs-lookup"><span data-stu-id="53b7f-134">In particular, Figure 1 shows a request by an anonymous visitor for `ProtectedPage.aspx`, which is a page that denies access to anonymous users.</span></span> <span data-ttu-id="53b7f-135">Da der Besucher anonym ist, wird die `UrlAuthorizationModule` bricht die Anforderung ab und gibt einen HTTP 401 Unauthorized Status zurück.</span><span class="sxs-lookup"><span data-stu-id="53b7f-135">Since the visitor is anonymous, the `UrlAuthorizationModule` aborts the request and returns an HTTP 401 Unauthorized status.</span></span> <span data-ttu-id="53b7f-136">Die `FormsAuthenticationModule` 401 Status wird dann in eine 302-Umleitung Anmeldeseite konvertiert.</span><span class="sxs-lookup"><span data-stu-id="53b7f-136">The `FormsAuthenticationModule` then converts the 401 status into a 302 Redirect to login page.</span></span> <span data-ttu-id="53b7f-137">Nach der Authentifizierung des Benutzers über die Anmeldeseite umgeleitet `ProtectedPage.aspx`.</span><span class="sxs-lookup"><span data-stu-id="53b7f-137">After the user is authenticated via the login page, he is redirected to `ProtectedPage.aspx`.</span></span> <span data-ttu-id="53b7f-138">Dieses Mal die `FormsAuthenticationModule` identifiziert den Benutzer basierend auf seinem Authentifizierungsticket.</span><span class="sxs-lookup"><span data-stu-id="53b7f-138">This time the `FormsAuthenticationModule` identifies the user based on his authentication ticket.</span></span> <span data-ttu-id="53b7f-139">Nun, dass der Besucher authentifiziert wird, die `UrlAuthorizationModule` ermöglicht den Zugriff auf die Seite.</span><span class="sxs-lookup"><span data-stu-id="53b7f-139">Now that the visitor is authenticated, the `UrlAuthorizationModule` permits access to the page.</span></span>


<span data-ttu-id="53b7f-140">[![Die Formularauthentifizierung und URL-Autorisierung-Workflow](user-based-authorization-cs/_static/image2.png)](user-based-authorization-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="53b7f-140">[![The Forms Authentication and URL Authorization Workflow](user-based-authorization-cs/_static/image2.png)](user-based-authorization-cs/_static/image1.png)</span></span>

<span data-ttu-id="53b7f-141">**Abbildung 1**: die Formularauthentifizierung und Workflow für URL-Autorisierung ([klicken Sie hier, um das Bild in voller Größe angezeigt](user-based-authorization-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="53b7f-141">**Figure 1**: The Forms Authentication and URL Authorization Workflow  ([Click to view full-size image](user-based-authorization-cs/_static/image3.png))</span></span>


<span data-ttu-id="53b7f-142">Abbildung 1 zeigt die Aktivität, die auftritt, wenn ein anonyme Besucher versucht, auf eine Ressource zuzugreifen, die nicht für anonyme Benutzer verfügbar ist.</span><span class="sxs-lookup"><span data-stu-id="53b7f-142">Figure 1 depicts the interaction that occurs when an anonymous visitor attempts to access a resource that is not available to anonymous users.</span></span> <span data-ttu-id="53b7f-143">In einem solchen Fall wird der anonyme Besucher zur Anmeldeseite mit der Seite umgeleitet, die sie in der Abfragezeichenfolge angegebene besuchen wollten.</span><span class="sxs-lookup"><span data-stu-id="53b7f-143">In such a case, the anonymous visitor is redirected to the login page with the page she attempted to visit specified in the querystring.</span></span> <span data-ttu-id="53b7f-144">Sobald der Benutzer erfolgreich angemeldet hat, wird er automatisch wieder auf die Ressource umgeleitet werden, die sie ursprünglich wollte anzeigen.</span><span class="sxs-lookup"><span data-stu-id="53b7f-144">Once the user has successfully logged on, she will be automatically redirected back to the resource she was initially attempting to view.</span></span>

<span data-ttu-id="53b7f-145">Wenn nicht autorisierte Anforderung durch einen anonymen Benutzer hergestellt wird, wird dieser Workflow ist einfach und ist für den Besucher zu verstehen, was geschehen ist einfach und deren Ursachen.</span><span class="sxs-lookup"><span data-stu-id="53b7f-145">When the unauthorized request is made by an anonymous user, this workflow is straightforward and is easy for the visitor to understand what has happened and why.</span></span> <span data-ttu-id="53b7f-146">Jedoch behalten in ausmacht, die der `FormsAuthenticationModule` leitet *alle* nicht autorisierte Benutzer die Anmeldeseite, selbst wenn von einem authentifizierten Benutzer angefordert wird.</span><span class="sxs-lookup"><span data-stu-id="53b7f-146">But keep in mind that the `FormsAuthenticationModule` will redirect *any* unauthorized user to the login page, even if the request is made by an authenticated user.</span></span> <span data-ttu-id="53b7f-147">Dies kann zu einer verwirrend Benutzeroberfläche führen, wenn ein authentifizierter Benutzer versucht, eine Website besuchen, für die sie die Autorität für die fehlt.</span><span class="sxs-lookup"><span data-stu-id="53b7f-147">This can result in a confusing user experience if an authenticated user attempts to visit a page for which she lacks authority.</span></span>

<span data-ttu-id="53b7f-148">Stellen Sie sich vor, dass unsere Website der URL-Autorisierungsregeln konfiguriert wurde, dass der ASP.NET-Seite `OnlyTito.aspx` Zugriff nur für Tito wurde.</span><span class="sxs-lookup"><span data-stu-id="53b7f-148">Imagine that our website had its URL authorization rules configured such that the ASP.NET page `OnlyTito.aspx` was accessibly only to Tito.</span></span> <span data-ttu-id="53b7f-149">Angenommen, dass Sam die Website besucht anmeldet, und anschließend versucht, besuchen `OnlyTito.aspx`.</span><span class="sxs-lookup"><span data-stu-id="53b7f-149">Now, imagine that Sam visits the site, logs on, and then attempts to visit `OnlyTito.aspx`.</span></span> <span data-ttu-id="53b7f-150">Die `UrlAuthorizationModule` hält am Anforderungslebenszyklus und eine HTTP 401 Unauthorized Rückgabestatus, der die `FormsAuthenticationModule` erkennt, und klicken Sie dann Sam zur Anmeldeseite umgeleitet.</span><span class="sxs-lookup"><span data-stu-id="53b7f-150">The `UrlAuthorizationModule` will halt the request lifecycle and return an HTTP 401 Unauthorized status, which the `FormsAuthenticationModule` will detect and then redirect Sam to the login page.</span></span> <span data-ttu-id="53b7f-151">Da Sam bereits angemeldet hat, aber sie sich vielleicht, warum er wieder zur Anmeldeseite gesendet wurde.</span><span class="sxs-lookup"><span data-stu-id="53b7f-151">Since Sam has already logged in, though, she may wonder why she has been sent back to the login page.</span></span> <span data-ttu-id="53b7f-152">Sie können Grund, dass ihre Anmeldeinformationen aus irgendeinem Grund verloren gegangen sind oder dass er ungültige Anmeldeinformationen eingegeben haben.</span><span class="sxs-lookup"><span data-stu-id="53b7f-152">She might reason that her login credentials were lost somehow, or that she entered invalid credentials.</span></span> <span data-ttu-id="53b7f-153">Wenn Sam seiner Anmeldeinformationen auf der Anmeldeseite erneut sie protokolliert auf (erneut) und umgeleitet zu `OnlyTito.aspx`.</span><span class="sxs-lookup"><span data-stu-id="53b7f-153">If Sam reenters her credentials from the login page she will be logged on (again) and redirected to `OnlyTito.aspx`.</span></span> <span data-ttu-id="53b7f-154">Die `UrlAuthorizationModule` erkennt, dass Sam kann nicht auf dieser Seite besuchen, und sie zur Anmeldeseite zurückgegeben werden werden.</span><span class="sxs-lookup"><span data-stu-id="53b7f-154">The `UrlAuthorizationModule` will detect that Sam cannot visit this page and she will be returned to the login page.</span></span>

<span data-ttu-id="53b7f-155">Abbildung 2 zeigt dieses verwirrend Workflows.</span><span class="sxs-lookup"><span data-stu-id="53b7f-155">Figure 2 depicts this confusing workflow.</span></span>


<span data-ttu-id="53b7f-156">[![Standardworkflow kann zu einem Zyklus verwirrend führen.](user-based-authorization-cs/_static/image5.png)](user-based-authorization-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="53b7f-156">[![The Default Workflow Can Lead to a Confusing Cycle](user-based-authorization-cs/_static/image5.png)](user-based-authorization-cs/_static/image4.png)</span></span>

<span data-ttu-id="53b7f-157">**Abbildung 2**: der Standard Workflow kann führen zu einem Zyklus verwirrend erscheinen ([klicken Sie hier, um das Bild in voller Größe angezeigt](user-based-authorization-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="53b7f-157">**Figure 2**: The Default Workflow Can Lead to a Confusing Cycle  ([Click to view full-size image](user-based-authorization-cs/_static/image6.png))</span></span>


<span data-ttu-id="53b7f-158">Der Workflow in Abbildung 2 dargestellten kann auch die meisten Computer clevere Besucher schnell befuddle.</span><span class="sxs-lookup"><span data-stu-id="53b7f-158">The workflow illustrated in Figure 2 can quickly befuddle even the most computer savvy visitor.</span></span> <span data-ttu-id="53b7f-159">Wir werden die Möglichkeiten, dies zu verhindern, dass verwirrend erscheinen Zyklus in Schritt2 betrachten.</span><span class="sxs-lookup"><span data-stu-id="53b7f-159">We will look at ways to prevent this confusing cycle in Step 2.</span></span>

> [!NOTE]
> <span data-ttu-id="53b7f-160">ASP.NET verwendet zwei Mechanismen, um zu bestimmen, ob der aktuelle Benutzer eine bestimmte Webseite zugreifen kann: URL-Autorisierung und Autorisierung.</span><span class="sxs-lookup"><span data-stu-id="53b7f-160">ASP.NET uses two mechanisms to determine whether the current user can access a particular web page: URL authorization and file authorization.</span></span> <span data-ttu-id="53b7f-161">Autorisierung wird implementiert, indem die [ `FileAuthorizationModule` ](https://msdn.microsoft.com/library/system.web.security.fileauthorizationmodule.aspx), der Autorität für die bestimmt, indem Sie die angeforderten Dateien ACLs lesen.</span><span class="sxs-lookup"><span data-stu-id="53b7f-161">File authorization is implemented by the [`FileAuthorizationModule`](https://msdn.microsoft.com/library/system.web.security.fileauthorizationmodule.aspx), which determines authority by consulting the requested file(s) ACLs.</span></span> <span data-ttu-id="53b7f-162">Autorisierung wird am häufigsten mit Windows-Authentifizierung verwendet, da ACLs Berechtigungen sind, die für Windows-Konten gelten.</span><span class="sxs-lookup"><span data-stu-id="53b7f-162">File authorization is most commonly used with Windows authentication because ACLs are permissions that apply to Windows accounts.</span></span> <span data-ttu-id="53b7f-163">Wenn Sie die Formularauthentifizierung verwenden, werden alle Betriebssystem- und den Dateinamen auf Systemebene Anforderungen von dem gleichen Windows-Konto, unabhängig von der Website für den Benutzer ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="53b7f-163">When using forms authentication, all operating system- and file system-level requests are executed by the same Windows account, regardless of the user visiting the site.</span></span> <span data-ttu-id="53b7f-164">Da diese Reihe von Lernprogrammen Formularauthentifizierung konzentriert, wird es nicht dateiauthentifizierung erörtert.</span><span class="sxs-lookup"><span data-stu-id="53b7f-164">Since this tutorial series focuses on forms authentication, we will not be discussing file authorization.</span></span>


### <a name="the-scope-of-url-authorization"></a><span data-ttu-id="53b7f-165">Der Bereich der URL-Autorisierung</span><span class="sxs-lookup"><span data-stu-id="53b7f-165">The Scope of URL Authorization</span></span>

<span data-ttu-id="53b7f-166">Die `UrlAuthorizationModule` wird verwalteter Code, der die ASP.NET-Laufzeit gehört.</span><span class="sxs-lookup"><span data-stu-id="53b7f-166">The `UrlAuthorizationModule` is managed code that is part of the ASP.NET runtime.</span></span> <span data-ttu-id="53b7f-167">Vor Version 7 der Microsofts [(Internet Information Services, IIS)](https://www.iis.net/) Webserver, es wurde eine unterschiedliche Barriere zwischen IISs HTTP-Pipeline und die ASP.NET-Laufzeit Pipeline.</span><span class="sxs-lookup"><span data-stu-id="53b7f-167">Prior to version 7 of Microsoft's [Internet Information Services (IIS)](https://www.iis.net/) web server, there was a distinct barrier between IIS's HTTP pipeline and the ASP.NET runtime's pipeline.</span></span> <span data-ttu-id="53b7f-168">Kurz gesagt, in IIS 6 und früher ASP. NET `UrlAuthorizationModule` nur ausgeführt wird, wenn eine Anforderung an die ASP.NET-Laufzeit aus IIS delegiert werden kann.</span><span class="sxs-lookup"><span data-stu-id="53b7f-168">In short, in IIS 6 and earlier, ASP.NET's `UrlAuthorizationModule` only executes when a request is delegated from IIS to the ASP.NET runtime.</span></span> <span data-ttu-id="53b7f-169">Wird standardmäßig IIS selbst - statische Inhalte wie HTML-Seiten und CSS, JavaScript und Bilddateien - verarbeitet und nur Anforderungen an die ASP.NET-Laufzeit, wenn eine Seite mit der Erweiterung des aktivitätsbezeichners `.aspx`, `.asmx`, oder `.ashx` angefordert wird.</span><span class="sxs-lookup"><span data-stu-id="53b7f-169">By default, IIS processes static content itself - like HTML pages and CSS, JavaScript, and image files - and only hands off requests to the ASP.NET runtime when a page with an extension of `.aspx`, `.asmx`, or `.ashx` is requested.</span></span>

<span data-ttu-id="53b7f-170">IIS 7, ermöglicht jedoch integrierten IIS und ASP.NET Pipelines.</span><span class="sxs-lookup"><span data-stu-id="53b7f-170">IIS 7, however, allows for integrated IIS and ASP.NET pipelines.</span></span> <span data-ttu-id="53b7f-171">Einige Konfigurationseinstellungen können Sie IIS 7 aufzurufenden Einrichten der `UrlAuthorizationModule` für *alle* Clientanforderungen, was bedeutet, dass die URL-Autorisierungsregeln für Dateien eines beliebigen Typs definiert werden können.</span><span class="sxs-lookup"><span data-stu-id="53b7f-171">With a few configuration settings you can setup IIS 7 to invoke the `UrlAuthorizationModule` for *all* requests, meaning that URL authorization rules can be defined for files of any type.</span></span> <span data-ttu-id="53b7f-172">Darüber hinaus umfasst IIS 7 eigene URL-Autorisierung-Modul.</span><span class="sxs-lookup"><span data-stu-id="53b7f-172">Additionally, IIS 7 includes its own URL authorization engine.</span></span> <span data-ttu-id="53b7f-173">Weitere Informationen für die Integration von ASP.NET und IIS 7 des systemeigenen URL-Autorisierung-Funktionen finden Sie unter [Verständnis IIS7-URL-Autorisierung](https://www.iis.net/articles/view.aspx/IIS7/Managing-IIS7/Configuring-Security/URL-Authorization/Understanding-IIS7-URL-Authorization).</span><span class="sxs-lookup"><span data-stu-id="53b7f-173">For more information on ASP.NET integration and IIS 7's native URL authorization functionality, see [Understanding IIS7 URL Authorization](https://www.iis.net/articles/view.aspx/IIS7/Managing-IIS7/Configuring-Security/URL-Authorization/Understanding-IIS7-URL-Authorization).</span></span> <span data-ttu-id="53b7f-174">Übernehmen Sie für eine eingehendere Betrachtung ASP.NET und IIS 7-Integration, eine Kopie Shahram Khosravis Buch *Professional IIS 7 und ASP.NET integrierten Programmierung* (ISBN: 978 0470152539).</span><span class="sxs-lookup"><span data-stu-id="53b7f-174">For a more in-depth look at ASP.NET and IIS 7 integration, pick up a copy of Shahram Khosravi's book, *Professional IIS 7 and ASP.NET Integrated Programming* (ISBN: 978-0470152539).</span></span>

<span data-ttu-id="53b7f-175">Kurz gesagt, werden in Versionen vor IIS 7, URL-Autorisierungsregeln nur auf Ressourcen, die durch die ASP.NET-Laufzeit behandelt angewendet.</span><span class="sxs-lookup"><span data-stu-id="53b7f-175">In a nutshell, in versions prior to IIS 7, URL authorization rules are only applied to resources handled by the ASP.NET runtime.</span></span> <span data-ttu-id="53b7f-176">Mit IIS 7 Es kann jedoch mithilfe IISs-systemeigenen URL Authorization-Feature oder ASP zu integrieren. NET `UrlAuthorizationModule` in IISs HTTP-Pipeline, wodurch erweitern diese Funktionalität für alle Anforderungen.</span><span class="sxs-lookup"><span data-stu-id="53b7f-176">But with IIS 7 it is possible to use IIS's native URL authorization feature or to integrate ASP.NET's `UrlAuthorizationModule` into IIS's HTTP pipeline, thereby extending this functionality to all requests.</span></span>

> [!NOTE]
> <span data-ttu-id="53b7f-177">Es gibt einige geringfügige noch wichtige Unterschiede bei der Art ASP. NET `UrlAuthorizationModule` und IIS 7 URL Authorization-Feature die Autorisierungsregeln verarbeitet.</span><span class="sxs-lookup"><span data-stu-id="53b7f-177">There are some subtle yet important differences in how ASP.NET's `UrlAuthorizationModule` and IIS 7's URL authorization feature process the authorization rules.</span></span> <span data-ttu-id="53b7f-178">Dieses Lernprogramm ist nicht untersuchen, IIS 7-URL-Autorisierung Funktionen oder die Unterschiede im wie Autorisierungsregeln, die im Vergleich zum Analysieren der `UrlAuthorizationModule`.</span><span class="sxs-lookup"><span data-stu-id="53b7f-178">This tutorial does not examine IIS 7's URL authorization functionality or the differences in how it parses authorization rules compared to the `UrlAuthorizationModule`.</span></span> <span data-ttu-id="53b7f-179">Weitere Informationen zu diesen Themen finden Sie in der IIS 7-Dokumentation auf MSDN oder am [www.iis.net](https://www.iis.net/).</span><span class="sxs-lookup"><span data-stu-id="53b7f-179">For more information on these topics, refer to the IIS 7 documentation on MSDN or at [www.iis.net](https://www.iis.net/).</span></span>


## <a name="step-1-defining-url-authorization-rules-inwebconfig"></a><span data-ttu-id="53b7f-180">Schritt 1: Definieren von URL-Autorisierungsregeln in`Web.config`</span><span class="sxs-lookup"><span data-stu-id="53b7f-180">Step 1: Defining URL Authorization Rules in`Web.config`</span></span>

<span data-ttu-id="53b7f-181">Die `UrlAuthorizationModule` bestimmt, ob gewähren oder Verweigern des Zugriffs auf eine angeforderte Ressource für eine bestimmte Identität basierend auf den URL-Autorisierungsregeln, die in der Konfigurationsdatei der Anwendung definiert.</span><span class="sxs-lookup"><span data-stu-id="53b7f-181">The `UrlAuthorizationModule` determines whether to grant or deny access to a requested resource for a particular identity based on the URL authorization rules defined in the application's configuration.</span></span> <span data-ttu-id="53b7f-182">Die Autorisierungsregeln werden buchstabiert den [ `<authorization>` Element](https://msdn.microsoft.com/library/8d82143t.aspx) in Form von `<allow>` und `<deny>` untergeordnete Elemente.</span><span class="sxs-lookup"><span data-stu-id="53b7f-182">The authorization rules are spelled out in the [`<authorization>` element](https://msdn.microsoft.com/library/8d82143t.aspx) in the form of `<allow>` and `<deny>` child elements.</span></span> <span data-ttu-id="53b7f-183">Jede `<allow>` und `<deny>` untergeordnetes Element angeben kann:</span><span class="sxs-lookup"><span data-stu-id="53b7f-183">Each `<allow>` and `<deny>` child element can specify:</span></span>

- <span data-ttu-id="53b7f-184">Einen bestimmten Benutzer</span><span class="sxs-lookup"><span data-stu-id="53b7f-184">A particular user</span></span>
- <span data-ttu-id="53b7f-185">Eine durch Trennzeichen getrennte Liste von Benutzern</span><span class="sxs-lookup"><span data-stu-id="53b7f-185">A comma-delimited list of users</span></span>
- <span data-ttu-id="53b7f-186">Alle anonymen Benutzer, gekennzeichnet durch ein Fragezeichen (?)</span><span class="sxs-lookup"><span data-stu-id="53b7f-186">All anonymous users, denoted by a question mark (?)</span></span>
- <span data-ttu-id="53b7f-187">Alle Benutzer, die durch ein Sternchen gekennzeichnet (\*)</span><span class="sxs-lookup"><span data-stu-id="53b7f-187">All users, denoted by an asterisk (\*)</span></span>

<span data-ttu-id="53b7f-188">Das folgende Markup veranschaulicht, wie die URL-Autorisierungsregeln verwenden, um Benutzer Tito und Scott zulassen und verweigern alle anderen:</span><span class="sxs-lookup"><span data-stu-id="53b7f-188">The following markup illustrates how to use the URL authorization rules to allow users Tito and Scott and deny all others:</span></span>

[!code-xml[Main](user-based-authorization-cs/samples/sample1.xml)]

<span data-ttu-id="53b7f-189">Die `<allow>` -Element definiert, welche Benutzer - Tito "und" Scott - dürfen während der `<deny>` Element anweist, dass *alle* Benutzern verweigert werden.</span><span class="sxs-lookup"><span data-stu-id="53b7f-189">The `<allow>` element defines what users are permitted - Tito and Scott - while the `<deny>` element instructs that *all* users are denied.</span></span>

> [!NOTE]
> <span data-ttu-id="53b7f-190">Die `<allow>` und `<deny>` Elemente können auch die Autorisierungsregeln für Rollen angeben.</span><span class="sxs-lookup"><span data-stu-id="53b7f-190">The `<allow>` and `<deny>` elements can also specify authorization rules for roles.</span></span> <span data-ttu-id="53b7f-191">Untersuchen wir rollenbasierte Autorisierung in einem späteren Lernprogramm.</span><span class="sxs-lookup"><span data-stu-id="53b7f-191">We will examine role-based authorization in a future tutorial.</span></span>


<span data-ttu-id="53b7f-192">Die folgende Einstellung gewährt den Zugriff auf Personen, die keine Sam (einschließlich anonyme Besucher):</span><span class="sxs-lookup"><span data-stu-id="53b7f-192">The following setting grants access to anyone other than Sam (including anonymous visitors):</span></span>

[!code-xml[Main](user-based-authorization-cs/samples/sample2.xml)]

<span data-ttu-id="53b7f-193">Um nur durch authentifizierte Benutzer zu ermöglichen, verwenden Sie die folgende Konfiguration, die für alle anonymen Benutzer den Zugriff verweigert:</span><span class="sxs-lookup"><span data-stu-id="53b7f-193">To allow only authenticated users, use the following configuration, which denies access to all anonymous users:</span></span>

[!code-xml[Main](user-based-authorization-cs/samples/sample3.xml)]

<span data-ttu-id="53b7f-194">Die Autorisierungsregeln werden definiert, in der `<system.web>` Element im `Web.config` und gelten für alle Ressourcen in der Webanwendung ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="53b7f-194">The authorization rules are defined within the `<system.web>` element in `Web.config` and apply to all of the ASP.NET resources in the web application.</span></span> <span data-ttu-id="53b7f-195">Häufig, weist eine Anwendung verschiedene Autorisierungsregeln für die verschiedenen Abschnitte.</span><span class="sxs-lookup"><span data-stu-id="53b7f-195">Oftentimes, an application has different authorization rules for different sections.</span></span> <span data-ttu-id="53b7f-196">Z. B. auf einer e-Commerce-Website alle Besucher konfigurieren möglicherweise Instrumentationsdaten die Produkte, finden Sie unter Product Reviews Suchkatalog für die und so weiter.</span><span class="sxs-lookup"><span data-stu-id="53b7f-196">For example, at an eCommerce site, all visitors may peruse the products, see product reviews, search the catalog, and so on.</span></span> <span data-ttu-id="53b7f-197">Nur authentifizierte Benutzer können jedoch das Auschecken oder die Seiten zum Verwalten einer Person versandverlaufs erreicht werden.</span><span class="sxs-lookup"><span data-stu-id="53b7f-197">However, only authenticated users may reach the checkout or the pages to manage one's shipping history.</span></span> <span data-ttu-id="53b7f-198">Darüber hinaus gibt es möglicherweise Teile des Standorts, die nur Benutzer auswählen, z. B. Websiteadministratoren zugänglich sind.</span><span class="sxs-lookup"><span data-stu-id="53b7f-198">Moreover, there may be portions of the site that are only accessible by select users, such as site administrators.</span></span>

<span data-ttu-id="53b7f-199">ASP.NET vereinfacht die verschiedenen Autorisierungsregeln für verschiedene Dateien und Ordner am Standort zu definieren.</span><span class="sxs-lookup"><span data-stu-id="53b7f-199">ASP.NET makes it easy to define different authorization rules for different files and folders in the site.</span></span> <span data-ttu-id="53b7f-200">Die Autorisierungsregeln, die in des Stammordners angegebenen `Web.config` Datei anwenden, um alle ASP.NET-Ressourcen am Standort.</span><span class="sxs-lookup"><span data-stu-id="53b7f-200">The authorization rules specified in the root folder's `Web.config` file apply to all ASP.NET resources in the site.</span></span> <span data-ttu-id="53b7f-201">Allerdings können diese Standardeinstellungen für die Autorisierung für einen bestimmten Ordner überschrieben werden, durch Hinzufügen einer `Web.config` mit einem `<authorization>` Abschnitt.</span><span class="sxs-lookup"><span data-stu-id="53b7f-201">However, these default authorization settings can be overridden for a particular folder by adding a `Web.config` with an `<authorization>` section.</span></span>

<span data-ttu-id="53b7f-202">Wir aktualisieren unsere Website, sodass nur authentifizierte Benutzer in die ASP.NET-Seiten besuchen können die `Membership` Ordner.</span><span class="sxs-lookup"><span data-stu-id="53b7f-202">Let's update our website so that only authenticated users can visit the ASP.NET pages in the `Membership` folder.</span></span> <span data-ttu-id="53b7f-203">Um dies zu erreichen wir müssen einen `Web.config` Datei wird in der `Membership` Ordner, und legen Sie dessen autorisierungseinstellungen, anonyme Benutzern zu verweigern.</span><span class="sxs-lookup"><span data-stu-id="53b7f-203">To accomplish this we need to add a `Web.config` file to the `Membership` folder and set its authorization settings to deny anonymous users.</span></span> <span data-ttu-id="53b7f-204">Mit der rechten Maustaste die `Membership` Ordner im Projektmappen-Explorer, wählen Sie im Menü neues Element hinzufügen im Kontextmenü, und fügen Sie eine neue Web-Konfigurationsdatei mit dem Namen `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="53b7f-204">Right-click the `Membership` folder in the Solution Explorer, choose the Add New Item menu from the context menu, and add a new Web Configuration File named `Web.config`.</span></span>


<span data-ttu-id="53b7f-205">[![Hinzufügen einer Datei "Web.config" zu dem Ordner Mitgliedschaft](user-based-authorization-cs/_static/image8.png)](user-based-authorization-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="53b7f-205">[![Add a Web.config File to the Membership Folder](user-based-authorization-cs/_static/image8.png)](user-based-authorization-cs/_static/image7.png)</span></span>

<span data-ttu-id="53b7f-206">**Abbildung 3**: Hinzufügen einer `Web.config` Datei wird in der `Membership` Ordner ([klicken Sie hier, um das Bild in voller Größe angezeigt](user-based-authorization-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="53b7f-206">**Figure 3**: Add a `Web.config` File to the `Membership` Folder  ([Click to view full-size image](user-based-authorization-cs/_static/image9.png))</span></span>


<span data-ttu-id="53b7f-207">An diesem Punkt Komponente im Projekt sollten zwei `Web.config` Dateien: einer in das Stammverzeichnis und einen in den `Membership` Ordner.</span><span class="sxs-lookup"><span data-stu-id="53b7f-207">At this point your project should contain two `Web.config` files: one in the root directory and one in the `Membership` folder.</span></span>


<span data-ttu-id="53b7f-208">[![Die Anwendung sollte jetzt zwei "Web.config"-Dateien enthalten.](user-based-authorization-cs/_static/image11.png)](user-based-authorization-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="53b7f-208">[![Your Application Should Now Contain Two Web.config Files](user-based-authorization-cs/_static/image11.png)](user-based-authorization-cs/_static/image10.png)</span></span>

<span data-ttu-id="53b7f-209">**Abbildung 4**: Ihre Anwendung sollte jetzt zwei enthalten `Web.config` Dateien ([klicken Sie hier, um das Bild in voller Größe angezeigt](user-based-authorization-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="53b7f-209">**Figure 4**: Your Application Should Now Contain Two `Web.config` Files  ([Click to view full-size image](user-based-authorization-cs/_static/image12.png))</span></span>


<span data-ttu-id="53b7f-210">Aktualisieren Sie die Konfigurationsdatei in die `Membership` Ordner so, dass die It für anonyme Benutzer Zugriff verhindert.</span><span class="sxs-lookup"><span data-stu-id="53b7f-210">Update the configuration file in the `Membership` folder so that it prohibits access to anonymous users.</span></span>

[!code-xml[Main](user-based-authorization-cs/samples/sample4.xml)]

<span data-ttu-id="53b7f-211">Das ist alles vorhanden ist!</span><span class="sxs-lookup"><span data-stu-id="53b7f-211">That's all there is to it!</span></span>

<span data-ttu-id="53b7f-212">Um diese Änderung zu testen, finden Sie auf der Startseite in einem Browser, und stellen Sie sicher, dass Sie abgemeldet. Da das Standardverhalten einer ASP.NET-Anwendung darin besteht, alle Besucher konfigurieren können, und da wir keine Autorisierung Änderungen in des Stammverzeichnis vorgenommen haben `Web.config` -Datei werden wir können die Dateien in das Stammverzeichnis als eine anonyme Besucher besuchen.</span><span class="sxs-lookup"><span data-stu-id="53b7f-212">To test out this change, visit the homepage in a browser and make sure you are logged out. Since the default behavior of an ASP.NET application is to allow all visitors, and since we didn't make any authorization modifications to the root directory's `Web.config` file, we are able to visit the files in the root directory as an anonymous visitor.</span></span>

<span data-ttu-id="53b7f-213">Klicken Sie auf das Erstellen von Benutzerkonten in der linken Spalte gefunden.</span><span class="sxs-lookup"><span data-stu-id="53b7f-213">Click on the Creating User Accounts link found in the left column.</span></span> <span data-ttu-id="53b7f-214">Dadurch gelangen Sie zu der `~/Membership/CreatingUserAccounts.aspx`.</span><span class="sxs-lookup"><span data-stu-id="53b7f-214">This will take you to the `~/Membership/CreatingUserAccounts.aspx`.</span></span> <span data-ttu-id="53b7f-215">Da die `Web.config` in der Datei die `Membership` Ordner definiert Autorisierungsregeln, um anonymen Zugriff zu verhindern die `UrlAuthorizationModule` bricht die Anforderung ab und gibt einen HTTP 401 Unauthorized Status zurück.</span><span class="sxs-lookup"><span data-stu-id="53b7f-215">Since the `Web.config` file in the `Membership` folder defines authorization rules to prohibit anonymous access, the `UrlAuthorizationModule` aborts the request and returns an HTTP 401 Unauthorized status.</span></span> <span data-ttu-id="53b7f-216">Die `FormsAuthenticationModule` dies 302 Umleitung Status, senden uns zur Anmeldeseite ändert.</span><span class="sxs-lookup"><span data-stu-id="53b7f-216">The `FormsAuthenticationModule` modifies this to a 302 Redirect status, sending us to the login page.</span></span> <span data-ttu-id="53b7f-217">Beachten Sie, dass die Seite wir versuchen zuzugreifen (`CreatingUserAccounts.aspx`) übergeben wird, zu der Anmeldeseite über die `ReturnUrl` Querystring-Parameter.</span><span class="sxs-lookup"><span data-stu-id="53b7f-217">Note that the page we were attempting to access (`CreatingUserAccounts.aspx`) is passed to the login page via the `ReturnUrl` querystring parameter.</span></span>


<span data-ttu-id="53b7f-218">[![Seit der URL-Autorisierung Regeln verbieten anonymen Zugriff werden wir die Anmeldeseite umgeleitet](user-based-authorization-cs/_static/image14.png)](user-based-authorization-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="53b7f-218">[![Since the URL Authorization Rules Prohibit Anonymous Access, We are Redirected to the Login Page](user-based-authorization-cs/_static/image14.png)](user-based-authorization-cs/_static/image13.png)</span></span>

<span data-ttu-id="53b7f-219">**Abbildung 5**: Da die URL-Autorisierung anonymen Zugriff zulassen Regeln, werden wir zur Anmeldeseite umgeleitet ([klicken Sie hier, um das Bild in voller Größe angezeigt](user-based-authorization-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="53b7f-219">**Figure 5**: Since the URL Authorization Rules Prohibit Anonymous Access, We are Redirected to the Login Page  ([Click to view full-size image](user-based-authorization-cs/_static/image15.png))</span></span>


<span data-ttu-id="53b7f-220">Nach erfolgreich anmelden, werden wir umgeleitet die `CreatingUserAccounts.aspx` Seite.</span><span class="sxs-lookup"><span data-stu-id="53b7f-220">Upon successfully logging in, we are redirected to the `CreatingUserAccounts.aspx` page.</span></span> <span data-ttu-id="53b7f-221">Dieses Mal die `UrlAuthorizationModule` ermöglicht den Zugriff auf die Seite, da es nicht mehr anonym sind.</span><span class="sxs-lookup"><span data-stu-id="53b7f-221">This time the `UrlAuthorizationModule` permits access to the page because we are no longer anonymous.</span></span>

### <a name="applying-url-authorization-rules-to-a-specific-location"></a><span data-ttu-id="53b7f-222">Anwenden von URL-Autorisierungsregeln zu einer bestimmten Position</span><span class="sxs-lookup"><span data-stu-id="53b7f-222">Applying URL Authorization Rules to a Specific Location</span></span>

<span data-ttu-id="53b7f-223">Die autorisierungseinstellungen definiert, der `<system.web>` Abschnitt `Web.config` gelten für alle Ressourcen in diesem Verzeichnis und seinen Unterverzeichnissen ASP.NET (bis andernfalls durch eine andere überschrieben `Web.config` Datei).</span><span class="sxs-lookup"><span data-stu-id="53b7f-223">The authorization settings defined in the `<system.web>` section of `Web.config` apply to all of the ASP.NET resources in that directory and its subdirectories (until otherwise overridden by another `Web.config` file).</span></span> <span data-ttu-id="53b7f-224">In einigen Fällen können wir jedoch alle ASP.NET-Ressourcen in einem bestimmten Verzeichnis eine spezifische autorisierungskonfiguration mit Ausnahme von einer oder zwei bestimmte Seiten haben möchten.</span><span class="sxs-lookup"><span data-stu-id="53b7f-224">In some cases, though, we may want all ASP.NET resources in a given directory to have a particular authorization configuration except for one or two specific pages.</span></span> <span data-ttu-id="53b7f-225">Dies kann durch Hinzufügen einer `<location>` Element im `Web.config`, zeigen Sie ihn in die Datei, deren Autorisierungsregeln unterscheiden sich, und seine eindeutige Autorisierungsregeln darin zu definieren.</span><span class="sxs-lookup"><span data-stu-id="53b7f-225">This can be achieved by adding a `<location>` element in `Web.config`, pointing it to the file whose authorization rules differ, and defining its unique authorization rules therein.</span></span>

<span data-ttu-id="53b7f-226">Um zu veranschaulichen, mit der `<location>` Element, um die Konfigurationseinstellungen für eine bestimmte Ressource zu überschreiben, wir die autorisierungseinstellungen so anpassen, dass nur Tito besuchen kann `CreatingUserAccounts.aspx`.</span><span class="sxs-lookup"><span data-stu-id="53b7f-226">To illustrate using the `<location>` element to override the configuration settings for a specific resource, let's customize the authorization settings so that only Tito can visit `CreatingUserAccounts.aspx`.</span></span> <span data-ttu-id="53b7f-227">Um dies zu erreichen, fügen einen `<location>` Element an der `Membership` des Ordners `Web.config` Datei, und aktualisieren Sie das Markup, sodass er wie folgt aussieht:</span><span class="sxs-lookup"><span data-stu-id="53b7f-227">To accomplish this, add a `<location>` element to the `Membership` folder's `Web.config` file and update its markup so that it looks like the following:</span></span>

[!code-xml[Main](user-based-authorization-cs/samples/sample5.xml)]

<span data-ttu-id="53b7f-228">Die `<authorization>` Element im `<system.web>` definiert die Standard-URL-Autorisierungsregeln für ASP.NET-Ressourcen in der `Membership` Ordner und seinen Unterordnern.</span><span class="sxs-lookup"><span data-stu-id="53b7f-228">The `<authorization>` element in `<system.web>` defines the default URL authorization rules for ASP.NET resources in the `Membership` folder and its subfolders.</span></span> <span data-ttu-id="53b7f-229">Die `<location>` Element erlaubt es uns, die diese Regeln für eine bestimmte Ressource zu überschreiben.</span><span class="sxs-lookup"><span data-stu-id="53b7f-229">The `<location>` element allows us to override these rules for a particular resource.</span></span> <span data-ttu-id="53b7f-230">Im obigen Markup der `<location>` Elementverweise der `CreatingUserAccounts.aspx` Seite, und gibt an, z. B. Tito, ermöglichen, seine Autorisierungsregeln verweigern aber alle anderen Benutzer.</span><span class="sxs-lookup"><span data-stu-id="53b7f-230">In the above markup the `<location>` element references the `CreatingUserAccounts.aspx` page and specifies its authorization rules such as to allow Tito, but deny everyone else.</span></span>

<span data-ttu-id="53b7f-231">Um diese Änderung für die Autorisierung zu testen, starten Sie auf der Website als anonymer Benutzer.</span><span class="sxs-lookup"><span data-stu-id="53b7f-231">To test out this authorization change, start by visiting the website as an anonymous user.</span></span> <span data-ttu-id="53b7f-232">Wenn Sie versuchen, eine andere Seite in besuchen die `Membership` Ordner, z. B. `UserBasedAuthorization.aspx`, die `UrlAuthorizationModule` verweigert die Anforderung und Sie werden zur Anmeldeseite umgeleitet.</span><span class="sxs-lookup"><span data-stu-id="53b7f-232">If you attempt to visit any page in the `Membership` folder, such as `UserBasedAuthorization.aspx`, the `UrlAuthorizationModule` will deny the request and you will be redirected to the login page.</span></span> <span data-ttu-id="53b7f-233">Nach der Anmeldung als Scott sagen, besuchen Sie eine andere Seite in der `Membership` Ordner *außer* für `CreatingUserAccounts.aspx`.</span><span class="sxs-lookup"><span data-stu-id="53b7f-233">After logging in as, say, Scott, you can visit any page in the `Membership` folder *except* for `CreatingUserAccounts.aspx`.</span></span> <span data-ttu-id="53b7f-234">Bei dem Versuch, besuchen `CreatingUserAccounts.aspx` als jeder angemeldet Tito führt jedoch bei einem Versuch vor nicht autorisiertem Zugriff, Sie wieder auf die Anmeldeseite umgeleitet.</span><span class="sxs-lookup"><span data-stu-id="53b7f-234">Attempting to visit `CreatingUserAccounts.aspx` logged on as anyone but Tito will result in an unauthorized access attempt, redirecting you back to the login page.</span></span>

> [!NOTE]
> <span data-ttu-id="53b7f-235">Die `<location>` Element muss außerhalb der Konfigurations angezeigt `<system.web>` Element.</span><span class="sxs-lookup"><span data-stu-id="53b7f-235">The `<location>` element must appear outside of the configuration's `<system.web>` element.</span></span> <span data-ttu-id="53b7f-236">Sie benötigen ein separates `<location>` -Element für jede Ressource, deren autorisierungseinstellungen, die Sie überschreiben möchten.</span><span class="sxs-lookup"><span data-stu-id="53b7f-236">You need to use a separate `<location>` element for each resource whose authorization settings you want to override.</span></span>


### <a name="a-look-at-how-theurlauthorizationmoduleuses-the-authorization-rules-to-grant-or-deny-access"></a><span data-ttu-id="53b7f-237">Ein Blick auf wie die`UrlAuthorizationModule`verwendet die Autorisierungsregeln zum gewähren oder Verweigern des Zugriffs</span><span class="sxs-lookup"><span data-stu-id="53b7f-237">A Look at How the`UrlAuthorizationModule`Uses the Authorization Rules to Grant or Deny Access</span></span>

<span data-ttu-id="53b7f-238">Die `UrlAuthorizationModule` bestimmt, ob eine bestimmte Identität für eine bestimmte URL zu autorisieren, indem Sie die URL-Autorisierung analysieren einzeln nacheinander Regeln, beginnend mit der ersten Aktivität und ihre Arbeitsweise nach unten.</span><span class="sxs-lookup"><span data-stu-id="53b7f-238">The `UrlAuthorizationModule` determines whether to authorize a particular identity for a particular URL by analyzing the URL authorization rules one at a time, starting from the first one and working its way down.</span></span> <span data-ttu-id="53b7f-239">Sobald eine Übereinstimmung gefunden wird, If je nach der Übereinstimmung der Benutzer wird Zugriff gewährt oder verweigert, ein `<allow>` oder `<deny>` Element.</span><span class="sxs-lookup"><span data-stu-id="53b7f-239">As soon as a match is found, the user is granted or denied access, depending on if the match was found in an `<allow>` or `<deny>` element.</span></span> <span data-ttu-id="53b7f-240"><strong>Wenn keine Übereinstimmung gefunden wird, wird dem Benutzer Zugriff gewährt.</strong></span><span class="sxs-lookup"><span data-stu-id="53b7f-240"><strong>If no match is found, the user is granted access.</strong></span></span> <span data-ttu-id="53b7f-241">Wenn Sie den Zugriff einschränken möchten, ist es daher unabdinglich, Sie verwenden eine `<deny>` Element als das letzte Element in der Konfiguration der URL-Autorisierung.</span><span class="sxs-lookup"><span data-stu-id="53b7f-241">Consequently, if you want to restrict access, it is imperative that you use a `<deny>` element as the last element in the URL authorization configuration.</span></span> <span data-ttu-id="53b7f-242"><strong>Wenn Sie weglassen eine</strong><strong>`<deny>`</strong><strong>Element, alle Benutzer werden Zugriff gewährt werden.</strong></span><span class="sxs-lookup"><span data-stu-id="53b7f-242"><strong>If you omit a</strong><strong>`<deny>`</strong><strong>element, all users will be granted access.</strong></span></span>

<span data-ttu-id="53b7f-243">Um besser zu verstehen, den Vorgang, mit dem `UrlAuthorizationModule` um Autorität zu bestimmen, betrachten Sie das Beispiel URL-Autorisierungsregeln, die weiter oben in diesem Schritt erläutert.</span><span class="sxs-lookup"><span data-stu-id="53b7f-243">To better understand the process used by the `UrlAuthorizationModule` to determine authority, consider the example URL authorization rules we looked at earlier in this step.</span></span> <span data-ttu-id="53b7f-244">Die erste Regel ist ein `<allow>` -Element, das Zugriff auf Tito und Scott ermöglicht.</span><span class="sxs-lookup"><span data-stu-id="53b7f-244">The first rule is an `<allow>` element that allows access to Tito and Scott.</span></span> <span data-ttu-id="53b7f-245">Die zweite Regeln wird ein `<deny>` -Element, das auf "Jeder" Zugriff verweigert.</span><span class="sxs-lookup"><span data-stu-id="53b7f-245">The second rules is a `<deny>` element that denies access to everyone.</span></span> <span data-ttu-id="53b7f-246">Wenn ein anonymer Benutzer besucht, die `UrlAuthorizationModule` gestartet wird, indem Sie anfordern, wird anonymen Scott oder Tito?</span><span class="sxs-lookup"><span data-stu-id="53b7f-246">If an anonymous user visits, the `UrlAuthorizationModule` starts by asking, Is anonymous either Scott or Tito?</span></span> <span data-ttu-id="53b7f-247">Die Antwort ist offensichtlich, Nein, es folglich wechselt in die zweite Regel.</span><span class="sxs-lookup"><span data-stu-id="53b7f-247">The answer, obviously, is No, so it proceeds to the second rule.</span></span> <span data-ttu-id="53b7f-248">Ist in der Menge der jeder anonym?</span><span class="sxs-lookup"><span data-stu-id="53b7f-248">Is anonymous in the set of everybody?</span></span> <span data-ttu-id="53b7f-249">Da die Antwort hier ist "Ja", die `<deny>` Regel wird wirksam und der Besucher auf der Anmeldeseite umgeleitet wird.</span><span class="sxs-lookup"><span data-stu-id="53b7f-249">Since the answer here is Yes, the `<deny>` rule is put in effect and the visitor is redirected to the login page.</span></span> <span data-ttu-id="53b7f-250">Auf ähnliche Weise, wenn das Unternehmen besuchende Jisun ist die `UrlAuthorizationModule` beginnt mit dem anfordern, wird Jisun Scott oder Tito?</span><span class="sxs-lookup"><span data-stu-id="53b7f-250">Similarly, if Jisun is visiting, the `UrlAuthorizationModule` starts by asking, Is Jisun either Scott or Tito?</span></span> <span data-ttu-id="53b7f-251">Da sie nicht der Fall ist die `UrlAuthorizationModule` geht auf die zweite Frage ist Jisun im Satz von jedem?</span><span class="sxs-lookup"><span data-stu-id="53b7f-251">Since she is not, the `UrlAuthorizationModule` proceeds to the second question, Is Jisun in the set of everybody?</span></span> <span data-ttu-id="53b7f-252">Sie ist, damit er, ebenfalls der Zugriff verweigert wird.</span><span class="sxs-lookup"><span data-stu-id="53b7f-252">She is, so she, too, is denied access.</span></span> <span data-ttu-id="53b7f-253">Abschließend, wenn Tito besucht, die erste Frage Bedrohung durch die `UrlAuthorizationModule` ist eine positive Antwort Tito Zugriff gewährt wird.</span><span class="sxs-lookup"><span data-stu-id="53b7f-253">Finally, if Tito visits, the first question posed by the `UrlAuthorizationModule` is an affirmative answer, so Tito is granted access.</span></span>

<span data-ttu-id="53b7f-254">Da die `UrlAuthorizationModule` Prozesse, die die Autorisierungsregeln von oben nach unten beenden am Übereinstimmung, es ist wichtig, die spezifischen Regeln, die vor den weniger spezifischen ab stehen haben.</span><span class="sxs-lookup"><span data-stu-id="53b7f-254">Since the `UrlAuthorizationModule` processes the authorization rules from the top down, stopping at any match, it is important to have the more specific rules come before the less specific ones.</span></span> <span data-ttu-id="53b7f-255">D. h. um Autorisierungsregeln zu definieren, die Jisun und anonyme Benutzer unterbunden, aber alle anderen authentifizierten Benutzern erlauben, Sie zunächst die spezifischste Regel – die eine weitreichendsten Jisun - und fahren Sie mit den weniger spezifischen Regeln - den alle anderen zulassen Authentifizierte Benutzer, aber alle anonymen Benutzer verweigern.</span><span class="sxs-lookup"><span data-stu-id="53b7f-255">That is, to define authorization rules that forbid Jisun and anonymous users, but allow all other authenticated users, you would start with the most specific rule - the one impacting Jisun - and then proceed to the less specific rules - those allowing all other authenticated users, but denying all anonymous users.</span></span> <span data-ttu-id="53b7f-256">Die folgenden URL-Autorisierungsregeln implementiert diese Richtlinie, indem zuerst Jisun verweigern und dann nur alle anonymen Benutzer.</span><span class="sxs-lookup"><span data-stu-id="53b7f-256">The following URL authorization rules implements this policy by first denying Jisun, and then denying any anonymous user.</span></span> <span data-ttu-id="53b7f-257">Jeder authentifizierte Benutzer als Jisun wird Zugriff gewährt, da beide Methoden `<deny>` Anweisungen entspricht.</span><span class="sxs-lookup"><span data-stu-id="53b7f-257">Any authenticated user other than Jisun will be granted access because neither of these `<deny>` statements will match.</span></span>

[!code-xml[Main](user-based-authorization-cs/samples/sample6.xml)]

## <a name="step-2-fixing-the-workflow-for-unauthorized-authenticated-users"></a><span data-ttu-id="53b7f-258">Schritt 2: Korrigieren, und des Workflows für nicht autorisierte, authentifizierten Benutzer</span><span class="sxs-lookup"><span data-stu-id="53b7f-258">Step 2: Fixing the Workflow for Unauthorized, Authenticated Users</span></span>

<span data-ttu-id="53b7f-259">Wie weiter oben in diesem Lernprogramm in der ein sehen Sie sich den Abschnitt für URL-Autorisierung erläutert, können Sie jederzeit eine nicht autorisierte Anforderung herausstellt, die `UrlAuthorizationModule` bricht die Anforderung ab und gibt einen HTTP 401 Unauthorized Status zurück.</span><span class="sxs-lookup"><span data-stu-id="53b7f-259">As we discussed earlier in this tutorial in the A Look at the URL Authorization Workflow section, anytime an unauthorized request transpires, the `UrlAuthorizationModule` aborts the request and returns an HTTP 401 Unauthorized status.</span></span> <span data-ttu-id="53b7f-260">Dieser Status 401 geändert wird, indem die `FormsAuthenticationModule` in eine 302 umleiten Status, die der Benutzer auf der Anmeldeseite gesendet.</span><span class="sxs-lookup"><span data-stu-id="53b7f-260">This 401 status is modified by the `FormsAuthenticationModule` into a 302 Redirect status that sends the user to the login page.</span></span> <span data-ttu-id="53b7f-261">Dieser Workflow erfolgt für alle nicht autorisierten Anforderung, selbst wenn der Benutzer authentifiziert ist.</span><span class="sxs-lookup"><span data-stu-id="53b7f-261">This workflow occurs on any unauthorized request, even if the user is authenticated.</span></span>

<span data-ttu-id="53b7f-262">Zurückgeben eines authentifizierten Benutzers auf der Anmeldeseite wird wahrscheinlich diese verwechseln, da sie bereits in das System angemeldet haben.</span><span class="sxs-lookup"><span data-stu-id="53b7f-262">Returning an authenticated user to the login page is likely to confuse them since they have already logged into the system.</span></span> <span data-ttu-id="53b7f-263">Mit ein wenig Arbeit können wir dieses Workflows verbessert, durch das Umleiten von authentifizierten Benutzer, die nicht autorisierte Anfragen zu einer Seite, aus der hervorgeht, dass sie versucht haben, eine zugriffsbeschränkte Seite den Zugriff auf.</span><span class="sxs-lookup"><span data-stu-id="53b7f-263">With a little bit of work we can improve this workflow by redirecting authenticated users who make unauthorized requests to a page that explains that they have attempted to access a restricted page.</span></span>

<span data-ttu-id="53b7f-264">Erstellen eine neue ASP.NET-Seite im Stammordner der Webanwendung, die mit dem Namen zunächst `UnauthorizedAccess.aspx`; vergessen Sie nicht, ordnen Sie diese Seite mit den `Site.master` Masterseite.</span><span class="sxs-lookup"><span data-stu-id="53b7f-264">Start by creating a new ASP.NET page in the web application's root folder named `UnauthorizedAccess.aspx`; don't forget to associate this page with the `Site.master` master page.</span></span> <span data-ttu-id="53b7f-265">Entfernen Sie nach dem Erstellen dieser Seite an, das Inhaltssteuerelement, das verweist auf die `LoginContent` ContentPlaceHolder, damit die Gestaltungsvorlage Standardinhaltstyp wird angezeigt.</span><span class="sxs-lookup"><span data-stu-id="53b7f-265">After creating this page, remove the Content control that references the `LoginContent` ContentPlaceHolder so that the master page's default content will be displayed.</span></span> <span data-ttu-id="53b7f-266">Als Nächstes fügen Sie eine Meldung, die Situation, nämlich erläutert wird, dass der Benutzer hat versucht, eine geschützte Ressource zuzugreifen.</span><span class="sxs-lookup"><span data-stu-id="53b7f-266">Next, add a message that explains the situation, namely that the user attempted to access a protected resource.</span></span> <span data-ttu-id="53b7f-267">Nach dem Hinzufügen einer solchen Nachricht die `UnauthorizedAccess.aspx` deklarativen Seitenmarkup sollte etwa wie folgt aussehen:</span><span class="sxs-lookup"><span data-stu-id="53b7f-267">After adding such a message, the `UnauthorizedAccess.aspx` page's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](user-based-authorization-cs/samples/sample7.aspx)]

<span data-ttu-id="53b7f-268">Jetzt müssen wir den Workflow zu ändern, sodass sie eine nicht autorisierte Anforderung von einem authentifizierten Benutzer durchgeführt wird, gesendet werden die `UnauthorizedAccess.aspx` Seite anstelle der Anmeldeseite.</span><span class="sxs-lookup"><span data-stu-id="53b7f-268">We now need to alter the workflow so that if an unauthorized request is performed by an authenticated user they are sent to the `UnauthorizedAccess.aspx` page instead of the login page.</span></span> <span data-ttu-id="53b7f-269">Die Logik, die nicht autorisierte Anfragen an die Anmeldeseite umgeleitet wird in eine private Methode von verborgen der `FormsAuthenticationModule` Klasse, damit wir dieses Verhalten nicht anpassen kann.</span><span class="sxs-lookup"><span data-stu-id="53b7f-269">The logic that redirects unauthorized requests to the login page is buried within a private method of the `FormsAuthenticationModule` class, so we cannot customize this behavior.</span></span> <span data-ttu-id="53b7f-270">Was wir jedoch ausführen kann, ist unser eigenes Logik zur Anmeldeseite hinzufügen, die den Benutzer umleitet `UnauthorizedAccess.aspx`, sofern erforderlich.</span><span class="sxs-lookup"><span data-stu-id="53b7f-270">What we can do, however, is add our own logic to the login page that redirects the user to `UnauthorizedAccess.aspx`, if needed.</span></span>

<span data-ttu-id="53b7f-271">Wenn die `FormsAuthenticationModule` leitet einen nicht autorisierten Besucher zur Anmeldeseite fügt er die angeforderte, nicht autorisierte URL, die Abfragezeichenfolge mit dem Namen `ReturnUrl`.</span><span class="sxs-lookup"><span data-stu-id="53b7f-271">When the `FormsAuthenticationModule` redirects an unauthorized visitor to the login page it appends the requested, unauthorized URL to the querystring with the name `ReturnUrl`.</span></span> <span data-ttu-id="53b7f-272">Angenommen, ein nicht autorisierter Benutzer versucht, besuchen `OnlyTito.aspx`, `FormsAuthenticationModule` würde weiterleiten, damit `Login.aspx?ReturnUrl=OnlyTito.aspx`.</span><span class="sxs-lookup"><span data-stu-id="53b7f-272">For example, if an unauthorized user attempted to visit `OnlyTito.aspx`, the `FormsAuthenticationModule` would redirect them to `Login.aspx?ReturnUrl=OnlyTito.aspx`.</span></span> <span data-ttu-id="53b7f-273">Daher, wenn die Anmeldeseite von einem authentifizierten Benutzer mit einer Abfragezeichenfolge erreicht wird, die enthält die `ReturnUrl` Parameter, und wir wissen, dass dieser nicht authentifizierte Benutzer nur versucht, eine Seite besuchen sie keine zum Anzeigen Berechtigung.</span><span class="sxs-lookup"><span data-stu-id="53b7f-273">Therefore, if the login page is reached by an authenticated user with a querystring that includes the `ReturnUrl` parameter, then we know that this unauthenticated user just attempted to visit a page she is not authorized to view.</span></span> <span data-ttu-id="53b7f-274">In einem solchen Fall ist es ihr, umleiten möchten `UnauthorizedAccess.aspx`.</span><span class="sxs-lookup"><span data-stu-id="53b7f-274">In such a case, we want to redirect her to `UnauthorizedAccess.aspx`.</span></span>

<span data-ttu-id="53b7f-275">Um dies zu erreichen, fügen Sie den folgenden Code der Anmeldeseite `Page_Load` Ereignishandler:</span><span class="sxs-lookup"><span data-stu-id="53b7f-275">To accomplish this, add the following code to the login page's `Page_Load` event handler:</span></span>

[!code-csharp[Main](user-based-authorization-cs/samples/sample8.cs)]

<span data-ttu-id="53b7f-276">Der obige Code leitet authentifiziert ist, nicht autorisierte Benutzer auf die `UnauthorizedAccess.aspx` Seite.</span><span class="sxs-lookup"><span data-stu-id="53b7f-276">The above code redirects authenticated, unauthorized users to the `UnauthorizedAccess.aspx` page.</span></span> <span data-ttu-id="53b7f-277">Um diese Logik in Aktion zu sehen, wie eine anonyme Besucher der Website, und klicken Sie auf den Link Erstellen von Benutzerkonten in der linken Spalte auf.</span><span class="sxs-lookup"><span data-stu-id="53b7f-277">To see this logic in action, visit the site as an anonymous visitor and click on the Creating User Accounts link in the left column.</span></span> <span data-ttu-id="53b7f-278">Dadurch gelangen Sie zu der `~/Membership/CreatingUserAccounts.aspx` Seite, die in Schritt 1 wird so, dass nur konfiguriert Tito Zugriff erhält.</span><span class="sxs-lookup"><span data-stu-id="53b7f-278">This will take you to the `~/Membership/CreatingUserAccounts.aspx` page, which in Step 1 we configured to only permit access to Tito.</span></span> <span data-ttu-id="53b7f-279">Da anonyme Benutzer nicht zulässig ist, die `FormsAuthenticationModule` uns zurück an die Anmeldeseite umgeleitet.</span><span class="sxs-lookup"><span data-stu-id="53b7f-279">Since anonymous users are prohibited, the `FormsAuthenticationModule` redirects us back to the login page.</span></span>

<span data-ttu-id="53b7f-280">An diesem Punkt sind wir anonym, sodass `Request.IsAuthenticated` gibt `false` und wir werden nicht auf umgeleitet `UnauthorizedAccess.aspx`.</span><span class="sxs-lookup"><span data-stu-id="53b7f-280">At this point we are anonymous, so `Request.IsAuthenticated` returns `false` and we are not redirected to `UnauthorizedAccess.aspx`.</span></span> <span data-ttu-id="53b7f-281">Stattdessen wird die Anmeldeseite angezeigt.</span><span class="sxs-lookup"><span data-stu-id="53b7f-281">Instead, the login page is displayed.</span></span> <span data-ttu-id="53b7f-282">Melden Sie sich mit einem anderen Benutzer als Tito, z. B. Bruce.</span><span class="sxs-lookup"><span data-stu-id="53b7f-282">Log in as a user other than Tito, such as Bruce.</span></span> <span data-ttu-id="53b7f-283">Geben Sie die entsprechenden Anmeldeinformationen ein, die Anmeldeseite leitet uns wieder an `~/Membership/CreatingUserAccounts.aspx`.</span><span class="sxs-lookup"><span data-stu-id="53b7f-283">After entering the appropriate credentials, the login page redirects us back to `~/Membership/CreatingUserAccounts.aspx`.</span></span> <span data-ttu-id="53b7f-284">Jedoch, da auf dieser Seite nur für Tito zugänglich ist, wir sind nicht autorisiert, um ihn anzuzeigen und werden zur Anmeldeseite sofort zurückgegeben.</span><span class="sxs-lookup"><span data-stu-id="53b7f-284">However, since this page is only accessible to Tito, we are unauthorized to view it and are promptly returned to the login page.</span></span> <span data-ttu-id="53b7f-285">Dieses Mal jedoch `Request.IsAuthenticated` gibt `true` (und die `ReturnUrl` Querystring-Parameter vorhanden ist), sodass wir, um umgeleitet werden die `UnauthorizedAccess.aspx` Seite.</span><span class="sxs-lookup"><span data-stu-id="53b7f-285">This time, however, `Request.IsAuthenticated` returns `true` (and the `ReturnUrl` querystring parameter exists), so we are redirected to the `UnauthorizedAccess.aspx` page.</span></span>


<span data-ttu-id="53b7f-286">[![Authentifiziert sind, werden nicht autorisierte Benutzer zu UnauthorizedAccess.aspx umgeleitet.](user-based-authorization-cs/_static/image17.png)](user-based-authorization-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="53b7f-286">[![Authenticated, Unauthorized Users are Redirected to UnauthorizedAccess.aspx](user-based-authorization-cs/_static/image17.png)](user-based-authorization-cs/_static/image16.png)</span></span>

<span data-ttu-id="53b7f-287">**Abbildung 6**: authentifiziert, nicht autorisierte Benutzer umgeleitet werden `UnauthorizedAccess.aspx` ([klicken Sie hier, um das Bild in voller Größe angezeigt](user-based-authorization-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="53b7f-287">**Figure 6**: Authenticated, Unauthorized Users are Redirected to `UnauthorizedAccess.aspx` ([Click to view full-size image](user-based-authorization-cs/_static/image18.png))</span></span>


<span data-ttu-id="53b7f-288">Diese benutzerdefinierten Workflows sorgt für eine mehr aussagefähiger und unkompliziert Benutzer von Kurzschlussoperationen den Zyklus in Abbildung 2 dargestellt.</span><span class="sxs-lookup"><span data-stu-id="53b7f-288">This customized workflow presents a more sensible and straightforward user experience by short circuiting the cycle depicted in Figure 2.</span></span>

## <a name="step-3-limiting-functionality-based-on-the-currently-logged-in-user"></a><span data-ttu-id="53b7f-289">Schritt 3: Funktionalität, die basierend auf dem derzeit angemeldeten Benutzer beschränkt.</span><span class="sxs-lookup"><span data-stu-id="53b7f-289">Step 3: Limiting Functionality Based on the Currently Logged In User</span></span>

<span data-ttu-id="53b7f-290">URL-Autorisierung vereinfacht die grob Autorisierungsregeln angeben.</span><span class="sxs-lookup"><span data-stu-id="53b7f-290">URL authorization makes it easy to specify coarse authorization rules.</span></span> <span data-ttu-id="53b7f-291">Wie in Schritt 1 wurde erläutert, können mit URL-Autorisierung wir kurz: welche Identitäten zulässig sind und welche verweigert werden, eine bestimmte Seite oder alle Seiten in einem Ordner anzeigen</span><span class="sxs-lookup"><span data-stu-id="53b7f-291">As we saw in Step 1, with URL authorization we can succinctly state what identities are permitted and which ones are denied from viewing a particular page or all pages in a folder.</span></span> <span data-ttu-id="53b7f-292">In bestimmten Szenarien kann, wir möchten jedoch ermöglicht allen Benutzern finden Sie auf einer Seite, aber der Seite funktionseinschränkungen basierend auf den Besucher.</span><span class="sxs-lookup"><span data-stu-id="53b7f-292">In certain scenarios, however, we may want to allow all users to visit a page, but limit the page's functionality based on the user visiting it.</span></span>

<span data-ttu-id="53b7f-293">Betrachten Sie den Fall einer e-Commerce-Website, die authentifizierten Besucher ihrer Produkte überprüfen können.</span><span class="sxs-lookup"><span data-stu-id="53b7f-293">Consider the case of an eCommerce website that allows authenticated visitors to review their products.</span></span> <span data-ttu-id="53b7f-294">Wenn ein anonymer Benutzer ein Produkt Seite besucht, wird sie sehen nur die Produktinformationen und würde nicht die Möglichkeit, eine Kritik zu lassen gegeben werden.</span><span class="sxs-lookup"><span data-stu-id="53b7f-294">When an anonymous user visits a product's page, they would see just the product information and would not be given the opportunity to leave a review.</span></span> <span data-ttu-id="53b7f-295">Allerdings würde ein authentifizierter Benutzer Zugriff auf derselben Seite Überprüfung Schnittstelle finden Sie unter.</span><span class="sxs-lookup"><span data-stu-id="53b7f-295">However, an authenticated user visiting the same page would see the reviewing interface.</span></span> <span data-ttu-id="53b7f-296">Wenn der authentifizierte Benutzer dieses Produkt noch nicht überprüft wurde, würde die Schnittstelle sie senden Sie eine Überprüfung aktivieren; Andernfalls würden sie sie zuvor gesendeten Überprüfung anzuzeigen.</span><span class="sxs-lookup"><span data-stu-id="53b7f-296">If the authenticated user had not yet reviewed this product, the interface would enable them to submit a review; otherwise it would show them their previously-submitted review.</span></span> <span data-ttu-id="53b7f-297">Um dieses Szenario einen Schritt nehmen Sie darüber hinaus die Produktseite möglicherweise zusätzliche Informationen anzeigen und bieten erweiterte Funktionen für Benutzer, die für das e-Commerce-Unternehmen arbeiten.</span><span class="sxs-lookup"><span data-stu-id="53b7f-297">To take this scenario a step further, the product page might show additional information and offer extended features for those users that work for the eCommerce company.</span></span> <span data-ttu-id="53b7f-298">Beispielsweise kann die Produktseite Liste der Bestand im Lager und enthalten Optionen, um des Produkts Preis und eine Beschreibung, die von einem Mitarbeiter besucht bearbeiten.</span><span class="sxs-lookup"><span data-stu-id="53b7f-298">For example, the product page might list the inventory in stock and include options to edit the product's price and description when visited by an employee.</span></span>

<span data-ttu-id="53b7f-299">Solche möglich, differenzierte Autorisierungsregeln können entweder deklarativ oder programmgesteuert (oder über eine Kombination aus beiden) implementiert werden.</span><span class="sxs-lookup"><span data-stu-id="53b7f-299">Such fine grain authorization rules can be implemented either declaratively or programmatically (or through some combination of the two).</span></span> <span data-ttu-id="53b7f-300">Im nächsten Abschnitt sehen wir, wie möglich, differenzierte Autorisierung über das LoginView-Steuerelement implementiert werden.</span><span class="sxs-lookup"><span data-stu-id="53b7f-300">In the next section we will see how to implement fine grain authorization via the LoginView control.</span></span> <span data-ttu-id="53b7f-301">Danach wird programmgesteuerte Techniken vorgestellt.</span><span class="sxs-lookup"><span data-stu-id="53b7f-301">Following that, we will explore programmatic techniques.</span></span> <span data-ttu-id="53b7f-302">Bevor wir Autorisierungsregeln möglich, differenzierte anwenden untersuchen können, müssen jedoch wir zuerst erstellen Sie eine Seite der Besucher, deren Funktionalität abhängig.</span><span class="sxs-lookup"><span data-stu-id="53b7f-302">Before we can look at applying fine grain authorization rules, however, we first need to create a page whose functionality depends on the user visiting it.</span></span>

<span data-ttu-id="53b7f-303">Erstellen Sie eine Seite, die die Dateien in einem bestimmten Verzeichnis innerhalb einer GridView auflistet.</span><span class="sxs-lookup"><span data-stu-id="53b7f-303">Let's create a page that lists the files in a particular directory within a GridView.</span></span> <span data-ttu-id="53b7f-304">Auflisten von Namen für jede Datei, Größe und andere Informationen, die GridView wird enthalten neben LinkButtons zwei Spalten: eine mit dem Titel anzeigen und mit dem Titel löschen.</span><span class="sxs-lookup"><span data-stu-id="53b7f-304">Along with listing each file's name, size, and other information, the GridView will include two columns of LinkButtons: one titled View and one titled Delete.</span></span> <span data-ttu-id="53b7f-305">Wenn die Ansicht LinkButton geklickt wird, werden der Inhalt der ausgewählten Datei angezeigt; Wenn die LinkButton Löschen geklickt wird, wird die Datei gelöscht.</span><span class="sxs-lookup"><span data-stu-id="53b7f-305">If the View LinkButton is clicked, the contents of the selected file will be displayed; if the Delete LinkButton is clicked, the file will be deleted.</span></span> <span data-ttu-id="53b7f-306">Zunächst erstellen Sie diese Seite, dass die Ansicht "und" Delete-Funktionen für alle Benutzer verfügbar sind.</span><span class="sxs-lookup"><span data-stu-id="53b7f-306">Let's initially create this page such that its view and delete functionality is available to all users.</span></span> <span data-ttu-id="53b7f-307">In der mit den Abschnitten LoginView-Steuerelement und Funktionalität programmgesteuert beschränken, die wir sehen werden, wie Sie aktivieren oder deaktivieren diese Funktionen, die basierend auf dem Benutzer Zugriff auf die Seite.</span><span class="sxs-lookup"><span data-stu-id="53b7f-307">In the Using the LoginView Control and Programmatically Limiting Functionality sections we will see how to enable or disable these features based on the user visiting the page.</span></span>

> [!NOTE]
> <span data-ttu-id="53b7f-308">Die ASP.NET-Seite an, die wir erstellen verwendet eine GridView-Steuerelements, um eine Liste der Dateien anzuzeigen.</span><span class="sxs-lookup"><span data-stu-id="53b7f-308">The ASP.NET page we are about to build uses a GridView control to display a list of files.</span></span> <span data-ttu-id="53b7f-309">Seit diesem Lernprogramm Reihe auf formularbasierte Authentifizierung, Autorisierung, Benutzerkonten und Rollen konzentriert, sollten ich keine Erörterung der internen Funktionsweise von des GridView-Steuerelements zu viel Zeit.</span><span class="sxs-lookup"><span data-stu-id="53b7f-309">Since this tutorial series focuses on forms authentication, authorization, user accounts, and roles, I do not want to spend too much time discussing the inner workings of the GridView control.</span></span> <span data-ttu-id="53b7f-310">Während dieses Lernprogramm spezifische schrittweise Anweisungen zum Einrichten dieser Seite enthält, ist es nicht stürzen die Details Warum Auswahl bestimmter vorgenommen wurden, oder was auf der gerenderten Ausgabe Auswirkungen bestimmte Eigenschaften haben.</span><span class="sxs-lookup"><span data-stu-id="53b7f-310">While this tutorial provides specific step-by-step instructions for setting up this page, it does not delve into the details of why certain choices were made, or what effect particular properties have on the rendered output.</span></span> <span data-ttu-id="53b7f-311">Eine gründliche Prüfung des GridView-Steuerelements, finden Sie in meinem *[arbeiten mit Daten in ASP.NET 2.0](../../data-access/index.md)* Reihe von Lernprogrammen.</span><span class="sxs-lookup"><span data-stu-id="53b7f-311">For a thorough examination of the GridView control, consult my *[Working with Data in ASP.NET 2.0](../../data-access/index.md)* tutorial series.</span></span>


<span data-ttu-id="53b7f-312">Öffnen Sie zunächst die `UserBasedAuthorization.aspx` in der Datei die `Membership` Ordner und Hinzufügen eines GridView-Steuerelements auf der Seite mit dem Namen `FilesGrid`.</span><span class="sxs-lookup"><span data-stu-id="53b7f-312">Start by opening the `UserBasedAuthorization.aspx` file in the `Membership` folder and adding a GridView control to the page named `FilesGrid`.</span></span> <span data-ttu-id="53b7f-313">Der GridView Smart Tag klicken Sie auf den Spalten bearbeiten-Link, um das Dialogfeld Felder zu starten.</span><span class="sxs-lookup"><span data-stu-id="53b7f-313">From the GridView's Smart Tag, click the Edit Columns link to launch the Fields dialog box.</span></span> <span data-ttu-id="53b7f-314">Von hier aus, deaktivieren Sie Kontrollkästchen Felder automatisch generiert, in der unteren linken Ecke.</span><span class="sxs-lookup"><span data-stu-id="53b7f-314">From here, uncheck the Auto-generate fields checkbox in the lower left corner.</span></span> <span data-ttu-id="53b7f-315">Fügen Sie eine Schaltfläche auswählen, eine Schaltfläche "löschen" und zwei BoundFields aus der oberen linken Ecke (die Schaltflächen "auswählen" und "Delete" kann unter den CommandField Typ gefunden).</span><span class="sxs-lookup"><span data-stu-id="53b7f-315">Next, add a Select button, a Delete button, and two BoundFields from the upper left corner (the Select and Delete buttons can be found under the CommandField type).</span></span> <span data-ttu-id="53b7f-316">Legen Sie der Schaltfläche auswählen `SelectText` Eigenschaft anzeigen und die erste BoundField- `HeaderText` und `DataField` Eigenschaften mit Namen.</span><span class="sxs-lookup"><span data-stu-id="53b7f-316">Set the Select button's `SelectText` property to View and the first BoundField's `HeaderText` and `DataField` properties to Name.</span></span> <span data-ttu-id="53b7f-317">Legen Sie die zweite BoundField- `HeaderText` Eigenschaft, um die Größe in Bytes, die `DataField` Eigenschaft auf die Länge, seine `DataFormatString` Eigenschaft, um {0: N0} und die zugehörige `HtmlEncode` Eigenschaft auf "false".</span><span class="sxs-lookup"><span data-stu-id="53b7f-317">Set the second BoundField's `HeaderText` property to Size in Bytes, its `DataField` property to Length, its `DataFormatString` property to {0:N0} and its `HtmlEncode` property to False.</span></span>

<span data-ttu-id="53b7f-318">Nach dem Konfigurieren der GridView-Spalten, klicken Sie auf OK, um das Dialogfeld "Felder" zu schließen.</span><span class="sxs-lookup"><span data-stu-id="53b7f-318">After configuring the GridView's columns, click OK to close the Fields dialog box.</span></span> <span data-ttu-id="53b7f-319">Legen Sie im Fenster Eigenschaften der GridView `DataKeyNames` Eigenschaft `FullName`.</span><span class="sxs-lookup"><span data-stu-id="53b7f-319">From the Properties window, set the GridView's `DataKeyNames` property to `FullName`.</span></span> <span data-ttu-id="53b7f-320">An diesem Punkt sollte die GridView deklarative Markup wie folgt aussehen:</span><span class="sxs-lookup"><span data-stu-id="53b7f-320">At this point the GridView's declarative markup should look like the following:</span></span>

[!code-aspx[Main](user-based-authorization-cs/samples/sample9.aspx)]

<span data-ttu-id="53b7f-321">Durch die GridView-Markup erstellt haben können wir den Code zu schreiben, der die Dateien in einem bestimmten Verzeichnis abrufen und an die GridView zu binden.</span><span class="sxs-lookup"><span data-stu-id="53b7f-321">With the GridView's markup created, we're ready to write the code that will retrieve the files in a particular directory and bind them to the GridView.</span></span> <span data-ttu-id="53b7f-322">Fügen Sie den folgenden Code auf der Seite `Page_Load` Ereignishandler:</span><span class="sxs-lookup"><span data-stu-id="53b7f-322">Add the following code to the page's `Page_Load` event handler:</span></span>

[!code-csharp[Main](user-based-authorization-cs/samples/sample10.cs)]

<span data-ttu-id="53b7f-323">Der obige Code verwendet die [ `DirectoryInfo` Klasse](https://msdn.microsoft.com/library/system.io.directoryinfo.aspx) um eine Liste der Dateien im Stammordner der Anwendung abzurufen.</span><span class="sxs-lookup"><span data-stu-id="53b7f-323">The above code uses the [`DirectoryInfo` class](https://msdn.microsoft.com/library/system.io.directoryinfo.aspx) to obtain a list of the files in the application's root folder.</span></span> <span data-ttu-id="53b7f-324">Die [ `GetFiles()` Methode](https://msdn.microsoft.com/library/system.io.directoryinfo.getfiles.aspx) aller Dateien im Verzeichnis zurückgegeben, als ein Array von [ `FileInfo` Objekte](https://msdn.microsoft.com/library/system.io.fileinfo.aspx), die dann an die GridView gebunden ist.</span><span class="sxs-lookup"><span data-stu-id="53b7f-324">The [`GetFiles()` method](https://msdn.microsoft.com/library/system.io.directoryinfo.getfiles.aspx) returns all of the files in the directory as an array of [`FileInfo` objects](https://msdn.microsoft.com/library/system.io.fileinfo.aspx), which is then bound to the GridView.</span></span> <span data-ttu-id="53b7f-325">Die `FileInfo` Objekt verfügt über eine Sammlung von Eigenschaften, z. B. `Name`, `Length`, und `IsReadOnly`, o. ä.</span><span class="sxs-lookup"><span data-stu-id="53b7f-325">The `FileInfo` object has an assortment of properties, such as `Name`, `Length`, and `IsReadOnly`, among others.</span></span> <span data-ttu-id="53b7f-326">Wie Sie aus der deklarativem Markup sehen können, zeigt die GridView lediglich die `Name` und `Length` Eigenschaften.</span><span class="sxs-lookup"><span data-stu-id="53b7f-326">As you can see from its declarative markup, the GridView displays just the `Name` and `Length` properties.</span></span>

> [!NOTE]
> <span data-ttu-id="53b7f-327">Die `DirectoryInfo` und `FileInfo` Klassen befinden sich in der [ `System.IO` Namespace](https://msdn.microsoft.com/library/system.io.aspx).</span><span class="sxs-lookup"><span data-stu-id="53b7f-327">The `DirectoryInfo` and `FileInfo` classes are found in the [`System.IO` namespace](https://msdn.microsoft.com/library/system.io.aspx).</span></span> <span data-ttu-id="53b7f-328">Aus diesem Grund werden Sie entweder erforderlich, stellen Sie diese Klassennamen mit ihren Namespacenamen oder den Namespace in die Klassendatei importiert haben (über `using System.IO`).</span><span class="sxs-lookup"><span data-stu-id="53b7f-328">Therefore, you will either need to preface these class names with their namespace names or have the namespace imported into the class file (via `using System.IO`).</span></span>


<span data-ttu-id="53b7f-329">Nehmen Sie einen Moment Zeit, um diese Seite über einen Browser besuchen.</span><span class="sxs-lookup"><span data-stu-id="53b7f-329">Take a moment to visit this page through a browser.</span></span> <span data-ttu-id="53b7f-330">Es zeigt die Liste der Dateien, die sich im Stammverzeichnis der Anwendung befinden.</span><span class="sxs-lookup"><span data-stu-id="53b7f-330">It will display the list of files residing in the application's root directory.</span></span> <span data-ttu-id="53b7f-331">Durch Klicken auf die Ansicht bzw. löschen LinkButtons führt dazu, dass einen Postback, jedoch keine Aktion tritt auf, da wir noch, haben die erforderlichen Ereignishandler zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="53b7f-331">Clicking any of the View or Delete LinkButtons will cause a postback, but no action will occur because we've yet to create the necessary event handlers.</span></span>


<span data-ttu-id="53b7f-332">[![Die GridView Listet die Dateien im Stammverzeichnis der Webanwendung](user-based-authorization-cs/_static/image20.png)](user-based-authorization-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="53b7f-332">[![The GridView Lists the Files in the Web Application's Root Directory](user-based-authorization-cs/_static/image20.png)](user-based-authorization-cs/_static/image19.png)</span></span>

<span data-ttu-id="53b7f-333">**Abbildung 7**: GridView Listet die Dateien im Stammverzeichnis der Webanwendung ([klicken Sie hier, um das Bild in voller Größe angezeigt](user-based-authorization-cs/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="53b7f-333">**Figure 7**: The GridView Lists the Files in the Web Application's Root Directory  ([Click to view full-size image](user-based-authorization-cs/_static/image21.png))</span></span>


<span data-ttu-id="53b7f-334">Wir benötigen eine Möglichkeit, um den Inhalt der ausgewählten Datei anzuzeigen.</span><span class="sxs-lookup"><span data-stu-id="53b7f-334">We need a means to display the contents of the selected file.</span></span> <span data-ttu-id="53b7f-335">Zurück zu Visual Studio, und fügen Sie ein Textfeld mit dem Namen `FileContents` oben GridView.</span><span class="sxs-lookup"><span data-stu-id="53b7f-335">Return to Visual Studio and add a TextBox named `FileContents` above the GridView.</span></span> <span data-ttu-id="53b7f-336">Legen Sie seine `TextMode` Eigenschaft, um `MultiLine` und dessen `Columns` und `Rows` Eigenschaften 95 %, 10, bzw.</span><span class="sxs-lookup"><span data-stu-id="53b7f-336">Set its `TextMode` property to `MultiLine` and its `Columns` and `Rows` properties to 95% and 10, respectively.</span></span>

[!code-aspx[Main](user-based-authorization-cs/samples/sample11.aspx)]

<span data-ttu-id="53b7f-337">Als Nächstes erstellen Sie einen Ereignishandler für der GridView [ `SelectedIndexChanged` Ereignis](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.selectedindexchanged.aspx) und fügen Sie den folgenden Code hinzu:</span><span class="sxs-lookup"><span data-stu-id="53b7f-337">Next, create an event handler for the GridView's [`SelectedIndexChanged` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.selectedindexchanged.aspx) and add the following code:</span></span>

[!code-csharp[Main](user-based-authorization-cs/samples/sample12.cs)]

<span data-ttu-id="53b7f-338">Dieser Code verwendet der GridView `SelectedValue` -Eigenschaft zum Bestimmen der vollständige Dateiname der ausgewählten Datei.</span><span class="sxs-lookup"><span data-stu-id="53b7f-338">This code uses the GridView's `SelectedValue` property to determine the full file name of the selected file.</span></span> <span data-ttu-id="53b7f-339">Intern die `DataKeys` Auflistung verwiesen wird, um das Abrufen der `SelectedValue`, daher ist es zwingend erforderlich, dass Sie festlegen, dass der GridView `DataKeyNames` Eigenschaft Namen, wie weiter oben in diesem Schritt beschrieben.</span><span class="sxs-lookup"><span data-stu-id="53b7f-339">Internally, the `DataKeys` collection is referenced in order to obtain the `SelectedValue`, so it is imperative that you set the GridView's `DataKeyNames` property to Name, as described earlier in this step.</span></span> <span data-ttu-id="53b7f-340">Die [ `File` Klasse](https://msdn.microsoft.com/library/system.io.file.aspx) wird verwendet, um den Inhalt der ausgewählten Datei in eine Zeichenfolge gelesen, die dann zugewiesen wird die `FileContents` Textfeldss `Text` -Eigenschaft, und zeigt den Inhalt der ausgewählten Datei auf der Seite.</span><span class="sxs-lookup"><span data-stu-id="53b7f-340">The [`File` class](https://msdn.microsoft.com/library/system.io.file.aspx) is used to read the selected file's contents into a string, which is then assigned to the `FileContents` TextBox's `Text` property, thereby displaying the contents of the selected file on the page.</span></span>


<span data-ttu-id="53b7f-341">[![Inhalt der ausgewählten Datei werden im Textfeld angezeigt.](user-based-authorization-cs/_static/image23.png)](user-based-authorization-cs/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="53b7f-341">[![The Selected File's Contents are Displayed in the TextBox](user-based-authorization-cs/_static/image23.png)](user-based-authorization-cs/_static/image22.png)</span></span>

<span data-ttu-id="53b7f-342">**Abbildung 8**: Inhalt der ausgewählten Datei in das Textfeld angezeigt werden ([klicken Sie hier, um das Bild in voller Größe angezeigt](user-based-authorization-cs/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="53b7f-342">**Figure 8**: The Selected File's Contents are Displayed in the TextBox  ([Click to view full-size image](user-based-authorization-cs/_static/image24.png))</span></span>


> [!NOTE]
> <span data-ttu-id="53b7f-343">Wenn Sie Anzeigen des Inhalts einer Datei, die HTML-Markup enthält, und dann versuchen, anzeigen oder Löschen einer Datei, erhalten Sie eine `HttpRequestValidationException` Fehler.</span><span class="sxs-lookup"><span data-stu-id="53b7f-343">If you view the contents of a file that contains HTML markup, and then attempt to view or delete a file, you will receive an `HttpRequestValidationException` error.</span></span> <span data-ttu-id="53b7f-344">Dies tritt auf, weil beim Postback Inhalt des Textfelds zurück an den Webserver gesendet werden.</span><span class="sxs-lookup"><span data-stu-id="53b7f-344">This occurs because on postback the TextBox's contents are sent back to the web server.</span></span> <span data-ttu-id="53b7f-345">Löst standardmäßig ASP.NET eine `HttpRequestValidationException` Fehler, wenn potenziell gefährliche postback Inhalt, z. B. HTML-Markup erkannt wird.</span><span class="sxs-lookup"><span data-stu-id="53b7f-345">By default, ASP.NET raises an `HttpRequestValidationException` error whenever potentially dangerous postback content, such as HTML markup, is detected.</span></span> <span data-ttu-id="53b7f-346">Um diesen Fehler aus, zu deaktivieren, deaktivieren Sie anforderungsüberprüfung für die Seite durch Hinzufügen von `ValidateRequest="false"` auf die `@Page` Richtlinie.</span><span class="sxs-lookup"><span data-stu-id="53b7f-346">To disable this error from occurring, turn off request validation for the page by adding `ValidateRequest="false"` to the `@Page` directive.</span></span> <span data-ttu-id="53b7f-347">Weitere Informationen zu den Vorteilen der anforderungsüberprüfung als sowie welche Vorsichtsmaßnahmen Sie beim Ausführen sollten, deaktivieren, finden Sie unter [Anforderungsvalidierung - Skript-Angriffe verhindert](https://asp.net/learn/whitepapers/request-validation/).</span><span class="sxs-lookup"><span data-stu-id="53b7f-347">For more information on the benefits of request validation as well as what precautions you should take when disabling it, read [Request Validation - Preventing Script Attacks](https://asp.net/learn/whitepapers/request-validation/).</span></span>


<span data-ttu-id="53b7f-348">Fügen Sie abschließend einen Ereignishandler durch den folgenden Code hinzu, für der GridView [ `RowDeleting` Ereignis](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.rowdeleting.aspx):</span><span class="sxs-lookup"><span data-stu-id="53b7f-348">Finally, add an event handler with the following code for the GridView's [`RowDeleting` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.rowdeleting.aspx):</span></span>

[!code-csharp[Main](user-based-authorization-cs/samples/sample13.cs)]

<span data-ttu-id="53b7f-349">Der Code einfach zeigt den vollständigen Namen der Datei, löschen Sie in der `FileContents` Textfeld *ohne* tatsächlich die Datei zu löschen.</span><span class="sxs-lookup"><span data-stu-id="53b7f-349">The code simply displays the full name of the file to delete in the `FileContents` TextBox *without* actually deleting the file.</span></span>


<span data-ttu-id="53b7f-350">[![Klicken auf die Schaltfläche "löschen" wird tatsächlich die Datei löschen nicht](user-based-authorization-cs/_static/image26.png)](user-based-authorization-cs/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="53b7f-350">[![Clicking the Delete Button Does Not Actually Delete the File](user-based-authorization-cs/_static/image26.png)](user-based-authorization-cs/_static/image25.png)</span></span>

<span data-ttu-id="53b7f-351">**Abbildung 9**: auf die Datei der löschen Schaltfläche wird nicht tatsächlich gelöscht ([klicken Sie hier, um das Bild in voller Größe angezeigt](user-based-authorization-cs/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="53b7f-351">**Figure 9**: Clicking the Delete Button Does Not Actually Delete the File  ([Click to view full-size image](user-based-authorization-cs/_static/image27.png))</span></span>


<span data-ttu-id="53b7f-352">In Schritt 1 konfiguriert es die URL-Autorisierungsregeln, um zu verhindern, dass anonyme Benutzer anzeigen von Seiten in der `Membership` Ordner.</span><span class="sxs-lookup"><span data-stu-id="53b7f-352">In Step 1 we configured the URL authorization rules to prohibit anonymous users from viewing the pages in the `Membership` folder.</span></span> <span data-ttu-id="53b7f-353">Um möglich, differenzierte Authentifizierung eine bessere Leistung aufweisen, können wir anonyme Benutzer besuchen der `UserBasedAuthorization.aspx` Seite, aber mit eingeschränkter Funktionalität.</span><span class="sxs-lookup"><span data-stu-id="53b7f-353">In order to better exhibit fine grain authentication, let's allow anonymous users to visit the `UserBasedAuthorization.aspx` page, but with limited functionality.</span></span> <span data-ttu-id="53b7f-354">Um diese Seite zu öffnen Sie durch alle Benutzer zugegriffen werden kann, fügen Sie die folgenden `<location>` Element auf der `Web.config` in der Datei die `Membership` Ordner:</span><span class="sxs-lookup"><span data-stu-id="53b7f-354">To open this page up to be accessed by all users, add the following `<location>` element to the `Web.config` file in the `Membership` folder:</span></span>

[!code-xml[Main](user-based-authorization-cs/samples/sample14.xml)]

<span data-ttu-id="53b7f-355">Nach dem Hinzufügen dieses `<location>` -Element, die neue URL-Autorisierungsregeln durch Anmeldung aus der Website testen.</span><span class="sxs-lookup"><span data-stu-id="53b7f-355">After adding this `<location>` element, test the new URL authorization rules by logging out of the site.</span></span> <span data-ttu-id="53b7f-356">Als anonymer Benutzer sollten Sie über eine Berechtigung für besuchen die `UserBasedAuthorization.aspx` Seite.</span><span class="sxs-lookup"><span data-stu-id="53b7f-356">As an anonymous user you should be permitted to visit the `UserBasedAuthorization.aspx` page.</span></span>

<span data-ttu-id="53b7f-357">Jeder authentifizierte oder anonyme Benutzer besuchen derzeit die `UserBasedAuthorization.aspx` Seite und anzeigen oder Löschen von Dateien.</span><span class="sxs-lookup"><span data-stu-id="53b7f-357">Currently, any authenticated or anonymous user can visit the `UserBasedAuthorization.aspx` page and view or delete files.</span></span> <span data-ttu-id="53b7f-358">Stellen sie so, dass nur authentifizierte Benutzer können den Inhalt einer Datei anzeigen, und nur Tito kann eine Datei gelöscht.</span><span class="sxs-lookup"><span data-stu-id="53b7f-358">Let's make it so that only authenticated users can view contents of a file and only Tito can delete a file.</span></span> <span data-ttu-id="53b7f-359">Solche möglich, differenzierte Autorisierungsregeln können deklarativ, programmgesteuert oder über eine Kombination beider Methoden angewendet werden.</span><span class="sxs-lookup"><span data-stu-id="53b7f-359">Such fine grain authorization rules can be applied declaratively, programmatically, or through a combination of both methods.</span></span> <span data-ttu-id="53b7f-360">Ermöglicht die Verwendung deklarativen Ansatzes zum einschränken, wer den Inhalt einer Datei anzeigen kann; Wir verwenden die programmgesteuerten Ansatz bis zur Grenze, die eine Datei löschen kann.</span><span class="sxs-lookup"><span data-stu-id="53b7f-360">Let's use the declarative approach to limit who can view the contents of a file; we'll use the programmatic approach to limit who can delete a file.</span></span>

### <a name="using-the-loginview-control"></a><span data-ttu-id="53b7f-361">Verwenden das LoginView-Steuerelement</span><span class="sxs-lookup"><span data-stu-id="53b7f-361">Using the LoginView Control</span></span>

<span data-ttu-id="53b7f-362">Wie wir im letzten Lernprogramme gesehen haben, das LoginView-Steuerelement eignet sich zum Anzeigen von anderen Schnittstellen für authentifizierte und anonyme Benutzer, und bietet ein einfaches Verfahren, um Funktionen auszublenden, die für anonyme Benutzer nicht zugänglich ist.</span><span class="sxs-lookup"><span data-stu-id="53b7f-362">As we've seen in past tutorials, the LoginView control is useful for displaying different interfaces for authenticated and anonymous users, and offers an easy way to hide functionality that is not accessible to anonymous users.</span></span> <span data-ttu-id="53b7f-363">Da anonyme Benutzer können nicht anzeigen oder Löschen von Dateien, wir brauchen nur zum Anzeigen der `FileContents` Textfeld aus, wenn die Seite von einem authentifizierten Benutzer besucht wird.</span><span class="sxs-lookup"><span data-stu-id="53b7f-363">Since anonymous users cannot view or delete files, we only need to show the `FileContents` TextBox when the page is visited by an authenticated user.</span></span> <span data-ttu-id="53b7f-364">Um dies zu erreichen, die Seite ein LoginView-Steuerelement hinzugefügt haben, nennen Sie sie `LoginViewForFileContentsTextBox`, und verschieben Sie die `FileContents` Textfeldss deklarativem Markup in des LoginView-Steuerelements `LoggedInTemplate`.</span><span class="sxs-lookup"><span data-stu-id="53b7f-364">To achieve this, add a LoginView control to the page, name it `LoginViewForFileContentsTextBox`, and move the `FileContents` TextBox's declarative markup into the LoginView control's `LoggedInTemplate`.</span></span>

[!code-aspx[Main](user-based-authorization-cs/samples/sample15.aspx)]

<span data-ttu-id="53b7f-365">Die Web-Steuerelemente in der LoginView-Vorlagen sind nicht mehr direkt aus der CodeBehind Klasse zugegriffen werden.</span><span class="sxs-lookup"><span data-stu-id="53b7f-365">The Web controls in the LoginView's templates are no longer directly accessible from the code-behind class.</span></span> <span data-ttu-id="53b7f-366">Z. B. die `FilesGrid` GridView `SelectedIndexChanged` und `RowDeleting` Ereignishandler derzeit verweisen die `FileContents` wie TextBox-Steuerelement durch Code:</span><span class="sxs-lookup"><span data-stu-id="53b7f-366">For example, the `FilesGrid` GridView's `SelectedIndexChanged` and `RowDeleting` event handlers currently reference the `FileContents` TextBox control with code like:</span></span>

[!code-csharp[Main](user-based-authorization-cs/samples/sample16.cs)]

<span data-ttu-id="53b7f-367">Dieser Code ist jedoch nicht mehr gültig.</span><span class="sxs-lookup"><span data-stu-id="53b7f-367">However, this code is no longer valid.</span></span> <span data-ttu-id="53b7f-368">Durch Verschieben der `FileContents` Textfeld in der `LoggedInTemplate` Textfeld kann nicht direkt zugegriffen werden.</span><span class="sxs-lookup"><span data-stu-id="53b7f-368">By moving the `FileContents` TextBox into the `LoggedInTemplate` the TextBox cannot be directly accessed.</span></span> <span data-ttu-id="53b7f-369">Stattdessen müssen wir verwenden die `FindControl("controlId")` Methode, um das Steuerelement programmgesteuert zu verweisen.</span><span class="sxs-lookup"><span data-stu-id="53b7f-369">Instead, we must use the `FindControl("controlId")` method to programmatically reference the control.</span></span> <span data-ttu-id="53b7f-370">Update der `FilesGrid` -Ereignishandler auf das Textfeld verweisen wie folgt:</span><span class="sxs-lookup"><span data-stu-id="53b7f-370">Update the `FilesGrid` event handlers to reference the TextBox like so:</span></span>

[!code-csharp[Main](user-based-authorization-cs/samples/sample17.cs)]

<span data-ttu-id="53b7f-371">Nach dem Verschieben des Textfelds auf die LoginView `LoggedInTemplate` und aktualisieren den Code der Seite zu verweisen, die das Textfeld mit dem `FindControl("controlId")` Muster, besuchen Sie die Seite als anonymer Benutzer.</span><span class="sxs-lookup"><span data-stu-id="53b7f-371">After moving the TextBox to the LoginView's `LoggedInTemplate` and updating the page's code to reference the TextBox using the `FindControl("controlId")` pattern, visit the page as an anonymous user.</span></span> <span data-ttu-id="53b7f-372">Wie in Abbildung 10 gezeigt, die `FileContents` Textfeld wird nicht angezeigt.</span><span class="sxs-lookup"><span data-stu-id="53b7f-372">As Figure 10 shows, the `FileContents` TextBox is not displayed.</span></span> <span data-ttu-id="53b7f-373">Die Ansicht LinkButton ist jedoch weiterhin angezeigt.</span><span class="sxs-lookup"><span data-stu-id="53b7f-373">However, the View LinkButton is still displayed.</span></span>


<span data-ttu-id="53b7f-374">[![LoginView-Steuerelement gerendert wird nur das Textfeld FileContents für authentifizierte Benutzer](user-based-authorization-cs/_static/image29.png)](user-based-authorization-cs/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="53b7f-374">[![The LoginView Control Only Renders the FileContents TextBox for Authenticated Users](user-based-authorization-cs/_static/image29.png)](user-based-authorization-cs/_static/image28.png)</span></span>

<span data-ttu-id="53b7f-375">**Abbildung 10**: die LoginView-Steuerelement nur rendert die `FileContents` TextBox für authentifizierte Benutzer ([klicken Sie hier, um das Bild in voller Größe angezeigt](user-based-authorization-cs/_static/image30.png))</span><span class="sxs-lookup"><span data-stu-id="53b7f-375">**Figure 10**: The LoginView Control Only Renders the `FileContents` TextBox for Authenticated Users  ([Click to view full-size image](user-based-authorization-cs/_static/image30.png))</span></span>


<span data-ttu-id="53b7f-376">Eine Möglichkeit zum Ausblenden der Schaltfläche "anzeigen" für anonyme Benutzer werden die GridView-Feld in ein TemplateField konvertiert.</span><span class="sxs-lookup"><span data-stu-id="53b7f-376">One way to hide the View button for anonymous users is to convert the GridView field into a TemplateField.</span></span> <span data-ttu-id="53b7f-377">Dadurch wird eine Vorlage, die für die Sicht LinkButton deklarative Markup enthält.</span><span class="sxs-lookup"><span data-stu-id="53b7f-377">This will generate a template that contains the declarative markup for the View LinkButton.</span></span> <span data-ttu-id="53b7f-378">Wir können dann die TemplateField LoginView-Steuerelement hinzu, und platzieren LinkButton innerhalb der LoginView `LoggedInTemplate`, wodurch die Schaltfläche "Ansicht" anonyme Besucher von ausblenden.</span><span class="sxs-lookup"><span data-stu-id="53b7f-378">We can then add a LoginView control to the TemplateField and place the LinkButton within the LoginView's `LoggedInTemplate`, thereby hiding the View button from anonymous visitors.</span></span> <span data-ttu-id="53b7f-379">Um dies zu erreichen, klicken Sie auf die Verknüpfung Spalten bearbeiten der GridView-Smarttag, um die Felder (Dialogfeld) zu starten.</span><span class="sxs-lookup"><span data-stu-id="53b7f-379">To accomplish this, click on the Edit Columns link from the GridView's Smart Tag to launch the Fields dialog box.</span></span> <span data-ttu-id="53b7f-380">Als nächstes wählen Sie die Schaltfläche auswählen, aus der Liste in der unteren linken Ecke aus, und klicken Sie dann auf dieses Feld auf einen Link TemplateField konvertieren.</span><span class="sxs-lookup"><span data-stu-id="53b7f-380">Next, select the Select button from the list in the lower left corner and then click the Convert this field to a TemplateField link.</span></span> <span data-ttu-id="53b7f-381">Auf diese Weise wird das Feld deklarativem Markup aus ändern:</span><span class="sxs-lookup"><span data-stu-id="53b7f-381">Doing so will modify the field's declarative markup from:</span></span>

[!code-aspx[Main](user-based-authorization-cs/samples/sample18.aspx)]

 <span data-ttu-id="53b7f-382">Nach:</span><span class="sxs-lookup"><span data-stu-id="53b7f-382">To:</span></span> 

[!code-aspx[Main](user-based-authorization-cs/samples/sample19.aspx)]

<span data-ttu-id="53b7f-383">An diesem Punkt können wir die TemplateField eine LoginView hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="53b7f-383">At this point, we can add a LoginView to the TemplateField.</span></span> <span data-ttu-id="53b7f-384">Das folgende Markup zeigt die Ansicht LinkButton nur für authentifizierte Benutzer.</span><span class="sxs-lookup"><span data-stu-id="53b7f-384">The following markup displays the View LinkButton only for authenticated users.</span></span>

[!code-aspx[Main](user-based-authorization-cs/samples/sample20.aspx)]

<span data-ttu-id="53b7f-385">Wie Abbildung 11 zeigt, ist das Endergebnis nicht, dass alles ziemlich wie die Sicht Spalte weiterhin angezeigt wird, obwohl die Sicht LinkButtons innerhalb der Spalte ausgeblendet sind.</span><span class="sxs-lookup"><span data-stu-id="53b7f-385">As Figure 11 shows, the end result is not that pretty as the View column is still displayed even though the View LinkButtons within the column are hidden.</span></span> <span data-ttu-id="53b7f-386">Wir werden im nächsten Abschnitt zum Ausblenden von der gesamten GridView-Spalte (und nicht nur die LinkButton) betrachten.</span><span class="sxs-lookup"><span data-stu-id="53b7f-386">We will look at how to hide the entire GridView column (and not just the LinkButton) in the next section.</span></span>


<span data-ttu-id="53b7f-387">[![LoginView-Steuerelement blendet Sie aus der Sicht LinkButtons für anonyme Besucher](user-based-authorization-cs/_static/image32.png)](user-based-authorization-cs/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="53b7f-387">[![The LoginView Control Hides the View LinkButtons for Anonymous Visitors](user-based-authorization-cs/_static/image32.png)](user-based-authorization-cs/_static/image31.png)</span></span>

<span data-ttu-id="53b7f-388">**Abbildung 11**: LoginView-Steuerelement blendet Sie aus der Sicht LinkButtons für anonyme Besucher ([klicken Sie hier, um das Bild in voller Größe angezeigt](user-based-authorization-cs/_static/image33.png))</span><span class="sxs-lookup"><span data-stu-id="53b7f-388">**Figure 11**: The LoginView Control Hides the View LinkButtons for Anonymous Visitors  ([Click to view full-size image](user-based-authorization-cs/_static/image33.png))</span></span>


### <a name="programmatically-limiting-functionality"></a><span data-ttu-id="53b7f-389">Funktionalität programmgesteuert beschränkt.</span><span class="sxs-lookup"><span data-stu-id="53b7f-389">Programmatically Limiting Functionality</span></span>

<span data-ttu-id="53b7f-390">In einigen Fällen reichen deklarative Techniken zum Einschränken der Funktionen zu einer Seite.</span><span class="sxs-lookup"><span data-stu-id="53b7f-390">In some circumstances, declarative techniques are insufficient for limiting functionality to a page.</span></span> <span data-ttu-id="53b7f-391">Die Verfügbarkeit von bestimmten Funktionen Seite möglicherweise z. B. Kriterien hinausgehen, ob der Benutzer Zugriff auf die Seite anonym oder authentifizierte abhängig.</span><span class="sxs-lookup"><span data-stu-id="53b7f-391">For example, the availability of certain page functionality may be dependent on criteria beyond whether the user visiting the page is anonymous or authenticated.</span></span> <span data-ttu-id="53b7f-392">In solchen Fällen können die verschiedenen Elemente der Benutzeroberfläche angezeigt oder durch programmgesteuerte Möglichkeit ausgeblendet werden.</span><span class="sxs-lookup"><span data-stu-id="53b7f-392">In such cases, the various user interface elements can be displayed or hidden through programmatic means.</span></span>

<span data-ttu-id="53b7f-393">Um die Funktionalität programmgesteuert zu beschränken, müssen wir zwei Aufgaben ausführen:</span><span class="sxs-lookup"><span data-stu-id="53b7f-393">In order to limit the functionality programmatically, we need to perform two tasks:</span></span>

1. <span data-ttu-id="53b7f-394">Bestimmen, ob der Benutzer Zugriff auf der Seite auf die Funktionalität zugreifen kann und</span><span class="sxs-lookup"><span data-stu-id="53b7f-394">Determine whether the user visiting the page can access the functionality, and</span></span>
2. <span data-ttu-id="53b7f-395">Programmgesteuert ändern der Benutzeroberfläche, die Grundlage, ob der Benutzer Zugriff auf die betreffenden Funktionen verfügt.</span><span class="sxs-lookup"><span data-stu-id="53b7f-395">Programmatically modify the user interface based on whether the user has access to the functionality in question.</span></span>

<span data-ttu-id="53b7f-396">Um die Anwendung dieser beiden Aufgaben zu veranschaulichen, sehen wir nur die Tito zum Löschen von Dateien aus der GridView erlauben.</span><span class="sxs-lookup"><span data-stu-id="53b7f-396">To demonstrate the application of these two tasks, let's only allow Tito to delete files from the GridView.</span></span> <span data-ttu-id="53b7f-397">Unsere erste Aufgabe ist, um festzustellen, ob es Tito besuchen die Seite ist.</span><span class="sxs-lookup"><span data-stu-id="53b7f-397">Our first task, then, is to determine whether it is Tito visiting the page.</span></span> <span data-ttu-id="53b7f-398">Sobald, ermittelt wurde, müssen wir die GridView Delete Spalte auszublenden (oder anzeigen).</span><span class="sxs-lookup"><span data-stu-id="53b7f-398">Once that has been determined, we need to hide (or show) the GridView's Delete column.</span></span> <span data-ttu-id="53b7f-399">Die GridView-Spalten werden über seine `Columns` Eigenschafts-wird nur eine Spalte gerendert, wenn seine `Visible` -Eigenschaftensatz auf `true` (Standard).</span><span class="sxs-lookup"><span data-stu-id="53b7f-399">The GridView's columns are accessible through its `Columns` property; a column is only rendered if its `Visible` property is set to `true` (the default).</span></span>

<span data-ttu-id="53b7f-400">Fügen Sie folgenden Code, der `Page_Load` -Ereignishandler vor dem Binden der Daten an die GridView:</span><span class="sxs-lookup"><span data-stu-id="53b7f-400">Add the following code to the `Page_Load` event handler prior to binding the data to the GridView:</span></span>

[!code-csharp[Main](user-based-authorization-cs/samples/sample21.cs)]

<span data-ttu-id="53b7f-401">Wie in erläutert die [ *eine Übersicht der Formularauthentifizierung* ](../introduction/an-overview-of-forms-authentication-cs.md) Lernprogramm `User.Identity.Name` gibt den Namen der Identität.</span><span class="sxs-lookup"><span data-stu-id="53b7f-401">As we discussed in the [*An Overview of Forms Authentication*](../introduction/an-overview-of-forms-authentication-cs.md) tutorial, `User.Identity.Name` returns the identity's name.</span></span> <span data-ttu-id="53b7f-402">Dies entspricht in das Steuerelement für die Anmeldung beim eingegebenen Benutzernamen.</span><span class="sxs-lookup"><span data-stu-id="53b7f-402">This corresponds to the username entered in the Login control.</span></span> <span data-ttu-id="53b7f-403">Tito besuchen die Seite, die GridView zweite Spalte ist `Visible` -Eigenschaftensatz auf `true`ist, andernfalls wird festgelegt ist, dass `false`.</span><span class="sxs-lookup"><span data-stu-id="53b7f-403">If it is Tito visiting the page, the GridView's second column's `Visible` property is set to `true`; otherwise, it is set to `false`.</span></span> <span data-ttu-id="53b7f-404">Das Ergebnis ist, dass wenn eine Person als Tito Seite, ein anderer authentifizierten Benutzer oder einen anonymen Benutzer besucht die Spalte Löschen nicht (siehe Abbildung 12); gerendert wird Wenn Tito auf die Seite besucht, die Spalte löschen ist jedoch vorhanden (siehe Abbildung 13).</span><span class="sxs-lookup"><span data-stu-id="53b7f-404">The net result is that when someone other than Tito visits the page, either another authenticated user or an anonymous user, the Delete column is not rendered (see Figure 12); however, when Tito visits the page, the Delete column is present (see Figure 13).</span></span>


<span data-ttu-id="53b7f-405">[![Die Spalte löschen, wird nicht gerendert beim besucht durch eine Person außer Tito (z. B. Bruce)](user-based-authorization-cs/_static/image35.png)](user-based-authorization-cs/_static/image34.png)</span><span class="sxs-lookup"><span data-stu-id="53b7f-405">[![The Delete Column is Not Rendered When Visited By Someone Other Than Tito (Such as Bruce)](user-based-authorization-cs/_static/image35.png)](user-based-authorization-cs/_static/image34.png)</span></span>

<span data-ttu-id="53b7f-406">**Abbildung 12**: Spalte für das Löschen wird nicht gerendert beim besucht durch eine Person außer Tito (z. B. Bruce) ([klicken Sie hier, um das Bild in voller Größe angezeigt](user-based-authorization-cs/_static/image36.png))</span><span class="sxs-lookup"><span data-stu-id="53b7f-406">**Figure 12**: The Delete Column is Not Rendered When Visited By Someone Other Than Tito (Such as Bruce)  ([Click to view full-size image](user-based-authorization-cs/_static/image36.png))</span></span>


<span data-ttu-id="53b7f-407">[![Die Spalte löschen wird für Tito gerendert.](user-based-authorization-cs/_static/image38.png)](user-based-authorization-cs/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="53b7f-407">[![The Delete Column is Rendered for Tito](user-based-authorization-cs/_static/image38.png)](user-based-authorization-cs/_static/image37.png)</span></span>

<span data-ttu-id="53b7f-408">**Abbildung 13**: die Spalte mit löschen für Tito gerendert wird ([klicken Sie hier, um das Bild in voller Größe angezeigt](user-based-authorization-cs/_static/image39.png))</span><span class="sxs-lookup"><span data-stu-id="53b7f-408">**Figure 13**: The Delete Column is Rendered for Tito  ([Click to view full-size image](user-based-authorization-cs/_static/image39.png))</span></span>


## <a name="step-4-applying-authorization-rules-to-classes-and-methods"></a><span data-ttu-id="53b7f-409">Schritt 4: Anwenden von Autorisierungsregeln auf Klassen und Methoden</span><span class="sxs-lookup"><span data-stu-id="53b7f-409">Step 4: Applying Authorization Rules to Classes and Methods</span></span>

<span data-ttu-id="53b7f-410">In Schritt 3 werden nicht zulässig für anonyme Benutzer anzeigen des Inhalts einer Datei und Löschen von Dateien auf alle Benutzer außer Tito untersagt.</span><span class="sxs-lookup"><span data-stu-id="53b7f-410">In Step 3 we disallowed anonymous users from viewing a file's contents and prohibited all users but Tito from deleting files.</span></span> <span data-ttu-id="53b7f-411">Dies wurde durch das Ausblenden von der zugehörigen Elemente der Benutzeroberfläche für nicht autorisierte Besucher über deklarative und programmgesteuerte Verfahren erreicht.</span><span class="sxs-lookup"><span data-stu-id="53b7f-411">This was accomplished by hiding the associated user interface elements for unauthorized visitors through declarative and programmatic techniques.</span></span> <span data-ttu-id="53b7f-412">In unserem Beispiel einfache ordnungsgemäß die Elemente der Benutzeroberfläche ausgeblendet wurde, einfache, aber wie sieht eine komplexere Standorten, wobei es möglicherweise viele verschiedene Arten, führen Sie die gleiche Funktionalität?</span><span class="sxs-lookup"><span data-stu-id="53b7f-412">For our simple example, properly hiding the user interface elements was straightforward, but what about more complex sites where there may be many different ways to perform the same functionality?</span></span> <span data-ttu-id="53b7f-413">In dieser Funktionalität für nicht autorisierte Benutzer beschränkt, was geschieht, wenn wir ausblenden oder deaktivieren alle Elemente der entsprechenden Benutzeroberfläche vergessen?</span><span class="sxs-lookup"><span data-stu-id="53b7f-413">In limiting that functionality to unauthorized users, what happens if we forget to hide or disable all of the applicable user interface elements?</span></span>

<span data-ttu-id="53b7f-414">Eine einfache Möglichkeit, stellen Sie sicher, dass ein nicht autorisierter Benutzer auf ein bestimmter Teil der Funktionalität zugreifen kann diese Klasse oder Methode mit ergänzt ist die [ `PrincipalPermission` Attribut](https://msdn.microsoft.com/library/system.security.permissions.principalpermissionattribute.aspx).</span><span class="sxs-lookup"><span data-stu-id="53b7f-414">An easy way to ensure that a particular piece of functionality cannot be accessed by an unauthorized user is to decorate that class or method with the [`PrincipalPermission` attribute](https://msdn.microsoft.com/library/system.security.permissions.principalpermissionattribute.aspx).</span></span> <span data-ttu-id="53b7f-415">Wenn der .NET Common Language Runtime eine Klasse verwendet oder eine der Methoden führt, überprüft stellen Sie sicher, dass der aktuelle Sicherheitskontext verfügt über die Berechtigung zum Verwenden der Klasse, oder führen Sie die Methode.</span><span class="sxs-lookup"><span data-stu-id="53b7f-415">When the .NET runtime uses a class or executes one of its methods, it checks to ensure that the current security context has permission to use the class or execute the method.</span></span> <span data-ttu-id="53b7f-416">Die `PrincipalPermission` Attribut bietet einen Mechanismus, der über den können wir diese Regeln definieren.</span><span class="sxs-lookup"><span data-stu-id="53b7f-416">The `PrincipalPermission` attribute provides a mechanism through which we can define these rules.</span></span>

<span data-ttu-id="53b7f-417">Wir veranschaulicht die Verwendung der `PrincipalPermission` Attribut für der GridView `SelectedIndexChanged` und `RowDeleting` Ereignishandler Ausführung durch anonyme Benutzer, und als Tito, bzw. verhindert werden soll.</span><span class="sxs-lookup"><span data-stu-id="53b7f-417">Let's demonstrate using the `PrincipalPermission` attribute on the GridView's `SelectedIndexChanged` and `RowDeleting` event handlers to prohibit execution by anonymous users and users other than Tito, respectively.</span></span> <span data-ttu-id="53b7f-418">Alles, was erforderlich ist, das entsprechende Attribut über jede Funktionsdefinition hinzufügen:</span><span class="sxs-lookup"><span data-stu-id="53b7f-418">All we need to do is add the appropriate attribute atop each function definition:</span></span>

[!code-csharp[Main](user-based-authorization-cs/samples/sample22.cs)]

<span data-ttu-id="53b7f-419">Das Attribut für die `SelectedIndexChanged` Ereignishandler gibt an, die nur Benutzer authentifizierte können den Ereignishandler ausführen, wobei als das Attribut auf die `RowDeleting` Ereignishandler beschränkt die Ausführung des Tito.</span><span class="sxs-lookup"><span data-stu-id="53b7f-419">The attribute for the `SelectedIndexChanged` event handler dictates that only authenticated users can execute the event handler, where as the attribute on the `RowDeleting` event handler limits the execution to Tito.</span></span>

<span data-ttu-id="53b7f-420">Wenn aus irgendeinem Grund, ein anderen Benutzer als Tito auszuführen versucht die `RowDeleting` Ereignishandler oder eine nicht authentifizierte Benutzer versucht, führen Sie die `SelectedIndexChanged` Ereignishandler, d. h. der .NET Common Language Runtime löst eine `SecurityException`.</span><span class="sxs-lookup"><span data-stu-id="53b7f-420">If, somehow, a user other than Tito attempts to execute the `RowDeleting` event handler or a non-authenticated user attempts to execute the `SelectedIndexChanged` event handler, the .NET runtime will raise a `SecurityException`.</span></span>


<span data-ttu-id="53b7f-421">[![Wenn der Sicherheitskontext zum Ausführen der Methode nicht autorisiert ist, wird eine SecurityException ausgelöst.](user-based-authorization-cs/_static/image41.png)](user-based-authorization-cs/_static/image40.png)</span><span class="sxs-lookup"><span data-stu-id="53b7f-421">[![If the Security Context is not Authorized to Execute the Method, a SecurityException is Thrown](user-based-authorization-cs/_static/image41.png)](user-based-authorization-cs/_static/image40.png)</span></span>

<span data-ttu-id="53b7f-422">**Abbildung 14**: Wenn der Sicherheitskontext nicht, zur Ausführung der Methode autorisiert ist ein `SecurityException` ausgelöst ([klicken Sie hier, um das Bild in voller Größe angezeigt](user-based-authorization-cs/_static/image42.png))</span><span class="sxs-lookup"><span data-stu-id="53b7f-422">**Figure 14**: If the Security Context is not Authorized to Execute the Method, a `SecurityException` is Thrown  ([Click to view full-size image](user-based-authorization-cs/_static/image42.png))</span></span>


> [!NOTE]
> <span data-ttu-id="53b7f-423">Um mehrere Sicherheitskontexten Zugriff auf eine Klasse oder Methode zuzulassen, ergänzen Sie die Klasse oder Methode mit einem `PrincipalPermission` Attribut für jede Sicherheitskontext.</span><span class="sxs-lookup"><span data-stu-id="53b7f-423">To allow multiple security contexts to access a class or method, decorate the class or method with a `PrincipalPermission` attribute for each security context.</span></span> <span data-ttu-id="53b7f-424">D. h. um Tito und Bruce ausführen können die `RowDeleting` Ereignishandler, d. h. hinzufügen *zwei* `PrincipalPermission` Attribute:</span><span class="sxs-lookup"><span data-stu-id="53b7f-424">That is, to allow both Tito and Bruce to execute the `RowDeleting` event handler, add *two* `PrincipalPermission` attributes:</span></span>


[!code-csharp[Main](user-based-authorization-cs/samples/sample23.cs)]

<span data-ttu-id="53b7f-425">Zusätzlich zu ASP.NET-Seiten haben viele Anwendungen auch eine Architektur, die verschiedenen Ebenen, wie z. B. von Geschäftslogik und Datenzugriffsebenen Daten enthält.</span><span class="sxs-lookup"><span data-stu-id="53b7f-425">In addition to ASP.NET pages, many applications also have an architecture that includes various layers, such as Business Logic and Data Access Layers.</span></span> <span data-ttu-id="53b7f-426">Diese Ebenen werden in der Regel als Klassenbibliotheken implementiert und bieten Klassen und Methoden zum Ausführen von Geschäftsfunktionen Logik und Daten, die verknüpft.</span><span class="sxs-lookup"><span data-stu-id="53b7f-426">These layers are typically implemented as Class Libraries and offer classes and methods for performing business logic- and data-related functionality.</span></span> <span data-ttu-id="53b7f-427">Die `PrincipalPermission` Attribut eignet sich für das Anwenden von Autorisierungsregeln auf diesen Ebenen gehört.</span><span class="sxs-lookup"><span data-stu-id="53b7f-427">The `PrincipalPermission` attribute is useful for applying authorization rules to these layers.</span></span>

<span data-ttu-id="53b7f-428">Weitere Informationen zur Verwendung der `PrincipalPermission` Attribut Autorisierungsregeln für Klassen und Methoden definieren, finden Sie unter [Scott Guthrie](https://weblogs.asp.net/scottgu/)des Blogeintrag [Hinzufügen von Autorisierungsregeln zu Business und Ebenen mithilfe`PrincipalPermissionAttributes` ](https://weblogs.asp.net/scottgu/archive/2006/10/04/Tip_2F00_Trick_3A00_-Adding-Authorization-Rules-to-Business-and-Data-Layers-using-PrincipalPermissionAttributes.aspx).</span><span class="sxs-lookup"><span data-stu-id="53b7f-428">For more information on using the `PrincipalPermission` attribute to define authorization rules on classes and methods, refer to [Scott Guthrie](https://weblogs.asp.net/scottgu/)'s blog entry [Adding Authorization Rules to Business and Data Layers Using `PrincipalPermissionAttributes`](https://weblogs.asp.net/scottgu/archive/2006/10/04/Tip_2F00_Trick_3A00_-Adding-Authorization-Rules-to-Business-and-Data-Layers-using-PrincipalPermissionAttributes.aspx).</span></span>

## <a name="summary"></a><span data-ttu-id="53b7f-429">Zusammenfassung</span><span class="sxs-lookup"><span data-stu-id="53b7f-429">Summary</span></span>

<span data-ttu-id="53b7f-430">In diesem Lernprogramm wurde erläutert, wie benutzerbasierte Autorisierungsregeln angewendet.</span><span class="sxs-lookup"><span data-stu-id="53b7f-430">In this tutorial we looked at how to apply user-based authorization rules.</span></span> <span data-ttu-id="53b7f-431">Wir beginnen mit einem Blick auf ASP. NET URL-Autorisierung-Framework.</span><span class="sxs-lookup"><span data-stu-id="53b7f-431">We started with a look at ASP.NET's URL authorization framework.</span></span> <span data-ttu-id="53b7f-432">Für jede Anforderung, das Modul für ASP.NET `UrlAuthorizationModule` untersucht die URL-Autorisierungsregeln, die definiert, in der Anwendungskonfigurationsdatei, um zu bestimmen, ob die Identität autorisiert ist, auf die angeforderte Ressource zuzugreifen.</span><span class="sxs-lookup"><span data-stu-id="53b7f-432">On each request, the ASP.NET engine's `UrlAuthorizationModule` inspects the URL authorization rules defined in the application's configuration to determine whether the identity is authorized to access the requested resource.</span></span> <span data-ttu-id="53b7f-433">Kurz gesagt, vereinfacht URL-Autorisierung Autorisierungsregeln für eine bestimmte Seite oder für alle Seiten in einem bestimmten Verzeichnis angeben.</span><span class="sxs-lookup"><span data-stu-id="53b7f-433">In short, URL authorization makes it easy to specify authorization rules for a specific page or for all pages in a particular directory.</span></span>

<span data-ttu-id="53b7f-434">Die URL-Autorisierungsframework gilt Autorisierungsregeln auf Basis von Seite.</span><span class="sxs-lookup"><span data-stu-id="53b7f-434">The URL authorization framework applies authorization rules on a page-by-page basis.</span></span> <span data-ttu-id="53b7f-435">Mit URL-Autorisierung ist entweder die anfordernde Identität autorisiert, auf eine bestimmte Ressource zugreifen, oder nicht.</span><span class="sxs-lookup"><span data-stu-id="53b7f-435">With URL authorization, either the requesting identity is authorized to access a particular resource or not.</span></span> <span data-ttu-id="53b7f-436">Viele Szenarien, rufen Sie jedoch für weitere möglich, differenzierte Autorisierungsregeln.</span><span class="sxs-lookup"><span data-stu-id="53b7f-436">Many scenarios, however, call for more fine grain authorization rules.</span></span> <span data-ttu-id="53b7f-437">Anstatt zu definieren, die Zugriff auf eine Seite zulässig ist, müssen wir möglicherweise "Jeder" Zugriff auf eine Seite zu ermöglichen, aber das Anzeigen von anderer Daten oder bieten unterschiedliche Funktionen aufgerufen, abhängig von der Benutzer Zugriff auf die Seite.</span><span class="sxs-lookup"><span data-stu-id="53b7f-437">Rather than defining who is permitted to access a page, we may need to let everyone access a page, but to show different data or offer different functionality depending on the user visiting the page.</span></span> <span data-ttu-id="53b7f-438">Autorisierung auf Seitenebene bedingt normalerweise zum Ausblenden von bestimmte Elemente der Benutzeroberfläche, um zu verhindern, dass nicht autorisierte Benutzer Zugriff auf unzulässige Funktion.</span><span class="sxs-lookup"><span data-stu-id="53b7f-438">Page-level authorization usually involves hiding specific user interface elements in order to prevent unauthorized users from accessing prohibited functionality.</span></span> <span data-ttu-id="53b7f-439">Darüber hinaus ist es möglich, die Attribute verwenden, um den Zugriff auf Klassen und Ausführung der Methoden für bestimmte Benutzer beschränken.</span><span class="sxs-lookup"><span data-stu-id="53b7f-439">Additionally, it is possible to use attributes to restrict access to classes and execution of its methods for certain users.</span></span>

<span data-ttu-id="53b7f-440">Viel Spaß beim Programmieren!</span><span class="sxs-lookup"><span data-stu-id="53b7f-440">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="53b7f-441">Weiterführende Themen</span><span class="sxs-lookup"><span data-stu-id="53b7f-441">Further Reading</span></span>

<span data-ttu-id="53b7f-442">Weitere Informationen zu den Themen in diesem Lernprogramm erläutert finden Sie in den folgenden Ressourcen:</span><span class="sxs-lookup"><span data-stu-id="53b7f-442">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="53b7f-443">Hinzufügen von Autorisierungsregeln für Geschäft und Ebenen der Daten mithilfe von `PrincipalPermissionAttributes`</span><span class="sxs-lookup"><span data-stu-id="53b7f-443">Adding Authorization Rules to Business and Data Layers Using `PrincipalPermissionAttributes`</span></span>](https://weblogs.asp.net/scottgu/archive/2006/10/04/Tip_2F00_Trick_3A00_-Adding-Authorization-Rules-to-Business-and-Data-Layers-using-PrincipalPermissionAttributes.aspx)
- [<span data-ttu-id="53b7f-444">ASP.NET-Autorisierung</span><span class="sxs-lookup"><span data-stu-id="53b7f-444">ASP.NET Authorization</span></span>](https://msdn.microsoft.com/library/wce3kxhd.aspx)
- [<span data-ttu-id="53b7f-445">Unterschiede zwischen der IIS 6 und IIS 7-Sicherheit</span><span class="sxs-lookup"><span data-stu-id="53b7f-445">Changes Between IIS6 and IIS7 Security</span></span>](https://www.iis.net/articles/view.aspx/IIS7/Managing-IIS7/Configuring-Security/Changes-between-IIS6-and-IIS7-Security)
- [<span data-ttu-id="53b7f-446">Konfigurieren bestimmte Dateien und Unterverzeichnisse</span><span class="sxs-lookup"><span data-stu-id="53b7f-446">Configuring Specific Files and Subdirectories</span></span>](https://msdn.microsoft.com/library/6hbkh9s7.aspx)
- [<span data-ttu-id="53b7f-447">Datenfunktionen Änderung basierend auf dem Benutzer beschränken</span><span class="sxs-lookup"><span data-stu-id="53b7f-447">Limiting Data Modification Functionality Based on the User</span></span>](../../data-access/editing-inserting-and-deleting-data/limiting-data-modification-functionality-based-on-the-user-cs.md)
- [<span data-ttu-id="53b7f-448">LoginView-Steuerelement-Schnellstarts</span><span class="sxs-lookup"><span data-stu-id="53b7f-448">LoginView Control QuickStarts</span></span>](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/login/loginview.aspx)
- [<span data-ttu-id="53b7f-449">Grundlegendes zu IIS7-URL-Autorisierung</span><span class="sxs-lookup"><span data-stu-id="53b7f-449">Understanding IIS7 URL Authorization</span></span>](https://www.iis.net/articles/view.aspx/IIS7/Managing-IIS7/Configuring-Security/URL-Authorization/Understanding-IIS7-URL-Authorization)
- [<span data-ttu-id="53b7f-450">`UrlAuthorizationModule` Technische Dokumentation</span><span class="sxs-lookup"><span data-stu-id="53b7f-450">`UrlAuthorizationModule` Technical Documentation</span></span>](https://msdn.microsoft.com/library/system.web.security.urlauthorizationmodule.aspx)
- [<span data-ttu-id="53b7f-451">Arbeiten mit Daten in ASP.NET 2.0</span><span class="sxs-lookup"><span data-stu-id="53b7f-451">Working with Data in ASP.NET 2.0</span></span>](../../data-access/index.md)

### <a name="about-the-author"></a><span data-ttu-id="53b7f-452">Informationen zum Autor</span><span class="sxs-lookup"><span data-stu-id="53b7f-452">About the Author</span></span>

<span data-ttu-id="53b7f-453">Scott Mitchell, Autor von mehreren ASP/ASP.NET-Büchern und Gründer von 4GuysFromRolla.com, bereits seit 1998 mit Microsoft-Web-Technologien gearbeitet.</span><span class="sxs-lookup"><span data-stu-id="53b7f-453">Scott Mitchell, author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="53b7f-454">Scott fungiert als ein unabhängiger Berater, Trainer und Writer.</span><span class="sxs-lookup"><span data-stu-id="53b7f-454">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="53b7f-455">Sein neueste Buch wird  *[Sams Schulen selbst ASP.NET 2.0 in 24 Stunden](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span><span class="sxs-lookup"><span data-stu-id="53b7f-455">His latest book is *[Sams Teach Yourself ASP.NET 2.0 in 24 Hours](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span></span> <span data-ttu-id="53b7f-456">Scott erreicht werden kann, zur [ mitchell@4guysfromrolla.com ](mailto:mitchell@4guysfromrolla.com) oder über seinen Blog unter [ http://ScottOnWriting.NET ](http://scottonwriting.net/).</span><span class="sxs-lookup"><span data-stu-id="53b7f-456">Scott can be reached at [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="53b7f-457">Besonderen Dank an</span><span class="sxs-lookup"><span data-stu-id="53b7f-457">Special Thanks To</span></span>

<span data-ttu-id="53b7f-458">Diese Reihe von Lernprogrammen wurde durch viele nützliche Bearbeiter überprüft.</span><span class="sxs-lookup"><span data-stu-id="53b7f-458">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="53b7f-459">Meine bevorstehende MSDN-Artikel Überprüfen von Interesse?</span><span class="sxs-lookup"><span data-stu-id="53b7f-459">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="53b7f-460">Wenn dies der Fall ist, löschen Sie mich zeilenweise [ mitchell@4GuysFromRolla.com ](mailto:mitchell@4GuysFromRolla.com).</span><span class="sxs-lookup"><span data-stu-id="53b7f-460">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="53b7f-461">[Zurück](validating-user-credentials-against-the-membership-user-store-cs.md)
> [Weiter](storing-additional-user-information-cs.md)</span><span class="sxs-lookup"><span data-stu-id="53b7f-461">[Previous](validating-user-credentials-against-the-membership-user-store-cs.md)
[Next](storing-additional-user-information-cs.md)</span></span>
