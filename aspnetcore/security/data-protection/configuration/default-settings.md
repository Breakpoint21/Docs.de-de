---
title: "Verwalten von Schlüsseln und Lebensdauer"
author: rick-anderson
description: "Beschreibt schlüsselverwaltung sowie seine Lebensdauer."
keywords: "ASP.NET Core, schlüsselverwaltung, DPAPI, DataProtection"
ms.author: riande
manager: wpickett
ms.date: 10/14/2016
ms.topic: article
ms.assetid: ef7dad2a-7029-4ae5-8f06-1fbebedccaa4
ms.technology: aspnet
ms.prod: asp.net-core
uid: security/data-protection/configuration/default-settings
ms.openlocfilehash: 5ac2d80e7d1cebcbc792e1247608e67991ec36f4
ms.sourcegitcommit: 8f4d4fad1ca27adf9e396f5c205c9875a3963664
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 10/13/2017
---
# <a name="key-management-and-lifetime"></a><span data-ttu-id="6a638-104">Verwalten von Schlüsseln und Lebensdauer</span><span class="sxs-lookup"><span data-stu-id="6a638-104">Key management and lifetime</span></span>

<a name="data-protection-default-settings"></a>

## <a name="key-management"></a><span data-ttu-id="6a638-105">Schlüsselverwaltung</span><span class="sxs-lookup"><span data-stu-id="6a638-105">Key Management</span></span>

<span data-ttu-id="6a638-106">Das System versucht, erkennen die betriebsumgebung, und geben Sie gute Konfigurationsfreie verhaltensbasierten Standardwerte.</span><span class="sxs-lookup"><span data-stu-id="6a638-106">The system tries to detect its operational environment and provide good zero-configuration behavioral defaults.</span></span> <span data-ttu-id="6a638-107">Die verwendete Heuristik lautet wie folgt.</span><span class="sxs-lookup"><span data-stu-id="6a638-107">The heuristic used is as follows.</span></span>

1. <span data-ttu-id="6a638-108">Wenn das System in Azure-Websites gehostet wird, werden die Schlüssel in den Ordner "% HOME%\ASP.NET\DataProtection-Keys" beibehalten.</span><span class="sxs-lookup"><span data-stu-id="6a638-108">If the system is being hosted in Azure Web Sites, keys are persisted to the "%HOME%\ASP.NET\DataProtection-Keys" folder.</span></span> <span data-ttu-id="6a638-109">Dieser Ordner wird vom Netzwerkspeicher gesichert und wird für alle Computer, der die Anwendung hostet synchronisiert.</span><span class="sxs-lookup"><span data-stu-id="6a638-109">This folder is backed by network storage and is synchronized across all machines hosting the application.</span></span> <span data-ttu-id="6a638-110">Schlüssel werden nicht im Ruhezustand geschützt.</span><span class="sxs-lookup"><span data-stu-id="6a638-110">Keys are not protected at rest.</span></span> <span data-ttu-id="6a638-111">Dieser Ordner stellt den Schlüssel Ring für alle Instanzen einer Anwendung in einen einzelnen bereitstellungsslot bereit.</span><span class="sxs-lookup"><span data-stu-id="6a638-111">This folder supplies the key ring to all instances of an application in a single deployment slot.</span></span> <span data-ttu-id="6a638-112">Separate bereitstellungsslots, z. B. Staging und Produktion verwendet einen Schlüssel Ring nicht gemeinsam.</span><span class="sxs-lookup"><span data-stu-id="6a638-112">Separate deployment slots, such as Staging and Production, will not share a key ring.</span></span> <span data-ttu-id="6a638-113">Wenn Sie zwischen bereitstellungsslots, z. B. Staging bis zur Produktion ausgetauscht oder mithilfe von austauschen / B-Tests, werden jedem System mithilfe von Datenschutz nicht gespeicherte Daten mithilfe der Schlüssel Ring innerhalb des vorherigen Slots zu entschlüsseln.</span><span class="sxs-lookup"><span data-stu-id="6a638-113">When you swap between deployment slots, for example swapping Staging to Production or using A/B testing, any system using data protection will not be able to decrypt stored data using the key ring inside the previous slot.</span></span> <span data-ttu-id="6a638-114">Dies wird für Benutzer, die aus einer ASP.NET-Anwendung, die die standard-ASP.NET-Cookie-Middleware verwendet protokolliert werden, da er Schutz von Daten verwendet, um die Cookies zu schützen.</span><span class="sxs-lookup"><span data-stu-id="6a638-114">This will lead to users being logged out of an ASP.NET application that uses the standard ASP.NET cookie middleware, as it uses data protection to protect its cookies.</span></span> <span data-ttu-id="6a638-115">Wenn Slot unabhängig Schlüssel Ringe gewünscht Verwenden eines externen Schlüsselbund-Anbieters, z. B. Azure Blob-Speicher, Azure Key Vault, eine SQL-Speicher oder Redis-Cache.</span><span class="sxs-lookup"><span data-stu-id="6a638-115">If you desire slot-independent key rings, use an external key ring provider, such as Azure Blob Storage, Azure Key Vault, a SQL store, or Redis cache.</span></span>

2. <span data-ttu-id="6a638-116">Wenn das Benutzerprofil verfügbar ist, werden die Schlüssel in den Ordner "% LOCALAPPDATA%\ASP.NET\DataProtection-Keys" beibehalten.</span><span class="sxs-lookup"><span data-stu-id="6a638-116">If the user profile is available, keys are persisted to the "%LOCALAPPDATA%\ASP.NET\DataProtection-Keys" folder.</span></span> <span data-ttu-id="6a638-117">Darüber hinaus, wenn das Betriebssystem Windows ist, müssen sie im Ruhezustand mit DPAPI verschlüsselt werden.</span><span class="sxs-lookup"><span data-stu-id="6a638-117">Additionally, if the operating system is Windows, they'll be encrypted at rest using DPAPI.</span></span>

3. <span data-ttu-id="6a638-118">Wenn die Anwendung in IIS gehostet wird, werden die Schlüssel in einen speziellen Registrierungsschlüssel der HKLM-Registrierung beibehalten, die nur für das Arbeitsprozesskonto ACLed ist.</span><span class="sxs-lookup"><span data-stu-id="6a638-118">If the application is hosted in IIS, keys are persisted to the HKLM registry in a special registry key that is ACLed only to the worker process account.</span></span> <span data-ttu-id="6a638-119">Schlüssel werden im Ruhezustand mit DPAPI verschlüsselt.</span><span class="sxs-lookup"><span data-stu-id="6a638-119">Keys are encrypted at rest using DPAPI.</span></span>

4. <span data-ttu-id="6a638-120">Wenn keine dieser Bedingungen übereinstimmt, werden die Schlüssel nicht außerhalb des aktuellen Prozesses beibehalten.</span><span class="sxs-lookup"><span data-stu-id="6a638-120">If none of these conditions matches, keys are not persisted outside of the current process.</span></span> <span data-ttu-id="6a638-121">Wenn der Prozess, alle generierten heruntergefahren verloren Schlüssel.</span><span class="sxs-lookup"><span data-stu-id="6a638-121">When the process shuts down, all generated keys will be lost.</span></span>

<span data-ttu-id="6a638-122">Der Entwickler ist immer vollständige Kontrolle und überschreiben kann, wie, und wo Schlüssel gespeichert werden.</span><span class="sxs-lookup"><span data-stu-id="6a638-122">The developer is always in full control and can override how and where keys are stored.</span></span> <span data-ttu-id="6a638-123">Die ersten drei oben aufgeführten Optionen sollten gute Standardwerte für die meisten Anwendungen, die ähnlich wie beim ASP.NET <machineKey> automatische Generierung Routinen in der Vergangenheit funktioniert hat.</span><span class="sxs-lookup"><span data-stu-id="6a638-123">The first three options above should good defaults for most applications similar to how the ASP.NET <machineKey> auto-generation routines worked in the past.</span></span> <span data-ttu-id="6a638-124">Der endgültige fallen-zurück-Option ist das einzige Szenario, die den Entwickler angeben tatsächlich erforderlich sind [Konfiguration](overview.md) vorgelagerten, wenn sie schlüsselpersistenz, aber diese fallen-zurück es nur in seltenen Fällen kommt.</span><span class="sxs-lookup"><span data-stu-id="6a638-124">The final, fall back option is the only scenario that truly requires the developer to specify [configuration](overview.md) upfront if they want key persistence, but this fall-back would only occur in rare situations.</span></span>

>[!WARNING]
> <span data-ttu-id="6a638-125">Wenn der Entwickler dieser heuristische Wert überschreibt und die Datenschutzsystem an einem bestimmten Schlüssel Repository verweist, werden automatische Verschlüsselung der Schlüssel im Ruhezustand deaktiviert.</span><span class="sxs-lookup"><span data-stu-id="6a638-125">If the developer overrides this heuristic and points the data protection system at a specific key repository, automatic encryption of keys at rest will be disabled.</span></span> <span data-ttu-id="6a638-126">Ruhende Schutz wieder aktiviert werden kann [Konfiguration](overview.md).</span><span class="sxs-lookup"><span data-stu-id="6a638-126">At rest protection can be re-enabled via [configuration](overview.md).</span></span>

## <a name="key-lifetime"></a><span data-ttu-id="6a638-127">Gültigkeitsdauer</span><span class="sxs-lookup"><span data-stu-id="6a638-127">Key Lifetime</span></span>

<span data-ttu-id="6a638-128">Schlüssel in der Standardeinstellung haben eine 90-Tage-Lebensdauer.</span><span class="sxs-lookup"><span data-stu-id="6a638-128">Keys by default have a 90-day lifetime.</span></span> <span data-ttu-id="6a638-129">Wenn ein Schlüssel läuft ab, das System automatisch einen neuen Schlüssel generieren und den neuen Schlüssel als aktiver Schlüssel festgelegt.</span><span class="sxs-lookup"><span data-stu-id="6a638-129">When a key expires, the system will automatically generate a new key and set the new key as the active key.</span></span> <span data-ttu-id="6a638-130">Als veraltet Schlüssel auf dem System bleiben sein Sie immer noch Entschlüsseln von Daten mit diesen geschützt.</span><span class="sxs-lookup"><span data-stu-id="6a638-130">As long as retired keys remain on the system you will still be able to decrypt any data protected with them.</span></span> <span data-ttu-id="6a638-131">Finden Sie unter [schlüsselverwaltung](../implementation/key-management.md#data-protection-implementation-key-management-expiration) für Weitere Informationen.</span><span class="sxs-lookup"><span data-stu-id="6a638-131">See [key management](../implementation/key-management.md#data-protection-implementation-key-management-expiration) for more information.</span></span>

## <a name="default-algorithms"></a><span data-ttu-id="6a638-132">Standardalgorithmen</span><span class="sxs-lookup"><span data-stu-id="6a638-132">Default Algorithms</span></span>

<span data-ttu-id="6a638-133">Die Nutzlast Schutz verwendete Standardalgorithmus ist AES-256-CBC für Vertraulichkeit und HMACSHA256 für erstellen.</span><span class="sxs-lookup"><span data-stu-id="6a638-133">The default payload protection algorithm used is AES-256-CBC for confidentiality and HMACSHA256 for authenticity.</span></span> <span data-ttu-id="6a638-134">512-Bit-Hauptschlüssel, jeweils nach 90 Tagen zurückgesetzt wird verwendet, die zwei untergeordneten Schlüssel für diese Algorithmen auf der Basis eines je Nutzlast verwendet abgeleitet werden.</span><span class="sxs-lookup"><span data-stu-id="6a638-134">A 512-bit master key, rolled every 90 days, is used to derive the two sub-keys used for these algorithms on a per-payload basis.</span></span> <span data-ttu-id="6a638-135">Finden Sie unter [Unterschlüssel Ableitung](../implementation/subkeyderivation.md#data-protection-implementation-subkey-derivation-aad) für Weitere Informationen.</span><span class="sxs-lookup"><span data-stu-id="6a638-135">See [subkey derivation](../implementation/subkeyderivation.md#data-protection-implementation-subkey-derivation-aad) for more information.</span></span>
