---
uid: web-forms/overview/data-access/paging-and-sorting/efficiently-paging-through-large-amounts-of-data-cs
title: Effizient Paging durch große Mengen von Daten (c#) | Microsoft Docs
author: rick-anderson
description: Die Standardoption für die Auslagerungsdatei des Steuerelements eine Präsentation ist nicht geeignet, bei der Arbeit mit großen Datenmengen Daten wie die zugrunde liegenden Daten Source Control Retriev...
ms.author: aspnetcontent
manager: wpickett
ms.date: 08/15/2006
ms.topic: article
ms.assetid: 59c01998-9326-4ecb-9392-cb9615962140
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/data-access/paging-and-sorting/efficiently-paging-through-large-amounts-of-data-cs
msc.type: authoredcontent
ms.openlocfilehash: ea1fd06f8eb7c53c3e9e7fb10c46974eb2af2acd
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 04/06/2018
ms.locfileid: "30889656"
---
<a name="efficiently-paging-through-large-amounts-of-data-c"></a><span data-ttu-id="abb7b-103">Effizient Paging durch große Mengen von Daten (c#)</span><span class="sxs-lookup"><span data-stu-id="abb7b-103">Efficiently Paging Through Large Amounts of Data (C#)</span></span>
====================
<span data-ttu-id="abb7b-104">durch [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="abb7b-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="abb7b-105">[Beispiel-App herunterladen](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_25_CS.exe) oder [PDF herunterladen](efficiently-paging-through-large-amounts-of-data-cs/_static/datatutorial25cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="abb7b-105">[Download Sample App](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_25_CS.exe) or [Download PDF](efficiently-paging-through-large-amounts-of-data-cs/_static/datatutorial25cs1.pdf)</span></span>

> <span data-ttu-id="abb7b-106">Die Standardoption für die Auslagerungsdatei des Steuerelements eine Präsentation ist ungeeignet, bei der Arbeit mit großen Mengen von Daten, während die zugrunde liegenden Datenquellen-Steuerelement alle Datensätze abruft, obwohl nur eine Teilmenge der Daten angezeigt wird.</span><span class="sxs-lookup"><span data-stu-id="abb7b-106">The default paging option of a data presentation control is unsuitable when working with large amounts of data, as its underlying data source control retrieves all records, even though only a subset of data is displayed.</span></span> <span data-ttu-id="abb7b-107">Unter solchen Umständen müssen Aktualisierungsfehler an benutzerdefinierte paging.</span><span class="sxs-lookup"><span data-stu-id="abb7b-107">In such circumstances, we must turn to custom paging.</span></span>


## <a name="introduction"></a><span data-ttu-id="abb7b-108">Einführung</span><span class="sxs-lookup"><span data-stu-id="abb7b-108">Introduction</span></span>

<span data-ttu-id="abb7b-109">Wie im vorherigen Lernprogramm erläutert, kann die Auslagerung auf zwei Arten implementiert werden:</span><span class="sxs-lookup"><span data-stu-id="abb7b-109">As we discussed in the preceding tutorial, paging can be implemented in one of two ways:</span></span>

- <span data-ttu-id="abb7b-110">**Standardnavigation** kann implementiert werden, indem Sie einfach das Paging aktivieren-Option in den Daten-Websteuerelement s Smarttag; allerdings immer eine Seite mit Daten anzeigen zu können, das ObjectDataSource ruft *alle* der Datensätze, sogar Obwohl nur eine Teilmenge davon auf der Seite angezeigt werden</span><span class="sxs-lookup"><span data-stu-id="abb7b-110">**Default Paging** can be implemented by simply checking the Enable Paging option in the data Web control s smart tag; however, whenever viewing a page of data, the ObjectDataSource retrieves *all* of the records, even though only a subset of them are displayed in the page</span></span>
- <span data-ttu-id="abb7b-111">**Benutzerdefiniertes Paging** verbessert die Leistung von Standard-paging durch Abrufen von nur Datensätze aus der Datenbank, die für bestimmte Seite durch den Benutzer angeforderte Datenbereich angezeigt werden müssen, benutzerdefiniertes Paging umfasst jedoch ein wenig mehr Aufwand implementieren als Standardpaging</span><span class="sxs-lookup"><span data-stu-id="abb7b-111">**Custom Paging** improves the performance of default paging by retrieving only those records from the database that need to be displayed for the particular page of data requested by the user; however, custom paging involves a bit more effort to implement than default paging</span></span>

<span data-ttu-id="abb7b-112">Aufgrund der einfachen Implementierung nur überprüfen ein Kontrollkästchen, und Sie re-Vorgang abgeschlossen.</span><span class="sxs-lookup"><span data-stu-id="abb7b-112">Due to the ease of implementation just check a checkbox and you re done!</span></span> <span data-ttu-id="abb7b-113">Standardnavigation ist einer attraktiven Option.</span><span class="sxs-lookup"><span data-stu-id="abb7b-113">default paging is an attractive option.</span></span> <span data-ttu-id="abb7b-114">Die Na gibt es beim Abrufen aller Datensätze, entscheiden, jedoch die Auswahl eines Kernfunktion beim paging durch ausreichend große Mengen von Daten oder Websites mit vielen gleichzeitigen Benutzern.</span><span class="sxs-lookup"><span data-stu-id="abb7b-114">Its na�ve approach in retrieving all of the records, though, makes it an implausible choice when paging through sufficiently large amounts of data or for sites with many concurrent users.</span></span> <span data-ttu-id="abb7b-115">Unter solchen Umständen aktivieren wir an das benutzerdefinierte paging, um ein reaktionsfähig System bereitzustellen.</span><span class="sxs-lookup"><span data-stu-id="abb7b-115">In such circumstances, we must turn to custom paging in order to provide a responsive system.</span></span>

<span data-ttu-id="abb7b-116">Die Herausforderung, benutzerdefinierte Paging wird eine Abfrage schreiben, die den genauen Satz von Datensätzen, die für eine bestimmte Seite der Daten erforderlichen zurückgibt.</span><span class="sxs-lookup"><span data-stu-id="abb7b-116">The challenge of custom paging is being able to write a query that returns the precise set of records needed for a particular page of data.</span></span> <span data-ttu-id="abb7b-117">Glücklicherweise bietet Microsoft SQL Server 2005 ein neues Schlüsselwort für Rangfolge Ergebnisse zu erzielen, die können wir eine Abfrage schreiben, die effizient echte Teilmenge von Datensätzen abrufen können.</span><span class="sxs-lookup"><span data-stu-id="abb7b-117">Fortunately, Microsoft SQL Server 2005 provides a new keyword for ranking results, which enables us to write a query that can efficiently retrieve the proper subset of records.</span></span> <span data-ttu-id="abb7b-118">In diesem Lernprogramm sehen wir, wie dieses neue SQL Server 2005-Schlüsselwort verwenden, um benutzerdefinierte Paging in einem GridView-Steuerelement zu implementieren.</span><span class="sxs-lookup"><span data-stu-id="abb7b-118">In this tutorial we'll see how to use this new SQL Server 2005 keyword to implement custom paging in a GridView control.</span></span> <span data-ttu-id="abb7b-119">Während die Benutzeroberfläche für das benutzerdefinierte Paging, für standardmäßige auslagerungen, schrittweise Ausführung von einer Seite mit dem nächsten entspricht kann benutzerdefiniertes Paging schneller Standardnavigation Größenordnung sein.</span><span class="sxs-lookup"><span data-stu-id="abb7b-119">While the user interface for custom paging is identical to that for default paging, stepping from one page to the next using custom paging can be several orders of magnitude faster than default paging.</span></span>

> [!NOTE]
> <span data-ttu-id="abb7b-120">Der genaue Leistungsgewinn antischadsoftwaresignaturen nach benutzerdefiniertes Paging hängt von der Gesamtzahl der Datensätze, die über ausgelagerte und die Last auf dem Datenbankserver ab.</span><span class="sxs-lookup"><span data-stu-id="abb7b-120">The exact performance gain exhibited by custom paging depends on the total number of records being paged through and the load being placed on the database server.</span></span> <span data-ttu-id="abb7b-121">Am Ende dieses Lernprogramms betrachten groben Metriken wir, die Vorteile der Leistung mithilfe von benutzerdefinierten Paging abgerufen zu veranschaulichen.</span><span class="sxs-lookup"><span data-stu-id="abb7b-121">At the end of this tutorial we'll look at some rough metrics that showcase the benefits in performance obtained through custom paging.</span></span>


## <a name="step-1-understanding-the-custom-paging-process"></a><span data-ttu-id="abb7b-122">Schritt 1: Grundlegendes zur benutzerdefinierten Paging</span><span class="sxs-lookup"><span data-stu-id="abb7b-122">Step 1: Understanding the Custom Paging Process</span></span>

<span data-ttu-id="abb7b-123">Beim paging durch Daten hängen präzise auf einer Seite angezeigten Datensätze der Datenseite angefordert wird und die Anzahl der Datensätze pro Seite angezeigt.</span><span class="sxs-lookup"><span data-stu-id="abb7b-123">When paging through data, the precise records displayed in a page depend upon the page of data being requested and the number of records displayed per page.</span></span> <span data-ttu-id="abb7b-124">Angenommen Sie, dass wollten wir die 81 Produkte durchblättern 10 Produkte pro Seite angezeigt.</span><span class="sxs-lookup"><span data-stu-id="abb7b-124">For example, imagine that we wanted to page through the 81 products, displaying 10 products per page.</span></span> <span data-ttu-id="abb7b-125">Wenn Sie die erste Seite anzeigen zu können, möchten wir d Produkte 1 bis 10; Wenn die zweite Seite, die wir d Produkte 11 bis 20 usw. von Interesse anzeigen.</span><span class="sxs-lookup"><span data-stu-id="abb7b-125">When viewing the first page, we d want products 1 through 10; when viewing the second page we d be interested in products 11 through 20, and so on.</span></span>

<span data-ttu-id="abb7b-126">Es gibt drei Variablen, die vorgeben, welche Datensätze abgerufen werden sollen und wie die Paginierung Schnittstelle gerendert werden soll:</span><span class="sxs-lookup"><span data-stu-id="abb7b-126">There are three variables that dictate what records need to be retrieved and how the paging interface should be rendered:</span></span>

- <span data-ttu-id="abb7b-127">**Starten Sie Zeilenindex** der Index der ersten Zeile auf der Seite der anzuzeigenden Daten; dieser Index kann durch Multiplizieren den Seitenindex durch die Datensätze pro Seite angezeigt und Hinzufügen von mindestens einem berechnet werden.</span><span class="sxs-lookup"><span data-stu-id="abb7b-127">**Start Row Index** the index of the first row in the page of data to display; this index can be calculated by multiplying the page index by the records to display per page and adding one.</span></span> <span data-ttu-id="abb7b-128">Beim paging durch 10 Datensätze zu einem Zeitpunkt für die erste Seite (dessen Seitenindex ist 0), wird der Start Zeilenindex 0 \* 10 + 1 oder 1; für die zweite Seite (dessen Seitenindex ist 1), Zeile der Startindex ist 1 \* 10 + 1 , oder 11.</span><span class="sxs-lookup"><span data-stu-id="abb7b-128">For example, when paging through records 10 at a time, for the first page (whose page index is 0), the Start Row Index is 0 \* 10 + 1, or 1; for the second page (whose page index is 1), the Start Row Index is 1 \* 10 + 1, or 11.</span></span>
- <span data-ttu-id="abb7b-129">**Maximale Zeilenanzahl** die maximale Anzahl der Datensätze pro Seite angezeigt werden sollen.</span><span class="sxs-lookup"><span data-stu-id="abb7b-129">**Maximum Rows** the maximum number of records to display per page.</span></span> <span data-ttu-id="abb7b-130">Diese Variable wird als maximale Anzahl an Zeilen bezeichnet, da für die letzte Seite gibt es weniger Datensätze als die Seitengröße sein kann.</span><span class="sxs-lookup"><span data-stu-id="abb7b-130">This variable is referred to as maximum rows since for the last page there may be fewer records returned than the page size.</span></span> <span data-ttu-id="abb7b-131">Beispielsweise wird beim paging durch die 81 10 Produktdatensätze pro Seite die neunte und letzten Seite nur ein Datensatz haben.</span><span class="sxs-lookup"><span data-stu-id="abb7b-131">For example, when paging through the 81 products 10 records per page, the ninth and final page will have just one record.</span></span> <span data-ttu-id="abb7b-132">Seite "keine" werden jedoch mehrere Datensätze als der Wert der maximalen Anzahl von Zeilen angezeigt.</span><span class="sxs-lookup"><span data-stu-id="abb7b-132">No page, though, will show more records than the Maximum Rows value.</span></span>
- <span data-ttu-id="abb7b-133">**Die Anzahl der Datensätze insgesamt** die Gesamtzahl der Datensätze, die über ausgelagert wird.</span><span class="sxs-lookup"><span data-stu-id="abb7b-133">**Total Record Count** the total number of records being paged through.</span></span> <span data-ttu-id="abb7b-134">Während diese Variable nicht erforderlich, um zu bestimmen, welche Datensätze für eine angegebene Seite abgerufen, dies ist aufgrund von Paging-Schnittstelle.</span><span class="sxs-lookup"><span data-stu-id="abb7b-134">While this variable isn t needed to determine what records to retrieve for a given page, it does dictate the paging interface.</span></span> <span data-ttu-id="abb7b-135">Beispielsweise 81 Produkte, die ausgelagerte über vorhanden sind, "weiß" die Auslagerungsschnittstelle neun Seitenzahlen im Paging-UI angezeigt.</span><span class="sxs-lookup"><span data-stu-id="abb7b-135">For example, if there are 81 products being paged through, the paging interface knows to display nine page numbers in the paging UI.</span></span>

<span data-ttu-id="abb7b-136">Der Zeilenindex starten wird mit Standardpaging als Produkt des der Seitenindex und die Seitengröße plus eins, berechnet, während die maximale Zeilenanzahl einfach die Seitengröße ist.</span><span class="sxs-lookup"><span data-stu-id="abb7b-136">With default paging, the Start Row Index is computed as the product of the page index and the page size plus one, whereas the Maximum Rows is simply the page size.</span></span> <span data-ttu-id="abb7b-137">Da Standardnavigation Ruft alle Datensätze aus wird die Datenbank beim Rendern von einer beliebigen Seite der Daten, den Index für jede Zeile bezeichnet, wodurch gleitenden Zeilenindex starten Zeile leichte Aufgabe.</span><span class="sxs-lookup"><span data-stu-id="abb7b-137">Since default paging retrieves all of the records from the database when rendering any page of data, the index for each row is known, thereby making moving to Start Row Index row a trivial task.</span></span> <span data-ttu-id="abb7b-138">Darüber hinaus wird die Anzahl der Datensätze insgesamt unmittelbar verfügbar, da sie s einfach die Anzahl der Datensätze in der DataTable (oder ein Objekt verwendet wird, in der Datenbankergebnisse enthalten).</span><span class="sxs-lookup"><span data-stu-id="abb7b-138">Moreover, the Total Record Count is readily available, as it s simply the number of records in the DataTable (or whatever object is being used to hold the database results).</span></span>

<span data-ttu-id="abb7b-139">Die Zeilenindex starten und die maximale Zeilenanzahl Variablen wird angegeben, muss eine benutzerdefinierte Implementierung von Paging nur die präzise Teilmenge der Datensätze, starten den Zeilenindex starten und bis zur maximalen Anzahl von Zeilen der Anzahl der Datensätze nach, zurückgeben.</span><span class="sxs-lookup"><span data-stu-id="abb7b-139">Given the Start Row Index and Maximum Rows variables, a custom paging implementation must only return the precise subset of records starting at the Start Row Index and up to Maximum Rows number of records after that.</span></span> <span data-ttu-id="abb7b-140">Benutzerdefiniertes Paging bietet zwei Herausforderungen:</span><span class="sxs-lookup"><span data-stu-id="abb7b-140">Custom paging provides two challenges:</span></span>

- <span data-ttu-id="abb7b-141">Es muss möglich, effizient zuordnen, einen Zeilenindex jede Zeile in die gesamten Daten über ausgelagert werden, sodass Rückgabe Datensätze im angegebenen Zeilenindex starten gestartet werden kann</span><span class="sxs-lookup"><span data-stu-id="abb7b-141">We must be able to efficiently associate a row index with each row in the entire data being paged through so that we can start returning records at the specified Start Row Index</span></span>
- <span data-ttu-id="abb7b-142">Wir müssen die Gesamtzahl der Datensätze, die ausgelagerte über bereitstellen</span><span class="sxs-lookup"><span data-stu-id="abb7b-142">We need to provide the total number of records being paged through</span></span>

<span data-ttu-id="abb7b-143">In den nächsten beiden Schritten untersuchen wir die SQL-Skript erforderlich, um auf diese beiden Probleme zu reagieren.</span><span class="sxs-lookup"><span data-stu-id="abb7b-143">In the next two steps we'll examine the SQL script needed to respond to these two challenges.</span></span> <span data-ttu-id="abb7b-144">Zusätzlich zu den SQL-Skript müssen wir auch für die Implementierung von Methoden in der DAL und BLL.</span><span class="sxs-lookup"><span data-stu-id="abb7b-144">In addition to the SQL script, we'll also need to implement methods in the DAL and BLL.</span></span>

## <a name="step-2-returning-the-total-number-of-records-being-paged-through"></a><span data-ttu-id="abb7b-145">Schritt 2: Zurückgeben der Gesamtzahl der Datensätze, die ausgelagerte über</span><span class="sxs-lookup"><span data-stu-id="abb7b-145">Step 2: Returning the Total Number of Records Being Paged Through</span></span>

<span data-ttu-id="abb7b-146">Bevor wir zum Abrufen der präzise Teilmenge der Datensätze für die Seite angezeigt wird untersuchen, können Sie s uns zunächst an, wie die Gesamtanzahl von Datensätzen, die ausgelagerte über zurückzugeben.</span><span class="sxs-lookup"><span data-stu-id="abb7b-146">Before we examine how to retrieve the precise subset of records for the page being displayed, let s first look at how to return the total number of records being paged through.</span></span> <span data-ttu-id="abb7b-147">Diese Informationen werden benötigt, um die Benutzeroberfläche für die Auslagerungsdatei ordnungsgemäß zu konfigurieren.</span><span class="sxs-lookup"><span data-stu-id="abb7b-147">This information is needed in order to properly configure the paging user interface.</span></span> <span data-ttu-id="abb7b-148">Die Gesamtanzahl der von einer bestimmten SQL-Abfrage zurückgegebenen Datensätze erhalten Sie, indem Sie mit der [ `COUNT` Aggregatfunktion](https://msdn.microsoft.com/library/ms175997.aspx).</span><span class="sxs-lookup"><span data-stu-id="abb7b-148">The total number of records returned by a particular SQL query can be obtained by using the [`COUNT` aggregate function](https://msdn.microsoft.com/library/ms175997.aspx).</span></span> <span data-ttu-id="abb7b-149">Angenommen, um zu bestimmen, die Gesamtanzahl von Datensätzen in der `Products` Tabelle, können wir die folgende Abfrage verwenden:</span><span class="sxs-lookup"><span data-stu-id="abb7b-149">For example, to determine the total number of records in the `Products` table, we can use the following query:</span></span>


[!code-sql[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample1.sql)]

<span data-ttu-id="abb7b-150">Lassen Sie s unsere DAL eine Methode hinzugefügt, die diese Informationen zurückgibt.</span><span class="sxs-lookup"><span data-stu-id="abb7b-150">Let s add a method to our DAL that returns this information.</span></span> <span data-ttu-id="abb7b-151">Insbesondere erstellen wir eine DAL-Methode wird aufgerufen, `TotalNumberOfProducts()` ausführt, die die `SELECT` oben aufgeführten-Anweisung.</span><span class="sxs-lookup"><span data-stu-id="abb7b-151">In particular, we'll create a DAL method called `TotalNumberOfProducts()` that executes the `SELECT` statement shown above.</span></span>

<span data-ttu-id="abb7b-152">Öffnen Sie zunächst die `Northwind.xsd` typisierte DataSet-Datei in die `App_Code/DAL` Ordner.</span><span class="sxs-lookup"><span data-stu-id="abb7b-152">Start by opening the `Northwind.xsd` Typed DataSet file in the `App_Code/DAL` folder.</span></span> <span data-ttu-id="abb7b-153">Als Nächstes mit der rechten Maustaste auf die `ProductsTableAdapter` im Designer, und wählen Sie die Abfrage hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="abb7b-153">Next, right-click on the `ProductsTableAdapter` in the Designer and choose Add Query.</span></span> <span data-ttu-id="abb7b-154">Sobald gibt es im vorherigen Lernprogrammen betrachtet, dadurch können wir die DAL eine neue Methode hinzu, die beim Aufrufen, wird eine bestimmte SQL-Anweisung oder gespeicherte Prozedur ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="abb7b-154">As we ve seen in previous tutorials, this will allow us to add a new method to the DAL that, when invoked, will execute a particular SQL statement or stored procedure.</span></span> <span data-ttu-id="abb7b-155">Wie bei unserer TableAdapter-Methoden in den vorherigen Lernprogrammen, für diese wahlweise eine Ad-hoc-SQL-Anweisung verwenden.</span><span class="sxs-lookup"><span data-stu-id="abb7b-155">As with our TableAdapter methods in previous tutorials, for this one opt to use an ad-hoc SQL statement.</span></span>


![Verwenden Sie eine Ad-hoc-SQL-Anweisung](efficiently-paging-through-large-amounts-of-data-cs/_static/image1.png)

<span data-ttu-id="abb7b-157">**Abbildung 1**: Verwenden Sie eine Ad-hoc-SQL-Anweisung</span><span class="sxs-lookup"><span data-stu-id="abb7b-157">**Figure 1**: Use an Ad-Hoc SQL Statement</span></span>


<span data-ttu-id="abb7b-158">Auf dem nächsten Bildschirm festlegbaren wir, welche Art von Abfrage zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="abb7b-158">On the next screen we can specify what type of query to create.</span></span> <span data-ttu-id="abb7b-159">Da diese Abfrage die Gesamtanzahl von Datensätzen in einem einzelnen skalaren Wert zurückgeben der `Products` Tabelle wählen Sie die `SELECT` die Option einen einzigen Wert zurückgibt.</span><span class="sxs-lookup"><span data-stu-id="abb7b-159">Since this query will return a single, scalar value the total number of records in the `Products` table choose the `SELECT` which returns a singe value option.</span></span>


![Konfigurieren Sie die Abfrage aus, um eine SELECT-Anweisung verwenden, die einen einzelnen Wert zurückgibt](efficiently-paging-through-large-amounts-of-data-cs/_static/image2.png)

<span data-ttu-id="abb7b-161">**Abbildung 2**: Konfigurieren Sie die Abfrage aus, um eine SELECT-Anweisung verwenden, die einen einzelnen Wert zurückgibt</span><span class="sxs-lookup"><span data-stu-id="abb7b-161">**Figure 2**: Configure the Query to Use a SELECT Statement that Returns a Single Value</span></span>


<span data-ttu-id="abb7b-162">Nach dem, der angibt, in des Typs der Abfrage zu verwenden, müssen wir als Nächstes die Abfrage angeben.</span><span class="sxs-lookup"><span data-stu-id="abb7b-162">After indicating the type of query to use, we must next specify the query.</span></span>


![Verwenden Sie die SELECT COUNT(\*) Produkte Abfrage](efficiently-paging-through-large-amounts-of-data-cs/_static/image3.png)

<span data-ttu-id="abb7b-164">**Abbildung 3**: Verwenden Sie die Option COUNT (\*) Abfrage der FROM-Produkte</span><span class="sxs-lookup"><span data-stu-id="abb7b-164">**Figure 3**: Use the SELECT COUNT(\*) FROM Products Query</span></span>


<span data-ttu-id="abb7b-165">Geben Sie schließlich den Namen für die Methode an.</span><span class="sxs-lookup"><span data-stu-id="abb7b-165">Finally, specify the name for the method.</span></span> <span data-ttu-id="abb7b-166">Verwendung als zuvor erwähnten, können s `TotalNumberOfProducts`.</span><span class="sxs-lookup"><span data-stu-id="abb7b-166">As aforementioned, let s use `TotalNumberOfProducts`.</span></span>


![Benennen Sie die TotalNumberOfProducts DAL-Methode](efficiently-paging-through-large-amounts-of-data-cs/_static/image4.png)

<span data-ttu-id="abb7b-168">**Abbildung 4**: Benennen der TotalNumberOfProducts DAL-Methode</span><span class="sxs-lookup"><span data-stu-id="abb7b-168">**Figure 4**: Name the DAL Method TotalNumberOfProducts</span></span>


<span data-ttu-id="abb7b-169">Nach dem Klicken auf "Fertig stellen" des Assistenten fügen die `TotalNumberOfProducts` Methode, um der DAL.</span><span class="sxs-lookup"><span data-stu-id="abb7b-169">After clicking Finish, the wizard will add the `TotalNumberOfProducts` method to the DAL.</span></span> <span data-ttu-id="abb7b-170">Die skalare zurückgeben Methoden in der DAL auf NULL festlegbaren Typen zurück, für den Fall, dass das Ergebnis von der SQL-Abfrage ist `NULL`.</span><span class="sxs-lookup"><span data-stu-id="abb7b-170">The scalar returning methods in the DAL return nullable types, in case the result from the SQL query is `NULL`.</span></span> <span data-ttu-id="abb7b-171">Unsere `COUNT` Abfrage, jedoch gibt stets einen nicht-`NULL` -Wert, unabhängig davon, die DAL-Methode gibt eine NULL-Werte zulassen ganze Zahl zurück.</span><span class="sxs-lookup"><span data-stu-id="abb7b-171">Our `COUNT` query, however, will always return a non-`NULL` value; regardless, the DAL method returns a nullable integer.</span></span>

<span data-ttu-id="abb7b-172">Zusätzlich zu der DAL-Methode benötigen wir auch eine Methode in der BLL.</span><span class="sxs-lookup"><span data-stu-id="abb7b-172">In addition to the DAL method, we also need a method in the BLL.</span></span> <span data-ttu-id="abb7b-173">Öffnen der `ProductsBLL` Klassendatei, und fügen eine `TotalNumberOfProducts` Methode, die einfach mit dem DAL s, unten aufruft `TotalNumberOfProducts` Methode:</span><span class="sxs-lookup"><span data-stu-id="abb7b-173">Open the `ProductsBLL` class file and add a `TotalNumberOfProducts` method that simply calls down to the DAL s `TotalNumberOfProducts` method:</span></span>


[!code-csharp[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample2.cs)]

<span data-ttu-id="abb7b-174">Die DAL-s `TotalNumberOfProducts` Methode gibt eine NULL-Werte zulassen ganze Zahl zurück, aber wir Ve erstellt die `ProductsBLL` Klasse s `TotalNumberOfProducts` Methode, sodass dieser standard eine ganze Zahl zurückgegeben.</span><span class="sxs-lookup"><span data-stu-id="abb7b-174">The DAL s `TotalNumberOfProducts` method returns a nullable integer; however, we ve created the `ProductsBLL` class s `TotalNumberOfProducts` method so that it returns a standard integer.</span></span> <span data-ttu-id="abb7b-175">Aus diesem Grund müssen wir die `ProductsBLL` Klasse s `TotalNumberOfProducts` Methode zurück, der Wertteil der NULL-Werte zulassen Ganzzahl zurückgegeben, durch die DAL-s. `TotalNumberOfProducts` Methode.</span><span class="sxs-lookup"><span data-stu-id="abb7b-175">Therefore, we need to have the `ProductsBLL` class s `TotalNumberOfProducts` method return the value portion of the nullable integer returned by the DAL s `TotalNumberOfProducts` method.</span></span> <span data-ttu-id="abb7b-176">Der Aufruf von `GetValueOrDefault()` Wert der Ganzzahl NULL-Werte zulässt, falls vorhanden; zurückgegeben, falls die NULL-Werte zulassen ganze Zahl ist `null`, jedoch gibt es die ganze Zahl Standardwert 0.</span><span class="sxs-lookup"><span data-stu-id="abb7b-176">The call to `GetValueOrDefault()` returns the value of the nullable integer, if it exists; if the nullable integer is `null`, however, it returns the default integer value, 0.</span></span>

## <a name="step-3-returning-the-precise-subset-of-records"></a><span data-ttu-id="abb7b-177">Schritt 3: Zurückgeben der präzise Teilmenge von Datensätzen</span><span class="sxs-lookup"><span data-stu-id="abb7b-177">Step 3: Returning the Precise Subset of Records</span></span>

<span data-ttu-id="abb7b-178">Unsere nächste Aufgabe ist die Erstellung von Methoden in der DAL und BLL, der den Zeilenindex starten zu akzeptieren und die maximale Zeilenanzahl Variablen zuvor erläuterten und die entsprechenden Datensätze zurückzugeben.</span><span class="sxs-lookup"><span data-stu-id="abb7b-178">Our next task is to create methods in the DAL and BLL that accept the Start Row Index and Maximum Rows variables discussed earlier and return the appropriate records.</span></span> <span data-ttu-id="abb7b-179">Bevor wir dies tun, Let s uns zunächst an die benötigten SQL-Skript.</span><span class="sxs-lookup"><span data-stu-id="abb7b-179">Before we do that, let s first look at the needed SQL script.</span></span> <span data-ttu-id="abb7b-180">Die Herausforderung, die für uns ist Transportservers, dass wir effizient zuweisen ein Indexes auf jede Zeile in die gesamten Ergebnisse über ausgelagert werden, sodass nur die Datensätze ab, auf den Zeilenindex starten (und bis zu die maximale Anzahl der Datensätze Anzahl der Datensätze) zurückgegeben werden können.</span><span class="sxs-lookup"><span data-stu-id="abb7b-180">The challenge facing us is that we must be able to efficiently assign an index to each row in the entire results being paged through so that we can return just those records starting at the Start Row Index (and up to the Maximum Records number of records).</span></span>

<span data-ttu-id="abb7b-181">Dies ist eine Herausforderung nicht, wenn bereits eine Spalte in der Datenbanktabelle, die als ein Zeilenindex dient vorhanden ist.</span><span class="sxs-lookup"><span data-stu-id="abb7b-181">This is not a challenge if there is already a column in the database table that serves as a row index.</span></span> <span data-ttu-id="abb7b-182">Auf den ersten Blick könnten wir meinen, dass die `Products` Tabelle s `ProductID` Feld ausreichen würde, wie das erste Produkt weist `ProductID` 1, der zweite ein 2, und so weiter.</span><span class="sxs-lookup"><span data-stu-id="abb7b-182">At first glance we might think that the `Products` table s `ProductID` field would suffice, as the first product has `ProductID` of 1, the second a 2, and so on.</span></span> <span data-ttu-id="abb7b-183">Löschen eines Produkts lässt jedoch eine Lücke in der Sequenz, die diesen Ansatz nullifying.</span><span class="sxs-lookup"><span data-stu-id="abb7b-183">However, deleting a product leaves a gap in the sequence, nullifying this approach.</span></span>

<span data-ttu-id="abb7b-184">Es gibt zwei allgemeine Techniken verwendet, um einen Zeilenindex mit den Daten zu blättern, effizient zuzuordnen Dadurch wird die präzise Teilmenge der Datensätze abgerufen werden sollen:</span><span class="sxs-lookup"><span data-stu-id="abb7b-184">There are two general techniques used to efficiently associate a row index with the data to page through, thereby enabling the precise subset of records to be retrieved:</span></span>

- <span data-ttu-id="abb7b-185">**Mit SQL Server 2005 s `ROW_NUMBER()` Schlüsselwort** noch nicht mit SQL Server 2005, die `ROW_NUMBER()` Schlüsselwort ordnet einen Rang jeder zurückgegebenen Datensatz basierend auf Sortierung.</span><span class="sxs-lookup"><span data-stu-id="abb7b-185">**Using SQL Server 2005 s `ROW_NUMBER()` Keyword** new to SQL Server 2005, the `ROW_NUMBER()` keyword associates a ranking with each returned record based on some ordering.</span></span> <span data-ttu-id="abb7b-186">Diese Rangfolge kann als ein Zeilenindex für jede Zeile verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="abb7b-186">This ranking can be used as a row index for each row.</span></span>
- <span data-ttu-id="abb7b-187">**Eine Tabellenvariable mit und `SET ROWCOUNT`**  SQL Server-s [ `SET ROWCOUNT` Anweisung](https://msdn.microsoft.com/library/ms188774.aspx) können verwendet werden, um wie viele Datensätze insgesamt Geben Sie eine Abfrage sollte vor der Beendigung; verarbeiten [Tabellenvariablen](http://www.sqlteam.com/item.asp?ItemID=9454) sind lokale T-SQL-Variablen, die Tabellendaten, akin zum aufnehmen können [temporäre Tabellen](http://www.sqlteam.com/item.asp?ItemID=2029).</span><span class="sxs-lookup"><span data-stu-id="abb7b-187">**Using a Table Variable and `SET ROWCOUNT`** SQL Server s [`SET ROWCOUNT` statement](https://msdn.microsoft.com/library/ms188774.aspx) can be used to specify how many total records a query should process before terminating; [table variables](http://www.sqlteam.com/item.asp?ItemID=9454) are local T-SQL variables that can hold tabular data, akin to [temporary tables](http://www.sqlteam.com/item.asp?ItemID=2029).</span></span> <span data-ttu-id="abb7b-188">Dieser Ansatz funktioniert ebenso gut mit Microsoft SQL Server 2005 und SQL Server 2000 (während der `ROW_NUMBER()` Ansatz funktioniert nur mit SQL Server 2005).</span><span class="sxs-lookup"><span data-stu-id="abb7b-188">This approach works equally well with both Microsoft SQL Server 2005 and SQL Server 2000 (whereas the `ROW_NUMBER()` approach only works with SQL Server 2005).</span></span>  
  
  <span data-ttu-id="abb7b-189">Die Idee ist, um eine Tabellenvariable zu erstellen, verfügt ein `IDENTITY` Spalten- und Spalten für die Primärschlüssel der Tabelle, deren Daten über ausgelagert wird werden.</span><span class="sxs-lookup"><span data-stu-id="abb7b-189">The idea here is to create a table variable that has an `IDENTITY` column and columns for the primary keys of the table whose data is being paged through.</span></span> <span data-ttu-id="abb7b-190">Als Nächstes wird der Inhalt der Tabelle, deren Daten über ausgelagerte, ausgegeben, in der Tabellenvariablen, wodurch zuordnen einen sequenziellen Zeilenindex (über die `IDENTITY` Spalte) für jeden Datensatz in der Tabelle.</span><span class="sxs-lookup"><span data-stu-id="abb7b-190">Next, the contents of the table whose data is being paged through is dumped into the table variable, thereby associating a sequential row index (via the `IDENTITY` column) for each record in the table.</span></span> <span data-ttu-id="abb7b-191">Nachdem die Tabellenvariable aufgefüllt wurde, eine `SELECT` Anweisung auf die Tabellenvariable mit der zugrunde liegenden Tabelle verknüpft, um die bestimmter Datensätze herausziehen ausgeführt werden kann.</span><span class="sxs-lookup"><span data-stu-id="abb7b-191">Once the table variable has been populated, a `SELECT` statement on the table variable, joined with the underlying table, can be executed to pull out the particular records.</span></span> <span data-ttu-id="abb7b-192">Die `SET ROWCOUNT` Anweisung wird verwendet, um die Anzahl der Datensätze Intelligent zu beschränken, die in der Tabellenvariablen gesichert werden müssen.</span><span class="sxs-lookup"><span data-stu-id="abb7b-192">The `SET ROWCOUNT` statement is used to intelligently limit the number of records that need to be dumped into the table variable.</span></span>  
  
  <span data-ttu-id="abb7b-193">Dieser Ansatz s Effizienz basiert darauf, dass die Seitenzahl angefordert wird, als die `SET ROWCOUNT` Wert wird den Wert der Zeile startIndex sowie die maximale Zeilenanzahl zugewiesen.</span><span class="sxs-lookup"><span data-stu-id="abb7b-193">This approach s efficiency is based on the page number being requested, as the `SET ROWCOUNT` value is assigned the value of Start Row Index plus the Maximum Rows.</span></span> <span data-ttu-id="abb7b-194">Dieser Ansatz ist sehr effizient, wenn paging durch niedrig nummerierten Seiten, z. B. das erste Paar Datenseiten.</span><span class="sxs-lookup"><span data-stu-id="abb7b-194">When paging through low-numbered pages such as the first few pages of data this approach is very efficient.</span></span> <span data-ttu-id="abb7b-195">Allerdings weist es standardmäßig Paging-ähnliche Leistung beim Abrufen einer Seite in der Nähe des.</span><span class="sxs-lookup"><span data-stu-id="abb7b-195">However, it exhibits default paging-like performance when retrieving a page near the end.</span></span>

<span data-ttu-id="abb7b-196">Dieses Lernprogramm implementiert nur benutzerdefinierte Paging mithilfe der `ROW_NUMBER()` Schlüsselwort.</span><span class="sxs-lookup"><span data-stu-id="abb7b-196">This tutorial implements custom paging using the `ROW_NUMBER()` keyword.</span></span> <span data-ttu-id="abb7b-197">Weitere Informationen zur Verwendung der Tabellenvariablen und `SET ROWCOUNT` Technik, finden Sie unter [eine weitere effiziente Methode zum Paging durch große Resultsets](http://www.4guysfromrolla.com/webtech/042606-1.shtml).</span><span class="sxs-lookup"><span data-stu-id="abb7b-197">For more information on using the table variable and `SET ROWCOUNT` technique, see [A More Efficient Method for Paging Through Large Result Sets](http://www.4guysfromrolla.com/webtech/042606-1.shtml).</span></span>

<span data-ttu-id="abb7b-198">Die `ROW_NUMBER()` Schlüsselwort jeder Datensatz über eine bestimmte Sortierung mit der folgenden Syntax zurückgegebene Rang zugeordnet:</span><span class="sxs-lookup"><span data-stu-id="abb7b-198">The `ROW_NUMBER()` keyword associated a ranking with each record returned over a particular ordering using the following syntax:</span></span>


[!code-sql[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample3.sql)]

<span data-ttu-id="abb7b-199">`ROW_NUMBER()` Gibt einen numerischen Wert, der angibt, den Rang für jeden Datensatz im Hinblick auf die angegebene Reihenfolge zurück.</span><span class="sxs-lookup"><span data-stu-id="abb7b-199">`ROW_NUMBER()` returns a numerical value that specifies the rank for each record with regards to the indicated ordering.</span></span> <span data-ttu-id="abb7b-200">Beispielsweise könnten um den Rang für jedes Produkt, geordnet von den am stärksten finden Sie unter zum am wenigsten aufwändige wir die folgende Abfrage verwenden:</span><span class="sxs-lookup"><span data-stu-id="abb7b-200">For example, to see the rank for each product, ordered from the most expensive to the least, we could use the following query:</span></span>


[!code-sql[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample4.sql)]

<span data-ttu-id="abb7b-201">Abbildung 5 zeigt diese Abfrage s Ergebnisse, wenn Sie über das Fenster "Abfrage" in Visual Studio ausführen.</span><span class="sxs-lookup"><span data-stu-id="abb7b-201">Figure 5 shows this query s results when run through the query window in Visual Studio.</span></span> <span data-ttu-id="abb7b-202">Beachten Sie, dass die Produkte nach Preis, zusammen mit dem Rang der Preis für jede Zeile sortiert werden.</span><span class="sxs-lookup"><span data-stu-id="abb7b-202">Note that the products are ordered by price, along with a price rank for each row.</span></span>


![Der Rang der Preis wird aus Gründen der Datensatz für jede zurückgegeben](efficiently-paging-through-large-amounts-of-data-cs/_static/image5.png)

<span data-ttu-id="abb7b-204">**Abbildung 5**: der Preis Rang ist enthalten, für jede zurückgegebene Datensatz</span><span class="sxs-lookup"><span data-stu-id="abb7b-204">**Figure 5**: The Price Rank is Included for Each Returned Record</span></span>


> [!NOTE]
> <span data-ttu-id="abb7b-205">`ROW_NUMBER()` ist nur eine der vielen neuen Rangfolgefunktionen in SQL Server 2005 verfügbar.</span><span class="sxs-lookup"><span data-stu-id="abb7b-205">`ROW_NUMBER()` is just one of the many new ranking functions available in SQL Server 2005.</span></span> <span data-ttu-id="abb7b-206">Eine ausführlichere Erläuterung der `ROW_NUMBER()`, zusammen mit den anderen Rangfolgefunktionen lesen [aufgelisteten Ergebnisse zurückgeben, mit Microsoft SQL Server 2005](http://www.4guysfromrolla.com/webtech/010406-1.shtml).</span><span class="sxs-lookup"><span data-stu-id="abb7b-206">For a more thorough discussion of `ROW_NUMBER()`, along with the other ranking functions, read [Returning Ranked Results with Microsoft SQL Server 2005](http://www.4guysfromrolla.com/webtech/010406-1.shtml).</span></span>


<span data-ttu-id="abb7b-207">Wenn die Ergebnisse mit der angegebenen Rangfolge `ORDER BY` Spalte in der `OVER` -Klausel (`UnitPrice`, im obigen Beispiel), SQL Server müssen die Ergebnisse zu sortieren.</span><span class="sxs-lookup"><span data-stu-id="abb7b-207">When ranking the results by the specified `ORDER BY` column in the `OVER` clause (`UnitPrice`, in the above example), SQL Server must sort the results.</span></span> <span data-ttu-id="abb7b-208">Dies ist ein schneller Vorgang, wenn es ein gruppierter Index über die Spalte(n), die die Ergebnisse werden ist nach, sortiert wird oder wenn es einem abdeckenden index jedoch andernfalls mehr teuer sein kann.</span><span class="sxs-lookup"><span data-stu-id="abb7b-208">This is a quick operation if there is a clustered index over the column(s) the results are being ordered by, or if there is a covering index, but can be more costly otherwise.</span></span> <span data-ttu-id="abb7b-209">Zur Verbesserung der Leistung für ausreichend große Abfragen erwägen Sie einen nicht gruppierten Index für die Spalte mit der die Ergebnisse geordnet sind.</span><span class="sxs-lookup"><span data-stu-id="abb7b-209">To help improve performance for sufficiently large queries, consider adding a non-clustered index for the column by which the results are ordered by.</span></span> <span data-ttu-id="abb7b-210">Finden Sie unter [Rangfolge Funktionen und Leistung in SQL Server 2005](http://www.sql-server-performance.com/ak_ranking_functions.asp) für eine detaillierte Darstellung der Leistungsaspekte.</span><span class="sxs-lookup"><span data-stu-id="abb7b-210">See [Ranking Functions and Performance in SQL Server 2005](http://www.sql-server-performance.com/ak_ranking_functions.asp) for a more detailed look at the performance considerations.</span></span>

<span data-ttu-id="abb7b-211">Die zurückgegebene Rangfolgeinformationen `ROW_NUMBER()` kann nicht direkt verwendet werden, der `WHERE` Klausel.</span><span class="sxs-lookup"><span data-stu-id="abb7b-211">The ranking information returned by `ROW_NUMBER()` cannot directly be used in the `WHERE` clause.</span></span> <span data-ttu-id="abb7b-212">Allerdings kann eine abgeleitete Tabelle zurückzugebenden verwendet die `ROW_NUMBER()` Ergebnis, die dann in angezeigt werden kann die `WHERE` Klausel.</span><span class="sxs-lookup"><span data-stu-id="abb7b-212">However, a derived table can be used to return the `ROW_NUMBER()` result, which can then appear in the `WHERE` clause.</span></span> <span data-ttu-id="abb7b-213">Die folgende Abfrage verwendet z. B. eine abgeleitete Tabelle zurückzugebenden Spalten ProductName und UnitPrice zusammen mit der `ROW_NUMBER()` Ergebnis und dann verwendet, eine `WHERE` -Klausel, um nur solche Produkte, deren Preis Rang zurück zwischen 11 und 20 ist:</span><span class="sxs-lookup"><span data-stu-id="abb7b-213">For example, the following query uses a derived table to return the ProductName and UnitPrice columns, along with the `ROW_NUMBER()` result, and then uses a `WHERE` clause to only return those products whose price rank is between 11 and 20:</span></span>


[!code-sql[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample5.sql)]

<span data-ttu-id="abb7b-214">Erweitern dieses Konzept etwas weiter, kann dieser Ansatz zum Abrufen einer bestimmten Seite der Daten anhand des gewünschten Zeilenindex starten und die maximale Zeilenanzahl nutzen:</span><span class="sxs-lookup"><span data-stu-id="abb7b-214">Extending this concept a bit further, we can utilize this approach to retrieve a specific page of data given the desired Start Row Index and Maximum Rows values:</span></span>


[!code-html[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample6.html)]

> [!NOTE]
> <span data-ttu-id="abb7b-215">Wie wir später in diesem Lernprogramm sehen werden die *`StartRowIndex`* vom ObjectDataSource ist indiziert, beginnend mit 0 (null), wohingegen die `ROW_NUMBER()` von SQL Server 2005 zurückgegebene Wert ist indiziert, beginnend mit 1.</span><span class="sxs-lookup"><span data-stu-id="abb7b-215">As we will see later on in this tutorial, the *`StartRowIndex`* supplied by the ObjectDataSource is indexed starting at zero, whereas the `ROW_NUMBER()` value returned by SQL Server 2005 is indexed starting at 1.</span></span> <span data-ttu-id="abb7b-216">Aus diesem Grund die `WHERE` -Klausel gibt die Datensätze zurück, in denen `PriceRank` ist streng größer als *`StartRowIndex`* und kleiner oder gleich *`StartRowIndex`*  +  *`MaximumRows`*.</span><span class="sxs-lookup"><span data-stu-id="abb7b-216">Therefore, the `WHERE` clause returns those records where `PriceRank` is strictly greater than *`StartRowIndex`* and less than or equal to *`StartRowIndex`* + *`MaximumRows`*.</span></span>


<span data-ttu-id="abb7b-217">Jetzt, dass wir haben erläutert, wie `ROW_NUMBER()` können werden verwendet, um eine bestimmte Seite mit Daten anhand des Zeilenindex starten und die maximale Anzahl der Zeilen abrufen, jetzt müssen wir diese Logik als Methoden in der DAL und BLL implementieren.</span><span class="sxs-lookup"><span data-stu-id="abb7b-217">Now that we ve discussed how `ROW_NUMBER()` can be used to retrieve a particular page of data given the Start Row Index and Maximum Rows values, we now need to implement this logic as methods in the DAL and BLL.</span></span>

<span data-ttu-id="abb7b-218">Beim Erstellen dieser Abfrage an, dass wir die Reihenfolge entscheiden, müssen werden durch den die Ergebnisse geordnet werden; Lassen Sie s die Produkte nach ihrer Namen in alphabetischer Reihenfolge zu sortieren.</span><span class="sxs-lookup"><span data-stu-id="abb7b-218">When creating this query we must decide the ordering by which the results will be ranked; let s sort the products by their name in alphabetical order.</span></span> <span data-ttu-id="abb7b-219">Dies bedeutet, dass durch das benutzerdefinierte Paging-Implementierung in diesem Lernprogramm wir keinen benutzerdefinierte mehrseitigen Bericht zu erstellen, als auch sortiert werden kann.</span><span class="sxs-lookup"><span data-stu-id="abb7b-219">This means that with the custom paging implementation in this tutorial we will not be able to create a custom paged report than can also be sorted.</span></span> <span data-ttu-id="abb7b-220">In den nächsten Lernprogrammen allerdings sehen wie solche Funktionen bereitgestellt werden kann.</span><span class="sxs-lookup"><span data-stu-id="abb7b-220">In the next tutorial, though, we'll see how such functionality can be provided.</span></span>

<span data-ttu-id="abb7b-221">Im vorherigen Abschnitt wurde die DAL-Methode als eine Ad-hoc-SQL-Anweisung erstellt.</span><span class="sxs-lookup"><span data-stu-id="abb7b-221">In the previous section we created the DAL method as an ad-hoc SQL statement.</span></span> <span data-ttu-id="abb7b-222">Leider der T-SQL-Parser in Visual Studio verwendet, die für die TableAdapter-Assistenten ist nicht t wie der `OVER` Syntax verwendet werden, indem Sie die `ROW_NUMBER()` Funktion.</span><span class="sxs-lookup"><span data-stu-id="abb7b-222">Unfortunately, the T-SQL parser in Visual Studio used by the TableAdapter wizard doesn t like the `OVER` syntax used by the `ROW_NUMBER()` function.</span></span> <span data-ttu-id="abb7b-223">Aus diesem Grund müssen wir diese DAL-Methode als gespeicherte Prozedur erstellen.</span><span class="sxs-lookup"><span data-stu-id="abb7b-223">Therefore, we must create this DAL method as a stored procedure.</span></span> <span data-ttu-id="abb7b-224">Wählen Sie im Server-Explorer aus dem Menü "Ansicht" (oder Klicken STRG + Alt + S), und erweitern Sie die `NORTHWND.MDF` Knoten.</span><span class="sxs-lookup"><span data-stu-id="abb7b-224">Select the Server Explorer from the View menu (or hit Ctrl+Alt+S) and expand the `NORTHWND.MDF` node.</span></span> <span data-ttu-id="abb7b-225">Klicken Sie zum Hinzufügen einer neuen gespeicherten Prozedur mit der rechten Maustaste auf den Knoten gespeicherte Prozeduren, und wählen Sie auf Hinzufügen einer neuen gespeicherten Prozedur (siehe Abbildung 6).</span><span class="sxs-lookup"><span data-stu-id="abb7b-225">To add a new stored procedure, right-click on the Stored Procedures node and choose Add a New Stored Procedure (see Figure 6).</span></span>


![Hinzufügen einer neuen gespeicherten Prozedur für das Paging durch die Produkte](efficiently-paging-through-large-amounts-of-data-cs/_static/image6.png)

<span data-ttu-id="abb7b-227">**Abbildung 6**: hinzufügen eine neue gespeicherte Prozedur für das Paging durch die Produkte</span><span class="sxs-lookup"><span data-stu-id="abb7b-227">**Figure 6**: Add a New Stored Procedure for Paging Through the Products</span></span>


<span data-ttu-id="abb7b-228">Diese gespeicherte Prozedur sollten zwei ganzzahlige Eingabeparameter entgegen - akzeptieren `@startRowIndex` und `@maximumRows` und Verwenden der `ROW_NUMBER()` Funktion geordnet nach der `ProductName` Feld, das nur die Zeilen zurückgeben, die größer als der angegebene `@startRowIndex` und kleiner als oder gleich `@startRowIndex`  +  `@maximumRow` s.</span><span class="sxs-lookup"><span data-stu-id="abb7b-228">This stored procedure should accept two integer input parameters - `@startRowIndex` and `@maximumRows` and use the `ROW_NUMBER()` function ordered by the `ProductName` field, returning only those rows greater than the specified `@startRowIndex` and less than or equal to `@startRowIndex` + `@maximumRow` s.</span></span> <span data-ttu-id="abb7b-229">Geben Sie das folgende Skript in die neue gespeicherte Prozedur, und klicken Sie dann auf das Symbol "Speichern", um die gespeicherte Prozedur zur Datenbank hinzuzufügen.</span><span class="sxs-lookup"><span data-stu-id="abb7b-229">Enter the following script into the new stored procedure and then click the Save icon to add the stored procedure to the database.</span></span>


[!code-sql[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample7.sql)]

<span data-ttu-id="abb7b-230">Nehmen Sie einen Moment Zeit, um es zu testen, nach dem Erstellen der gespeicherten Prozedur können. Mit der rechten Maustaste auf die `GetProductsPaged` gespeicherten Prozedur benennen Sie im Server-Explorer, und wählen Sie die Execute-Option.</span><span class="sxs-lookup"><span data-stu-id="abb7b-230">After creating the stored procedure, take a moment to test it out. Right-click on the `GetProductsPaged` stored procedure name in the Server Explorer and choose the Execute option.</span></span> <span data-ttu-id="abb7b-231">Visual Studio fordert Sie dann für die Eingabeparameter `@startRowIndex` und `@maximumRow` s (siehe Abbildung 7).</span><span class="sxs-lookup"><span data-stu-id="abb7b-231">Visual Studio will then prompt you for the input parameters, `@startRowIndex` and `@maximumRow` s (see Figure 7).</span></span> <span data-ttu-id="abb7b-232">Probieren Sie verschiedene Werte und überprüfen Sie die Ergebnisse.</span><span class="sxs-lookup"><span data-stu-id="abb7b-232">Try different values and examine the results.</span></span>


![Geben Sie einen Wert für die @startRowIndex und @maximumRows Parameter](efficiently-paging-through-large-amounts-of-data-cs/_static/image7.png)

<span data-ttu-id="abb7b-234"><strong>Abbildung 7</strong>: Geben Sie einen Wert für die @startRowIndex und @maximumRows Parameter</span><span class="sxs-lookup"><span data-stu-id="abb7b-234"><strong>Figure 7</strong>: Enter a Value for the @startRowIndex and @maximumRows Parameters</span></span>


<span data-ttu-id="abb7b-235">Nach dem Auswählen dieser Parametern Eingabewerte, die Fenster "Ausgabe" zeigt die Ergebnisse.</span><span class="sxs-lookup"><span data-stu-id="abb7b-235">After choosing these input parameters values, the Output window will show the results.</span></span> <span data-ttu-id="abb7b-236">Abbildung 8 zeigt die Ergebnisse bei der Übergabe von 10 für beide die `@startRowIndex` und `@maximumRows` Parameter.</span><span class="sxs-lookup"><span data-stu-id="abb7b-236">Figure 8 shows the results when passing in 10 for both the `@startRowIndex` and `@maximumRows` parameters.</span></span>


<span data-ttu-id="abb7b-237">[![Die Datensätze, würde werden in der zweiten Seite der Daten werden zurückgegeben.](efficiently-paging-through-large-amounts-of-data-cs/_static/image9.png)](efficiently-paging-through-large-amounts-of-data-cs/_static/image8.png)</span><span class="sxs-lookup"><span data-stu-id="abb7b-237">[![The Records That Would Appear in the Second Page of Data are Returned](efficiently-paging-through-large-amounts-of-data-cs/_static/image9.png)](efficiently-paging-through-large-amounts-of-data-cs/_static/image8.png)</span></span>

<span data-ttu-id="abb7b-238">**Abbildung 8**: der Datensätze, dass angezeigt würde in die zweite Seitendaten zurückgegeben werden ([klicken Sie hier, um das Bild in voller Größe angezeigt](efficiently-paging-through-large-amounts-of-data-cs/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="abb7b-238">**Figure 8**: The Records That Would Appear in the Second Page of Data are Returned ([Click to view full-size image](efficiently-paging-through-large-amounts-of-data-cs/_static/image10.png))</span></span>


<span data-ttu-id="abb7b-239">Mit dieser Prozedur erstellt, es erneut bereit, die zum Erstellen der `ProductsTableAdapter` Methode.</span><span class="sxs-lookup"><span data-stu-id="abb7b-239">With this stored procedure created, we re ready to create the `ProductsTableAdapter` method.</span></span> <span data-ttu-id="abb7b-240">Öffnen der `Northwind.xsd` typisierte DataSet mit der rechten Maustaste in den `ProductsTableAdapter`, und wählen Sie die Option der Abfrage hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="abb7b-240">Open the `Northwind.xsd` Typed DataSet, right-click in the `ProductsTableAdapter`, and choose the Add Query option.</span></span> <span data-ttu-id="abb7b-241">Erstellen Sie mithilfe einer vorhandenen gespeicherten Prozedur an, statt die Abfrage mit einer Ad-hoc-SQL-Anweisung.</span><span class="sxs-lookup"><span data-stu-id="abb7b-241">Instead of creating the query using an ad-hoc SQL statement, create it using an existing stored procedure.</span></span>


![Erstellen Sie die DAL-Methode, die mit einer vorhandenen gespeicherten Prozedur](efficiently-paging-through-large-amounts-of-data-cs/_static/image11.png)

<span data-ttu-id="abb7b-243">**Abbildung 9**: Erstellen Sie die DAL-Methode, die mit einer vorhandenen gespeicherten Prozedur</span><span class="sxs-lookup"><span data-stu-id="abb7b-243">**Figure 9**: Create the DAL Method Using an Existing Stored Procedure</span></span>


<span data-ttu-id="abb7b-244">Als Nächstes werden wir aufgefordert, um die gespeicherte Prozedur zum Aufrufen auszuwählen.</span><span class="sxs-lookup"><span data-stu-id="abb7b-244">Next, we are prompted to select the stored procedure to invoke.</span></span> <span data-ttu-id="abb7b-245">Wählen Sie die `GetProductsPaged` gespeicherten Prozedur aus der Dropdown Liste.</span><span class="sxs-lookup"><span data-stu-id="abb7b-245">Pick the `GetProductsPaged` stored procedure from the drop-down list.</span></span>


![Wählen Sie die GetProductsPaged gespeicherten Prozedur aus der Dropdown Liste](efficiently-paging-through-large-amounts-of-data-cs/_static/image12.png)

<span data-ttu-id="abb7b-247">**Abbildung 10**: Wählen Sie die GetProductsPaged gespeicherten Prozedur aus der Dropdown Liste</span><span class="sxs-lookup"><span data-stu-id="abb7b-247">**Figure 10**: Choose the GetProductsPaged Stored Procedure from the Drop-Down List</span></span>


<span data-ttu-id="abb7b-248">Der nächste Bildschirm fragt Sie dann, welche Art von Daten von der gespeicherten Prozedur zurückgegeben wird: Tabellendaten, die einen einzelnen Wert oder keinen Wert.</span><span class="sxs-lookup"><span data-stu-id="abb7b-248">The next screen then asks you what kind of data is returned by the stored procedure: tabular data, a single value, or no value.</span></span> <span data-ttu-id="abb7b-249">Da die `GetProductsPaged` gespeicherte Prozedur kann mehrere Datensätze zurückzugeben, anzugeben, dass sie Tabellendaten zurückgibt.</span><span class="sxs-lookup"><span data-stu-id="abb7b-249">Since the `GetProductsPaged` stored procedure can return multiple records, indicate that it returns tabular data.</span></span>


![Um anzugeben Sie, dass die gespeicherte Prozedur Tabellendaten zurückgibt](efficiently-paging-through-large-amounts-of-data-cs/_static/image13.png)

<span data-ttu-id="abb7b-251">**Abbildung 11**: anzugeben, dass die gespeicherte Prozedur Tabellendaten zurückgibt</span><span class="sxs-lookup"><span data-stu-id="abb7b-251">**Figure 11**: Indicate that the Stored Procedure Returns Tabular Data</span></span>


<span data-ttu-id="abb7b-252">Geben Sie schließlich an die Namen der Methoden, die Sie erstellt haben möchten.</span><span class="sxs-lookup"><span data-stu-id="abb7b-252">Finally, indicate the names of the methods you want to have created.</span></span> <span data-ttu-id="abb7b-253">Wie bei unserer vorherigen Lernprogrammen fahren Sie fort, und Methoden, die beide die Füllung mit einer "DataTable" erstellen und Zurückgeben einer "DataTable".</span><span class="sxs-lookup"><span data-stu-id="abb7b-253">As with our previous tutorials, go ahead and create methods using both the Fill a DataTable and Return a DataTable.</span></span> <span data-ttu-id="abb7b-254">Benennen Sie die erste Methode `FillPaged` und das zweite `GetProductsPaged`.</span><span class="sxs-lookup"><span data-stu-id="abb7b-254">Name the first method `FillPaged` and the second `GetProductsPaged`.</span></span>


![Name der Methoden FillPaged und GetProductsPaged](efficiently-paging-through-large-amounts-of-data-cs/_static/image14.png)

<span data-ttu-id="abb7b-256">**Abbildung 12**: Name der Methoden FillPaged und GetProductsPaged</span><span class="sxs-lookup"><span data-stu-id="abb7b-256">**Figure 12**: Name the Methods FillPaged and GetProductsPaged</span></span>


<span data-ttu-id="abb7b-257">Erstellt eine DAL-Methode, um eine bestimmte Seite Produkte zurückzugeben, müssen wir darüber hinaus auch solche Funktionen in die BLL angeben.</span><span class="sxs-lookup"><span data-stu-id="abb7b-257">In addition to created a DAL method to return a particular page of products, we also need to provide such functionality in the BLL.</span></span> <span data-ttu-id="abb7b-258">Wie die DAL-Methode der BLL s GetProductsPaged-Methode zustimmen zwei Integer-Eingaben zum Angeben der Zeilenindex starten und die maximale Zeilenanzahl sowie nur Datensätze, die innerhalb des angegebenen Bereichs liegen zurückgeben.</span><span class="sxs-lookup"><span data-stu-id="abb7b-258">Like the DAL method, the BLL s GetProductsPaged method must accept two integer inputs for specifying the Start Row Index and Maximum Rows, and must return just those records that fall within the specified range.</span></span> <span data-ttu-id="abb7b-259">Erstellen Sie eine solche BLL Methode in der ProductsBLL-Klasse, dass lediglich Aufrufe nach unten in der DAL-s GetProductsPaged-Methode, wie folgt:</span><span class="sxs-lookup"><span data-stu-id="abb7b-259">Create such a BLL method in the ProductsBLL class that merely calls down into the DAL s GetProductsPaged method, like so:</span></span>


[!code-csharp[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample8.cs)]

<span data-ttu-id="abb7b-260">Sie können einen beliebigen Namen verwenden Entscheidung, wie es in Kürze, die angezeigt wird, aber für die BLL Eingabeparameter für das s-Methode, für den Einsatz `startRowIndex` und `maximumRows` uns ein zusätzlicher erspart viel Arbeit, die beim Konfigurieren von einem ObjectDataSource zur Verwendung dieser Methode.</span><span class="sxs-lookup"><span data-stu-id="abb7b-260">You can use any name for the BLL method s input parameters, but, as we will see shortly, choosing to use `startRowIndex` and `maximumRows` saves us from an extra bit of work when configuring an ObjectDataSource to use this method.</span></span>

## <a name="step-4-configuring-the-objectdatasource-to-use-custom-paging"></a><span data-ttu-id="abb7b-261">Schritt 4: Konfigurieren der ObjectDataSource Verwendung benutzerdefiniertes Paging</span><span class="sxs-lookup"><span data-stu-id="abb7b-261">Step 4: Configuring the ObjectDataSource to Use Custom Paging</span></span>

<span data-ttu-id="abb7b-262">Mit den Methoden für den Zugriff auf eine bestimmte Teilmenge der Datensätze, die vollständige BLL und DAL steuern wir re kann jetzt eine GridView erstellen diese Seiten durch die zugrunde liegenden Datensätze mit benutzerdefiniertes Paging.</span><span class="sxs-lookup"><span data-stu-id="abb7b-262">With the BLL and DAL methods for accessing a particular subset of records complete, we re ready to create a GridView control that pages through its underlying records using custom paging.</span></span> <span data-ttu-id="abb7b-263">Öffnen Sie zunächst die `EfficientPaging.aspx` auf der Seite der `PagingAndSorting` Ordner die Seite eine GridView hinzu, und konfigurieren, um ein neues ObjectDataSource-Steuerelement zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="abb7b-263">Start by opening the `EfficientPaging.aspx` page in the `PagingAndSorting` folder, add a GridView to the page, and configure it to use a new ObjectDataSource control.</span></span> <span data-ttu-id="abb7b-264">In unseren Tutorials, letzten, mussten wir häufig das ObjectDataSource konfiguriert die `ProductsBLL` Klasse s `GetProducts` Methode.</span><span class="sxs-lookup"><span data-stu-id="abb7b-264">In our past tutorials, we often had the ObjectDataSource configured to use the `ProductsBLL` class s `GetProducts` method.</span></span> <span data-ttu-id="abb7b-265">Dieses Mal jedoch wir verwenden möchten die `GetProductsPaged` Methode stattdessen seit der `GetProducts` -Methode zurückkehrt *alle* der Produkte in der Datenbank während `GetProductsPaged` gibt nur eine bestimmte Teilmenge der Datensätze.</span><span class="sxs-lookup"><span data-stu-id="abb7b-265">This time, however, we want to use the `GetProductsPaged` method instead, since the `GetProducts` method returns *all* of the products in the database whereas `GetProductsPaged` returns just a particular subset of records.</span></span>


![Konfigurieren der ObjectDataSource zur Verwendung der ProductsBLL Klasse s GetProductsPaged-Methode](efficiently-paging-through-large-amounts-of-data-cs/_static/image15.png)

<span data-ttu-id="abb7b-267">**Abbildung 13**: Konfigurieren der ObjectDataSource zur Verwendung der ProductsBLL Klasse s GetProductsPaged-Methode</span><span class="sxs-lookup"><span data-stu-id="abb7b-267">**Figure 13**: Configure the ObjectDataSource to Use the ProductsBLL Class s GetProductsPaged Method</span></span>


<span data-ttu-id="abb7b-268">Da wir re erstellen eine nur-Lese GridView erkundet Festlegen der Methode Dropdown-Liste in den INSERT-, Update-, und löschen Sie Registerkarten (keine).</span><span class="sxs-lookup"><span data-stu-id="abb7b-268">Since we re creating a read-only GridView, take a moment to set the method drop-down list in the INSERT, UPDATE, and DELETE tabs to (None).</span></span>

<span data-ttu-id="abb7b-269">Im nächsten Schritt fordert uns das ObjectDataSource-Assistenten für die Datenquellen der `GetProductsPaged` Methode s `startRowIndex` und `maximumRows` Eingabewerte für Parameter.</span><span class="sxs-lookup"><span data-stu-id="abb7b-269">Next, the ObjectDataSource wizard prompts us for the sources of the `GetProductsPaged` method s `startRowIndex` and `maximumRows` input parameters values.</span></span> <span data-ttu-id="abb7b-270">Diese Eingabeparameter werden tatsächlich festgelegt werden, indem die GridView automatisch so einfach behalten Sie die Quelle keine und klicken Sie auf ' Fertig stellen '.</span><span class="sxs-lookup"><span data-stu-id="abb7b-270">These input parameters will actually be set by the GridView automatically, so simply leave the source set to None and click Finish.</span></span>


![Lassen Sie die Eingabeparameter Quellen None](efficiently-paging-through-large-amounts-of-data-cs/_static/image16.png)

<span data-ttu-id="abb7b-272">**Abbildung 14**: lassen Sie die Eingabeparameter Quellen None</span><span class="sxs-lookup"><span data-stu-id="abb7b-272">**Figure 14**: Leave the Input Parameter Sources as None</span></span>


<span data-ttu-id="abb7b-273">Nach Abschluss des Assistenten ObjectDataSource wird die GridView eine BoundField- oder CheckBoxField, für die einzelnen Datenfelder Produkt enthalten.</span><span class="sxs-lookup"><span data-stu-id="abb7b-273">After completing the ObjectDataSource wizard, the GridView will contain a BoundField or CheckBoxField for each of the product data fields.</span></span> <span data-ttu-id="abb7b-274">Wahlweise können die GridView-s-Darstellung anpassen, nach Bedarf.</span><span class="sxs-lookup"><span data-stu-id="abb7b-274">Feel free to tailor the GridView s appearance as you see fit.</span></span> <span data-ttu-id="abb7b-275">Ich haben sich entschieden, zur ausschließlichen Anzeige der `ProductName`, `CategoryName`, `SupplierName`, `QuantityPerUnit`, und `UnitPrice` BoundFields.</span><span class="sxs-lookup"><span data-stu-id="abb7b-275">I ve opted to display only the `ProductName`, `CategoryName`, `SupplierName`, `QuantityPerUnit`, and `UnitPrice` BoundFields.</span></span> <span data-ttu-id="abb7b-276">Konfigurieren Sie zudem die GridView zur Unterstützung von Paging durch Aktivieren des Kontrollkästchens Paging aktivieren, in das Smarttag.</span><span class="sxs-lookup"><span data-stu-id="abb7b-276">Also, configure the GridView to support paging by checking the Enable Paging checkbox in its smart tag.</span></span> <span data-ttu-id="abb7b-277">Nach der Änderung sollte die GridView und ObjectDataSource deklarative Markup etwa wie folgt aussehen:</span><span class="sxs-lookup"><span data-stu-id="abb7b-277">After these changes, the GridView and ObjectDataSource declarative markup should look similar to the following:</span></span>


[!code-aspx[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample9.aspx)]

<span data-ttu-id="abb7b-278">Wenn Sie die Seite über einen Browser besuchen, die GridView ist jedoch keine Where gefunden werden.</span><span class="sxs-lookup"><span data-stu-id="abb7b-278">If you visit the page through a browser, however, the GridView is no where to be found.</span></span>


![Die GridView wird nicht angezeigt.](efficiently-paging-through-large-amounts-of-data-cs/_static/image17.png)

<span data-ttu-id="abb7b-280">**Abbildung 15**: die GridView wird nicht angezeigt.</span><span class="sxs-lookup"><span data-stu-id="abb7b-280">**Figure 15**: The GridView is Not Displayed</span></span>


<span data-ttu-id="abb7b-281">Die GridView ist nicht vorhanden, da das ObjectDataSource derzeit für beide 0 als Werte verwendet die `GetProductsPaged` `startRowIndex` und `maximumRows` Eingabeparameter.</span><span class="sxs-lookup"><span data-stu-id="abb7b-281">The GridView is missing because the ObjectDataSource is currently using 0 as the values for both of the `GetProductsPaged` `startRowIndex` and `maximumRows` input parameters.</span></span> <span data-ttu-id="abb7b-282">Daher die resultierende SQL-Abfrage ist keine Datensätze zurückgeben, und daher die GridView wird nicht angezeigt.</span><span class="sxs-lookup"><span data-stu-id="abb7b-282">Hence, the resulting SQL query is returning no records and therefore the GridView is not displayed.</span></span>

<span data-ttu-id="abb7b-283">Zur Behebung des Problems, müssen wir die ObjectDataSource benutzerdefiniertes Paging Verwendung konfigurieren.</span><span class="sxs-lookup"><span data-stu-id="abb7b-283">To remedy this, we need to configure the ObjectDataSource to use custom paging.</span></span> <span data-ttu-id="abb7b-284">Dies kann in den folgenden Schritten erfolgen:</span><span class="sxs-lookup"><span data-stu-id="abb7b-284">This can be accomplished in the following steps:</span></span>

1. <span data-ttu-id="abb7b-285">**Legen Sie das ObjectDataSource-s `EnablePaging` Eigenschaft `true`**  Dies gibt an, um das ObjectDataSource, die an ihn übergeben werden muss die `SelectMethod` zwei zusätzliche Parameter: einen zur Angabe der Zeilenindex starten ([ `StartRowIndexParameterName` ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.startrowindexparametername.aspx)), und geben Sie die maximale Zeilenanzahl ([`MaximumRowsParameterName`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.maximumrowsparametername.aspx)).</span><span class="sxs-lookup"><span data-stu-id="abb7b-285">**Set the ObjectDataSource s `EnablePaging` property to `true`** this indicates to the ObjectDataSource that it must pass to the `SelectMethod` two additional parameters: one to specify the Start Row Index ([`StartRowIndexParameterName`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.startrowindexparametername.aspx)), and one to specify the Maximum Rows ([`MaximumRowsParameterName`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.maximumrowsparametername.aspx)).</span></span>
2. <span data-ttu-id="abb7b-286">**Legen Sie das ObjectDataSource-s `StartRowIndexParameterName` und `MaximumRowsParameterName` Eigenschaften entsprechend** der `StartRowIndexParameterName` und `MaximumRowsParameterName` -Eigenschaften geben die Namen der Eingabeparameter übergebenen der `SelectMethod` für benutzerdefinierte Paging Zwecke.</span><span class="sxs-lookup"><span data-stu-id="abb7b-286">**Set the ObjectDataSource s `StartRowIndexParameterName` and `MaximumRowsParameterName` Properties Accordingly** the `StartRowIndexParameterName` and `MaximumRowsParameterName` properties indicate the names of the input parameters passed into the `SelectMethod` for custom paging purposes.</span></span> <span data-ttu-id="abb7b-287">Standardmäßig sind diese Parameternamen `startIndexRow` und `maximumRows`, daher, beim Erstellen der `GetProductsPaged` Methode in der BLL diese Werte für die Eingabeparameter verwendet.</span><span class="sxs-lookup"><span data-stu-id="abb7b-287">By default, these parameter names are `startIndexRow` and `maximumRows`, which is why, when creating the `GetProductsPaged` method in the BLL, I used these values for the input parameters.</span></span> <span data-ttu-id="abb7b-288">Wenn Sie ausgewählt haben, verwenden Sie unterschiedliche Parameternamen für BLL s `GetProductsPaged` Methode z. B. `startIndex` und `maxRows`für Beispiel müssen Sie das ObjectDataSource-s festgelegt `StartRowIndexParameterName` und `MaximumRowsParameterName` Eigenschaften entsprechend (z. B. StartIndex für `StartRowIndexParameterName` und MaxRows für `MaximumRowsParameterName`).</span><span class="sxs-lookup"><span data-stu-id="abb7b-288">If you chose to use different parameter names for the BLL s `GetProductsPaged` method such as `startIndex` and `maxRows`, for example you would need to set the ObjectDataSource s `StartRowIndexParameterName` and `MaximumRowsParameterName` properties accordingly (such as startIndex for `StartRowIndexParameterName` and maxRows for `MaximumRowsParameterName`).</span></span>
3. <span data-ttu-id="abb7b-289">**Legen Sie die s ObjectDataSource [ `SelectCountMethod` Eigenschaft](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.selectcountmethod(VS.80).aspx) auf den Namen der Methode, die insgesamt Anzahl der Datensätze werden ausgelagerten über zurückgibt (`TotalNumberOfProducts`)** Bedenken Sie, dass die `ProductsBLL` Klasse s `TotalNumberOfProducts`Methode gibt die Gesamtzahl der Datensätze, die ausgelagerte durch eine DAL-Methode, die ausgeführt wird mithilfe einer `SELECT COUNT(*) FROM Products` Abfrage.</span><span class="sxs-lookup"><span data-stu-id="abb7b-289">**Set the ObjectDataSource s [`SelectCountMethod` Property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.selectcountmethod(VS.80).aspx) to the Name of the Method that Returns the Total Number of Records Being Paged Through (`TotalNumberOfProducts`)** recall that the `ProductsBLL` class s `TotalNumberOfProducts` method returns the total number of records being paged through using a DAL method that executes a `SELECT COUNT(*) FROM Products` query.</span></span> <span data-ttu-id="abb7b-290">Diese Informationen werden von der ObjectDataSource benötigt, um die Auslagerungsschnittstelle ordnungsgemäß zu rendern.</span><span class="sxs-lookup"><span data-stu-id="abb7b-290">This information is needed by the ObjectDataSource in order to correctly render the paging interface.</span></span>
4. <span data-ttu-id="abb7b-291">**Entfernen Sie die `startRowIndex` und `maximumRows` `<asp:Parameter>` Elemente aus der ObjectDataSource s deklarativem Markup** beim Konfigurieren der ObjectDataSource über den Assistenten hinzugefügt Visual Studio automatisch zwei `<asp:Parameter>` Elemente für die `GetProductsPaged` Methode s Eingabeparameter.</span><span class="sxs-lookup"><span data-stu-id="abb7b-291">**Remove the `startRowIndex` and `maximumRows` `<asp:Parameter>` Elements from the ObjectDataSource s Declarative Markup** when configuring the ObjectDataSource through the wizard, Visual Studio automatically added two `<asp:Parameter>` elements for the `GetProductsPaged` method s input parameters.</span></span> <span data-ttu-id="abb7b-292">Durch Festlegen von `EnablePaging` auf `true`, diese Parameter automatisch weitergegeben werden; Wenn sie auch in die deklarative Syntax angezeigt werden, versucht das ObjectDataSource Übergabe *vier* Parameter für die `GetProductsPaged` Methode und die zwei Parameter an die `TotalNumberOfProducts` Methode.</span><span class="sxs-lookup"><span data-stu-id="abb7b-292">By setting `EnablePaging` to `true`, these parameters will be passed automatically; if they also appear in the declarative syntax, the ObjectDataSource will attempt to pass *four* parameters to the `GetProductsPaged` method and two parameters to the `TotalNumberOfProducts` method.</span></span> <span data-ttu-id="abb7b-293">Wenn Sie vergessen, entfernen Sie diese `<asp:Parameter>` Elemente, wenn Sie die Seite über einen Browser besuchen Sie eine Fehlermeldung wie erhalten: *ObjectDataSource "ObjectDataSource1" konnte nicht gefunden werden eine nicht generische Methode "TotalNumberOfProducts", die aufweist Parameter: StartRowIndex MaximumRows*.</span><span class="sxs-lookup"><span data-stu-id="abb7b-293">If you forget to remove these `<asp:Parameter>` elements, when visiting the page through a browser you'll get an error message like: *ObjectDataSource 'ObjectDataSource1' could not find a non-generic method 'TotalNumberOfProducts' that has parameters: startRowIndex, maximumRows*.</span></span>

<span data-ttu-id="abb7b-294">Nachdem diese Änderungen vorgenommen wurden, sollte das ObjectDataSource s deklarative Syntax wie folgt aussehen:</span><span class="sxs-lookup"><span data-stu-id="abb7b-294">After making these changes, the ObjectDataSource s declarative syntax should look like the following:</span></span>


[!code-aspx[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample10.aspx)]

<span data-ttu-id="abb7b-295">Beachten Sie, dass die `EnablePaging` und `SelectCountMethod` Eigenschaften festgelegt wurden und die `<asp:Parameter>` Elemente entfernt wurden.</span><span class="sxs-lookup"><span data-stu-id="abb7b-295">Note that the `EnablePaging` and `SelectCountMethod` properties have been set and the `<asp:Parameter>` elements have been removed.</span></span> <span data-ttu-id="abb7b-296">Abbildung 16 zeigt einen Screenshot des Fensters Eigenschaften auf, nachdem diese Änderungen vorgenommen wurden.</span><span class="sxs-lookup"><span data-stu-id="abb7b-296">Figure 16 shows a screen shot of the Properties window after these changes have been made.</span></span>


![Um benutzerdefinierte Paging zu verwenden, konfigurieren Sie das ObjectDataSource-Steuerelement](efficiently-paging-through-large-amounts-of-data-cs/_static/image18.png)

<span data-ttu-id="abb7b-298">**Abbildung 16**: um benutzerdefiniertes Paging zu verwenden, konfigurieren Sie das ObjectDataSource-Steuerelement</span><span class="sxs-lookup"><span data-stu-id="abb7b-298">**Figure 16**: To Use Custom Paging, Configure the ObjectDataSource Control</span></span>


<span data-ttu-id="abb7b-299">Finden Sie nachdem diese Änderungen vorgenommen wurden auf dieser Seite über einen Browser.</span><span class="sxs-lookup"><span data-stu-id="abb7b-299">After making these changes, visit this page through a browser.</span></span> <span data-ttu-id="abb7b-300">Daraufhin sollte 10 Produkte aufgeführt, alphabetisch sortiert.</span><span class="sxs-lookup"><span data-stu-id="abb7b-300">You should see 10 products listed, ordered alphabetically.</span></span> <span data-ttu-id="abb7b-301">Nehmen Sie einen Moment Zeit, um die Seite zu einem Zeitpunkt zu durchlaufen.</span><span class="sxs-lookup"><span data-stu-id="abb7b-301">Take a moment to step through the data one page at a time.</span></span> <span data-ttu-id="abb7b-302">Es gibt keinen visuellen Unterschied aus der Perspektive des Endbenutzers s standardmäßige und benutzerdefinierte Paging, Seiten benutzerdefinierte paging effizienter durch große Mengen von Daten während es nur die Datensätze abruft, die für eine angegebene Seite angezeigt werden müssen.</span><span class="sxs-lookup"><span data-stu-id="abb7b-302">While there is no visual difference from the end user s perspective between default paging and custom paging, custom paging more efficiently pages through large amounts of data as it only retrieves those records that need to be displayed for a given page.</span></span>


<span data-ttu-id="abb7b-303">[![Die Daten, sortiert nach Produkt-s-Name ist ausgelagerten benutzerdefinierte mithilfe von Paging](efficiently-paging-through-large-amounts-of-data-cs/_static/image20.png)](efficiently-paging-through-large-amounts-of-data-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="abb7b-303">[![The Data, Ordered by the Product s Name, is Paged Using Custom Paging](efficiently-paging-through-large-amounts-of-data-cs/_static/image20.png)](efficiently-paging-through-large-amounts-of-data-cs/_static/image19.png)</span></span>

<span data-ttu-id="abb7b-304">**Abbildung 17**: die Daten, sortiert nach Produkt-s-Name ist ausgelagerten benutzerdefinierte mithilfe von Paging ([klicken Sie hier, um das Bild in voller Größe angezeigt](efficiently-paging-through-large-amounts-of-data-cs/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="abb7b-304">**Figure 17**: The Data, Ordered by the Product s Name, is Paged Using Custom Paging ([Click to view full-size image](efficiently-paging-through-large-amounts-of-data-cs/_static/image21.png))</span></span>


> [!NOTE]
> <span data-ttu-id="abb7b-305">Mit benutzerdefinierten Paging zählen der Seite "durch das ObjectDataSource-s. zurückgegebene Wert `SelectCountMethod` im Ansichtszustand GridView s gespeichert ist.</span><span class="sxs-lookup"><span data-stu-id="abb7b-305">With custom paging, the page count value returned by the ObjectDataSource�s `SelectCountMethod` is stored in the GridView�s view state.</span></span> <span data-ttu-id="abb7b-306">Andere GridView-Variablen der `PageIndex`, `EditIndex`, `SelectedIndex`, `DataKeys` Auflistung usw. sind gespeichert *Steuerelementzustand*, dem wird beibehalten, unabhängig vom Wert der GridView s `EnableViewState` Diese Eigenschaft.</span><span class="sxs-lookup"><span data-stu-id="abb7b-306">Other GridView variables the `PageIndex`, `EditIndex`, `SelectedIndex`, `DataKeys` collection, and so on are stored in *control state*, which is persisted regardless of the value of the GridView�s `EnableViewState` property.</span></span> <span data-ttu-id="abb7b-307">Da die `PageCount` Wert wird beibehalten über Postbacks über den Ansichtszustand, wenn eine Auslagerungsdatei-Schnittstelle verwenden, die enthält einen Link, um die letzte Seite aufzurufen, ist es unabdinglich, der Ansichtszustand des GridView-s aktiviert werden.</span><span class="sxs-lookup"><span data-stu-id="abb7b-307">Since the `PageCount` value is persisted across postbacks using view state, when using a paging interface that includes a link to take you to the last page, it is imperative that the GridView�s view state be enabled.</span></span> <span data-ttu-id="abb7b-308">(Wenn Paging-Schnittstelle einen direkten Link zur letzten keine enthält Seite, Sie können dann die Ansichtszustand deaktivieren)</span><span class="sxs-lookup"><span data-stu-id="abb7b-308">(If your paging interface does not include a direct link to the last page, then you may disable view state.)</span></span>


<span data-ttu-id="abb7b-309">Bewirkt, dass einen Postback und weist die GridView zum Aktualisieren der letzten Seite Link seine `PageIndex` Eigenschaft.</span><span class="sxs-lookup"><span data-stu-id="abb7b-309">Clicking the last page link causes a postback and instructs the GridView to update its `PageIndex` property.</span></span> <span data-ttu-id="abb7b-310">Wenn die letzte Seitenlink geklickt wird, weist die GridView seine `PageIndex` auf einen Wert einer Eigenschaft kleiner als die `PageCount` Eigenschaft.</span><span class="sxs-lookup"><span data-stu-id="abb7b-310">If the last page link is clicked, the GridView assigns its `PageIndex` property to a value one less than its `PageCount` property.</span></span> <span data-ttu-id="abb7b-311">Mit Ansichtszustand deaktiviert die `PageCount` Wert wird über Postbacks verloren und die `PageIndex` wird stattdessen den Wert des maximalen ganzen Zahl zugewiesen.</span><span class="sxs-lookup"><span data-stu-id="abb7b-311">With view state disabled, the `PageCount` value is lost across postbacks and the `PageIndex` is assigned the maximum integer value instead.</span></span> <span data-ttu-id="abb7b-312">Als Nächstes die GridView versucht, durch Multiplizieren den Startindex für die Zeile zu bestimmen die `PageSize` und `PageCount` Eigenschaften.</span><span class="sxs-lookup"><span data-stu-id="abb7b-312">Next, the GridView attempts to determine the starting row index by multiplying the `PageSize` and `PageCount` properties.</span></span> <span data-ttu-id="abb7b-313">Dies führt zu einer `OverflowException` , da das Produkt die maximale zulässige ganzzahlige Größe überschreitet.</span><span class="sxs-lookup"><span data-stu-id="abb7b-313">This results in an `OverflowException` since the product exceeds the maximum allowed integer size.</span></span>

## <a name="implement-custom-paging-and-sorting"></a><span data-ttu-id="abb7b-314">Implementieren benutzerdefinierter Paging und sortieren</span><span class="sxs-lookup"><span data-stu-id="abb7b-314">Implement Custom Paging and Sorting</span></span>

<span data-ttu-id="abb7b-315">Unsere aktuelle benutzerdefiniertes Paging-Implementierung muss die Reihenfolge nach dem die Daten über ausgelagert werden statisch angegeben werden, für die Erstellung der `GetProductsPaged` gespeicherten Prozedur.</span><span class="sxs-lookup"><span data-stu-id="abb7b-315">Our current custom paging implementation requires that the order by which the data is paged through be specified statically when creating the `GetProductsPaged` stored procedure.</span></span> <span data-ttu-id="abb7b-316">Allerdings kann notierten enthält das Smarttag für GridView s ein Kontrollkästchen Sortieren aktivieren, zusätzlich zur Option Paging aktivieren.</span><span class="sxs-lookup"><span data-stu-id="abb7b-316">However, you may have noted that the GridView s smart tag contains an Enable Sorting checkbox in addition to the Enable Paging option.</span></span> <span data-ttu-id="abb7b-317">Leider werden sortierungsunterstützung an die GridView mit unseren aktuellen benutzerdefinierte Paging Implementierung hinzufügen, nur die Datensätze der aktuell angezeigten Seite der Daten sortiert.</span><span class="sxs-lookup"><span data-stu-id="abb7b-317">Unfortunately, adding sorting support to the GridView with our current custom paging implementation will only sort the records on the currently viewed page of data.</span></span> <span data-ttu-id="abb7b-318">Wenn Sie die GridView auch Unterstützung von Paging, und klicken Sie dann beim Anzeigen der ersten Seite der Daten nach Produktname konfigurieren in absteigender Reihenfolge sortieren wird es z. B. die Reihenfolge der Produkte auf der Seite "1" umgekehrt.</span><span class="sxs-lookup"><span data-stu-id="abb7b-318">For example, if you configure the GridView to also support paging and then, when viewing the first page of data, sort by product name in descending order, it will reverse the order of the products on page 1.</span></span> <span data-ttu-id="abb7b-319">Wie in Abbildung 18 dargestellt, zeigt z. B. Carnarvon-Tiger als erste Produkt beim in umgekehrter alphabetischer Reihenfolge sortieren, wodurch die 71 anderen Produkte ignoriert, die in alphabetischer Reihenfolge nach Carnarvon-Tiger, folgen. nur die Datensätze auf der ersten Seite werden bei der Sortierung berücksichtigt.</span><span class="sxs-lookup"><span data-stu-id="abb7b-319">As Figure 18 shows, such shows Carnarvon Tigers as the first product when sorting in reverse alphabetical order, which ignores the 71 other products that come after Carnarvon Tigers, alphabetically; only those records on the first page are considered in the sorting.</span></span>


<span data-ttu-id="abb7b-320">[![Nur die Daten angezeigt, auf der aktuellen Seite wird sortiert.](efficiently-paging-through-large-amounts-of-data-cs/_static/image23.png)](efficiently-paging-through-large-amounts-of-data-cs/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="abb7b-320">[![Only the Data Shown on the Current Page is Sorted](efficiently-paging-through-large-amounts-of-data-cs/_static/image23.png)](efficiently-paging-through-large-amounts-of-data-cs/_static/image22.png)</span></span>

<span data-ttu-id="abb7b-321">**Abbildung 18**: nur die Daten angezeigt, auf der aktuellen Seite sortiert wird ([klicken Sie hier, um das Bild in voller Größe angezeigt](efficiently-paging-through-large-amounts-of-data-cs/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="abb7b-321">**Figure 18**: Only the Data Shown on the Current Page is Sorted ([Click to view full-size image](efficiently-paging-through-large-amounts-of-data-cs/_static/image24.png))</span></span>


<span data-ttu-id="abb7b-322">Die Sortierung gilt nur für die aktuelle Seite der Daten, da die Sortierung erfolgt nach dem die Daten aus den s BLL abgerufen wurde `GetProductsPaged` , und diese Methode gibt nur die Datensätze für die Seite.</span><span class="sxs-lookup"><span data-stu-id="abb7b-322">The sorting only applies to the current page of data because the sorting is occurring after the data has been retrieved from the BLL s `GetProductsPaged` method, and this method only returns those records for the specific page.</span></span> <span data-ttu-id="abb7b-323">Um die Sortierung ordnungsgemäß zu implementieren, müssen wir den Sortierungsausdruck auf übergeben der `GetProductsPaged` Methode, damit die Daten vor der Rückgabe der speziellen Seite der Daten entsprechend Rang haben können.</span><span class="sxs-lookup"><span data-stu-id="abb7b-323">To implement sorting correctly, we need to pass the sort expression to the `GetProductsPaged` method so that the data can be ranked appropriately before returning the specific page of data.</span></span> <span data-ttu-id="abb7b-324">Wir sehen, wie dies in unserem nächsten Lernprogramm zu erreichen.</span><span class="sxs-lookup"><span data-stu-id="abb7b-324">We'll see how to accomplish this in our next tutorial.</span></span>

## <a name="implementing-custom-paging-and-deleting"></a><span data-ttu-id="abb7b-325">Implementieren benutzerdefinierte Paging und löschen</span><span class="sxs-lookup"><span data-stu-id="abb7b-325">Implementing Custom Paging and Deleting</span></span>

<span data-ttu-id="abb7b-326">Wenn Sie Funktionen in eine GridView, deren Daten werden mithilfe von benutzerdefinierten Paging Techniken werden, festgestellt werden wenn den letzten Datensatz von der letzten Seite löschen ausgelagert, löschen aktivieren, die GridView anstatt entsprechend dekrementiert die GridView s verschwindet`PageIndex`.</span><span class="sxs-lookup"><span data-stu-id="abb7b-326">If you enabling deleting functionality in a GridView whose data is paged using custom paging techniques you will find that when deleting the last record from the last page, the GridView disappears rather than appropriately decrementing the GridView s `PageIndex`.</span></span> <span data-ttu-id="abb7b-327">Um diesen Fehler zu reproduzieren, aktivieren Sie für das Lernprogramm einfach wir gerade erstellten löschen.</span><span class="sxs-lookup"><span data-stu-id="abb7b-327">To reproduce this bug, enable deleting for the tutorial just we just created.</span></span> <span data-ttu-id="abb7b-328">Wechseln Sie zur letzten Seite (Seite 9), in denen sollte ein einzelnes Produkt angezeigt werden, da wir über 81 Produkte, 10 Produkte zu einem Zeitpunkt paging sind.</span><span class="sxs-lookup"><span data-stu-id="abb7b-328">Go to the last page (page 9), where you should see a single product since we are paging through 81 products, 10 products at a time.</span></span> <span data-ttu-id="abb7b-329">Löschen Sie dieses Produkt.</span><span class="sxs-lookup"><span data-stu-id="abb7b-329">Delete this product.</span></span>

<span data-ttu-id="abb7b-330">Beim Löschen des letzten Produkts, die GridView *sollten* automatisch zur Seite "achte" wechseln, und solche Funktionen mit Standardnavigation ausgestellt wird.</span><span class="sxs-lookup"><span data-stu-id="abb7b-330">Upon deleting the last product, the GridView *should* automatically go to the eighth page, and such functionality is exhibited with default paging.</span></span> <span data-ttu-id="abb7b-331">Mit benutzerdefinierten Paging verschwindet jedoch nach dem Löschen dieses letzten Produkts auf der letzten Seite GridView einfach aus dem Bildschirm vollständig.</span><span class="sxs-lookup"><span data-stu-id="abb7b-331">With custom paging, however, after deleting that last product on the last page, the GridView simply disappears from the screen altogether.</span></span> <span data-ttu-id="abb7b-332">Die genaue Ursache *warum* in diesem Fall ist vom Datentyp bit den Rahmen dieses lehrprogramms sprengen; Siehe [löschen den letzten Datensatz auf der letzten Seite aus eine GridView, für das benutzerdefinierte Paging](http://scottonwriting.net/sowblog/posts/7326.aspx) für die Details auf niedriger Ebene, auf die Quelle der Dieses Problem.</span><span class="sxs-lookup"><span data-stu-id="abb7b-332">The precise reason *why* this happens is a bit beyond the scope of this tutorial; see [Deleting the Last Record on the Last Page from a GridView with Custom Paging](http://scottonwriting.net/sowblog/posts/7326.aspx) for the low-level details as to the source of this problem.</span></span> <span data-ttu-id="abb7b-333">Zusammenfassend es s aufgrund der folgenden Schrittfolge, die durch die GridView ausgeführt werden, wenn auf die Schaltfläche "löschen" geklickt wird:</span><span class="sxs-lookup"><span data-stu-id="abb7b-333">In summary it s due to the following sequence of steps that are performed by the GridView when the Delete button is clicked:</span></span>

1. <span data-ttu-id="abb7b-334">Datensatz löschen</span><span class="sxs-lookup"><span data-stu-id="abb7b-334">Delete the record</span></span>
2. <span data-ttu-id="abb7b-335">Erhalten Sie die entsprechenden Einträge für den angegebenen anzuzeigende `PageIndex` und `PageSize`</span><span class="sxs-lookup"><span data-stu-id="abb7b-335">Get the appropriate records to display for the specified `PageIndex` and `PageSize`</span></span>
3. <span data-ttu-id="abb7b-336">Kontrollkästchen, um sicherzustellen, dass die `PageIndex` Wenn es automatisch die GridView s Verringern der Fall ist, nicht die Anzahl der Datenseiten in der Datenquelle überschreitet `PageIndex` Eigenschaft</span><span class="sxs-lookup"><span data-stu-id="abb7b-336">Check to ensure that the `PageIndex` does not exceed the number of pages of data in the data source; if it does, automatically decrement the GridView s `PageIndex` property</span></span>
4. <span data-ttu-id="abb7b-337">Binden Sie die entsprechende Seite der Daten an die GridView unter Verwendung der Datensätze, die in Schritt2 abgerufen</span><span class="sxs-lookup"><span data-stu-id="abb7b-337">Bind the appropriate page of data to the GridView using the records obtained in Step 2</span></span>

<span data-ttu-id="abb7b-338">Das Problem ist die Tatsache, diese in Schritt2 der `PageIndex` verwendet, wenn Datensätze anzuzeigenden grabbing weiterhin ist die `PageIndex` der letzten Seite, deren einzige Datensatz wurde gerade gelöscht.</span><span class="sxs-lookup"><span data-stu-id="abb7b-338">The problem stems from the fact that in Step 2 the `PageIndex` used when grabbing the records to display is still the `PageIndex` of the last page whose sole record was just deleted.</span></span> <span data-ttu-id="abb7b-339">Aus diesem Grund in Schritt2 *keine* Datensätze zurückgegeben werden, da diese letzte Seite der Daten nicht mehr Datensätze enthält.</span><span class="sxs-lookup"><span data-stu-id="abb7b-339">Therefore, in Step 2, *no* records are returned since that last page of data no longer contains any records.</span></span> <span data-ttu-id="abb7b-340">Klicken Sie dann in Schritt 3, erkennt die GridView, die die `PageIndex` -Eigenschaft ist größer als die Gesamtanzahl der Seiten, die in der Datenquelle (da wir Ve gelöscht. den letzten Datensatz in der letzten Seite) und daher verringert die `PageIndex` Eigenschaft.</span><span class="sxs-lookup"><span data-stu-id="abb7b-340">Then, in Step 3, the GridView realizes that its `PageIndex` property is greater than the total number of pages in the data source (since we ve deleted the last record in the last page) and therefore decrements its `PageIndex` property.</span></span> <span data-ttu-id="abb7b-341">In Schritt 4 versucht die GridView selbst an die in Schritt2 abgerufenen Daten zu binden. Allerdings was in Schritt2, die keine Einträge zurückgegeben wurden, wiederum zu einer leeren GridView.</span><span class="sxs-lookup"><span data-stu-id="abb7b-341">In Step 4 the GridView attempts to bind itself to the data retrieved in Step 2; however, in Step 2 no records were returned, therefore resulting in an empty GridView.</span></span> <span data-ttu-id="abb7b-342">Dieses Problem ist nicht t mit Standardnavigation, surface, da in Schritt2 *alle* Datensätze aus der Datenquelle abgerufen werden.</span><span class="sxs-lookup"><span data-stu-id="abb7b-342">With default paging, this problem doesn t surface because in Step 2 *all* records are retrieved from the data source.</span></span>

<span data-ttu-id="abb7b-343">Zum Beheben dieses Problems haben wir zwei Optionen zur Verfügung.</span><span class="sxs-lookup"><span data-stu-id="abb7b-343">To fix this we have two options.</span></span> <span data-ttu-id="abb7b-344">Der erste Schritt besteht im Erstellen Sie eines ereignishandlers für die GridView s `RowDeleted` Ereignishandler, der bestimmt, wie viele Datensätze auf der Seite angezeigt wurden, die gerade gelöscht wurde.</span><span class="sxs-lookup"><span data-stu-id="abb7b-344">The first is to create an event handler for the GridView s `RowDeleted` event handler that determines how many records were displayed in the page that was just deleted.</span></span> <span data-ttu-id="abb7b-345">Wenn gab es nur ein Datensatz, und klicken Sie dann der Datensatz nur gelöscht das letzte Lesezeichen wurde und wir benötigen, um die GridView s zu verringern. `PageIndex`.</span><span class="sxs-lookup"><span data-stu-id="abb7b-345">If there was only one record, then the record just deleted must have been the last one and we need to decrement the GridView s `PageIndex`.</span></span> <span data-ttu-id="abb7b-346">Natürlich nur aktualisiert werden sollen die `PageIndex` Wenn der Löschvorgang tatsächlich erfolgreich war, kann die Leuchten, die ermittelt die `e.Exception` Eigenschaft ist `null`.</span><span class="sxs-lookup"><span data-stu-id="abb7b-346">Of course, we only want to update the `PageIndex` if the delete operation was actually successful, which can be determined by ensuring that the `e.Exception` property is `null`.</span></span>

<span data-ttu-id="abb7b-347">Dieser Ansatz funktioniert, da er aktualisiert die `PageIndex` nach Schritt 1, aber vor Schritt2.</span><span class="sxs-lookup"><span data-stu-id="abb7b-347">This approach works because it updates the `PageIndex` after Step 1 but before Step 2.</span></span> <span data-ttu-id="abb7b-348">Aus diesem Grund wird die entsprechende Gruppe von Datensätzen in Schritt2 zurückgegeben.</span><span class="sxs-lookup"><span data-stu-id="abb7b-348">Therefore, in Step 2, the appropriate set of records is returned.</span></span> <span data-ttu-id="abb7b-349">Um dies zu erreichen, verwenden Sie Code wie folgt aus:</span><span class="sxs-lookup"><span data-stu-id="abb7b-349">To accomplish this, use code like the following:</span></span>


[!code-csharp[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample11.cs)]

<span data-ttu-id="abb7b-350">Eine alternative problemumgehung besteht im Erstellen eines ereignishandlers für das ObjectDataSource-s `RowDeleted` Ereignis und Festlegen der `AffectedRows` Eigenschaft, um den Wert 1.</span><span class="sxs-lookup"><span data-stu-id="abb7b-350">An alternative workaround is to create an event handler for the ObjectDataSource s `RowDeleted` event and to set the `AffectedRows` property to a value of 1.</span></span> <span data-ttu-id="abb7b-351">Nach dem Löschen des Datensatzes in Schritt 1 (jedoch vor dem erneuten Abrufen der Daten in Schritt2), die GridView aktualisiert seine `PageIndex` Eigenschaft, wenn eine oder mehrere Zeilen, die von dem Vorgang betroffen waren.</span><span class="sxs-lookup"><span data-stu-id="abb7b-351">After deleting the record in Step 1 (but before re-retrieving the data in Step 2), the GridView updates its `PageIndex` property if one or more rows were affected by the operation.</span></span> <span data-ttu-id="abb7b-352">Allerdings die `AffectedRows` Eigenschaft nicht durch das ObjectDataSource festgelegt ist und daher wird dieser Schritt ausgelassen.</span><span class="sxs-lookup"><span data-stu-id="abb7b-352">However, the `AffectedRows` property is not set by the ObjectDataSource and therefore this step is omitted.</span></span> <span data-ttu-id="abb7b-353">Eine Möglichkeit, diesen Schritt ausgeführt haben manuell festlegen, wird die `AffectedRows` Eigenschaft, wenn der Löschvorgang erfolgreich abgeschlossen wurde.</span><span class="sxs-lookup"><span data-stu-id="abb7b-353">One way to have this step executed is to manually set the `AffectedRows` property if the delete operation completes successfully.</span></span> <span data-ttu-id="abb7b-354">Dies kann erreicht werden, mithilfe von Code wie folgt:</span><span class="sxs-lookup"><span data-stu-id="abb7b-354">This can be accomplished using code like the following:</span></span>


[!code-csharp[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample12.cs)]

<span data-ttu-id="abb7b-355">Der Code für beide diese Ereignishandler finden Sie im Code-Behind-Klasse, von der `EfficientPaging.aspx` Beispiel.</span><span class="sxs-lookup"><span data-stu-id="abb7b-355">The code for both of these events handlers can be found in code-behind class of the `EfficientPaging.aspx` example.</span></span>

## <a name="comparing-the-performance-of-default-and-custom-paging"></a><span data-ttu-id="abb7b-356">Vergleichen die Leistung von Standard- und benutzerdefinierte Paging</span><span class="sxs-lookup"><span data-stu-id="abb7b-356">Comparing the Performance of Default and Custom Paging</span></span>

<span data-ttu-id="abb7b-357">Da benutzerdefiniertes Paging nur die benötigten Datensätze abruft, serverwiederherstellungsmethode Standardnavigation *alle* der Datensätze für jede Seite angezeigt wird, sie deaktivieren, dass das benutzerdefiniertes Paging effizienter als die Standardnavigation ist.</span><span class="sxs-lookup"><span data-stu-id="abb7b-357">Since custom paging only retrieves the needed records, whereas default paging returns *all* of the records for each page being viewed, it s clear that custom paging is more efficient than default paging.</span></span> <span data-ttu-id="abb7b-358">Aber nur wie viel effizienter benutzerdefiniertes Paging ist?</span><span class="sxs-lookup"><span data-stu-id="abb7b-358">But just how much more efficient is custom paging?</span></span> <span data-ttu-id="abb7b-359">Welche Art von Leistungssteigerungen durch Verschieben von Standardnavigation benutzerdefiniertes Paging angezeigt werden kann?</span><span class="sxs-lookup"><span data-stu-id="abb7b-359">What sort of performance gains can be seen by moving from default paging to custom paging?</span></span>

<span data-ttu-id="abb7b-360">Leider dort s kein passendes alle hier beantworten.</span><span class="sxs-lookup"><span data-stu-id="abb7b-360">Unfortunately, there s no one size fits all answer here.</span></span> <span data-ttu-id="abb7b-361">Die Leistungszuwachs hängt von einer Reihe von Faktoren, die bekannteste zwei wird die Anzahl der Datensätze, die über ausgelagerte und der Auslastung auf der Datenbank-Kanäle für Server und Kommunikation zwischen dem Webserver und Datenbankserver platziert.</span><span class="sxs-lookup"><span data-stu-id="abb7b-361">The performance gain depends on a number of factors, the most prominent two being the number of records being paged through and the load placed on the database server and communication channels between the web server and database server.</span></span> <span data-ttu-id="abb7b-362">Für kleine Tabellen mit ein paar Dutzend Datensätze möglicherweise der Leistungsunterschied unerheblich.</span><span class="sxs-lookup"><span data-stu-id="abb7b-362">For small tables with just a few dozen records, the performance difference may be negligible.</span></span> <span data-ttu-id="abb7b-363">Bei großen Tabellen mit Tausenden und Hunderttausenden von Tausenden von Zeilen jedoch ist der Leistungsunterschied akuten.</span><span class="sxs-lookup"><span data-stu-id="abb7b-363">For large tables, with thousands to hundreds of thousands of rows, though, the performance difference is acute.</span></span>

<span data-ttu-id="abb7b-364">Ein Artikel ändere, [benutzerdefinierte Paging in ASP.NET 2.0 mit SQL Server 2005](http://aspnet.4guysfromrolla.com/articles/031506-1.aspx), enthält einige ich ausgeführt wurde, um die Unterschiede zwischen diesen beiden Paging Verfahren beim paging durch eine Datenbanktabelle mit weisen Leistungstests 50.000 Datensätze.</span><span class="sxs-lookup"><span data-stu-id="abb7b-364">An article of mine, [Custom Paging in ASP.NET 2.0 with SQL Server 2005](http://aspnet.4guysfromrolla.com/articles/031506-1.aspx), contains some performance tests I ran to exhibit the differences in performance between these two paging techniques when paging through a database table with 50,000 records.</span></span> <span data-ttu-id="abb7b-365">Bei diesen Tests untersucht ich beide die Uhrzeit zum Ausführen der Abfrage auf der SQL Server-Ebene (mit [SQL Profiler](https://msdn.microsoft.com/library/ms173757.aspx)) und an die Seite mit ASP.NET [ASP.NET s ablaufverfolgungsfeatures](https://msdn.microsoft.com/library/y13fw6we.aspx).</span><span class="sxs-lookup"><span data-stu-id="abb7b-365">In these tests I examined both the time to execute the query at the SQL Server level (using [SQL Profiler](https://msdn.microsoft.com/library/ms173757.aspx)) and at the ASP.NET page using [ASP.NET s tracing features](https://msdn.microsoft.com/library/y13fw6we.aspx).</span></span> <span data-ttu-id="abb7b-366">Bedenken Sie, dass diese Tests auf meinem Entwicklung mit einem einzelnen aktiven Benutzer ausgeführt wurden und deshalb unwissenschaftlichen sind und nicht eine typische Website Auslastungsmustern zu imitieren.</span><span class="sxs-lookup"><span data-stu-id="abb7b-366">Keep in mind that these tests were run on my development box with a single active user, and therefore are unscientific and do not mimic typical website load patterns.</span></span> <span data-ttu-id="abb7b-367">Unabhängig davon, veranschaulichen die Ergebnisse der relativen Unterschiede werden in die Ausführungszeit für Standard- und benutzerdefinierte Paging, bei der Arbeit mit ausreichend große Mengen von Daten.</span><span class="sxs-lookup"><span data-stu-id="abb7b-367">Regardless, the results illustrate the relative differences in execution time for default and custom paging when working with sufficiently large amounts of data.</span></span>


|  | <span data-ttu-id="abb7b-368">**Durchschn. Dauer (Sek.)**</span><span class="sxs-lookup"><span data-stu-id="abb7b-368">**Avg. Duration (sec)**</span></span> | <span data-ttu-id="abb7b-369">**Lesevorgänge**</span><span class="sxs-lookup"><span data-stu-id="abb7b-369">**Reads**</span></span> |
| --- | --- | --- |
| <span data-ttu-id="abb7b-370">**Standardmäßig Paging SQL Profiler**</span><span class="sxs-lookup"><span data-stu-id="abb7b-370">**Default Paging SQL Profiler**</span></span> | <span data-ttu-id="abb7b-371">1.411</span><span class="sxs-lookup"><span data-stu-id="abb7b-371">1.411</span></span> | <span data-ttu-id="abb7b-372">383</span><span class="sxs-lookup"><span data-stu-id="abb7b-372">383</span></span> |
| <span data-ttu-id="abb7b-373">**Benutzerdefinierte Paging SQL Profiler**</span><span class="sxs-lookup"><span data-stu-id="abb7b-373">**Custom Paging SQL Profiler**</span></span> | <span data-ttu-id="abb7b-374">0.002</span><span class="sxs-lookup"><span data-stu-id="abb7b-374">0.002</span></span> | <span data-ttu-id="abb7b-375">29</span><span class="sxs-lookup"><span data-stu-id="abb7b-375">29</span></span> |
| <span data-ttu-id="abb7b-376">**Paging ASP.NET-Standardablaufverfolgung**</span><span class="sxs-lookup"><span data-stu-id="abb7b-376">**Default Paging ASP.NET Trace**</span></span> | <span data-ttu-id="abb7b-377">2.379</span><span class="sxs-lookup"><span data-stu-id="abb7b-377">2.379</span></span> | <span data-ttu-id="abb7b-378">*N/V*</span><span class="sxs-lookup"><span data-stu-id="abb7b-378">*N/A*</span></span> |
| <span data-ttu-id="abb7b-379">**Benutzerdefinierte Paging ASP.NET-Ablaufverfolgung**</span><span class="sxs-lookup"><span data-stu-id="abb7b-379">**Custom Paging ASP.NET Trace**</span></span> | <span data-ttu-id="abb7b-380">0.029</span><span class="sxs-lookup"><span data-stu-id="abb7b-380">0.029</span></span> | <span data-ttu-id="abb7b-381">*N/V*</span><span class="sxs-lookup"><span data-stu-id="abb7b-381">*N/A*</span></span> |


<span data-ttu-id="abb7b-382">Wie Sie sehen können, das Abrufen von Daten einer bestimmten Seite 354 weniger Lesevorgänge durchschnittlich erforderlich und in einem Bruchteil der Zeit abgeschlossen.</span><span class="sxs-lookup"><span data-stu-id="abb7b-382">As you can see, retrieving a particular page of data required 354 less reads on average and completed in a fraction of the time.</span></span> <span data-ttu-id="abb7b-383">Auf der ASP.NET-Seite benutzerdefinierte Seite konnte für das Rendern nahe bei 1/100<sup>ten</sup> der Zeit bei Verwendung von Standardnavigation werden gedauert.</span><span class="sxs-lookup"><span data-stu-id="abb7b-383">At the ASP.NET page, custom the page was able to render in close to 1/100<sup>th</sup> of the time it took when using default paging.</span></span> <span data-ttu-id="abb7b-384">Finden Sie unter [Meine Artikel](http://aspnet.4guysfromrolla.com/articles/031506-1.aspx) für Weitere Informationen zu diesen Ergebnissen zusammen mit Code und eine Datenbank, die Sie zum Reproduzieren von Tests in Ihrer eigenen Umgebung herunterladen können.</span><span class="sxs-lookup"><span data-stu-id="abb7b-384">See [my article](http://aspnet.4guysfromrolla.com/articles/031506-1.aspx) for more information on these results along with code and a database you can download to reproduce these tests in your own environment.</span></span>

## <a name="summary"></a><span data-ttu-id="abb7b-385">Zusammenfassung</span><span class="sxs-lookup"><span data-stu-id="abb7b-385">Summary</span></span>

<span data-ttu-id="abb7b-386">Standardnavigation ist ein Kinderspiel nur Überprüfung der Paging aktivieren das Kontrollkästchen in den Daten Web Control s smart Tag implementiert, jedoch solche Einfachheit stammen, auf Kosten der Leistung.</span><span class="sxs-lookup"><span data-stu-id="abb7b-386">Default paging is a cinch to implement just check the Enable Paging checkbox in the data Web control s smart tag but such simplicity comes at the cost of performance.</span></span> <span data-ttu-id="abb7b-387">Bei der Standardnavigation, wenn ein Benutzer eine beliebige Seite der Daten anfordert *alle* Datensätze zurückgegeben werden, obwohl nur ein kleiner Teil davon angezeigt werden darf.</span><span class="sxs-lookup"><span data-stu-id="abb7b-387">With default paging, when a user requests any page of data *all* records are returned, even though only a tiny fraction of them may be shown.</span></span> <span data-ttu-id="abb7b-388">Um diese Verwaltungsaufwand zu begegnen, bietet das ObjectDataSource ein alternative Paging Option benutzerdefiniertes Paging.</span><span class="sxs-lookup"><span data-stu-id="abb7b-388">To combat this performance overhead, the ObjectDataSource offers an alternative paging option custom paging.</span></span>

<span data-ttu-id="abb7b-389">Während das benutzerdefiniertes Paging verbessert Standard paging s Leistungsprobleme durch das Abrufen von nur Datensätze, die angezeigt werden, müssen sie s komplizierter benutzerdefiniertes Paging implementieren.</span><span class="sxs-lookup"><span data-stu-id="abb7b-389">While custom paging improves upon default paging s performance issues by retrieving only those records that need to be displayed, it s more involved to implement custom paging.</span></span> <span data-ttu-id="abb7b-390">Zuerst muss eine Abfrage geschrieben werden, die ordnungsgemäß (und effizient) bestimmte Teilmenge der Datensätze, die angeforderte zugreift.</span><span class="sxs-lookup"><span data-stu-id="abb7b-390">First, a query must be written that correctly (and efficiently) accesses the specific subset of records requested.</span></span> <span data-ttu-id="abb7b-391">Dies kann auf vielfältige Weise erreicht werden. die in diesem Lernprogramm werden untersucht ist mit SQL Server 2005 s neue `ROW_NUMBER()` Rang Funktion durchgeführt, und klicken Sie dann nur die zurückzugebenden Ergebnisse, dessen Rangfolge in einem angegebenen Bereich fällt.</span><span class="sxs-lookup"><span data-stu-id="abb7b-391">This can be accomplished in a number of ways; the one we examined in this tutorial is to use SQL Server 2005 s new `ROW_NUMBER()` function to rank results, and then to return just those results whose ranking falls within a specified range.</span></span> <span data-ttu-id="abb7b-392">Darüber hinaus müssen wir eine Möglichkeit zum Bestimmen der Gesamtzahl der Datensätze, die ausgelagerte über hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="abb7b-392">Furthermore, we need to add a means to determine the total number of records being paged through.</span></span> <span data-ttu-id="abb7b-393">Nach dem Erstellen dieser Methoden DAL und BLL, müssen wir auch das ObjectDataSource konfigurieren, sodass sie ermitteln kann, wie viele Datensätze werden über ausgelagerte und Zeilenindex starten und die maximale Anzahl an Zeilen Werte ordnungsgemäß an der BLL erfolgreich.</span><span class="sxs-lookup"><span data-stu-id="abb7b-393">After creating these DAL and BLL methods, we also need to configure the ObjectDataSource so that it can determine how many total records are being paged through and can correctly pass the Start Row Index and Maximum Rows values to the BLL.</span></span>

<span data-ttu-id="abb7b-394">Beim Implementieren von benutzerdefinierten Paging eine Reihe von Schritten erfordert und nicht annähernd so einfach wie Standardnavigation ist, ist benutzerdefiniertes Paging beim paging durch ausreichend große Mengen von Daten.</span><span class="sxs-lookup"><span data-stu-id="abb7b-394">While implementing custom paging does require a number of steps and is not nearly as simple as default paging, custom paging is a necessity when paging through sufficiently large amounts of data.</span></span> <span data-ttu-id="abb7b-395">Wie die Ergebnisse untersucht angezeigte, benutzerdefinierte Paging Sekunden aus dem ASP.NET Render Seitenzeit bringen kann, und kann die Last auf dem Datenbankserver beträchtlichem eine oder mehrere crashes.</span><span class="sxs-lookup"><span data-stu-id="abb7b-395">As the results examined showed, custom paging can shed seconds off of the ASP.NET page render time and can lighten the load on the database server by one ore more orders of magnitude.</span></span>

<span data-ttu-id="abb7b-396">Viel Spaß beim Programmieren!</span><span class="sxs-lookup"><span data-stu-id="abb7b-396">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="abb7b-397">Informationen zum Autor</span><span class="sxs-lookup"><span data-stu-id="abb7b-397">About the Author</span></span>

<span data-ttu-id="abb7b-398">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), Autor von sieben ASP/ASP.NET-Büchern und Gründer von [4GuysFromRolla.com](http://www.4guysfromrolla.com), Microsoft Web-Technologien seit 1998 arbeitet.</span><span class="sxs-lookup"><span data-stu-id="abb7b-398">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="abb7b-399">Scott fungiert als ein unabhängiger Berater, Trainer und Writer.</span><span class="sxs-lookup"><span data-stu-id="abb7b-399">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="abb7b-400">Sein neueste Buch wird [ *Sams Schulen selbst ASP.NET 2.0 in 24 Stunden*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="abb7b-400">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="abb7b-401">Er die erreicht werden kann, zur [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) oder über seinen Blog die finden Sie unter [ http://ScottOnWriting.NET ](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="abb7b-401">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="abb7b-402">[Zurück](paging-and-sorting-report-data-cs.md)
> [Weiter](sorting-custom-paged-data-cs.md)</span><span class="sxs-lookup"><span data-stu-id="abb7b-402">[Previous](paging-and-sorting-report-data-cs.md)
[Next](sorting-custom-paged-data-cs.md)</span></span>
