---
uid: web-forms/overview/data-access/working-with-binary-files/including-a-file-upload-option-when-adding-a-new-record-cs
title: "Option z. B. eine Datei hochladen, wenn Sie einen neuen Datensatz (c#) hinzufügen | Microsoft Docs"
author: rick-anderson
description: "Dieses Lernprogramm zeigt, wie eine Weboberfläche erstellen, die können den Benutzer sowohl geben Text-Daten und Hochladen von Binärdateien. Um die verfügbaren Optionen t veranschaulichen..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 03/27/2007
ms.topic: article
ms.assetid: 362ade25-3965-4fb2-88d2-835c4786244f
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/data-access/working-with-binary-files/including-a-file-upload-option-when-adding-a-new-record-cs
msc.type: authoredcontent
ms.openlocfilehash: 384251e5d0d72c6d1cc014c929a5d504be11d1d6
ms.sourcegitcommit: 060879fcf3f73d2366b5c811986f8695fff65db8
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/24/2018
---
<a name="including-a-file-upload-option-when-adding-a-new-record-c"></a><span data-ttu-id="872e2-104">Z. B. eine Datei hochladen-Option beim Hinzufügen eines neuen Datensatzes (c#)</span><span class="sxs-lookup"><span data-stu-id="872e2-104">Including a File Upload Option When Adding a New Record (C#)</span></span>
====================
<span data-ttu-id="872e2-105">durch [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="872e2-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="872e2-106">[Beispiel-App herunterladen](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_56_CS.exe) oder [PDF herunterladen](including-a-file-upload-option-when-adding-a-new-record-cs/_static/datatutorial56cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="872e2-106">[Download Sample App](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_56_CS.exe) or [Download PDF](including-a-file-upload-option-when-adding-a-new-record-cs/_static/datatutorial56cs1.pdf)</span></span>

> <span data-ttu-id="872e2-107">Dieses Lernprogramm zeigt, wie eine Weboberfläche erstellen, die können den Benutzer sowohl geben Text-Daten und Hochladen von Binärdateien.</span><span class="sxs-lookup"><span data-stu-id="872e2-107">This tutorial shows how to create a Web interface that allows the user to both enter text data and upload binary files.</span></span> <span data-ttu-id="872e2-108">Um die verfügbaren Optionen zum Speichern von binären Daten zu veranschaulichen, wird eine Datei in der Datenbank gespeichert werden, während die andere im Dateisystem gespeichert ist.</span><span class="sxs-lookup"><span data-stu-id="872e2-108">To illustrate the options available to store binary data, one file will be saved in the database while the other is stored in the file system.</span></span>


## <a name="introduction"></a><span data-ttu-id="872e2-109">Einführung</span><span class="sxs-lookup"><span data-stu-id="872e2-109">Introduction</span></span>

<span data-ttu-id="872e2-110">In den vorherigen zwei Lernprogrammen untersucht wir Techniken zum Speichern von Binärdaten, die Datenmodell für die Anwendung s erläutert, wie das FileUpload-Steuerelement zum Senden von Dateien vom Client an den Webserver und wurde erläutert, wie diese binären Daten in einer W vorhanden verwenden zugeordnet ist "EB"-Steuerelement.</span><span class="sxs-lookup"><span data-stu-id="872e2-110">In the previous two tutorials we explored techniques for storing binary data that is associated with the application s data model, looked at how to use the FileUpload control to send files from the client to the web server, and saw how to present this binary data in a data Web control.</span></span> <span data-ttu-id="872e2-111">Wir haben noch zu erörtern, wie das Datenmodell jedoch hochgeladene Daten zugeordnet.</span><span class="sxs-lookup"><span data-stu-id="872e2-111">We ve yet to talk about how to associate uploaded data with the data model, though.</span></span>

<span data-ttu-id="872e2-112">In dieses Lernprogramms erstellen wir eine Webseite, um eine neue Kategorie hinzuzufügen.</span><span class="sxs-lookup"><span data-stu-id="872e2-112">In this tutorial we will create a web page to add a new category.</span></span> <span data-ttu-id="872e2-113">Auf dieser Seite müssen zusätzlich zu den Textfelder für die s-Kategorienamen und eine Beschreibung ein zwei FileUpload-Steuerelemente für die neue Kategorie s Grafik und eine für die Broschüren enthalten.</span><span class="sxs-lookup"><span data-stu-id="872e2-113">In addition to TextBoxes for the category s name and description, this page will need to include two FileUpload controls one for the new category s picture and one for the brochure.</span></span> <span data-ttu-id="872e2-114">Das hochgeladene Bild direkt in den neuen Eintrag s gespeichert `Picture` Spalte während der Broschüren gespeichert werden die `~/Brochures` Ordner mit dem Pfad der Datei, die im neuen Datensatz s gespeichert `BrochurePath` Spalte.</span><span class="sxs-lookup"><span data-stu-id="872e2-114">The uploaded picture will be stored directly in the new record s `Picture` column, whereas the brochure will be saved to the `~/Brochures` folder with the path to the file saved in the new record s `BrochurePath` column.</span></span>

<span data-ttu-id="872e2-115">Vor dem Erstellen dieser neuen Webseite, müssen wir die Architektur zu aktualisieren.</span><span class="sxs-lookup"><span data-stu-id="872e2-115">Before creating this new web page, we'll need to update the architecture.</span></span> <span data-ttu-id="872e2-116">Die `CategoriesTableAdapter` Hauptabfrage s ist, kann nicht abgerufen werden. die `Picture` Spalte.</span><span class="sxs-lookup"><span data-stu-id="872e2-116">The `CategoriesTableAdapter` s main query does not retrieve the `Picture` column.</span></span> <span data-ttu-id="872e2-117">Folglich automatisch generierte `Insert` Methode ist nur für Eingaben die `CategoryName`, `Description`, und `BrochurePath` Felder.</span><span class="sxs-lookup"><span data-stu-id="872e2-117">Consequently, the auto-generated `Insert` method only has inputs for the `CategoryName`, `Description`, and `BrochurePath` fields.</span></span> <span data-ttu-id="872e2-118">Daher müssen wir eine zusätzliche Anmeldemethode im TableAdapter erstellen, die für alle vier fordert `Categories` Felder.</span><span class="sxs-lookup"><span data-stu-id="872e2-118">Therefore, we need to create an additional method in the TableAdapter that prompts for all four `Categories` fields.</span></span> <span data-ttu-id="872e2-119">Die `CategoriesBLL` Klasse in der Business Logic Layer wird ebenfalls aktualisiert werden müssen.</span><span class="sxs-lookup"><span data-stu-id="872e2-119">The `CategoriesBLL` class in the Business Logic Layer will also need to be updated.</span></span>

## <a name="step-1-adding-aninsertwithpicturemethod-to-thecategoriestableadapter"></a><span data-ttu-id="872e2-120">Schritt 1: Hinzufügen einer`InsertWithPicture`Methode, um die`CategoriesTableAdapter`</span><span class="sxs-lookup"><span data-stu-id="872e2-120">Step 1: Adding an`InsertWithPicture`Method to the`CategoriesTableAdapter`</span></span>

<span data-ttu-id="872e2-121">Wir der Erstellung der `CategoriesTableAdapter` zurück in die [erstellen eine Datenzugriffsschicht](../introduction/creating-a-data-access-layer-cs.md) Lernprogramm wir konfiguriert er zum automatischen Generieren von `INSERT`, `UPDATE`, und `DELETE` Anweisungen anhand der Hauptabfrage.</span><span class="sxs-lookup"><span data-stu-id="872e2-121">When we created the `CategoriesTableAdapter` back in the [Creating a Data Access Layer](../introduction/creating-a-data-access-layer-cs.md) tutorial, we configured it to automatically generate `INSERT`, `UPDATE`, and `DELETE` statements based on the main query.</span></span> <span data-ttu-id="872e2-122">Darüber hinaus wir der TableAdapter den direkten DB Ansatz einsetzen, die die Methoden erstellt angewiesen `Insert`, `Update`, und `Delete`.</span><span class="sxs-lookup"><span data-stu-id="872e2-122">Moreover, we instructed the TableAdapter to employ the DB Direct approach, which created the methods `Insert`, `Update`, and `Delete`.</span></span> <span data-ttu-id="872e2-123">Führen Sie diese Methoden automatisch generierte `INSERT`, `UPDATE`, und `DELETE` Anweisungen und folglich annehmen von Eingabeparametern, die basierend auf den Spalten, die von der Hauptabfrage zurückgegeben.</span><span class="sxs-lookup"><span data-stu-id="872e2-123">These methods execute the auto-generated `INSERT`, `UPDATE`, and `DELETE` statements and, consequently, accept input parameters based on the columns returned by the main query.</span></span> <span data-ttu-id="872e2-124">In der [Hochladen von Dateien](uploading-files-cs.md) Lernprogramm augmentiert, wir dass die `CategoriesTableAdapter` s hauptspeicherpool für Abfragen verwenden die `BrochurePath` Spalte.</span><span class="sxs-lookup"><span data-stu-id="872e2-124">In the [Uploading Files](uploading-files-cs.md) tutorial we augmented the `CategoriesTableAdapter` s main query to use the `BrochurePath` column.</span></span>

<span data-ttu-id="872e2-125">Da die `CategoriesTableAdapter` s Hauptabfrage verweist nicht auf die `Picture` Spalte, wir können weder fügen Sie einen neuen Datensatz hinzu noch aktualisieren ein vorhandenes Datensatzes mit einem Wert für die `Picture` Spalte.</span><span class="sxs-lookup"><span data-stu-id="872e2-125">Since the `CategoriesTableAdapter` s main query does not reference the `Picture` column, we can neither add a new record nor update an existing record with a value for the `Picture` column.</span></span> <span data-ttu-id="872e2-126">Um diese Informationen aufzuzeichnen, können wir entweder eine neue Methode erstellen, in dem TableAdapter, die speziell für das Einfügen eines Datensatzes mit Binärdaten verwendet wird, oder wir können anpassen, die automatisch generierte `INSERT` Anweisung.</span><span class="sxs-lookup"><span data-stu-id="872e2-126">In order to capture this information, we can either create a new method in the TableAdapter that is used specifically to insert a record with binary data or we can customize the auto-generated `INSERT` statement.</span></span> <span data-ttu-id="872e2-127">Das Problem bei der Anpassung der automatisch generierte `INSERT` -Anweisung ist, dass es besteht das Risiko, dass unsere Anpassungen, die vom Assistenten überschrieben.</span><span class="sxs-lookup"><span data-stu-id="872e2-127">The problem with customizing the auto-generated `INSERT` statement is that we risk having our customizations overwritten by the wizard.</span></span> <span data-ttu-id="872e2-128">Angenommen, wir angepasst der `INSERT` Anweisung, um die Verwendung von umfassen die `Picture` Spalte.</span><span class="sxs-lookup"><span data-stu-id="872e2-128">For example, imagine that we customized the `INSERT` statement to include use of the `Picture` column.</span></span> <span data-ttu-id="872e2-129">Dadurch würde die TableAdapter aktualisiert `Insert` Methode, um einen zusätzlichen Eingabeparameter für die Kategorie s Bild s Binärdaten enthalten.</span><span class="sxs-lookup"><span data-stu-id="872e2-129">This would update the TableAdapter s `Insert` method to include an additional input parameter for the category s picture s binary data.</span></span> <span data-ttu-id="872e2-130">Wir konnten dann erstellen Sie eine Methode in der Business Logic Layer verwenden Sie diese DAL-Methode und das Aufrufen dieser Methode BLL über die Präsentationsebene, und alles wunderbar funktionieren würde.</span><span class="sxs-lookup"><span data-stu-id="872e2-130">We could then create a method in the Business Logic Layer to use this DAL method and invoke this BLL method through the Presentation Layer, and everything would work wonderfully.</span></span> <span data-ttu-id="872e2-131">D. h. erst beim nächsten Mal wir TableAdapter über den TableAdapter-Konfigurations-Assistenten konfiguriert.</span><span class="sxs-lookup"><span data-stu-id="872e2-131">That is, until the next time we configured the TableAdapter through the TableAdapter Configuration wizard.</span></span> <span data-ttu-id="872e2-132">Sobald der Assistent abgeschlossen, unsere Änderungen an der `INSERT` Anweisung überschrieben, die `Insert` Methode würde wieder her, um die alte Form, und getesteten Codes würde nicht mehr kompiliert!</span><span class="sxs-lookup"><span data-stu-id="872e2-132">As soon as the wizard completed, our customizations to the `INSERT` statement would be overwritten, the `Insert` method would revert to its old form, and our code would no longer compile!</span></span>

> [!NOTE]
> <span data-ttu-id="872e2-133">Diese aufwendig ist ein nicht-Problem bei der Verwendung von gespeicherten Prozeduren anstelle von Ad-hoc-SQL-Anweisungen.</span><span class="sxs-lookup"><span data-stu-id="872e2-133">This annoyance is a non-issue when using stored procedures instead of ad-hoc SQL statements.</span></span> <span data-ttu-id="872e2-134">Eine zukünftige Lernprogramm wird mithilfe von gespeicherten Prozeduren anstelle von Ad-hoc-SQL-Anweisungen in der Datenzugriffsebene untersuchen.</span><span class="sxs-lookup"><span data-stu-id="872e2-134">A future tutorial will explore using stored procedures in lieu of ad-hoc SQL statements in the Data Access Layer.</span></span>


<span data-ttu-id="872e2-135">Um dieses zu vermeiden kann anfallenden, anstatt die automatisch generierten SQL-Anweisungen anpassen s stattdessen eine neue Methode für den TableAdapter erstellen.</span><span class="sxs-lookup"><span data-stu-id="872e2-135">To avoid this potential headache, rather than customizing the auto-generated SQL statements let s instead create a new method for the TableAdapter.</span></span> <span data-ttu-id="872e2-136">Diese Methode mit der Bezeichnung `InsertWithPicture`, akzeptiert die Werte für die `CategoryName`, `Description`, `BrochurePath`, und `Picture` Spalten und führen Sie eine `INSERT` -Anweisung, die alle vier Werte in einen neuen Datensatz gespeichert.</span><span class="sxs-lookup"><span data-stu-id="872e2-136">This method, named `InsertWithPicture`, will accept values for the `CategoryName`, `Description`, `BrochurePath`, and `Picture` columns and execute an `INSERT` statement that stores all four values in a new record.</span></span>

<span data-ttu-id="872e2-137">Öffnen Sie das typisierte DataSet, und klicken Sie im Designer mit der Maustaste auf die `CategoriesTableAdapter` s-Header, und wählen Sie im Kontextmenü der Abfrage hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="872e2-137">Open the Typed DataSet and, from the Designer, right-click on the `CategoriesTableAdapter` s header and choose Add Query from the context menu.</span></span> <span data-ttu-id="872e2-138">Dadurch wird der TableAdapter-Abfrage Assistenten aus, der zuerst uns gefragt, wie die TableAdapter-Abfrage für die Datenbank zugreifen, sollte gestartet.</span><span class="sxs-lookup"><span data-stu-id="872e2-138">This launches the TableAdapter Query Configuration Wizard, which begins by asking us how the TableAdapter query should access the database.</span></span> <span data-ttu-id="872e2-139">Wählen Sie SQL-Anweisungen, und klicken Sie auf Weiter.</span><span class="sxs-lookup"><span data-stu-id="872e2-139">Choose Use SQL statements and click Next.</span></span> <span data-ttu-id="872e2-140">Als Nächstes fordert für den Typ der Abfrage generiert werden soll.</span><span class="sxs-lookup"><span data-stu-id="872e2-140">The next step prompts for the type of query to be generated.</span></span> <span data-ttu-id="872e2-141">Da wir re erstellen eine Abfrage aus, um einen neuen Datensatz zum Hinzufügen der `Categories` Tabelle, wählen Sie einfügen, und klicken Sie auf Weiter.</span><span class="sxs-lookup"><span data-stu-id="872e2-141">Since we re creating a query to add a new record to the `Categories` table, choose INSERT and click Next.</span></span>


<span data-ttu-id="872e2-142">[![Wählen Sie die INSERT-Option](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image1.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="872e2-142">[![Select the INSERT Option](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image1.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image1.png)</span></span>

<span data-ttu-id="872e2-143">**Abbildung 1**: Wählen Sie die Option Einfügen ([klicken Sie hier, um das Bild in voller Größe angezeigt](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="872e2-143">**Figure 1**: Select the INSERT Option ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image2.png))</span></span>


<span data-ttu-id="872e2-144">Jetzt müssen wir geben die `INSERT` SQL-Anweisung.</span><span class="sxs-lookup"><span data-stu-id="872e2-144">We now need to specify the `INSERT` SQL statement.</span></span> <span data-ttu-id="872e2-145">Der Assistent automatisch schlägt vor, Ihnen eine `INSERT` Anweisung, die Hauptabfrage des TableAdapter s entspricht.</span><span class="sxs-lookup"><span data-stu-id="872e2-145">The wizard automatically suggests an `INSERT` statement corresponding to the TableAdapter s main query.</span></span> <span data-ttu-id="872e2-146">In diesem Fall es s ein `INSERT` -Anweisung, die fügt die `CategoryName`, `Description`, und `BrochurePath` Werte.</span><span class="sxs-lookup"><span data-stu-id="872e2-146">In this case, it s an `INSERT` statement that inserts the `CategoryName`, `Description`, and `BrochurePath` values.</span></span> <span data-ttu-id="872e2-147">Aktualisieren Sie die Anweisung, damit die `Picture` Spalte dient zusammen mit einem `@Picture` -Parameter wie folgt:</span><span class="sxs-lookup"><span data-stu-id="872e2-147">Update the statement so that the `Picture` column is included along with a `@Picture` parameter, like so:</span></span>


[!code-sql[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample1.sql)]

<span data-ttu-id="872e2-148">Im letzten Bildschirm des Assistenten werden Sie gefragt, benennen Sie die neue Methode des TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="872e2-148">The final screen of the wizard asks us to name the new TableAdapter method.</span></span> <span data-ttu-id="872e2-149">Geben Sie `InsertWithPicture` , und klicken Sie auf ' Fertig stellen '.</span><span class="sxs-lookup"><span data-stu-id="872e2-149">Enter `InsertWithPicture` and click Finish.</span></span>


<span data-ttu-id="872e2-150">[![Name der neuen Methode des TableAdapter InsertWithPicture](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image2.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="872e2-150">[![Name the New TableAdapter Method InsertWithPicture](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image2.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image3.png)</span></span>

<span data-ttu-id="872e2-151">**Abbildung 2**: Benennen Sie die neue Methode des TableAdapter `InsertWithPicture` ([klicken Sie hier, um das Bild in voller Größe angezeigt](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="872e2-151">**Figure 2**: Name the New TableAdapter Method `InsertWithPicture` ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image4.png))</span></span>


## <a name="step-2-updating-the-business-logic-layer"></a><span data-ttu-id="872e2-152">Schritt 2: Aktualisieren der Geschäftslogikebene</span><span class="sxs-lookup"><span data-stu-id="872e2-152">Step 2: Updating the Business Logic Layer</span></span>

<span data-ttu-id="872e2-153">Da die Darstellungsschicht sollte nur eine Verbindung mit der Business Logic Layer, anstatt umgehen sie fahren Sie direkt mit der Datenzugriffsebene, wir eine Methode BLL erstellen müssen, die die DAL-Methode aufruft, soeben erstellt wurde (`InsertWithPicture`).</span><span class="sxs-lookup"><span data-stu-id="872e2-153">Since the Presentation Layer should only interface with the Business Logic Layer rather than bypassing it to go directly to the Data Access Layer, we need to create a BLL method that invokes the DAL method we just created (`InsertWithPicture`).</span></span> <span data-ttu-id="872e2-154">In diesem Lernprogramm erstellen Sie eine Methode in der `CategoriesBLL` Klasse mit dem Namen `InsertWithPicture` , akzeptiert als Eingabe drei `string` s und einer `byte` Array.</span><span class="sxs-lookup"><span data-stu-id="872e2-154">For this tutorial, create a method in the `CategoriesBLL` class named `InsertWithPicture` that accepts as input three `string` s and a `byte` array.</span></span> <span data-ttu-id="872e2-155">Die `string` Eingabeparameter sind für den Kategorienamen s, Beschreibung und Broschüren Dateipfad, während die `byte` Array ist, für den binären Inhalt des Bilds Kategorie s.</span><span class="sxs-lookup"><span data-stu-id="872e2-155">The `string` input parameters are for the category s name, description, and brochure file path, while the `byte` array is for the binary contents of the category s picture.</span></span> <span data-ttu-id="872e2-156">Wie der folgende Code zeigt, ruft diese Methode auf BLL entsprechende DAL-Methode:</span><span class="sxs-lookup"><span data-stu-id="872e2-156">As the following code shows, this BLL method invokes the corresponding DAL method:</span></span>


[!code-csharp[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample2.cs)]

> [!NOTE]
> <span data-ttu-id="872e2-157">Stellen Sie sicher, dass Sie vor dem Hinzufügen der typisierte DataSet gespeichert haben die `InsertWithPicture` Methode, um die BLL.</span><span class="sxs-lookup"><span data-stu-id="872e2-157">Make sure that you have saved the Typed DataSet before adding the `InsertWithPicture` method to the BLL.</span></span> <span data-ttu-id="872e2-158">Da die `CategoriesTableAdapter` Klassencode basierend auf dem typisierten DataSet wird automatisch generiert, wenn Sie Ich möchte das typisierte DataSet zuerst die Änderungen speichern die `Adapter` Eigenschaft, gewonnene t erfahren, ob die `InsertWithPicture` Methode.</span><span class="sxs-lookup"><span data-stu-id="872e2-158">Since the `CategoriesTableAdapter` class code is auto-generated based on the Typed DataSet, if you don t first save your changes to the Typed DataSet the `Adapter` property won t know about the `InsertWithPicture` method.</span></span>


## <a name="step-3-listing-the-existing-categories-and-their-binary-data"></a><span data-ttu-id="872e2-159">Schritt 3: Auflisten von vorhandenen Kategorien hinzufügen und ihre binäre Daten</span><span class="sxs-lookup"><span data-stu-id="872e2-159">Step 3: Listing the Existing Categories and their Binary Data</span></span>

<span data-ttu-id="872e2-160">In diesem Lernprogramm erstellen wir eine Seite, die ein Endbenutzer auf dem System, eine neue Kategorie hinzufügen kann. Geben Sie ein Bild und Broschüren für die neue Kategorie.</span><span class="sxs-lookup"><span data-stu-id="872e2-160">In this tutorial we will create a page that allows an end user to add a new category to the system, providing a picture and brochure for the new category.</span></span> <span data-ttu-id="872e2-161">In der [vorherigen Lernprogramm](displaying-binary-data-in-the-data-web-controls-cs.md) wir eine GridView mit einem TemplateField und ImageField verwendet, und jede s Kategoriename angezeigt, Beschreibung, Bild und einen Link zu seiner Broschüren herunterladen.</span><span class="sxs-lookup"><span data-stu-id="872e2-161">In the [preceding tutorial](displaying-binary-data-in-the-data-web-controls-cs.md) we used a GridView with a TemplateField and ImageField to display each category s name, description, picture, and a link to download its brochure.</span></span> <span data-ttu-id="872e2-162">Lassen Sie s replizieren diese Funktion in diesem Lernprogramm erstellen eine Seite, die sowohl alle vorhandene Kategorien Listet und ermöglicht eine neue erstellt werden soll.</span><span class="sxs-lookup"><span data-stu-id="872e2-162">Let s replicate that functionality for this tutorial, creating a page that both lists all existing categories and allows for new ones to be created.</span></span>

<span data-ttu-id="872e2-163">Öffnen Sie zunächst die `DisplayOrDownload.aspx` Seite aus der `BinaryData` Ordner.</span><span class="sxs-lookup"><span data-stu-id="872e2-163">Start by opening the `DisplayOrDownload.aspx` page from the `BinaryData` folder.</span></span> <span data-ttu-id="872e2-164">Wechseln Sie zur Quellansicht und die GridView und ObjectDataSource s deklarative Syntax kopieren, Einfügen in die `<asp:Content>` Element im `UploadInDetailsView.aspx`.</span><span class="sxs-lookup"><span data-stu-id="872e2-164">Go to the Source view and copy the GridView and ObjectDataSource s declarative syntax, pasting it within the `<asp:Content>` element in `UploadInDetailsView.aspx`.</span></span> <span data-ttu-id="872e2-165">Darüber hinaus nicht vergessen, über kopiert der `GenerateBrochureLink` Methode aus der CodeBehind-Klasse der `DisplayOrDownload.aspx` zu `UploadInDetailsView.aspx`.</span><span class="sxs-lookup"><span data-stu-id="872e2-165">Also, don t forget to copy over the `GenerateBrochureLink` method from the code-behind class of `DisplayOrDownload.aspx` to `UploadInDetailsView.aspx`.</span></span>


<span data-ttu-id="872e2-166">[![Kopieren Sie die deklarative Syntax von DisplayOrDownload.aspx zum UploadInDetailsView.aspx](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image3.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="872e2-166">[![Copy and Paste the Declarative Syntax from DisplayOrDownload.aspx to UploadInDetailsView.aspx](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image3.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image5.png)</span></span>

<span data-ttu-id="872e2-167">**Abbildung 3**: Kopieren Sie die Deklarationssyntax von `DisplayOrDownload.aspx` auf `UploadInDetailsView.aspx` ([klicken Sie hier, um das Bild in voller Größe angezeigt](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="872e2-167">**Figure 3**: Copy and Paste the Declarative Syntax from `DisplayOrDownload.aspx` to `UploadInDetailsView.aspx` ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image6.png))</span></span>


<span data-ttu-id="872e2-168">Nach dem Kopieren der deklarativen Syntax und `GenerateBrochureLink` aufzurufende Methode über die `UploadInDetailsView.aspx` Seite, zeigen Sie die Seite über einen Browser, um sicherzustellen, dass alles ordnungsgemäß kopiert wurde.</span><span class="sxs-lookup"><span data-stu-id="872e2-168">After copying the declarative syntax and `GenerateBrochureLink` method over to the `UploadInDetailsView.aspx` page, view the page through a browser to ensure that everything was copied over correctly.</span></span> <span data-ttu-id="872e2-169">Eine GridView, die acht Kategorien auflisten, die einen Link zum Herunterladen der Broschüren als auch die Kategorie s Bild enthält, sollte angezeigt werden.</span><span class="sxs-lookup"><span data-stu-id="872e2-169">You should see a GridView listing the eight categories that includes a link to download the brochure as well as the category s picture.</span></span>


<span data-ttu-id="872e2-170">[![Jede Kategorie zusammen mit seiner Binärdaten sollte jetzt angezeigt.](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image4.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="872e2-170">[![You Should Now See Each Category Along with Its Binary Data](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image4.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image7.png)</span></span>

<span data-ttu-id="872e2-171">**Abbildung 4**: Sie sollten jetzt finden Sie unter jeder Kategorie zusammen mit einem Binärdaten ([klicken Sie hier, um das Bild in voller Größe angezeigt](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="872e2-171">**Figure 4**: You Should Now See Each Category Along with Its Binary Data ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image8.png))</span></span>


## <a name="step-4-configuring-thecategoriesdatasourceto-support-inserting"></a><span data-ttu-id="872e2-172">Schritt 4: Konfigurieren der`CategoriesDataSource`mit dem Support einfügen</span><span class="sxs-lookup"><span data-stu-id="872e2-172">Step 4: Configuring the`CategoriesDataSource`to Support Inserting</span></span>

<span data-ttu-id="872e2-173">Die `CategoriesDataSource` ObjectDataSource verwendet werden, indem die `Categories` GridView bieten derzeit nicht die Möglichkeit zum Einfügen von Daten.</span><span class="sxs-lookup"><span data-stu-id="872e2-173">The `CategoriesDataSource` ObjectDataSource used by the `Categories` GridView currently does not provide the ability to insert data.</span></span> <span data-ttu-id="872e2-174">Um über dieses Datenquellen-Steuerelement einfügen zu unterstützen, müssen wir ordnen Sie seine `Insert` Methode, um eine Methode in der zugrunde liegenden Objekts `CategoriesBLL`.</span><span class="sxs-lookup"><span data-stu-id="872e2-174">In order to support inserting through this data source control, we need to map its `Insert` method to a method in its underlying object, `CategoriesBLL`.</span></span> <span data-ttu-id="872e2-175">Insbesondere soll für die Zuordnung der `CategoriesBLL` Methode, die wir, wieder in Schritt2 hinzugefügt `InsertWithPicture`.</span><span class="sxs-lookup"><span data-stu-id="872e2-175">In particular, we want to map it to the `CategoriesBLL` method we added back in Step 2, `InsertWithPicture`.</span></span>

<span data-ttu-id="872e2-176">Starten Sie, indem Sie auf den Link Konfigurieren von Datenquellen über das ObjectDataSource-s-Smarttag.</span><span class="sxs-lookup"><span data-stu-id="872e2-176">Start by clicking the Configure Data Source link from the ObjectDataSource s smart tag.</span></span> <span data-ttu-id="872e2-177">Der erste Bildschirm zeigt das Objekt, das die Datenquelle so konfiguriert ist, dass arbeiten `CategoriesBLL`.</span><span class="sxs-lookup"><span data-stu-id="872e2-177">The first screen shows the object the data source is configured to work with, `CategoriesBLL`.</span></span> <span data-ttu-id="872e2-178">Lassen Sie diese Einstellung als-ist, und klicken Sie neben der Verschiebung der Anwendungszeit auf dem Bildschirm Datenmethoden definieren.</span><span class="sxs-lookup"><span data-stu-id="872e2-178">Leave this setting as-is and click Next to advance to the Define Data Methods screen.</span></span> <span data-ttu-id="872e2-179">Wechseln Sie zur Registerkarte "Einfügen", und wählen Sie die `InsertWithPicture` Methode aus der Dropdown-Liste.</span><span class="sxs-lookup"><span data-stu-id="872e2-179">Move to the INSERT tab and pick the `InsertWithPicture` method from the drop-down list.</span></span> <span data-ttu-id="872e2-180">Klicken Sie auf ' Fertig stellen ', um den Assistenten abzuschließen.</span><span class="sxs-lookup"><span data-stu-id="872e2-180">Click Finish to complete the wizard.</span></span>


<span data-ttu-id="872e2-181">[![Konfigurieren der ObjectDataSource zur Verwendung der InsertWithPicture-Methode](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image5.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="872e2-181">[![Configure the ObjectDataSource to use the InsertWithPicture Method](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image5.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image9.png)</span></span>

<span data-ttu-id="872e2-182">**Abbildung 5**: Konfigurieren der ObjectDataSource verwenden die `InsertWithPicture` Methode ([klicken Sie hier, um das Bild in voller Größe angezeigt](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="872e2-182">**Figure 5**: Configure the ObjectDataSource to use the `InsertWithPicture` Method ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image10.png))</span></span>


> [!NOTE]
> <span data-ttu-id="872e2-183">Nach Abschluss des Assistenten, kann Visual Studio bitten Sie Sie nach Bedarf aktualisieren von Feldern und Schlüssel, die die Daten Web neu generieren, wird Felder steuert.</span><span class="sxs-lookup"><span data-stu-id="872e2-183">Upon completing the wizard, Visual Studio may ask if you want to Refresh Fields and Keys, which will regenerate the data Web controls fields.</span></span> <span data-ttu-id="872e2-184">Wählen Sie Nein, da Ja Feld Anpassungen überschrieben werden, die Sie vorgenommen haben, können.</span><span class="sxs-lookup"><span data-stu-id="872e2-184">Choose No, because choosing Yes will overwrite any field customizations you may have made.</span></span>


<span data-ttu-id="872e2-185">Das ObjectDataSource wird nach Abschluss des Assistenten enthalten nun einen Wert für die `InsertMethod` Eigenschaft sowie `InsertParameters` veranschaulicht, die folgenden deklarativem Markup für die Kategorie der vier Spalten:</span><span class="sxs-lookup"><span data-stu-id="872e2-185">After completing the wizard, the ObjectDataSource will now include a value for its `InsertMethod` property as well as `InsertParameters` for the four category columns, as the following declarative markup illustrates:</span></span>


[!code-aspx[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample3.aspx)]

## <a name="step-5-creating-the-inserting-interface"></a><span data-ttu-id="872e2-186">Schritt 5: Erstellen der einfügen-Schnittstelle</span><span class="sxs-lookup"><span data-stu-id="872e2-186">Step 5: Creating the Inserting Interface</span></span>

<span data-ttu-id="872e2-187">Erster in behandelt die [eine Übersicht der einfügen, aktualisieren und Löschen von Daten](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md), DetailsView-Steuerelement bietet eine integrierte einfügende-Schnittstelle, die verwendet werden kann, bei der Arbeit mit einem Datenquellen-Steuerelement, das Einfügevorgänge unterstützt.</span><span class="sxs-lookup"><span data-stu-id="872e2-187">As first covered in the [An Overview of Inserting, Updating, and Deleting Data](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md), the DetailsView control provides a built-in inserting interface that can be utilized when working with a data source control that supports inserting.</span></span> <span data-ttu-id="872e2-188">Lassen Sie s, DetailsView-Steuerelement zu dieser Seite oben GridView, die dauerhaft die einfügende Schnittstelle gerendert werden dadurch kann einen Benutzer schnell hinzufügen wie eine neue Kategorie hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="872e2-188">Let s add a DetailsView control to this page above the GridView that will permanently render its inserting interface, allowing a user to quickly add a new category.</span></span> <span data-ttu-id="872e2-189">Beim Hinzufügen einer neuen Kategorie in der DetailsView, GridView unter ihm wird automatisch aktualisiert wird und die neue Kategorie angezeigt.</span><span class="sxs-lookup"><span data-stu-id="872e2-189">Upon adding a new category in the DetailsView, the GridView beneath it will automatically refresh and display the new category.</span></span>

<span data-ttu-id="872e2-190">Start durch Ziehen einer DetailsView aus der Toolbox auf den Designer über die GridView Festlegen seiner `ID` Eigenschaft `NewCategory` und gelöscht wird, die `Height` und `Width` Eigenschaftswerte.</span><span class="sxs-lookup"><span data-stu-id="872e2-190">Start by dragging a DetailsView from the Toolbox onto the Designer above the GridView, setting its `ID` property to `NewCategory` and clearing out the `Height` and `Width` property values.</span></span> <span data-ttu-id="872e2-191">Binden Sie es aus dem DetailsView s smart Tag zur vorhandenen `CategoriesDataSource` und aktivieren Sie das Kontrollkästchen einfügen aktivieren.</span><span class="sxs-lookup"><span data-stu-id="872e2-191">From the DetailsView s smart tag, bind it to the existing `CategoriesDataSource` and then check the Enable Inserting checkbox.</span></span>


<span data-ttu-id="872e2-192">[![Binden von DetailsView an die CategoriesDataSource und Einfügen aktivieren](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image6.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="872e2-192">[![Bind the DetailsView to the CategoriesDataSource and Enable Inserting](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image6.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image11.png)</span></span>

<span data-ttu-id="872e2-193">**Abbildung 6**: binden, DetailsView der `CategoriesDataSource` und Einfügen aktivieren ([klicken Sie hier, um das Bild in voller Größe angezeigt](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="872e2-193">**Figure 6**: Bind the DetailsView to the `CategoriesDataSource` and Enable Inserting ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image12.png))</span></span>


<span data-ttu-id="872e2-194">Um DetailsView in die einfügende Schnittstelle dauerhaft zu rendern, legen dessen `DefaultMode` Eigenschaft `Insert`.</span><span class="sxs-lookup"><span data-stu-id="872e2-194">To permanently render the DetailsView in its inserting interface, set its `DefaultMode` property to `Insert`.</span></span>

<span data-ttu-id="872e2-195">Beachten Sie, DetailsView fünf BoundFields hat `CategoryID`, `CategoryName`, `Description`, `NumberOfProducts`, und `BrochurePath` zwar die `CategoryID` BoundField wird in der einfügen-Schnittstelle nicht gerendert, da seine `InsertVisible` -Eigenschaftensatz auf `false`.</span><span class="sxs-lookup"><span data-stu-id="872e2-195">Note that the DetailsView has five BoundFields `CategoryID`, `CategoryName`, `Description`, `NumberOfProducts`, and `BrochurePath` although the `CategoryID` BoundField is not rendered in the inserting interface because its `InsertVisible` property is set to `false`.</span></span> <span data-ttu-id="872e2-196">Diese BoundFields vorhanden ist, da sie die zurückgegebene Spalten sind die `GetCategories()` Methode, die ist, was das ObjectDataSource aufruft, um die Daten abzurufen.</span><span class="sxs-lookup"><span data-stu-id="872e2-196">These BoundFields exists because they are the columns returned by the `GetCategories()` method, which is what the ObjectDataSource invokes to retrieve its data.</span></span> <span data-ttu-id="872e2-197">Zum Einfügen, aber wir Verschlüsselungskennwort t möchten, können den Benutzer aus, geben Sie einen Wert für `NumberOfProducts`.</span><span class="sxs-lookup"><span data-stu-id="872e2-197">For inserting, however, we don t want to let the user specify a value for `NumberOfProducts`.</span></span> <span data-ttu-id="872e2-198">Darüber hinaus muss ihnen das Hochladen eines Bilds für die neue Kategorie sowie zum Hochladen von PDF-Datei für die Broschüren gewähren.</span><span class="sxs-lookup"><span data-stu-id="872e2-198">Moreover, we need to allow them to upload a picture for the new category as well as upload a PDF for the brochure.</span></span>

<span data-ttu-id="872e2-199">Entfernen der `NumberOfProducts` BoundField aus der, DetailsView vollständig und aktualisieren Sie dann die `HeaderText` Eigenschaften der `CategoryName` und `BrochurePath` BoundFields, Kategorie und Broschüren, bzw.</span><span class="sxs-lookup"><span data-stu-id="872e2-199">Remove the `NumberOfProducts` BoundField from the DetailsView altogether and then update the `HeaderText` properties of the `CategoryName` and `BrochurePath` BoundFields to Category and Brochure, respectively.</span></span> <span data-ttu-id="872e2-200">Konvertieren Sie als Nächstes die `BrochurePath` BoundField in ein TemplateField und Hinzufügen einer neuen TemplateField für das Bild dieses neue TemplateField ein `HeaderText` Wert des Bilds.</span><span class="sxs-lookup"><span data-stu-id="872e2-200">Next, convert the `BrochurePath` BoundField into a TemplateField and add a new TemplateField for the picture, giving this new TemplateField a `HeaderText` value of Picture.</span></span> <span data-ttu-id="872e2-201">Verschieben der `Picture` TemplateField, sodass diese zwischen ist die `BrochurePath` TemplateField und CommandField.</span><span class="sxs-lookup"><span data-stu-id="872e2-201">Move the `Picture` TemplateField so that it is between the `BrochurePath` TemplateField and CommandField.</span></span>


![Binden von DetailsView an die CategoriesDataSource und Einfügen aktivieren](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image7.gif)

<span data-ttu-id="872e2-203">**Abbildung 7**: binden, DetailsView der `CategoriesDataSource` und Einfügen aktivieren</span><span class="sxs-lookup"><span data-stu-id="872e2-203">**Figure 7**: Bind the DetailsView to the `CategoriesDataSource` and Enable Inserting</span></span>


<span data-ttu-id="872e2-204">Wenn Sie konvertiert die `BrochurePath` BoundField in ein TemplateField mithilfe des Dialogfelds Felder bearbeiten, um die TemplateField enthält ein `ItemTemplate`, `EditItemTemplate`, und `InsertItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="872e2-204">If you converted the `BrochurePath` BoundField into a TemplateField through the Edit Fields dialog box, the TemplateField includes an `ItemTemplate`, `EditItemTemplate`, and `InsertItemTemplate`.</span></span> <span data-ttu-id="872e2-205">Nur die `InsertItemTemplate` ist erforderlich, jedoch so wünschen, entfernen Sie die anderen beiden Vorlagen.</span><span class="sxs-lookup"><span data-stu-id="872e2-205">Only the `InsertItemTemplate` is needed, however, so feel free to remove the other two templates.</span></span> <span data-ttu-id="872e2-206">An diesem Punkt sollte die DetailsView s deklarative Syntax wie folgt aussehen:</span><span class="sxs-lookup"><span data-stu-id="872e2-206">At this point your DetailsView s declarative syntax should look like the following:</span></span>


[!code-aspx[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample4.aspx)]

## <a name="adding-fileupload-controls-for-the-brochure-and-picture-fields"></a><span data-ttu-id="872e2-207">Hinzufügen von FileUpload-Steuerelementen für die Broschüren und Bildfelder</span><span class="sxs-lookup"><span data-stu-id="872e2-207">Adding FileUpload Controls for the Brochure and Picture Fields</span></span>

<span data-ttu-id="872e2-208">Gegenwärtig die `BrochurePath` TemplateField s `InsertItemTemplate` enthält ein Textfeld, während die `Picture` TemplateField enthält keine Vorlagen.</span><span class="sxs-lookup"><span data-stu-id="872e2-208">Presently, the `BrochurePath` TemplateField s `InsertItemTemplate` contains a TextBox, while the `Picture` TemplateField does not contain any templates.</span></span> <span data-ttu-id="872e2-209">Wir aktualisieren diese zwei TemplateField s müssen `InsertItemTemplate` s FileUpload Steuerelemente verwenden.</span><span class="sxs-lookup"><span data-stu-id="872e2-209">We need to update these two TemplateField s `InsertItemTemplate` s to use FileUpload controls.</span></span>

<span data-ttu-id="872e2-210">Aus den DetailsView s smart Tag, wählen Sie die Vorlagen bearbeiten aus, und wählen Sie dann die `BrochurePath` TemplateField s `InsertItemTemplate` aus der Dropdown-Liste.</span><span class="sxs-lookup"><span data-stu-id="872e2-210">From the DetailsView s smart tag, choose the Edit Templates option and then select the `BrochurePath` TemplateField s `InsertItemTemplate` from the drop-down list.</span></span> <span data-ttu-id="872e2-211">Entfernen Sie das Textfeld ein, und ziehen Sie dann ein FileUpload-Steuerelement aus der Toolbox in die Vorlage.</span><span class="sxs-lookup"><span data-stu-id="872e2-211">Remove the TextBox and then drag a FileUpload control from the Toolbox into the template.</span></span> <span data-ttu-id="872e2-212">Legen Sie das Steuerelement FileUpload s `ID` auf `BrochureUpload`.</span><span class="sxs-lookup"><span data-stu-id="872e2-212">Set the FileUpload control s `ID` to `BrochureUpload`.</span></span> <span data-ttu-id="872e2-213">Auf ähnliche Weise Hinzufügen eines FileUpload-Steuerelements, um die `Picture` TemplateField s `InsertItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="872e2-213">Similarly, add a FileUpload control to the `Picture` TemplateField s `InsertItemTemplate`.</span></span> <span data-ttu-id="872e2-214">Legen Sie dieses Steuerelement FileUpload s `ID` auf `PictureUpload`.</span><span class="sxs-lookup"><span data-stu-id="872e2-214">Set this FileUpload control s `ID` to `PictureUpload`.</span></span>


<span data-ttu-id="872e2-215">[![Hinzufügen eines FileUpload-Steuerelements zu den InsertItemTemplate](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image8.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="872e2-215">[![Add a FileUpload Control to the InsertItemTemplate](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image8.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image13.png)</span></span>

<span data-ttu-id="872e2-216">**Abbildung 8**: Hinzufügen eines Steuerelements FileUpload, um die `InsertItemTemplate` ([klicken Sie hier, um das Bild in voller Größe angezeigt](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image14.png))</span><span class="sxs-lookup"><span data-stu-id="872e2-216">**Figure 8**: Add a FileUpload Control to the `InsertItemTemplate` ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image14.png))</span></span>


<span data-ttu-id="872e2-217">Nach dem Herstellen dieser Ergänzungen, werden zwei TemplateField s deklarative Syntax verwendet:</span><span class="sxs-lookup"><span data-stu-id="872e2-217">After making these additions, the two TemplateField s declarative syntax will be:</span></span>


[!code-aspx[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample5.aspx)]

<span data-ttu-id="872e2-218">Wenn ein Benutzer eine neue Kategorie hinzufügt, möchten wir sicherstellen, dass die Broschüren und Bild von den richtigen Dateityp aufweist.</span><span class="sxs-lookup"><span data-stu-id="872e2-218">When a user adds a new category, we want to ensure that the brochure and picture are of the correct file type.</span></span> <span data-ttu-id="872e2-219">Für die Broschüren muss der Benutzer eine PDF-Datei angeben.</span><span class="sxs-lookup"><span data-stu-id="872e2-219">For the brochure, the user must supply a PDF.</span></span> <span data-ttu-id="872e2-220">Für das Bild, die wir benötigen die Benutzer eine Bilddatei hochladen, aber lassen wir *alle* image nur Image Dateien eines bestimmten Typs, z. B. gif oder JPG-Format vorliegen?</span><span class="sxs-lookup"><span data-stu-id="872e2-220">For the picture, we need the user to upload an image file, but do we allow *any* image file or only image files of a particular type, such as GIFs or JPGs?</span></span> <span data-ttu-id="872e2-221">Um die verschiedenen Dateitypen zu ermöglichen, müssen wir d erweitern die `Categories` Schema, um eine Spalte enthalten, die den Dateityp aufzeichnet, damit dieses Typs über an den Client gesendet werden kann `Response.ContentType` in `DisplayCategoryPicture.aspx`.</span><span class="sxs-lookup"><span data-stu-id="872e2-221">In order to allow for different file types, we d need to extend the `Categories` schema to include a column that captures the file type so that this type can be sent to the client through `Response.ContentType` in `DisplayCategoryPicture.aspx`.</span></span> <span data-ttu-id="872e2-222">Da wir t Verschlüsselungskennwort wird eine solche Spalte haben, wäre es unerlässlich, um Benutzer zu beschränken, auf die Bereitstellung einer bestimmten Bilddateityp.</span><span class="sxs-lookup"><span data-stu-id="872e2-222">Since we don t have such a column, it would be prudent to restrict users to only providing a specific image file type.</span></span> <span data-ttu-id="872e2-223">Die `Categories` Tabelle s vorhandener Bilder sind Bitmaps JPG-Format sind allerdings eine besser geeignete Dateiformat für Bilder, die über das Internet bereitgestellt.</span><span class="sxs-lookup"><span data-stu-id="872e2-223">The `Categories` table s existing images are bitmaps, but JPGs are a more appropriate file format for images served over the web.</span></span>

<span data-ttu-id="872e2-224">Wenn ein Benutzer einen falschen Dateityp hochlädt, müssen wir auf "Abbrechen" die Einfügung und zeigt folgende Meldung angezeigt, die das Problem.</span><span class="sxs-lookup"><span data-stu-id="872e2-224">If a user uploads an incorrect file type, we need to cancel the insert and display a message indicating the problem.</span></span> <span data-ttu-id="872e2-225">Fügen Sie eine Bezeichnung Websteuerelement unterhalb der DetailsView hinzu.</span><span class="sxs-lookup"><span data-stu-id="872e2-225">Add a Label Web control beneath the DetailsView.</span></span> <span data-ttu-id="872e2-226">Festlegen seiner `ID` Eigenschaft, um `UploadWarning`deaktivieren, seine `Text` Eigenschaftensatz, der `CssClass` Eigenschaft in "Warnung", und die `Visible` und `EnableViewState` Eigenschaften `false`.</span><span class="sxs-lookup"><span data-stu-id="872e2-226">Set its `ID` property to `UploadWarning`, clear out its `Text` property, set the `CssClass` property to Warning, and the `Visible` and `EnableViewState` properties to `false`.</span></span> <span data-ttu-id="872e2-227">Die `Warning` CSS-Klasse definiert ist, im `Styles.css` und rendert den Text in eine große, Rot, kursiv, fette Schriftart.</span><span class="sxs-lookup"><span data-stu-id="872e2-227">The `Warning` CSS class is defined in `Styles.css` and renders the text in a large, red, italicized, bold font.</span></span>

> [!NOTE]
> <span data-ttu-id="872e2-228">Im Idealfall der `CategoryName` und `Description` BoundFields konvertiert von TemplateFields und Einfügen von Schnittstellen angepasst.</span><span class="sxs-lookup"><span data-stu-id="872e2-228">Ideally, the `CategoryName` and `Description` BoundFields would be converted to TemplateFields and their inserting interfaces customized.</span></span> <span data-ttu-id="872e2-229">Die `Description` einfügen-Schnittstelle, z. B. würde wahrscheinlich besser geeignet über ein mehrzeiliges Textfeld.</span><span class="sxs-lookup"><span data-stu-id="872e2-229">The `Description` inserting interface, for example, would likely be better suited through a multi-line textbox.</span></span> <span data-ttu-id="872e2-230">Und seit der `CategoryName` Spalte akzeptiert keine `NULL` Werte, ein RequiredFieldValidator hinzugefügt werden sollen, um sicherzustellen, dass der Benutzer stellt einen Wert für den neuen Kategorienamen s bereit.</span><span class="sxs-lookup"><span data-stu-id="872e2-230">And since the `CategoryName` column does not accept `NULL` values, a RequiredFieldValidator should be added to ensure the user provides a value for the new category s name.</span></span> <span data-ttu-id="872e2-231">Diese Schritte sind an dem Leser als Übung übrig.</span><span class="sxs-lookup"><span data-stu-id="872e2-231">These steps are left as an exercise to the reader.</span></span> <span data-ttu-id="872e2-232">Verweisen auf [Anpassen der Benutzeroberfläche für die Änderung der Daten](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-cs.md) für einen umfassenden Einblick, erweitern die Änderung Schnittstellen.</span><span class="sxs-lookup"><span data-stu-id="872e2-232">Refer back to [Customizing the Data Modification Interface](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-cs.md) for an in-depth look at augmenting the data modification interfaces.</span></span>


## <a name="step-6-saving-the-uploaded-brochure-to-the-web-server-s-file-system"></a><span data-ttu-id="872e2-233">Schritt 6: Hochgeladene Broschüren Web Server s im Dateisystem speichern</span><span class="sxs-lookup"><span data-stu-id="872e2-233">Step 6: Saving the Uploaded Brochure to the Web Server s File System</span></span>

<span data-ttu-id="872e2-234">Wenn der Benutzer die Werte für eine neue Kategorie eingegeben und klickt auf die Schaltfläche zum Einfügen, asynchronen Postback und das Einfügen von Workflow erweitert.</span><span class="sxs-lookup"><span data-stu-id="872e2-234">When the user enters the values for a new category and clicks the Insert button, a postback occurs and the inserting workflow unfolds.</span></span> <span data-ttu-id="872e2-235">Erste, DetailsView s [ `ItemInserting` Ereignis](https://msdn.microsoft.com/library/system.web.ui.webcontrols.detailsview.iteminserting.aspx) ausgelöst wird.</span><span class="sxs-lookup"><span data-stu-id="872e2-235">First, the DetailsView s [`ItemInserting` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.detailsview.iteminserting.aspx) fires.</span></span> <span data-ttu-id="872e2-236">Anschließend wird die s ObjectDataSource `Insert()` Methode wird aufgerufen, was dazu führt, in einen neuen Datensatz hinzugefügt wird die `Categories` Tabelle.</span><span class="sxs-lookup"><span data-stu-id="872e2-236">Next, the ObjectDataSource s `Insert()` method is invoked, which results in a new record being added to the `Categories` table.</span></span> <span data-ttu-id="872e2-237">Danach, DetailsView s [ `ItemInserted` Ereignis](https://msdn.microsoft.com/library/system.web.ui.webcontrols.detailsview.iteminserted.aspx) ausgelöst wird.</span><span class="sxs-lookup"><span data-stu-id="872e2-237">After that, the DetailsView s [`ItemInserted` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.detailsview.iteminserted.aspx) fires.</span></span>

<span data-ttu-id="872e2-238">Vor dem ObjectDataSource s `Insert()` Methode aufgerufen wird, müssen Sie zunächst sicherstellen, dass die entsprechenden Dateitypen vom Benutzer hochgeladen wurden und speichern Sie die Broschüren PDF-Datei im Web Server s-Dateisystem.</span><span class="sxs-lookup"><span data-stu-id="872e2-238">Before the ObjectDataSource s `Insert()` method is invoked, we must first ensure that the appropriate file types were uploaded by the user and then save the brochure PDF to the web server s file system.</span></span> <span data-ttu-id="872e2-239">Erstellen Sie einen Ereignishandler für das DetailsView s `ItemInserting` Ereignis und fügen Sie den folgenden Code hinzu:</span><span class="sxs-lookup"><span data-stu-id="872e2-239">Create an event handler for the DetailsView s `ItemInserting` event and add the following code:</span></span>


[!code-csharp[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample6.cs)]

<span data-ttu-id="872e2-240">Der Ereignishandler wird gestartet, durch Verweisen auf die `BrochureUpload` FileUpload-Steuerelement, DetailsView s Vorlagen.</span><span class="sxs-lookup"><span data-stu-id="872e2-240">The event handler starts by referencing the `BrochureUpload` FileUpload control from the DetailsView s templates.</span></span> <span data-ttu-id="872e2-241">Klicken Sie dann wird eine Broschüren hochgeladen wurde, die Erweiterung der hochgeladenen Datei s untersucht.</span><span class="sxs-lookup"><span data-stu-id="872e2-241">Then, if a brochure has been uploaded, the uploaded file s extension is examined.</span></span> <span data-ttu-id="872e2-242">Wenn die Erweiterung nicht ist. PDF-Datei, klicken Sie dann eine Warnung wird angezeigt, die Einfügung wird abgebrochen und beendet die Ausführung des ereignishandlers.</span><span class="sxs-lookup"><span data-stu-id="872e2-242">If the extension is not .PDF, then a warning is displayed, the insert is cancelled, and the execution of the event handler ends.</span></span>

> [!NOTE]
> <span data-ttu-id="872e2-243">Vertrauensstellungen der vertrauenden Seite auf der hochgeladenen Datei s-Erweiterung ist nicht zur Sicherstellung, dass die hochgeladene Datei ein PDF-Dokument ist eine sichere Technik.</span><span class="sxs-lookup"><span data-stu-id="872e2-243">Relying on the uploaded file s extension is not a sure-fire technique for ensuring that the uploaded file is a PDF document.</span></span> <span data-ttu-id="872e2-244">Der Benutzer möglicherweise ein gültiges PDF-Dokument mit der Erweiterung `.Brochure`, oder konnte nicht in der PDF-Dokument erstellt und ihm haben eine `.pdf` Erweiterung.</span><span class="sxs-lookup"><span data-stu-id="872e2-244">The user could have a valid PDF document with the extension `.Brochure`, or could have taken a non-PDF document and given it a `.pdf` extension.</span></span> <span data-ttu-id="872e2-245">Die binäre Inhalt der Datei s müssen programmgesteuert untersucht werden, um den Dateityp mehr abschließend sicherzustellen.</span><span class="sxs-lookup"><span data-stu-id="872e2-245">The file s binary content would need to be programmatically examined in order to more conclusively verify the file type.</span></span> <span data-ttu-id="872e2-246">Solche gründliche Ansätze sind jedoch häufig Ausgangsstruktur; Überprüfen die Erweiterung ist für die meisten Szenarien ausreichend.</span><span class="sxs-lookup"><span data-stu-id="872e2-246">Such thorough approaches, though, are often overkill; checking the extension is sufficient for most scenarios.</span></span>


<span data-ttu-id="872e2-247">Entsprechend der Anleitung unter dem [Hochladen von Dateien](uploading-files-cs.md) Tutorial, muss darauf geachtet werden beim Speichern im Dateisystem Dateien, damit dieses Uploads einen Benutzer s nicht einem anderen s überschrieben wird.</span><span class="sxs-lookup"><span data-stu-id="872e2-247">As discussed in the [Uploading Files](uploading-files-cs.md) tutorial, care must be taken when saving files to the file system so that one user s upload does not overwrite another s.</span></span> <span data-ttu-id="872e2-248">Für dieses Lernprogramm versuchen wir, die denselben Namen wie die hochgeladene Datei verwenden.</span><span class="sxs-lookup"><span data-stu-id="872e2-248">For this tutorial we will attempt to use the same name as the uploaded file.</span></span> <span data-ttu-id="872e2-249">Wenn es eine Datei in bereits die `~/Brochures` Verzeichnis mit diesem gleichen Dateinamen, allerdings müssen wir eine Zahl am Ende anfügen, bis ein eindeutiger Name gefunden wird.</span><span class="sxs-lookup"><span data-stu-id="872e2-249">If there already exists a file in the `~/Brochures` directory with that same file name, however, we'll append a number at the end until a unique name is found.</span></span> <span data-ttu-id="872e2-250">Z. B., wenn der Benutzer eine Broschüren mit dem Namen Dateiuploads `Meats.pdf`, aber es bereits eine Datei namens ist `Meats.pdf` in der `~/Brochures` Ordner ändern wir den gespeicherten Dateinamen an `Meats-1.pdf`.</span><span class="sxs-lookup"><span data-stu-id="872e2-250">For example, if the user uploads a brochure file named `Meats.pdf`, but there is already a file named `Meats.pdf` in the `~/Brochures` folder, we'll change the saved file name to `Meats-1.pdf`.</span></span> <span data-ttu-id="872e2-251">Wenn vorhanden ist, müssen wir versuchen `Meats-2.pdf`usw., bis ein eindeutiger Dateiname gefunden wird.</span><span class="sxs-lookup"><span data-stu-id="872e2-251">If that exists, we'll try `Meats-2.pdf`, and so on, until a unique file name is found.</span></span>

<span data-ttu-id="872e2-252">Der folgende code verwendet die [ `File.Exists(path)` Methode](https://msdn.microsoft.com/library/system.io.file.exists.aspx) zu bestimmen, ob eine Datei mit dem angegebenen Namen ist bereits vorhanden.</span><span class="sxs-lookup"><span data-stu-id="872e2-252">The following code uses the [`File.Exists(path)` method](https://msdn.microsoft.com/library/system.io.file.exists.aspx) to determine if a file already exists with the specified file name.</span></span> <span data-ttu-id="872e2-253">Wenn dies der Fall ist, wird er weiterhin wiederholen Sie den neuen Dateinamen für die Broschüren, bis kein Konflikt gefunden wird.</span><span class="sxs-lookup"><span data-stu-id="872e2-253">If so, it continues to try new file names for the brochure until no conflict is found.</span></span>


[!code-csharp[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample7.cs)]

<span data-ttu-id="872e2-254">Wenn ein gültiger Dateiname gefunden wurde, muss die Datei in das Dateisystem und die ObjectDataSource s gespeichert werden sollen `brochurePath``InsertParameter` Wert aktualisiert werden, damit diese Dateinamen in die Datenbank geschrieben werden muss.</span><span class="sxs-lookup"><span data-stu-id="872e2-254">Once a valid file name has been found, the file needs to be saved to the file system and the ObjectDataSource s `brochurePath``InsertParameter` value needs to be updated so that this file name is written to the database.</span></span> <span data-ttu-id="872e2-255">Wie wir gesehen, wieder in haben die *Hochladen von Dateien* Lernprogramm die Datei gespeichert werden kann mithilfe des Steuerelements FileUpload s `SaveAs(path)` Methode.</span><span class="sxs-lookup"><span data-stu-id="872e2-255">As we saw back in the *Uploading Files* tutorial, the file can be saved using the FileUpload control s `SaveAs(path)` method.</span></span> <span data-ttu-id="872e2-256">Aktualisiert das ObjectDataSource `brochurePath` verwenden die `e.Values` Auflistung.</span><span class="sxs-lookup"><span data-stu-id="872e2-256">To update the ObjectDataSource s `brochurePath` parameter, use the `e.Values` collection.</span></span>


[!code-csharp[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample8.cs)]

## <a name="step-7-saving-the-uploaded-picture-to-the-database"></a><span data-ttu-id="872e2-257">Schritt 7: Hochgeladene Bild in der Datenbank speichern.</span><span class="sxs-lookup"><span data-stu-id="872e2-257">Step 7: Saving the Uploaded Picture to the Database</span></span>

<span data-ttu-id="872e2-258">Zum Speichern der hochgeladenen Bilds in der neuen `Categories` aufzuzeichnen, müssen wir die ObjectDataSource s die hochgeladene Inhalt im Binärformat zuweisen `picture` Parameter in der DetailsView s `ItemInserting` Ereignis.</span><span class="sxs-lookup"><span data-stu-id="872e2-258">To store the uploaded picture in the new `Categories` record, we need to assign the uploaded binary content to the ObjectDataSource s `picture` parameter in the DetailsView s `ItemInserting` event.</span></span> <span data-ttu-id="872e2-259">Bevor wir diese Zuordnung vornehmen, müssen wir jedoch, zunächst sicherstellen, dass das hochgeladene Bild eine JPG- und nicht einem anderen Bildtyp ist.</span><span class="sxs-lookup"><span data-stu-id="872e2-259">Before we make this assignment, however, we need to first make sure that the uploaded picture is a JPG and not some other image type.</span></span> <span data-ttu-id="872e2-260">Können Sie wie in Schritt 6 s die hochgeladene Bild s-Dateierweiterung zu verwenden, um den Typ zu ermitteln.</span><span class="sxs-lookup"><span data-stu-id="872e2-260">As in Step 6, let s use the uploaded picture s file extension to ascertain its type.</span></span>

<span data-ttu-id="872e2-261">Während der `Categories` Tabelle ermöglicht `NULL` Werte für die `Picture` Spalte derzeit alle Kategorien haben ein Bild.</span><span class="sxs-lookup"><span data-stu-id="872e2-261">While the `Categories` table allows `NULL` values for the `Picture` column, all categories currently have a picture.</span></span> <span data-ttu-id="872e2-262">Lassen Sie s erzwingen, dass der Benutzer ein Bild angeben, wenn Sie eine neue Kategorie über diese Seite hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="872e2-262">Let s force the user to provide a picture when adding a new category through this page.</span></span> <span data-ttu-id="872e2-263">Der folgende Code überprüft, um sicherzustellen, dass ein Bild hochgeladen wurde, und ob er eine entsprechende Erweiterung hat.</span><span class="sxs-lookup"><span data-stu-id="872e2-263">The following code checks to ensure that a picture has been uploaded and that it has an appropriate extension.</span></span>


[!code-csharp[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample9.cs)]

<span data-ttu-id="872e2-264">Dieser Code sollte *vor* den Code aus Schritt 6, damit liegt ein Problem mit dem Hochladen von Bildern, wird der Ereignishandler beendet werden, bevor die Broschüren-Datei im Dateisystem gespeichert wird.</span><span class="sxs-lookup"><span data-stu-id="872e2-264">This code should be placed *before* the code from Step 6 so that if there is a problem with the picture upload, the event handler will terminate before the brochure file is saved to the file system.</span></span>

<span data-ttu-id="872e2-265">Vorausgesetzt, dass eine entsprechende Datei hochgeladen wurde, weisen Sie die hochgeladene Inhalt im Binärformat mit dem Bild-Parameterwert s mit der folgenden Codezeile:</span><span class="sxs-lookup"><span data-stu-id="872e2-265">Assuming that an appropriate file has been uploaded, assign the uploaded binary content to the picture parameter s value with the following line of code:</span></span>


[!code-csharp[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample10.cs)]

## <a name="the-completeiteminsertingevent-handler"></a><span data-ttu-id="872e2-266">Die vollständige`ItemInserting`-Ereignishandler</span><span class="sxs-lookup"><span data-stu-id="872e2-266">The Complete`ItemInserting`Event Handler</span></span>

<span data-ttu-id="872e2-267">Der Vollständigkeit halber hier ist die `ItemInserting` -Ereignishandler in seiner Gesamtheit:</span><span class="sxs-lookup"><span data-stu-id="872e2-267">For completeness, here is the `ItemInserting` event handler in its entirety:</span></span>


[!code-csharp[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample11.cs)]

## <a name="step-8-fixing-thedisplaycategorypictureaspxpage"></a><span data-ttu-id="872e2-268">Schritt 8: Korrigieren und die`DisplayCategoryPicture.aspx`Seite</span><span class="sxs-lookup"><span data-stu-id="872e2-268">Step 8: Fixing the`DisplayCategoryPicture.aspx`Page</span></span>

<span data-ttu-id="872e2-269">Let s nehmen einen Moment Zeit, um zu testen, die einfügende Schnittstelle und `ItemInserting` Ereignishandler, die in den letzten Schritten erstellt wurde.</span><span class="sxs-lookup"><span data-stu-id="872e2-269">Let s take a moment to test out the inserting interface and `ItemInserting` event handler that was created over the last few steps.</span></span> <span data-ttu-id="872e2-270">Besuchen Sie die `UploadInDetailsView.aspx` Seite über einen Browser und der Versuch, eine Kategorie hinzufügen, aber lassen Sie das Bild oder ein nicht-JPG-Bild oder eine PDF-Format Broschüren angeben.</span><span class="sxs-lookup"><span data-stu-id="872e2-270">Visit the `UploadInDetailsView.aspx` page through a browser and attempt to add a category, but omit the picture, or specify a non-JPG picture or a non-PDF brochure.</span></span> <span data-ttu-id="872e2-271">In diesen Fällen sollten folgende Fehlermeldung wird angezeigt, und das Einfügen der Workflow abgebrochen.</span><span class="sxs-lookup"><span data-stu-id="872e2-271">In any of these cases, an error message will be displayed and the insert workflow cancelled.</span></span>


<span data-ttu-id="872e2-272">[![Eine Warnmeldung wird angezeigt, wenn ein ungültiger Typ für die Datei hochgeladen wird](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image9.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="872e2-272">[![A Warning Message is Displayed If an Invalid File Type is Uploaded](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image9.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image15.png)</span></span>

<span data-ttu-id="872e2-273">**Abbildung 9**: eine Warnmeldung wird angezeigt, wenn ein ungültiger Typ für die Datei wird hochgeladen ([klicken Sie hier, um das Bild in voller Größe angezeigt](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image16.png))</span><span class="sxs-lookup"><span data-stu-id="872e2-273">**Figure 9**: A Warning Message is Displayed If an Invalid File Type is Uploaded ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image16.png))</span></span>


<span data-ttu-id="872e2-274">Wenn Sie überprüft haben, dass die Seite erfordert ein Bild hochgeladen werden und erzielter t PDF-Format oder nicht JPG-Dateien übernehmen, fügen Sie eine neue Kategorie mit ein gültige JPG-Bild, das Broschüren-Feld leer lassen.</span><span class="sxs-lookup"><span data-stu-id="872e2-274">Once you have verified that the page requires a picture to be uploaded and won t accept non-PDF or non-JPG files, add a new category with a valid JPG picture, leaving the Brochure field empty.</span></span> <span data-ttu-id="872e2-275">Nach dem Klicken auf die Schaltfläche zum Einfügen, wird die Seite postback und ein neuer Datensatz werden hinzugefügt werden, um die `Categories` Tabelle mit den hochgeladenen Image s binären Inhalt direkt in der Datenbank gespeichert.</span><span class="sxs-lookup"><span data-stu-id="872e2-275">After clicking the Insert button, the page will postback and a new record will be added to the `Categories` table with the uploaded image s binary contents stored directly in the database.</span></span> <span data-ttu-id="872e2-276">GridView wird aktualisiert und zeigt eine Zeile für die neu hinzugefügte Kategorie allerdings, wie in Abbildung 10 gezeigt, die neue Kategorie s Grafik ist nicht korrekt dargestellt.</span><span class="sxs-lookup"><span data-stu-id="872e2-276">The GridView is updated and shows a row for the newly added category, but, as Figure 10 shows, the new category s picture is not rendered correctly.</span></span>


<span data-ttu-id="872e2-277">[![Die neue Kategorie s, auf dem Bild nicht angezeigt wird](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image10.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="872e2-277">[![The New Category s Picture is not Displayed](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image10.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image17.png)</span></span>

<span data-ttu-id="872e2-278">**Abbildung 10**: die neue Kategorie s Bild wird nicht angezeigt ([klicken Sie hier, um das Bild in voller Größe angezeigt](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="872e2-278">**Figure 10**: The New Category s Picture is not Displayed ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image18.png))</span></span>


<span data-ttu-id="872e2-279">Ist der Grund, das das neue Bild wird nicht angezeigt, da die `DisplayCategoryPicture.aspx` Seite, die eine angegebene Kategorie s Bild zurückgibt ist so konfiguriert, dass um Bitmaps zu verarbeiten, die einen OLE-Header vorhanden sind.</span><span class="sxs-lookup"><span data-stu-id="872e2-279">The reason the new picture is not displayed is because the `DisplayCategoryPicture.aspx` page that returns a specified category s picture is configured to process bitmaps that have an OLE header.</span></span> <span data-ttu-id="872e2-280">Dieser Header 78 Byte aus entfernt wird die `Picture` s'-Spalte binären Inhalt vor dem Senden an den Client zurück.</span><span class="sxs-lookup"><span data-stu-id="872e2-280">This 78 byte header is stripped from the `Picture` column s binary contents before they are sent back to the client.</span></span> <span data-ttu-id="872e2-281">Aber die JPG-Datei, die wir gerade hochgeladenen für die neue Kategorie verfügt nicht über diesen OLE-Header; aus diesem Grund sind ungültig, die erforderlichen Bytes von s binäre Bilddaten entfernt.</span><span class="sxs-lookup"><span data-stu-id="872e2-281">But the JPG file we just uploaded for the new category does not have this OLE header; therefore, valid, necessary bytes are being removed from the image s binary data.</span></span>

<span data-ttu-id="872e2-282">Da es sich jetzt beide Bitmaps mit OLE-Header und JPG-Format in die `Categories` Tabelle, müssen wir aktualisieren `DisplayCategoryPicture.aspx` , damit sie den OLE-Header für die ursprüngliche acht Kategorien Striping und umgeht diese Striping für neuere Kategorie Datensätze.</span><span class="sxs-lookup"><span data-stu-id="872e2-282">Since there are now both bitmaps with OLE headers and JPGs in the `Categories` table, we need to update `DisplayCategoryPicture.aspx` so that it does the OLE header stripping for the original eight categories and bypasses this stripping for the newer category records.</span></span> <span data-ttu-id="872e2-283">In unserem nächsten Lernprogramm untersucht, wie ein vorhandenen Datensatz s-Image zu aktualisieren, und wir werden alle alten Kategorie Bilder aktualisieren, sodass sie die JPG-Format sind.</span><span class="sxs-lookup"><span data-stu-id="872e2-283">In our next tutorial we'll examine how to update an existing record s image, and we'll update all of the old category pictures so that they are JPGs.</span></span> <span data-ttu-id="872e2-284">Verwenden Sie vorerst jedoch den folgenden Code in `DisplayCategoryPicture.aspx` um die OLE-Header nur für die ursprüngliche acht Kategorien zu entfernen:</span><span class="sxs-lookup"><span data-stu-id="872e2-284">For now, though, use the following code in `DisplayCategoryPicture.aspx` to strip the OLE headers only for those original eight categories:</span></span>


[!code-csharp[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample12.cs)]

<span data-ttu-id="872e2-285">Durch diese Änderung wird die JPG-Bild jetzt richtig in die GridView gerendert.</span><span class="sxs-lookup"><span data-stu-id="872e2-285">With this change, the JPG image is now rendered correctly in the GridView.</span></span>


<span data-ttu-id="872e2-286">[![Die JPG-Images für die neuen Kategorien sind ordnungsgemäß gerendert.](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image11.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="872e2-286">[![The JPG Images for New Categories are Correctly Rendered](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image11.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image19.png)</span></span>

<span data-ttu-id="872e2-287">**Abbildung 11**: JPG Bilder für die neuen Kategorien sind ordnungsgemäß gerendert ([klicken Sie hier, um das Bild in voller Größe angezeigt](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image20.png))</span><span class="sxs-lookup"><span data-stu-id="872e2-287">**Figure 11**: The JPG Images for New Categories are Correctly Rendered ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image20.png))</span></span>


## <a name="step-9-deleting-the-brochure-in-the-face-of-an-exception"></a><span data-ttu-id="872e2-288">Schritt 9: Durch das Löschen der Broschüren bei einer Ausnahme</span><span class="sxs-lookup"><span data-stu-id="872e2-288">Step 9: Deleting the Brochure in the Face of an Exception</span></span>

<span data-ttu-id="872e2-289">Eine der Herausforderungen von Binärdaten im Web Server s-Dateisystem gespeichert ist, dass es sich um eine Trennung zwischen dem Datenmodell und die binären Daten führt.</span><span class="sxs-lookup"><span data-stu-id="872e2-289">One of the challenges of storing binary data on the web server s file system is that it introduces a disconnect between the data model and its binary data.</span></span> <span data-ttu-id="872e2-290">Daher immer ein Datensatz gelöscht wird, müssen die entsprechenden binären Daten im Dateisystem auch entfernt werden.</span><span class="sxs-lookup"><span data-stu-id="872e2-290">Therefore, whenever a record is deleted, the corresponding binary data on the file system must also be removed.</span></span> <span data-ttu-id="872e2-291">Dies kann sprachbasierte möglich, wenn Sie auch einfügen.</span><span class="sxs-lookup"><span data-stu-id="872e2-291">This can come into play when inserting, as well.</span></span> <span data-ttu-id="872e2-292">Das folgende Szenario: ein Benutzer eine neue Kategorie angeben, ein gültiges Bild und Broschüren hinzufügt.</span><span class="sxs-lookup"><span data-stu-id="872e2-292">Consider the following scenario: a user adds a new category, specifying a valid picture and brochure.</span></span> <span data-ttu-id="872e2-293">Beim Klicken auf die Schaltfläche Insert ein ein Postback erfolgt und die DetailsView-s `ItemInserting` Ereignis wird ausgelöst, die Broschüren die Web Server s im Dateisystem speichern.</span><span class="sxs-lookup"><span data-stu-id="872e2-293">Upon clicking the Insert button, a postback occurs and the DetailsView s `ItemInserting` event fires, saving the brochure to the web server s file system.</span></span> <span data-ttu-id="872e2-294">Weiter, das ObjectDataSource-s `Insert()` Methode aufgerufen wird, ruft die der `CategoriesBLL` Klasse s `InsertWithPicture` aufruft der `CategoriesTableAdapter` s `InsertWithPicture` Methode.</span><span class="sxs-lookup"><span data-stu-id="872e2-294">Next, the ObjectDataSource s `Insert()` method is invoked, which calls the `CategoriesBLL` class s `InsertWithPicture` method, which calls the `CategoriesTableAdapter` s `InsertWithPicture` method.</span></span>

<span data-ttu-id="872e2-295">Nun, was geschieht, wenn die Datenbank offline ist oder wenn Fehler in der `INSERT` SQL-Anweisung?</span><span class="sxs-lookup"><span data-stu-id="872e2-295">Now, what happens if the database is offline, or if there is an error in the `INSERT` SQL statement?</span></span> <span data-ttu-id="872e2-296">Deutlich schlägt einfügen fehl, damit die Datenbank keine neue Kategoriezeile hinzugefügt werden.</span><span class="sxs-lookup"><span data-stu-id="872e2-296">Clearly the INSERT will fail, so no new category row will be added to the database.</span></span> <span data-ttu-id="872e2-297">Jedoch können wir noch die hochgeladene Broschüren-Datei auf dem Webserver-s-Datei-System!</span><span class="sxs-lookup"><span data-stu-id="872e2-297">But we still have the uploaded brochure file sitting on the web server s file system!</span></span> <span data-ttu-id="872e2-298">Diese Datei muss bei einer Ausnahme während des Workflows für das Einfügen von gelöscht werden.</span><span class="sxs-lookup"><span data-stu-id="872e2-298">This file needs to be deleted in the face of an exception during the inserting workflow.</span></span>

<span data-ttu-id="872e2-299">Wie zuvor erläutert in der [Behandlung von BLL- und DAL-Ebene Ausnahmen auf einer ASP.NET-Seite](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md) Lernprogramm beim Auslösen einer Ausnahme aus in die Tiefen der Architektur ist es durch die verschiedenen Anwendungsebenen protokolliert wird.</span><span class="sxs-lookup"><span data-stu-id="872e2-299">As discussed previously in the [Handling BLL- and DAL-Level Exceptions in an ASP.NET Page](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md) tutorial, when an exception is thrown from within the depths of the architecture it is bubbled up through the various layers.</span></span> <span data-ttu-id="872e2-300">Bei der Präsentationsschicht, können wir feststellen, ob eine Ausnahme, von der DetailsView s aufgetreten ist `ItemInserted` Ereignis.</span><span class="sxs-lookup"><span data-stu-id="872e2-300">At the Presentation Layer, we can determine if an exception has occurred from the DetailsView s `ItemInserted` event.</span></span> <span data-ttu-id="872e2-301">Dieser Ereignishandler stellt auch die Werte der ObjectDataSource s `InsertParameters`.</span><span class="sxs-lookup"><span data-stu-id="872e2-301">This event handler also provides the values of the ObjectDataSource s `InsertParameters`.</span></span> <span data-ttu-id="872e2-302">Wir können aus diesem Grund erstellen Sie einen Ereignishandler für das `ItemInserted` Ereignis, das überprüft, ob eine Ausnahme aufgetreten, und, wenn dies der Fall ist, löscht die Datei, die durch das ObjectDataSource s angegebene `brochurePath` Parameter:</span><span class="sxs-lookup"><span data-stu-id="872e2-302">Therefore, we can create an event handler for the `ItemInserted` event that checks if there was an exception and, if so, deletes the file specified by the ObjectDataSource s `brochurePath` parameter:</span></span>


[!code-csharp[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample13.cs)]

## <a name="summary"></a><span data-ttu-id="872e2-303">Zusammenfassung</span><span class="sxs-lookup"><span data-stu-id="872e2-303">Summary</span></span>

<span data-ttu-id="872e2-304">Es gibt eine Reihe von Schritten, die ausgeführt werden muss, um eine webbasierte Schnittstelle zum Hinzufügen von Datensätzen, die Binärdaten enthalten bereitzustellen.</span><span class="sxs-lookup"><span data-stu-id="872e2-304">There are a number of steps that must be performed in order to provide a web-based interface for adding records that include binary data.</span></span> <span data-ttu-id="872e2-305">Wenn die binären Daten direkt in der Datenbank gespeichert wird, werden wahrscheinlich müssen Sie die Architektur aktualisieren Hinzufügen von bestimmten Methoden, um Fälle zu behandeln, in dem binäre Daten eingefügt werden.</span><span class="sxs-lookup"><span data-stu-id="872e2-305">If the binary data is being stored directly into the database, chances are you'll need to update the architecture, adding specific methods to handle the case where binary data is being inserted.</span></span> <span data-ttu-id="872e2-306">Nach die Architektur aktualisiert wurde, ist der nächste Schritt die einfügende Schnittstelle erstellt mithilfe einer DetailsView, die ein Steuerelement FileUpload für jedes Feld Binärdaten enthalten angepasst wurde erreicht werden kann.</span><span class="sxs-lookup"><span data-stu-id="872e2-306">Once the architecture has been updated, the next step is creating the inserting interface, which can be accomplished using a DetailsView that has been customized to include a FileUpload control for each binary data field.</span></span> <span data-ttu-id="872e2-307">Die hochgeladenen Daten können dann die Web Server s im Dateisystem gespeichert oder auf einen Daten-Quelle-Parameter in der DetailsView s zugewiesen `ItemInserting` -Ereignishandler.</span><span class="sxs-lookup"><span data-stu-id="872e2-307">The uploaded data can then be saved to the web server s file system or assigned to a data source parameter in the DetailsView s `ItemInserting` event handler.</span></span>

<span data-ttu-id="872e2-308">Speichern von Binärdaten in das Dateisystem erfordert mehr Planung, als das Speichern von Daten direkt in der Datenbank.</span><span class="sxs-lookup"><span data-stu-id="872e2-308">Saving binary data to the file system requires more planning than saving data directly into the database.</span></span> <span data-ttu-id="872e2-309">Ein Benennungsschema muss ausgewählt werden, um einem Benutzer s Upload einer anderen s überschreiben zu vermeiden.</span><span class="sxs-lookup"><span data-stu-id="872e2-309">A naming scheme must be chosen in order to avoid one user s upload overwriting another s.</span></span> <span data-ttu-id="872e2-310">Darüber hinaus müssen zusätzliche Schritte ausgeführt werden, die hochgeladene Datei löschen, wenn die Datenbank einfügen ein Fehler auftritt.</span><span class="sxs-lookup"><span data-stu-id="872e2-310">Also, extra steps must be taken to delete the uploaded file if the database insert fails.</span></span>

<span data-ttu-id="872e2-311">Wir haben jetzt die Möglichkeit zum Hinzufügen von neuer Kategorien mit dem System mit einem Broschüren und Bild, aber es gibt es noch zu betrachten zum Aktualisieren einer vorhandenen Kategorie s-Binärdaten oder die Binärdaten für eine gelöschte Kategorie ordnungsgemäß zu entfernen.</span><span class="sxs-lookup"><span data-stu-id="872e2-311">We now have the ability to add new categories to the system with a brochure and picture, but we ve yet to look at how to update an existing category s binary data or how to correctly remove the binary data for a deleted category.</span></span> <span data-ttu-id="872e2-312">Wir werden diese beiden Themen in den nächsten Lernprogrammen untersuchen.</span><span class="sxs-lookup"><span data-stu-id="872e2-312">We'll explore these two topics in the next tutorial.</span></span>

<span data-ttu-id="872e2-313">Viel Spaß beim Programmieren!</span><span class="sxs-lookup"><span data-stu-id="872e2-313">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="872e2-314">Informationen zum Autor</span><span class="sxs-lookup"><span data-stu-id="872e2-314">About the Author</span></span>

<span data-ttu-id="872e2-315">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), Autor von sieben ASP/ASP.NET-Büchern und Gründer von [4GuysFromRolla.com](http://www.4guysfromrolla.com), Microsoft Web-Technologien seit 1998 arbeitet.</span><span class="sxs-lookup"><span data-stu-id="872e2-315">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="872e2-316">Scott fungiert als ein unabhängiger Berater, Trainer und Writer.</span><span class="sxs-lookup"><span data-stu-id="872e2-316">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="872e2-317">Sein neueste Buch wird [ *Sams Schulen selbst ASP.NET 2.0 in 24 Stunden*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="872e2-317">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="872e2-318">Er die erreicht werden kann, zur [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) oder über seinen Blog die finden Sie unter [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="872e2-318">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="872e2-319">Besonderen Dank an</span><span class="sxs-lookup"><span data-stu-id="872e2-319">Special Thanks To</span></span>

<span data-ttu-id="872e2-320">Diese Reihe von Lernprogrammen wurde durch viele nützliche Bearbeiter überprüft.</span><span class="sxs-lookup"><span data-stu-id="872e2-320">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="872e2-321">Lead Prüfer für dieses Lernprogramm wurden Dave Gardner Teresa Murphy und Bernadette Leigh.</span><span class="sxs-lookup"><span data-stu-id="872e2-321">Lead reviewers for this tutorial were Dave Gardner, Teresa Murphy, and Bernadette Leigh.</span></span> <span data-ttu-id="872e2-322">Meine bevorstehende MSDN-Artikel Überprüfen von Interesse?</span><span class="sxs-lookup"><span data-stu-id="872e2-322">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="872e2-323">Wenn dies der Fall ist, löschen Sie mich zeilenweise [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="872e2-323">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

>[!div class="step-by-step"]
<span data-ttu-id="872e2-324">[Zurück](displaying-binary-data-in-the-data-web-controls-cs.md)
[Weiter](updating-and-deleting-existing-binary-data-cs.md)</span><span class="sxs-lookup"><span data-stu-id="872e2-324">[Previous](displaying-binary-data-in-the-data-web-controls-cs.md)
[Next](updating-and-deleting-existing-binary-data-cs.md)</span></span>
