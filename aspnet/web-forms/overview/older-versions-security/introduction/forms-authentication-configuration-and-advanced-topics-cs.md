---
uid: web-forms/overview/older-versions-security/introduction/forms-authentication-configuration-and-advanced-topics-cs
title: Forms Authentifizierungskonfiguration und Weiterführende Themen (c#) | Microsoft Docs
author: rick-anderson
description: In diesem Lernprogramm wird die verschiedenen Einstellungen für die Formularauthentifizierung untersuchen und finden Sie unter wie sie über das Forms-Element zu ändern. Dadurch wird eine detaillierte gelten...
ms.author: aspnetcontent
manager: wpickett
ms.date: 01/14/2008
ms.topic: article
ms.assetid: b9c29865-a34e-48bb-92c0-c443a72cb860
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/older-versions-security/introduction/forms-authentication-configuration-and-advanced-topics-cs
msc.type: authoredcontent
ms.openlocfilehash: d6578737478fb86f64be261925becc3adec33247
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 04/06/2018
---
<a name="forms-authentication-configuration-and-advanced-topics-c"></a><span data-ttu-id="3bc57-104">Konfiguration der Formularauthentifizierung und Weiterführende Themen (c#)</span><span class="sxs-lookup"><span data-stu-id="3bc57-104">Forms Authentication Configuration and Advanced Topics (C#)</span></span>
====================
<span data-ttu-id="3bc57-105">durch [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="3bc57-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="3bc57-106">[Herunterladen von Code](http://download.microsoft.com/download/2/F/7/2F705A34-F9DE-4112-BBDE-60098089645E/ASPNET_Security_Tutorial_03_CS.zip) oder [PDF herunterladen](http://download.microsoft.com/download/2/F/7/2F705A34-F9DE-4112-BBDE-60098089645E/aspnet_tutorial03_AuthAdvanced_cs.pdf)</span><span class="sxs-lookup"><span data-stu-id="3bc57-106">[Download Code](http://download.microsoft.com/download/2/F/7/2F705A34-F9DE-4112-BBDE-60098089645E/ASPNET_Security_Tutorial_03_CS.zip) or [Download PDF](http://download.microsoft.com/download/2/F/7/2F705A34-F9DE-4112-BBDE-60098089645E/aspnet_tutorial03_AuthAdvanced_cs.pdf)</span></span>

> <span data-ttu-id="3bc57-107">In diesem Lernprogramm wird die verschiedenen Einstellungen für die Formularauthentifizierung untersuchen und finden Sie unter wie sie über das Forms-Element zu ändern.</span><span class="sxs-lookup"><span data-stu-id="3bc57-107">In this tutorial we will examine the various forms authentication settings and see how to modify them through the forms element.</span></span> <span data-ttu-id="3bc57-108">Dadurch wird eine ausführliche Übersicht über das Anpassen der Timeoutwert für das Formularauthentifizierungsticket, verwenden eine Anmeldeseite mit einer benutzerdefinierten URL (z. B. SignIn.aspx anstelle von "Login.aspx") und cookieless Formularauthentifizierungstickets gelten.</span><span class="sxs-lookup"><span data-stu-id="3bc57-108">This will entail a detailed look at customizing the forms authentication ticket's timeout value, using a login page with a custom URL (like SignIn.aspx instead of Login.aspx), and cookieless forms authentication tickets.</span></span>


## <a name="introduction"></a><span data-ttu-id="3bc57-109">Einführung</span><span class="sxs-lookup"><span data-stu-id="3bc57-109">Introduction</span></span>

<span data-ttu-id="3bc57-110">In der [vorherigen Lernprogramm](an-overview-of-forms-authentication-cs.md) erläutert die Schritte zum Implementieren der Formularauthentifizierung in einer ASP.NET-Anwendung, von der Angabe von Konfigurationseinstellungen in der Datei "Web.config" zum Erstellen eines Protokolls für die verschiedenen auf der Seite anzeigen Inhalt für authentifizierte und anonyme Benutzer.</span><span class="sxs-lookup"><span data-stu-id="3bc57-110">In the [previous tutorial](an-overview-of-forms-authentication-cs.md) we looked at the steps necessary for implementing forms authentication in an ASP.NET application, from specifying configuration settings in Web.config to creating a log in page to displaying different content for authenticated and anonymous users.</span></span> <span data-ttu-id="3bc57-111">Beachten Sie, dass wir die Verwendung der Formularauthentifizierung durch Festlegen der Mode-Attribut-Website konfiguriert die &lt;Authentifizierung&gt; Element Formulare.</span><span class="sxs-lookup"><span data-stu-id="3bc57-111">Recall that we configured the website to use forms authentication by setting the mode attribute of the &lt;authentication&gt; element to Forms.</span></span> <span data-ttu-id="3bc57-112">Die &lt;Authentifizierung&gt; Element kann optional enthalten eine &lt;Forms&gt; untergeordnetes Element, über die eine Sammlung von Einstellungen für die Formularauthentifizierung angegeben werden kann.</span><span class="sxs-lookup"><span data-stu-id="3bc57-112">The &lt;authentication&gt; element may optionally include a &lt;forms&gt; child element, through which an assortment of forms authentication settings may be specified.</span></span>

<span data-ttu-id="3bc57-113">In diesem Lernprogramm wir untersuchen die unterschiedlichen Einstellungen für die Formularauthentifizierung und erfahren Sie, wie sie durch Ändern der &lt;Forms&gt; Element.</span><span class="sxs-lookup"><span data-stu-id="3bc57-113">In this tutorial we will examine the various forms authentication settings and see how to modify them through the &lt;forms&gt; element.</span></span> <span data-ttu-id="3bc57-114">Dadurch wird eine ausführliche Übersicht über das Anpassen der Timeoutwert für das Formularauthentifizierungsticket, verwenden eine Anmeldeseite mit einer benutzerdefinierten URL (z. B. SignIn.aspx anstelle von "Login.aspx") und cookieless Formularauthentifizierungstickets gelten.</span><span class="sxs-lookup"><span data-stu-id="3bc57-114">This will entail a detailed look at customizing the forms authentication ticket's timeout value, using a login page with a custom URL (like SignIn.aspx instead of Login.aspx), and cookieless forms authentication tickets.</span></span> <span data-ttu-id="3bc57-115">Außerdem wird die Zusammensetzung das Formularauthentifizierungsticket genauer untersuchen und finden Sie unter der Vorsichtsmaßnahmen, die ASP.NET benötigt, um sicherzustellen, dass das Ticket Daten aus dem überprüfungs- und Manipulationen sicher ist.</span><span class="sxs-lookup"><span data-stu-id="3bc57-115">We will also examine the makeup of the forms authentication ticket more closely and see the precautions ASP.NET takes to ensure that the ticket's data is secure from inspection and tampering.</span></span> <span data-ttu-id="3bc57-116">Schließlich untersuchen wir wie zusätzliche Benutzerdaten in das Formularauthentifizierungsticket gespeichert und wie diese Daten über einen benutzerdefinierten principal-Objekt zu modellieren.</span><span class="sxs-lookup"><span data-stu-id="3bc57-116">Finally, we will look at how to store extra user data in the forms authentication ticket and how to model this data through a custom principal object.</span></span>

## <a name="step-1-examining-the-ltformsgt-configuration-settings"></a><span data-ttu-id="3bc57-117">Schritt 1: Untersuchen der &lt;Forms&gt; -Konfigurationseinstellungen</span><span class="sxs-lookup"><span data-stu-id="3bc57-117">Step 1: Examining the &lt;forms&gt; Configuration Settings</span></span>

<span data-ttu-id="3bc57-118">Das Authentifizierungssystem Formularen in ASP.NET bietet eine Reihe von Konfigurationseinstellungen, die auf eine Anwendungsbasis angepasst werden kann.</span><span class="sxs-lookup"><span data-stu-id="3bc57-118">The forms authentication system in ASP.NET offers a number of configuration settings that can be customized on an application-by-application basis.</span></span> <span data-ttu-id="3bc57-119">Hierzu zählen Einstellungen wie: die Lebensdauer der Formularauthentifizierung ticket; Welche Art des Schutzes wird auf das Ticket angewendet; Tickets werden verwendet, unter welchen Bedingungen Authentifizierung ohne Cookies. der Pfad zur Anmeldeseite. und andere Informationen.</span><span class="sxs-lookup"><span data-stu-id="3bc57-119">This includes settings like: the lifetime of the forms authentication ticket; what sort of protection is applied to the ticket; under what conditions cookieless authentication tickets are used; the path to the login page; and other information.</span></span> <span data-ttu-id="3bc57-120">Um die Standardwerte zu ändern, fügen einen [ &lt;Forms&gt; Element](https://msdn.microsoft.com/library/1d3t3c61.aspx) als untergeordnetes Element von der [ &lt;Authentifizierung&gt; Element](https://msdn.microsoft.com/library/532aee0e.aspx), diese Eigenschaft angeben Werte, die Sie als XML-Attribute anpassen möchten, wie folgt:</span><span class="sxs-lookup"><span data-stu-id="3bc57-120">To modify the default values, add a [&lt;forms&gt; element](https://msdn.microsoft.com/library/1d3t3c61.aspx) as a child of the [&lt;authentication&gt; element](https://msdn.microsoft.com/library/532aee0e.aspx), specifying those property values you want to customize as XML attributes like so:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample1.xml)]

<span data-ttu-id="3bc57-121">Tabelle 1 werden die Eigenschaften zusammengefasst, die über angepasst werden können die &lt;Forms&gt; Element.</span><span class="sxs-lookup"><span data-stu-id="3bc57-121">Table 1 summarizes the properties that can be customized through the &lt;forms&gt; element.</span></span> <span data-ttu-id="3bc57-122">Da die Datei "Web.config" eine XML-Datei ist, sind die Namen der Attribute in der linken Spalte Groß-/Kleinschreibung beachtet.</span><span class="sxs-lookup"><span data-stu-id="3bc57-122">Since Web.config is an XML file, the attribute names in the left column are case-sensitive.</span></span>


| <span data-ttu-id="3bc57-123"><strong>Attribut</strong></span><span class="sxs-lookup"><span data-stu-id="3bc57-123"><strong>Attribute</strong></span></span> |                                                                                                                                                                                                                                     <span data-ttu-id="3bc57-124"><strong>Beschreibung</strong></span><span class="sxs-lookup"><span data-stu-id="3bc57-124"><strong>Description</strong></span></span>                                                                                                                                                                                                                                      |
|----------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|         <span data-ttu-id="3bc57-125">ohne Cookies</span><span class="sxs-lookup"><span data-stu-id="3bc57-125">cookieless</span></span>         |                                                                                                                <span data-ttu-id="3bc57-126">Dieses Attribut gibt an, unter welchen Bedingungen das Authentifizierungsticket in einem Cookie und wird in die URL eingebettet gespeichert ist.</span><span class="sxs-lookup"><span data-stu-id="3bc57-126">This attribute specifies under what conditions the authentication ticket is stored in a cookie versus being embedded in the URL.</span></span> <span data-ttu-id="3bc57-127">Zulässige Werte sind: UseCookies; UseUri; AutoErmittlung; und UseDeviceProfile (Standard).</span><span class="sxs-lookup"><span data-stu-id="3bc57-127">Allowable values are: UseCookies; UseUri; AutoDetect; and UseDeviceProfile (the default).</span></span> <span data-ttu-id="3bc57-128">Schritt 2 überprüft diese Einstellung im Detail.</span><span class="sxs-lookup"><span data-stu-id="3bc57-128">Step 2 examines this setting in more detail.</span></span>                                                                                                                |
|         <span data-ttu-id="3bc57-129">defaultUrl</span><span class="sxs-lookup"><span data-stu-id="3bc57-129">defaultUrl</span></span>         |                                                                                                                                                         <span data-ttu-id="3bc57-130">Gibt die URL, an die Benutzer nach der Anmeldung auf der Anmeldeseite von es ist kein umleitungs-URL-Wert, der in der Abfragezeichenfolge angegeben umgeleitet werden.</span><span class="sxs-lookup"><span data-stu-id="3bc57-130">Indicates the URL that users are redirected to after signing in from the login page if there is no RedirectUrl value specified in the querystring.</span></span> <span data-ttu-id="3bc57-131">Der Standardwert ist "default.aspx".</span><span class="sxs-lookup"><span data-stu-id="3bc57-131">The default value is default.aspx.</span></span>                                                                                                                                                         |
|           <span data-ttu-id="3bc57-132">Domäne</span><span class="sxs-lookup"><span data-stu-id="3bc57-132">domain</span></span>           | <span data-ttu-id="3bc57-133">Bei Verwendung von Cookie-basierte Authentifizierungstickets wird mit dieser Einstellung Domänenwert für das Cookie.</span><span class="sxs-lookup"><span data-stu-id="3bc57-133">When using cookie-based authentication tickets, this setting specifies the cookie's domain value.</span></span> <span data-ttu-id="3bc57-134">Der Standardwert ist eine leere Zeichenfolge, die bewirkt, dass der Browser die Domäne verwenden, von der aus (z. B. www.yourdomain.com) ausgestellt wurde.</span><span class="sxs-lookup"><span data-stu-id="3bc57-134">The default value is an empty string, which causes the browser to use the domain from which it was issued (such as www.yourdomain.com).</span></span> <span data-ttu-id="3bc57-135">In diesem Fall das Cookie wird <strong>nicht</strong> gesendet werden, wenn Sie festlegen, dass untergeordnete Domänen, z. B. admin.yourdomain.com anfordert. Wenn Sie möchten das Cookie an alle Unterdomänen übergeben werden, Sie die Festlegung auf IhreDomäne.com Domänenattribut anpassen müssen.</span><span class="sxs-lookup"><span data-stu-id="3bc57-135">In this case, the cookie will <strong>not</strong> be sent when making requests to subdomains, such as admin.yourdomain.com. If you want the cookie to be passed to all subdomains you need to customize the domain attribute setting it to yourdomain.com.</span></span> |
|  <span data-ttu-id="3bc57-136">enableCrossAppRedirects</span><span class="sxs-lookup"><span data-stu-id="3bc57-136">enableCrossAppRedirects</span></span>   |                                                                                                                                                                   <span data-ttu-id="3bc57-137">Ein boolescher Wert, der angibt, ob der authentifizierte Benutzer gespeichert werden, wenn URLs in andere Webanwendungen auf demselben Server umgeleitet.</span><span class="sxs-lookup"><span data-stu-id="3bc57-137">A Boolean value indicating whether authenticated users are remembered when redirected to URLs in other web applications on the same server.</span></span> <span data-ttu-id="3bc57-138">Der Standardwert ist false.</span><span class="sxs-lookup"><span data-stu-id="3bc57-138">The default is false.</span></span>                                                                                                                                                                   |
|          <span data-ttu-id="3bc57-139">loginUrl</span><span class="sxs-lookup"><span data-stu-id="3bc57-139">loginUrl</span></span>          |                                                                                                                                                                                                                      <span data-ttu-id="3bc57-140">Die URL der Anmeldeseite.</span><span class="sxs-lookup"><span data-stu-id="3bc57-140">The URL of the login page.</span></span> <span data-ttu-id="3bc57-141">Der Standardwert ist "Login.aspx".</span><span class="sxs-lookup"><span data-stu-id="3bc57-141">The default value is login.aspx.</span></span>                                                                                                                                                                                                                      |
|            <span data-ttu-id="3bc57-142">Name</span><span class="sxs-lookup"><span data-stu-id="3bc57-142">name</span></span>            |                                                                                                                                                                                                   <span data-ttu-id="3bc57-143">Wenn Tickets Cookie-basierte Authentifizierung, die den Namen des Cookies verwenden zu können.</span><span class="sxs-lookup"><span data-stu-id="3bc57-143">When using cookie-based authentication tickets, the name of the cookie.</span></span> <span data-ttu-id="3bc57-144">Der Standardwert ist. ASPXAUTH.</span><span class="sxs-lookup"><span data-stu-id="3bc57-144">The default is .ASPXAUTH.</span></span>                                                                                                                                                                                                   |
|            <span data-ttu-id="3bc57-145">path</span><span class="sxs-lookup"><span data-stu-id="3bc57-145">path</span></span>            |                                                                             <span data-ttu-id="3bc57-146">Bei Verwendung von Cookie-basierte Authentifizierungstickets wird mit dieser Einstellung das Cookie Path-Attribut.</span><span class="sxs-lookup"><span data-stu-id="3bc57-146">When using cookie-based authentication tickets, this setting specifies the cookie's path attribute.</span></span> <span data-ttu-id="3bc57-147">Der Path-Attribut kann der Entwickler den Umfang eines Cookies zu einem bestimmten Verzeichnishierarchie zu beschränken.</span><span class="sxs-lookup"><span data-stu-id="3bc57-147">The path attribute enables a developer to limit the scope of a cookie to a particular directory hierarchy.</span></span> <span data-ttu-id="3bc57-148">Der Standardwert ist / dem informiert des Browsers, um das Ticket Authentifizierungscookie zu jeder Anforderung an die Domäne zu senden.</span><span class="sxs-lookup"><span data-stu-id="3bc57-148">The default value is /, which informs the browser to send the authentication ticket cookie to any request made to the domain.</span></span>                                                                              |
|         <span data-ttu-id="3bc57-149">Schutz</span><span class="sxs-lookup"><span data-stu-id="3bc57-149">protection</span></span>         |                                                                                                                                            <span data-ttu-id="3bc57-150">Gibt an, welche Methoden verwendet werden, um das Formularauthentifizierungsticket zu schützen.</span><span class="sxs-lookup"><span data-stu-id="3bc57-150">Indicates what techniques are used to protect the forms authentication ticket.</span></span> <span data-ttu-id="3bc57-151">Die zulässigen Werte sind: alle (Standardeinstellung); Verschlüsselung; None; und -Validierung.</span><span class="sxs-lookup"><span data-stu-id="3bc57-151">The allowable values are: All (the default); Encryption; None; and Validation.</span></span> <span data-ttu-id="3bc57-152">Diese Einstellungen werden in Schritt 3 im Detail erläutert.</span><span class="sxs-lookup"><span data-stu-id="3bc57-152">These settings are discussed in detail in Step 3.</span></span>                                                                                                                                            |
|         <span data-ttu-id="3bc57-153">requireSSL</span><span class="sxs-lookup"><span data-stu-id="3bc57-153">requireSSL</span></span>         |                                                                                                                                                                                <span data-ttu-id="3bc57-154">Ein boolescher Wert, der angibt, ob eine SSL-Verbindung erforderlich ist, um das Authentifizierungscookie zu übermitteln.</span><span class="sxs-lookup"><span data-stu-id="3bc57-154">A Boolean value that indicates whether an SSL connection is required to transmit the authentication cookie.</span></span> <span data-ttu-id="3bc57-155">Der Standardwert ist false.</span><span class="sxs-lookup"><span data-stu-id="3bc57-155">The default value is false.</span></span>                                                                                                                                                                                |
|     <span data-ttu-id="3bc57-156">slidingExpiration</span><span class="sxs-lookup"><span data-stu-id="3bc57-156">slidingExpiration</span></span>      |                                                                                                 <span data-ttu-id="3bc57-157">Ein boolescher Wert, der angibt, ob das Authentifizierungscookie Timeout jedes Mal zurückgesetzt wird der Benutzer die Website während einer Sitzung besucht wird.</span><span class="sxs-lookup"><span data-stu-id="3bc57-157">A Boolean value that indicates whether the authentication cookie's timeout is reset each time the user visits the site during a single session.</span></span> <span data-ttu-id="3bc57-158">Der Standardwert ist true.</span><span class="sxs-lookup"><span data-stu-id="3bc57-158">The default value is true.</span></span> <span data-ttu-id="3bc57-159">Timeout die Authentifizierungsrichtlinie für Ticket wird ausführlicher in den unter Angabe der Ticket-Timeoutwert-Abschnitt.</span><span class="sxs-lookup"><span data-stu-id="3bc57-159">The authentication ticket timeout policy is discussed in more detail in the Specifying the Ticket's Timeout Value section.</span></span>                                                                                                 |
|          <span data-ttu-id="3bc57-160">timeout</span><span class="sxs-lookup"><span data-stu-id="3bc57-160">timeout</span></span>           |                                                                                                                               <span data-ttu-id="3bc57-161">Gibt die Zeit in Minuten, nach denen das Ticket Authentifizierungscookie abläuft.</span><span class="sxs-lookup"><span data-stu-id="3bc57-161">Specifies the time, in minutes, after which the authentication ticket cookie expires.</span></span> <span data-ttu-id="3bc57-162">Der Standardwert ist 30.</span><span class="sxs-lookup"><span data-stu-id="3bc57-162">The default value is 30.</span></span> <span data-ttu-id="3bc57-163">Timeout die Authentifizierungsrichtlinie für Ticket wird ausführlicher in den unter Angabe der Ticket-Timeoutwert-Abschnitt.</span><span class="sxs-lookup"><span data-stu-id="3bc57-163">The authentication ticket timeout policy is discussed in more detail in the Specifying the Ticket's Timeout Value section.</span></span>                                                                                                                               |

<span data-ttu-id="3bc57-164">**Tabelle 1**: eine Zusammenfassung der &lt;Forms&gt; Attribute des Elements</span><span class="sxs-lookup"><span data-stu-id="3bc57-164">**Table 1**: A Summary of the &lt;forms&gt; Element's Attributes</span></span>

<span data-ttu-id="3bc57-165">In ASP.NET 2.0 und jenseits der Standardgrenze wird Forms Authentifizierungswerte in der FormsAuthenticationConfiguration-Klasse in .NET Framework hartcodiert sind.</span><span class="sxs-lookup"><span data-stu-id="3bc57-165">In ASP.NET 2.0 and beyond, the default forms authentication values are hard-coded in the FormsAuthenticationConfiguration class in the .NET Framework.</span></span> <span data-ttu-id="3bc57-166">Alle Änderungen müssen auf Basis von Anwendung in der Datei "Web.config" angewendet werden.</span><span class="sxs-lookup"><span data-stu-id="3bc57-166">Any modifications must be applied on an application-by-application basis in the Web.config file.</span></span> <span data-ttu-id="3bc57-167">Dies unterscheidet sich von ASP.NET 1.x, in dem die Standardwerte der Forms-Authentifizierung in der Datei "Machine.config" gespeichert wurden (und deshalb über das Bearbeiten von "Machine.config" geändert werden).</span><span class="sxs-lookup"><span data-stu-id="3bc57-167">This differs from ASP.NET 1.x, where the default forms authentication values were stored in the machine.config file (and could therefore be modified via editing machine.config).</span></span> <span data-ttu-id="3bc57-168">Zeit für das Thema von ASP.NET 1.x, lohnt es sich, nennen Sie, dass eine Anzahl von den Einstellungen für Formularauthentifizierung System unterschiedliche Standardwerte in ASP.NET 2.0 haben und mehr als in ASP.NET 1.x.</span><span class="sxs-lookup"><span data-stu-id="3bc57-168">While on the topic of ASP.NET 1.x, it is worthwhile to mention that a number of the forms authentication system settings have different default values in ASP.NET 2.0 and beyond than in ASP.NET 1.x.</span></span> <span data-ttu-id="3bc57-169">Wenn Sie Ihre Anwendung von einer ASP.NET 1.x-Umgebung migrieren, ist es wichtig, diese Unterschiede bewusst sein.</span><span class="sxs-lookup"><span data-stu-id="3bc57-169">If you are migrating your application from an ASP.NET 1.x environment, it is important to be aware of these differences.</span></span> <span data-ttu-id="3bc57-170">Wenden Sie sich an [der &lt;Forms&gt; Element technische Dokumentation](https://msdn.microsoft.com/library/1d3t3c61.aspx) eine Liste der Unterschiede.</span><span class="sxs-lookup"><span data-stu-id="3bc57-170">Consult [the &lt;forms&gt; element technical documentation](https://msdn.microsoft.com/library/1d3t3c61.aspx) for a list of the differences.</span></span>

> [!NOTE]
> <span data-ttu-id="3bc57-171">Verschiedene Einstellungen für die Formularauthentifizierung, z. B. Timeout, Domäne und den Pfad, geben Sie Details für das resultierende Ticket Formularauthentifizierungscookies.</span><span class="sxs-lookup"><span data-stu-id="3bc57-171">Several forms authentication settings, such as the timeout, domain, and path, specify details for the resulting forms authentication ticket cookie.</span></span> <span data-ttu-id="3bc57-172">Weitere Informationen auf Cookies, deren Funktionsweise und ihre verschiedenen Eigenschaften lesen [dieses Lernprogramms Cookies](http://www.quirksmode.org/js/cookies.html).</span><span class="sxs-lookup"><span data-stu-id="3bc57-172">For more information on cookies, how they work, and their various properties, read [this Cookies tutorial](http://www.quirksmode.org/js/cookies.html).</span></span>


### <a name="specifying-the-tickets-timeout-value"></a><span data-ttu-id="3bc57-173">Des Tickets-Timeoutwert angeben</span><span class="sxs-lookup"><span data-stu-id="3bc57-173">Specifying the Ticket's Timeout Value</span></span>

<span data-ttu-id="3bc57-174">Das Formularauthentifizierungsticket ist ein Token, das eine Identität darstellt.</span><span class="sxs-lookup"><span data-stu-id="3bc57-174">The forms authentication ticket is a token that represents an identity.</span></span> <span data-ttu-id="3bc57-175">Mit dem Cookie-basierte Authentifizierungstickets dieses Token in Form eines Cookies gespeichert und bei jeder Anforderung an den Webserver gesendet.</span><span class="sxs-lookup"><span data-stu-id="3bc57-175">With cookie-based authentication tickets, this token is held in the form of a cookie and sent to the web server on each request.</span></span> <span data-ttu-id="3bc57-176">Besitz des Tokens, im Wesentlichen wird deklariert, ich bin *Benutzername*, ich bereits angemeldet sind, und wird verwendet, damit der Identität eines Benutzers über die Besuche Seite gespeichert werden kann.</span><span class="sxs-lookup"><span data-stu-id="3bc57-176">Possession of the token, in essence, declares, I am *username*, I have already logged in, and is used so that a user's identity can be remembered across page visits.</span></span>

<span data-ttu-id="3bc57-177">Das Formularauthentifizierungsticket umfasst nicht nur die Identität des Benutzers, sondern enthält auch Informationen, um die Integrität und Sicherheit des Tokens zu gewährleisten.</span><span class="sxs-lookup"><span data-stu-id="3bc57-177">The forms authentication ticket not only includes the user's identity, but also contains information to help ensure the integrity and security of the token.</span></span> <span data-ttu-id="3bc57-178">Nachdem alle soll nicht wir einen böswilligen Benutzer in der Lage, um eine gefälschte Token zu erstellen und ändern ein legitim Token in irgendeiner underhanded sein.</span><span class="sxs-lookup"><span data-stu-id="3bc57-178">After all, we don't want a nefarious user to be able to create a counterfeit token, or to modify a legit token in some underhanded way.</span></span>

<span data-ttu-id="3bc57-179">Ein solcher Bit von Tickets enthalten Informationen eine *Ablauf*, der das Datum und die Uhrzeit, die das Ticket nicht mehr gültig ist ist.</span><span class="sxs-lookup"><span data-stu-id="3bc57-179">One such bit of information included in the ticket is an *expiry*, which is the date and time the ticket is no longer valid.</span></span> <span data-ttu-id="3bc57-180">Jedes Mal die FormsAuthenticationModule ein Authentifizierungsticket untersucht wird sichergestellt, dass das Ticket Ablauf noch nicht überschritten hat.</span><span class="sxs-lookup"><span data-stu-id="3bc57-180">Each time the FormsAuthenticationModule inspects an authentication ticket, it ensures that the ticket's expiry has not yet passed.</span></span> <span data-ttu-id="3bc57-181">Wenn dies der Fall, ignoriert das Ticket und identifiziert den Benutzer als anonyme.</span><span class="sxs-lookup"><span data-stu-id="3bc57-181">If it has, it disregards the ticket and identifies the user as being anonymous.</span></span> <span data-ttu-id="3bc57-182">Diese Schutzmaßnahme schützt vor Replay-Angriffen.</span><span class="sxs-lookup"><span data-stu-id="3bc57-182">This safeguard helps protect against replay attacks.</span></span> <span data-ttu-id="3bc57-183">Ohne ein Ablauf, wenn ein Hacker auf gültige Authentifizierungsticket eines Benutzers - vielleicht erhalten von physischen Zugriff auf ihren Computer verschafft und über ihre Cookies rooting konnte-einer Anforderungs an den Server mit diesem gestohlenen Authentifizierungsticket Versand konnte und Eintrag zu erhalten.</span><span class="sxs-lookup"><span data-stu-id="3bc57-183">Without an expiry, if a hacker was able to get her hands on a user's valid authentication ticket - perhaps by gaining physical access to their computer and rooting through their cookies - they could send a request to the server with this stolen authentication ticket and gain entry.</span></span> <span data-ttu-id="3bc57-184">Während des Ablaufs dieses Szenario verhindern nicht, wird es im Fenster beschränkt, währenddessen ein solcher Angriff erfolgreich ausgeführt werden kann.</span><span class="sxs-lookup"><span data-stu-id="3bc57-184">While the expiry doesn't prevent this scenario, it does limit the window during which such an attack can succeed.</span></span>

> [!NOTE]
> <span data-ttu-id="3bc57-185">Schritt 3 Details zusätzlichen Techniken ebenfalls hilfreich, in dem Forms-Authentifizierungssystem das Authentifizierungsticket geschützt.</span><span class="sxs-lookup"><span data-stu-id="3bc57-185">Step 3 details additional techniques used by the forms authentication system to protect the authentication ticket.</span></span>


<span data-ttu-id="3bc57-186">Wenn Sie das Authentifizierungsticket zu erstellen, bestimmt der Forms-Authentifizierungssystem der ablaufzeitperiode durch consulting Timeouteinstellung.</span><span class="sxs-lookup"><span data-stu-id="3bc57-186">When creating the authentication ticket, the forms authentication system determines its expiry by consulting the timeout setting.</span></span> <span data-ttu-id="3bc57-187">Dies bedeutet, dass es sich bei der ablaufzeitperiode in ein Datum und Uhrzeit in der Zukunft 30 Minuten festgelegt ist, wenn das Formularauthentifizierungsticket erstellt wird, wie in Tabelle 1, das Festlegen von Standardwerten auf 30 Minuten Timeout erwähnt.</span><span class="sxs-lookup"><span data-stu-id="3bc57-187">As noted in Table 1, the timeout setting defaults to 30 minutes, meaning that when the forms authentication ticket is created its expiry is set to a date and time 30 minutes in the future.</span></span>

<span data-ttu-id="3bc57-188">Die Ablaufzeit definiert eine absolute Uhrzeit des Ablaufs das Formularauthentifizierungsticket in der Zukunft.</span><span class="sxs-lookup"><span data-stu-id="3bc57-188">The expiry defines an absolute time in the future when the forms authentication ticket expires.</span></span> <span data-ttu-id="3bc57-189">Aber in der Regel Entwickler möchte eine gleitende Ablaufwert zu implementieren, die zurückgesetzt wird, jedes Mal, wenn der Benutzer die Website erneut ansehen.</span><span class="sxs-lookup"><span data-stu-id="3bc57-189">But usually developers want to implement a sliding expiry, one that is reset every time the user revisits the site.</span></span> <span data-ttu-id="3bc57-190">Dieses Verhalten wird durch die Einstellungen SlidingExpiration bestimmt.</span><span class="sxs-lookup"><span data-stu-id="3bc57-190">This behavior is determined by the slidingExpiration settings.</span></span> <span data-ttu-id="3bc57-191">Wenn auf "true" (Standard), jedes Mal die FormsAuthenticationModule einen Benutzer authentifiziert festgelegt, das Ticket Ablauf aktualisiert.</span><span class="sxs-lookup"><span data-stu-id="3bc57-191">If set to true (the default), each time the FormsAuthenticationModule authenticates a user, it updates the ticket's expiry.</span></span> <span data-ttu-id="3bc57-192">Wenn false wird der Ablauf nicht bei jeder Anforderung aktualisiert wird, erstellt das Ticket abläuft genau Timeout Anzahl von Minuten nach, wann das Ticket wurde und somit verursacht.</span><span class="sxs-lookup"><span data-stu-id="3bc57-192">If set to false, the expiry is not updated on each request, thereby causing the ticket to expire exactly timeout number of minutes past when the ticket was first created.</span></span>

> [!NOTE]
> <span data-ttu-id="3bc57-193">Die Ablaufzeit in das Authentifizierungsticket gespeichert ist, ein absolutes Datum und Zeitwert, z. B. 2 August 2008 11:34 Uhr.</span><span class="sxs-lookup"><span data-stu-id="3bc57-193">The expiry stored in the authentication ticket is an absolute date and time value, like August 2, 2008 11:34 AM.</span></span> <span data-ttu-id="3bc57-194">Darüber hinaus sind das Datum und die Uhrzeit relativ zur Ortszeit des Servers ein.</span><span class="sxs-lookup"><span data-stu-id="3bc57-194">Moreover, the date and time are relative to the web server's local time.</span></span> <span data-ttu-id="3bc57-195">Diesen Entwurf entscheiden kann einige interessante Nebenwirkungen auf Daylight Saving Time (DST) verfügen, wenn Uhren in den Vereinigten Staaten im Voraus eine Stunde (vorausgesetzt, dass der Webserver in einem Gebietsschema gehostet wird, in dem Sommerzeit eingehalten wird) verschoben werden.</span><span class="sxs-lookup"><span data-stu-id="3bc57-195">This design decision can have some interesting side effects around Daylight Saving Time (DST), which is when clocks in the United States are moved ahead one hour (assuming the web server is hosted in a locale where Daylight Saving Time is observed).</span></span> <span data-ttu-id="3bc57-196">Beachten Sie, was für eine ASP.NET-Website mit einer 30 Minuten nach Ablauf der Zeitanzeige passieren würde, die DST beginnt (Hierbei handelt es um 2:00 Uhr).</span><span class="sxs-lookup"><span data-stu-id="3bc57-196">Consider what would happen for an ASP.NET website with a 30 minute expiry near the time that DST begins (which is at 2:00 AM).</span></span> <span data-ttu-id="3bc57-197">Angenommen Sie, ein Besucher mit dem Standort am 11. März 2008 um 1:55 Uhr anmeldet.</span><span class="sxs-lookup"><span data-stu-id="3bc57-197">Imagine a visitor signs on to the site on March 11, 2008 at 1:55 AM.</span></span> <span data-ttu-id="3bc57-198">Dadurch würde ein Formularauthentifizierungsticket generiert, die am 11. März 2008 um 2:25 Uhr (30 Minuten in der Zukunft) abläuft.</span><span class="sxs-lookup"><span data-stu-id="3bc57-198">This would generate a forms authentication ticket that expires at March 11, 2008 at 2:25 AM (30 minutes in the future).</span></span> <span data-ttu-id="3bc57-199">Allerdings nach um 02:00 Uhr führt ein, springt die Uhr um 3:00 Uhr aufgrund DST.</span><span class="sxs-lookup"><span data-stu-id="3bc57-199">However, once 2:00 AM rolls around, the clock jumps to 3:00 AM because of DST.</span></span> <span data-ttu-id="3bc57-200">Wenn der Benutzer eine neue Seite sechs Minuten nach dem Anmelden bei (um 15:01 Uhr) lädt, notiert die FormsAuthenticationModule an, dass das Ticket abgelaufen ist und den Benutzer zur Anmeldeseite leitet.</span><span class="sxs-lookup"><span data-stu-id="3bc57-200">When the user loads a new page six minutes after signing in (at 3:01 AM), the FormsAuthenticationModule notes that the ticket has expired and redirects the user to the login page.</span></span> <span data-ttu-id="3bc57-201">Übernehmen Sie für eine ausführlichere Beschreibung dieser und anderen Authentifizierung Ticket Timeout eigentümlichkeiten, als auch problemumgehungen, eine Kopie des Stefan Schackow *Professional ASP.NET 2.0-Sicherheit, Mitgliedschaft und Rollenverwaltung* (ISBN-Nummer: 978-0-7645-9698-8).</span><span class="sxs-lookup"><span data-stu-id="3bc57-201">For a more thorough discussion on this and other authentication ticket timeout oddities, as well as workarounds, pick up a copy of Stefan Schackow's *Professional ASP.NET 2.0 Security, Membership, and Role Management* (ISBN: 978-0-7645-9698-8).</span></span>


<span data-ttu-id="3bc57-202">Abbildung 1 zeigt den Workflow aus, wenn SlidingExpiration auf "false" festgelegt ist und den Timeout auf 30 festgelegt ist.</span><span class="sxs-lookup"><span data-stu-id="3bc57-202">Figure 1 illustrates the workflow when slidingExpiration is set to false and timeout is set to 30.</span></span> <span data-ttu-id="3bc57-203">Beachten Sie, dass das Authentifizierungsticket, die bei der Anmeldung generiert, das Ablaufdatum enthält und dieser Wert wird bei nachfolgenden Anforderungen nicht aktualisiert.</span><span class="sxs-lookup"><span data-stu-id="3bc57-203">Note that the authentication ticket generated at login contains the expiration date, and this value is not updated on subsequent requests.</span></span> <span data-ttu-id="3bc57-204">Wenn die FormsAuthenticationModule feststellt, dass das Ticket abgelaufen ist, wird diese verworfen und die Anforderung als anonym behandelt.</span><span class="sxs-lookup"><span data-stu-id="3bc57-204">If the FormsAuthenticationModule finds that the ticket has expired, it discards it and treats the request as anonymous.</span></span>


<span data-ttu-id="3bc57-205">[![Eine Grafische Darstellung der das Formularauthentifizierungsticket Ablauf beim SlidingExpiration wird "false"](forms-authentication-configuration-and-advanced-topics-cs/_static/image2.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="3bc57-205">[![A Graphical Representation of the Forms Authentication Ticket's Expiry When slidingExpiration is false](forms-authentication-configuration-and-advanced-topics-cs/_static/image2.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image1.png)</span></span>

<span data-ttu-id="3bc57-206">**Abbildung 01**: eine Grafische Darstellung der das Formularauthentifizierungsticket Ablauf beim SlidingExpiration wird "false" ([klicken Sie hier, um das Bild in voller Größe angezeigt](forms-authentication-configuration-and-advanced-topics-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="3bc57-206">**Figure 01**: A Graphical Representation of the Forms Authentication Ticket's Expiry When slidingExpiration is false([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-cs/_static/image3.png))</span></span>


<span data-ttu-id="3bc57-207">Abbildung 2 zeigt den Workflow aus, wenn SlidingExpiration festgelegt ist, auf "true" und das Timeout auf 30 festgelegt ist.</span><span class="sxs-lookup"><span data-stu-id="3bc57-207">Figure 2 shows the workflow when slidingExpiration is set to true and timeout is set to 30.</span></span> <span data-ttu-id="3bc57-208">Wenn eine authentifizierte Anforderung, (mit einem nicht abgelaufenen Ticket empfangen wird) wird der ablaufzeitperiode Timeout Anzahl der Minuten in der Zukunft aktualisiert.</span><span class="sxs-lookup"><span data-stu-id="3bc57-208">When an authenticated request is received (with a non-expired ticket) its expiry is updated to timeout number of minutes in the future.</span></span>


<span data-ttu-id="3bc57-209">[![Eine Grafische Darstellung der das Formularauthentifizierungsticket SlidingExpiration ist bei "true"](forms-authentication-configuration-and-advanced-topics-cs/_static/image5.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="3bc57-209">[![A Graphical Representation of the Forms Authentication Ticket's When slidingExpiration is true](forms-authentication-configuration-and-advanced-topics-cs/_static/image5.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image4.png)</span></span>

<span data-ttu-id="3bc57-210">**Abbildung 02**: eine Grafische Darstellung der das Formularauthentifizierungsticket SlidingExpiration ist bei "true" ([klicken Sie hier, um das Bild in voller Größe angezeigt](forms-authentication-configuration-and-advanced-topics-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="3bc57-210">**Figure 02**: A Graphical Representation of the Forms Authentication Ticket's When slidingExpiration is true  ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-cs/_static/image6.png))</span></span>


<span data-ttu-id="3bc57-211">Bei Verwendung von Cookie-basierte Authentifizierungstickets (Standard) wird in dieser Diskussion etwas verwirrend, da Cookies auch ihre eigenen Cacheobjekte angegeben haben, können.</span><span class="sxs-lookup"><span data-stu-id="3bc57-211">When using cookie-based authentication tickets (the default), this discussion becomes a little more confusing because cookies can also have their own expiries specified.</span></span> <span data-ttu-id="3bc57-212">Ein Cookie-Ablauf (oder fehlen) der Browser angewiesen, wenn das Cookie zerstört werden soll.</span><span class="sxs-lookup"><span data-stu-id="3bc57-212">A cookie's expiry (or lack thereof) instructs the browser when the cookie should be destroyed.</span></span> <span data-ttu-id="3bc57-213">Wenn das Cookie nicht über einem Ablaufwert verfügt, ist es zerstört, wenn der Browser geschlossen.</span><span class="sxs-lookup"><span data-stu-id="3bc57-213">If the cookie lacks an expiry, it is destroyed when the browser shuts down.</span></span> <span data-ttu-id="3bc57-214">Wenn einem Ablaufwert vorhanden ist, jedoch das Cookie bleibt bis zum Ablaufdatum auf dem Computer des Benutzers gespeichert und im Ablauf angegebenen Zeit vergangen.</span><span class="sxs-lookup"><span data-stu-id="3bc57-214">If an expiry is present, however, the cookie remains stored on the user's computer until the date and time specified in the expiry has passed.</span></span> <span data-ttu-id="3bc57-215">Wenn Cookies vom Browser zerstört wird, wird er nicht mehr an den Webserver gesendet.</span><span class="sxs-lookup"><span data-stu-id="3bc57-215">When a cookie is destroyed by the browser, it is no longer sent to the web server.</span></span> <span data-ttu-id="3bc57-216">Aus diesem Grund ist die Zerstörung eines Cookies analog für den Benutzer aus der Website anmelden.</span><span class="sxs-lookup"><span data-stu-id="3bc57-216">Therefore, the destruction of a cookie is analogous to the user logging out of the site.</span></span>

> [!NOTE]
> <span data-ttu-id="3bc57-217">Natürlich kann ein Benutzer Cookies auf ihrem Computer gespeichert proaktiv entfernen.</span><span class="sxs-lookup"><span data-stu-id="3bc57-217">Of course, a user may proactively remove any cookies stored on their computer.</span></span> <span data-ttu-id="3bc57-218">In Internet Explorer 7 würden Sie wechseln Sie zu Extras, Optionen, und klicken Sie auf die Schaltfläche "löschen" im Bereich Verlauf durchsuchen.</span><span class="sxs-lookup"><span data-stu-id="3bc57-218">In Internet Explorer 7, you would go to Tools, Options, and click the Delete button in the Browsing history section.</span></span> <span data-ttu-id="3bc57-219">Klicken Sie dort auf die Schaltfläche zum Löschen von Cookies.</span><span class="sxs-lookup"><span data-stu-id="3bc57-219">From there, click the Delete cookies button.</span></span>


<span data-ttu-id="3bc57-220">Der Forms-Authentifizierungssystem erstellt sitzungsbasierte oder Ablauf-basierten Cookies je nach dem Wert, der zum Übergeben der *PersistCookie* Parameter.</span><span class="sxs-lookup"><span data-stu-id="3bc57-220">The forms authentication system creates session-based or expiry-based cookies depending on the value passed in to the *persistCookie* parameter.</span></span> <span data-ttu-id="3bc57-221">Wie bereits erwähnt, mit denen das FormsAuthentication-Klasse, GetAuthCookie SetAuthCookie und RedirectFromLoginPage Methoden in zwei Eingabeparameter: *Benutzername* und *PersistCookie*.</span><span class="sxs-lookup"><span data-stu-id="3bc57-221">Recall that the FormsAuthentication class's GetAuthCookie, SetAuthCookie, and RedirectFromLoginPage methods take in two input parameters: *username* and *persistCookie*.</span></span> <span data-ttu-id="3bc57-222">Die Anmeldeseite in dem vorherigen Lernprogramm erstellten enthalten ein Anmeldedaten Kontrollkästchen, der bestimmt, ob ein permanentes Cookie erstellt wurde.</span><span class="sxs-lookup"><span data-stu-id="3bc57-222">The login page we created in the preceding tutorial included a Remember me CheckBox, which determined whether a persistent cookie was created.</span></span> <span data-ttu-id="3bc57-223">Permanente Cookies sind Ablauf-basiert. nicht persistenter Cookies sind sitzungsbasiert.</span><span class="sxs-lookup"><span data-stu-id="3bc57-223">Persistent cookies are expiry-based; non-persistent cookies are session-based.</span></span>

<span data-ttu-id="3bc57-224">Bereits vorgestellten Konzepte Timeout und SlidingExpiration gelten die gleiche für beide und Ablauf-sitzungsbasierte Cookies.</span><span class="sxs-lookup"><span data-stu-id="3bc57-224">The timeout and slidingExpiration concepts already discussed apply the same to both session- and expiry-based cookies.</span></span> <span data-ttu-id="3bc57-225">Es ist nur ein geringfügiger Unterschied bei der Ausführung: bei Ablauf-basierte Cookies mit SlidingTimeout auf "true" festgelegt ist Ablaufdatum für das Cookie wird nur aktualisiert, wenn mehr als die Hälfte der angegebenen Zeit abgelaufen.</span><span class="sxs-lookup"><span data-stu-id="3bc57-225">There is only one minor difference in execution: when using expiry-based cookies with slidingTimeout set to true, the cookie's expiry is only updated when more than half of the specified time has elapsed.</span></span>

<span data-ttu-id="3bc57-226">Wir aktualisieren unsere Website Authentifizierungsrichtlinien Ticket Timeout damit, das Timeout nach einer Stunde (60 Minuten), verwenden eine gleitende Ablaufzeit tickets.</span><span class="sxs-lookup"><span data-stu-id="3bc57-226">Let's update our website's authentication ticket timeout policies so that tickets timeout after one hour (60 minutes), using a sliding expiration.</span></span> <span data-ttu-id="3bc57-227">Diese Änderung wirksam, aktualisieren Sie die Datei "Web.config" Hinzufügen einer &lt;Forms&gt; Element an der &lt;Authentifizierung&gt; Element durch das folgende Markup:</span><span class="sxs-lookup"><span data-stu-id="3bc57-227">To effect this change, update the Web.config file, adding a &lt;forms&gt; element to the &lt;authentication&gt; element with the following markup:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample2.xml)]

### <a name="using-an-login-page-url-other-than-loginaspx"></a><span data-ttu-id="3bc57-228">Verwenden eine URL für die Anmeldeseite als "Login.aspx"</span><span class="sxs-lookup"><span data-stu-id="3bc57-228">Using an Login Page URL Other than Login.aspx</span></span>

<span data-ttu-id="3bc57-229">Da die FormsAuthenticationModule nicht autorisierte Benutzer automatisch zur Anmeldeseite umgeleitet, muss der Anmeldeseite-URL kennen.</span><span class="sxs-lookup"><span data-stu-id="3bc57-229">Since the FormsAuthenticationModule automatically redirects unauthorized users to the login page, it needs to know the login page's URL.</span></span> <span data-ttu-id="3bc57-230">Diese URL wird angegeben, indem das Attribut "LoginUrl" in der &lt;Forms&gt; Element und der Standardwert ist "Login.aspx".</span><span class="sxs-lookup"><span data-stu-id="3bc57-230">This URL is specified by the loginUrl attribute in the &lt;forms&gt; element and defaults to login.aspx.</span></span> <span data-ttu-id="3bc57-231">Wenn Sie über eine vorhandene Website portieren, möglicherweise verfügen Sie bereits eine Anmeldeseite mit einer anderen URL, eine, die bereits mit einem Lesezeichen versehene und von Suchmaschinen indiziert wurden.</span><span class="sxs-lookup"><span data-stu-id="3bc57-231">If you are porting over an existing website, you may already have a login page with a different URL, one that has already been bookmarked and indexed by search engines.</span></span> <span data-ttu-id="3bc57-232">Anstelle die vorhandenen Anmeldeseite an "Login.aspx" umbenennen und wichtige Links und Lesezeichen, Benutzer, können Sie stattdessen die LoginUrl Attribut auf der Anmeldeseite ändern.</span><span class="sxs-lookup"><span data-stu-id="3bc57-232">Rather than renaming your existing login page to login.aspx and breaking links and users' bookmarks, you can instead modify the loginUrl attribute to point to your login page.</span></span>

<span data-ttu-id="3bc57-233">Beispielsweise, wenn Ihre Anmeldeseite SignIn.aspx benannt wurde, befand sich im Verzeichnis Benutzer Sie konnte zeigen die Konfigurationseinstellung LoginUrl ~/Users/SignIn.aspx wie folgt:</span><span class="sxs-lookup"><span data-stu-id="3bc57-233">For example, if your login page was named SignIn.aspx and was located in the Users directory, you could point the loginUrl configuration setting to ~/Users/SignIn.aspx like so:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample3.xml)]

<span data-ttu-id="3bc57-234">Da die aktuelle Anwendung bereits eine Anmeldeseite mit dem Namen "Login.aspx" aufweist, besteht keine Notwendigkeit, geben Sie einen benutzerdefinierten Wert in der &lt;Forms&gt; Element.</span><span class="sxs-lookup"><span data-stu-id="3bc57-234">Since our current application already has a login page named Login.aspx, there's no need to specify a custom value in the &lt;forms&gt; element.</span></span>

## <a name="step-2-using-cookieless-forms-authentication-tickets"></a><span data-ttu-id="3bc57-235">Schritt 2: Verwenden von Cookieless Formularauthentifizierungstickets</span><span class="sxs-lookup"><span data-stu-id="3bc57-235">Step 2: Using Cookieless Forms Authentication Tickets</span></span>

<span data-ttu-id="3bc57-236">Standardmäßig bestimmt der Forms-Authentifizierungssystem, ob die Authentifizierungstickets in der Auflistung der Cookies zu speichern oder diese in der URL, die basierend auf der Website für den Benutzer-Agent einbetten.</span><span class="sxs-lookup"><span data-stu-id="3bc57-236">By default the forms authentication system determines whether to store its authentication tickets in the cookies collection or embed them in the URL based on the user agent visiting the site.</span></span> <span data-ttu-id="3bc57-237">Alle grundlegenden Desktopbrowsern wie Internet Explorer, Firefox, Opera und Safari unterstützt Cookies, doch nicht alle mobilen Geräte führen.</span><span class="sxs-lookup"><span data-stu-id="3bc57-237">All mainstream desktop browsers like Internet Explorer, Firefox, Opera, and Safari, support cookies, but not all mobile devices do.</span></span>

<span data-ttu-id="3bc57-238">Die Cookierichtlinie verwendet wird, von dem Authentifizierungssystem Forms hängt von der cookieless Einstellung in der &lt;Forms&gt; -Element, das einen von vier Werten zugewiesen werden kann:</span><span class="sxs-lookup"><span data-stu-id="3bc57-238">The cookie policy used by the forms authentication system depends on the cookieless setting in the &lt;forms&gt; element, which can be assigned one of four values:</span></span>

- <span data-ttu-id="3bc57-239">UseCookies - gibt an, dass die Cookie-basierte Authentifizierungstickets immer verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="3bc57-239">UseCookies - specifies that cookie-based authentication tickets will always be used.</span></span>
- <span data-ttu-id="3bc57-240">UseUri - gibt an, dass die Cookie-basierte Authentifizierungstickets nie verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="3bc57-240">UseUri - indicates that cookie-based authentication tickets will never be used.</span></span>
- <span data-ttu-id="3bc57-241">AutoErmittlung – Wenn das Geräteprofil Cookies, Cookie-basierte Authentifizierungstickets nicht unterstützt werden nicht verwendet. Wenn das Geräteprofil Cookies unterstützt, wird ein Überprüfungsmechanismus verwendet, um festzustellen, ob Cookies aktiviert sind.</span><span class="sxs-lookup"><span data-stu-id="3bc57-241">AutoDetect - if the device profile does not support cookies, cookie-based authentication tickets are not used; if the device profile supports cookies, a probing mechanism is used to determine if cookies are enabled.</span></span>
- <span data-ttu-id="3bc57-242">UseDeviceProfile - die Standardeinstellung; Cookie-basierte Authentifizierungstickets verwendet, nur, wenn das Geräteprofil Cookies unterstützt.</span><span class="sxs-lookup"><span data-stu-id="3bc57-242">UseDeviceProfile - the default; uses cookie-based authentication tickets only if the device profile supports cookies.</span></span> <span data-ttu-id="3bc57-243">Keine Rückschlüsse auf eventuelle Mechanismus nicht verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="3bc57-243">No probing mechanism is used.</span></span>

<span data-ttu-id="3bc57-244">Einstellungen für die automatische Erkennung und UseDeviceProfile basieren auf einer *Geräteprofil* Punkte, ob Cookie-basierte oder cookieless Authentifizierungstickets verwendet.</span><span class="sxs-lookup"><span data-stu-id="3bc57-244">The AutoDetect and UseDeviceProfile settings rely on a *device profile* in ascertaining whether to use cookie-based or cookieless authentication tickets.</span></span> <span data-ttu-id="3bc57-245">ASP.NET verwaltet eine Datenbank von verschiedenen Geräten und ihre Funktionen, z. B., ob sie Cookies unterstützen, welche Version von JavaScript unterstützen und So weiter.</span><span class="sxs-lookup"><span data-stu-id="3bc57-245">ASP.NET maintains a database of various devices and their capabilities, such as whether they support cookies, what version of JavaScript they support, and so on.</span></span> <span data-ttu-id="3bc57-246">Jedes Mal fordert ein Gerät von einem Webserver, er entlang sendet, einer Webseite ein *Benutzer-Agent-* HTTP-Header, der den Gerätetyp identifiziert.</span><span class="sxs-lookup"><span data-stu-id="3bc57-246">Each time a device requests a web page from a web server it sends along a *user-agent* HTTP header that identifies the device type.</span></span> <span data-ttu-id="3bc57-247">ASP.NET entspricht automatisch die angegebenen Benutzer-Agent-Zeichenfolge mit dem entsprechenden Profil in der Datenbank angegeben.</span><span class="sxs-lookup"><span data-stu-id="3bc57-247">ASP.NET automatically matches the supplied user-agent string with the corresponding profile specified in its database.</span></span>

> [!NOTE]
> <span data-ttu-id="3bc57-248">Diese Datenbank von Gerätefunktionen befindet sich in einer Reihe von XML-Dateien, die Folgen der [Browserdefinitionsdatei Schema](https://msdn.microsoft.com/library/ms228122.aspx).</span><span class="sxs-lookup"><span data-stu-id="3bc57-248">This database of device capabilities is stored in a number of XML files that adhere to the [Browser Definition File schema](https://msdn.microsoft.com/library/ms228122.aspx).</span></span> <span data-ttu-id="3bc57-249">Die Standardeinstellung Gerät Profildateien befinden sich in % WINDIR%\Microsoft.Net\Framework\v2.0.50727\CONFIG\Browsers.</span><span class="sxs-lookup"><span data-stu-id="3bc57-249">The default device profile files are located in %WINDIR%\Microsoft.Net\Framework\v2.0.50727\CONFIG\Browsers.</span></span> <span data-ttu-id="3bc57-250">Sie können auch benutzerdefinierte Dateien hinzufügen, um Ihre Anwendung App\_Browsern-Ordner.</span><span class="sxs-lookup"><span data-stu-id="3bc57-250">You can also add custom files to your application's App\_Browsers folder.</span></span> <span data-ttu-id="3bc57-251">Weitere Informationen finden Sie unter [Vorgehensweise: Erkennen von Browsertypen in ASP.NET Web Pages](https://msdn.microsoft.com/library/3yekbd5b.aspx).</span><span class="sxs-lookup"><span data-stu-id="3bc57-251">For more information, see [How To: Detect Browser Types in ASP.NET Web Pages](https://msdn.microsoft.com/library/3yekbd5b.aspx).</span></span>


<span data-ttu-id="3bc57-252">Da die Standardeinstellung UseDeviceProfile ist, werden cookieless Formularauthentifizierungstickets verwendet werden, bei die Website von einem Gerät zugegriffen wird, deren Profil meldet, dass es keine Cookies unterstützt.</span><span class="sxs-lookup"><span data-stu-id="3bc57-252">Because the default setting is UseDeviceProfile, cookieless forms authentication tickets will be used when the site is visited by a device whose profile reports that it does not support cookies.</span></span>

### <a name="encoding-the-authentication-ticket-in-the-url"></a><span data-ttu-id="3bc57-253">Das Authentifizierungsticket in der URL-Codierung</span><span class="sxs-lookup"><span data-stu-id="3bc57-253">Encoding the Authentication Ticket in the URL</span></span>

<span data-ttu-id="3bc57-254">Cookies sind eine natürliche "Mittel" für einschließlich Informationen über den Browser in jede Anforderung an eine bestimmte Website, die ist, warum die Formulare standardauthentifizierungseinstellungen Cookies verwendet werden, wenn das Gerät über unterstützt.</span><span class="sxs-lookup"><span data-stu-id="3bc57-254">Cookies are a natural medium for including information from the browser in each request to a particular website, which is why the default forms authentication settings use cookies if the visiting device supports them.</span></span> <span data-ttu-id="3bc57-255">Wenn Cookies nicht unterstützt werden, müssen ein alternativen Verfahren für die Übergabe von des Authentifizierungstickets vom Client an den Server verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="3bc57-255">If cookies are not supported, an alternate means for passing the authentication ticket from the client to the server must be employed.</span></span> <span data-ttu-id="3bc57-256">Eine häufig verwendete problemumgehung in Umgebungen ohne Cookies verwendet wird um die Cookiedaten in der URL zu codieren.</span><span class="sxs-lookup"><span data-stu-id="3bc57-256">A common workaround used in cookieless environments is to encode the cookie data in the URL.</span></span>

<span data-ttu-id="3bc57-257">Die beste Möglichkeit, um festzustellen, wie solche Informationen in die URL eingebettet werden kann, ist cookieless Authentifizierungstickets Nutzung zu erzwingen.</span><span class="sxs-lookup"><span data-stu-id="3bc57-257">The best way to see how such information can be embedded within the URL is to force the site to use cookieless authentication tickets.</span></span> <span data-ttu-id="3bc57-258">Dies kann durch die cookieless Konfigurationseinstellung auf UseUri erfolgen:</span><span class="sxs-lookup"><span data-stu-id="3bc57-258">This can be accomplished by setting the cookieless configuration setting to UseUri:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample4.xml)]

<span data-ttu-id="3bc57-259">Nachdem Sie diese Änderung vorgenommen haben, besuchen Sie die Website über einen Browser aus.</span><span class="sxs-lookup"><span data-stu-id="3bc57-259">Once you have made this change, visit the site through a browser.</span></span> <span data-ttu-id="3bc57-260">Wenn als anonymer Benutzer besuchen, sieht die URLs, genau wie vor funktionsfähig.</span><span class="sxs-lookup"><span data-stu-id="3bc57-260">When visiting as an anonymous user, the URLs will look exactly like they did before.</span></span> <span data-ttu-id="3bc57-261">Zeigt z. B. beim Besuch der Seite "default.aspx" Adressleiste des Browsers die folgende URL:</span><span class="sxs-lookup"><span data-stu-id="3bc57-261">For example, when visiting Default.aspx page my browser's address bar shows the following URL:</span></span>

`http://localhost:2448/ASPNET\_Security\_Tutorial\_03\_CS/default.aspx`

<span data-ttu-id="3bc57-262">Allerdings wird nach der Anmeldung das Formularauthentifizierungsticket in die URL eingebettet ist.</span><span class="sxs-lookup"><span data-stu-id="3bc57-262">However, upon logging in, the forms authentication ticket is embedded into the URL.</span></span> <span data-ttu-id="3bc57-263">Z. B. nach dem Zugriff auf die Anmeldeseite und als Sam anmelden, ich bin auf der Seite "default.aspx" zurückgegeben, aber die URL diesmal ist:</span><span class="sxs-lookup"><span data-stu-id="3bc57-263">For example, after visiting the login page and logging in as Sam, I am returned to the Default.aspx page, but the URL this time is:</span></span>

`http://localhost:2448/ASPNET\_Security\_Tutorial\_03\_CS/(F(jaIOIDTJxIr12xYS-VVgkqKCVAuIoW30Bu0diWi6flQC-FyMaLXJfow\_Vd9GZkB2Cv-rfezq0gKadKX0YPZCkA2))/default.aspx`

<span data-ttu-id="3bc57-264">Das Formularauthentifizierungsticket wurde in die URL eingebettet.</span><span class="sxs-lookup"><span data-stu-id="3bc57-264">The forms authentication ticket has been embedded within the URL.</span></span> <span data-ttu-id="3bc57-265">Die Zeichenfolge (F (jaIOIDTJxIr12xYS-VVgkqKCVAuIoW30Bu0diWi6flQC-FyMaLXJfow\_Vd9GZkB2Cv rfezq0gKadKX0YPZCkA2) stellt den Hexadezimal codierten Ticket Authentifizierungsinformationen dar und sind die gleichen Daten, die in der Regel in einem Cookie gespeichert ist.</span><span class="sxs-lookup"><span data-stu-id="3bc57-265">The string (F(jaIOIDTJxIr12xYS-VVgkqKCVAuIoW30Bu0diWi6flQC-FyMaLXJfow\_Vd9GZkB2Cv-rfezq0gKadKX0YPZCkA2) represents the hex-encoded authentication ticket information, and is the same data that is usually stored within a cookie.</span></span>

<span data-ttu-id="3bc57-266">Damit cookieless Authentifizierungstickets arbeiten kann das System muss alle URLs auf der Seite auf Einbeziehung die Authentifizierungsticketdaten codieren, andernfalls das Authentifizierungsticket geht verloren, wenn der Benutzer auf einen Link klickt.</span><span class="sxs-lookup"><span data-stu-id="3bc57-266">In order for cookieless authentication tickets to work, the system must encode all URLs on the page to include the authentication ticket data, otherwise the authentication ticket will be lost when the user clicks on a link.</span></span> <span data-ttu-id="3bc57-267">Glücklicherweise wird diese Einbetten von Logik automatisch ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="3bc57-267">Thankfully, this embedding logic is performed automatically.</span></span> <span data-ttu-id="3bc57-268">Um diese Funktion zu zeigen, öffnen Sie die Seite "default.aspx", und fügen Sie ein Linksteuerelement bzw. Eigenschaften Text und NavigateUrl Testlink und SomePage.aspx, festlegen.</span><span class="sxs-lookup"><span data-stu-id="3bc57-268">To demonstrate this functionality, open the Default.aspx page and add a HyperLink control, setting its Text and NavigateUrl properties to Test Link and SomePage.aspx, respectively.</span></span> <span data-ttu-id="3bc57-269">Es spielt keine Rolle, dass es eine Seite im Projekt mit dem Namen SomePage.aspx nicht.</span><span class="sxs-lookup"><span data-stu-id="3bc57-269">It doesn't matter that there really isn't a page in our project named SomePage.aspx.</span></span>

<span data-ttu-id="3bc57-270">Speichern Sie die Änderungen in "default.aspx", und besuchen sie dann über einen Browser.</span><span class="sxs-lookup"><span data-stu-id="3bc57-270">Save the changes to Default.aspx and then visit it through a browser.</span></span> <span data-ttu-id="3bc57-271">Melden Sie sich an den Standort so, dass das Formularauthentifizierungsticket in die URL eingebettet ist.</span><span class="sxs-lookup"><span data-stu-id="3bc57-271">Log on to the site so that the forms authentication ticket is embedded in the URL.</span></span> <span data-ttu-id="3bc57-272">Als Nächstes "default.aspx", klicken Sie auf den Link Link testen.</span><span class="sxs-lookup"><span data-stu-id="3bc57-272">Next, from Default.aspx, click the Test Link link.</span></span> <span data-ttu-id="3bc57-273">Was ist passiert?</span><span class="sxs-lookup"><span data-stu-id="3bc57-273">What happened?</span></span> <span data-ttu-id="3bc57-274">Wenn keine Seite mit dem Namen SomePage.aspx vorhanden ist, klicken Sie dann einen 404-Fehler ist aufgetreten, aber ist nicht wichtig hier.</span><span class="sxs-lookup"><span data-stu-id="3bc57-274">If no page named SomePage.aspx exists, then a 404 error occurred, but that's not what's important here.</span></span> <span data-ttu-id="3bc57-275">Konzentrieren Sie stattdessen die Adressleiste in Ihrem Browser.</span><span class="sxs-lookup"><span data-stu-id="3bc57-275">Instead, focus on the Address bar in your browser.</span></span> <span data-ttu-id="3bc57-276">Beachten Sie, dass sie das Formularauthentifizierungsticket in der URL enthalten.</span><span class="sxs-lookup"><span data-stu-id="3bc57-276">Note that it includes the forms authentication ticket in the URL!</span></span>

`http://localhost:2448/ASPNET\_Security\_Tutorial\_03\_CS/(F(jaIOIDTJxIr12xYS-VVgkqKCVAuIoW30Bu0diWi6flQC-FyMaLXJfow\_Vd9GZkB2Cv-rfezq0gKadKX0YPZCkA2))/SomePage.aspx`

<span data-ttu-id="3bc57-277">Die URL SomePage.aspx unter folgendem Link automatisch in eine URL konvertiert wurde, die das Authentifizierungsticket - enthalten haben nicht, müssen Sie jeglichen Code schreiben!</span><span class="sxs-lookup"><span data-stu-id="3bc57-277">The URL SomePage.aspx in the link was automatically converted into a URL that included the authentication ticket - we didn't have to write a lick of code!</span></span> <span data-ttu-id="3bc57-278">Das Authentifizierungsticket Formular wird automatisch in die URL für alle Links, die nicht mit http:// beginnen eingebettet werden oder /.</span><span class="sxs-lookup"><span data-stu-id="3bc57-278">The form authentication ticket will automatically be embedded in the URL for any hyperlinks that do not start with http:// or /.</span></span> <span data-ttu-id="3bc57-279">Es spielt keine Rolle, wenn der Link angezeigt, in einem Aufruf von Response.Redirect, in einem Linksteuerelement oder in ein HTML-Ankerelement wird (d. h. &lt;eine Href = "..."&gt;... &lt;/a&gt;).</span><span class="sxs-lookup"><span data-stu-id="3bc57-279">It doesn't matter if the hyperlink appears in a call to Response.Redirect, in a HyperLink control, or in an anchor HTML element (i.e., &lt;a href="..."&gt;...&lt;/a&gt;).</span></span> <span data-ttu-id="3bc57-280">Solange die URL ist nicht, etwa http://www.someserver.com/SomePage.aspx oder /SomePage.aspx, die Formulare Authentifizierungsticket für uns eingebettet werden wird.</span><span class="sxs-lookup"><span data-stu-id="3bc57-280">As long as the URL isn't something like http://www.someserver.com/SomePage.aspx or /SomePage.aspx, the forms authentication ticket will be embedded for us.</span></span>

> [!NOTE]
> <span data-ttu-id="3bc57-281">Cookieless Formularauthentifizierungstickets entsprechen, auf die gleiche Timeout Richtlinien als Cookie-basierte Authentifizierungstickets.</span><span class="sxs-lookup"><span data-stu-id="3bc57-281">Cookieless forms authentication tickets adhere to the same timeout policies as cookie-based authentication tickets.</span></span> <span data-ttu-id="3bc57-282">Es gibt jedoch cookieless Authentifizierungstickets mehr anfällig für replay-Angriffe, da das Authentifizierungsticket direkt in die URL eingebettet ist.</span><span class="sxs-lookup"><span data-stu-id="3bc57-282">However, cookieless authentication tickets are more prone to replay attacks since the authentication ticket is embedded directly in the URL.</span></span> <span data-ttu-id="3bc57-283">Angenommen Sie, ein Benutzer eine Website aufruft, anmeldet und fügt dann die URL in eine e-Mail an einen Kollegen aufzuheben.</span><span class="sxs-lookup"><span data-stu-id="3bc57-283">Imagine a user who visits a website, logs in, and then pastes the URL in an email to a colleague.</span></span> <span data-ttu-id="3bc57-284">Wenn der Kollege auf diesen Link klickt, bevor die Ablaufzeit erreicht ist, werden sie als Benutzer angemeldet, die die e-Mail zugesandt!</span><span class="sxs-lookup"><span data-stu-id="3bc57-284">If the colleague clicks on that link before the expiry is reached, they will be logged in as the user who sent the email!</span></span>


## <a name="step-3-securing-the-authentication-ticket"></a><span data-ttu-id="3bc57-285">Schritt 3: Sichern der das Authentifizierungsticket</span><span class="sxs-lookup"><span data-stu-id="3bc57-285">Step 3: Securing the Authentication Ticket</span></span>

<span data-ttu-id="3bc57-286">Das Formularauthentifizierungsticket wird unverschlüsselt übertragen entweder in einem Cookie oder direkt in die URL eingebettet.</span><span class="sxs-lookup"><span data-stu-id="3bc57-286">The forms authentication ticket is transmitted over the wire either in a cookie or embedded directly within the URL.</span></span> <span data-ttu-id="3bc57-287">Zusätzlich zu den Informationen zur Dienstidentität zählen das Authentifizierungsticket auch Benutzerdaten, (wie wir in Schritt 4 angezeigt werden).</span><span class="sxs-lookup"><span data-stu-id="3bc57-287">In addition to identity information, the authentication ticket can also include user data (as we will see in Step 4).</span></span> <span data-ttu-id="3bc57-288">Daher ist es wichtig, dass das Ticket Daten verschlüsselt werden von neugierige und (noch wichtiger), die das Forms-Authentifizierungssystem kann zu gewährleisten, dass das Ticket nicht manipuliert wurde.</span><span class="sxs-lookup"><span data-stu-id="3bc57-288">Consequently, it is important that the ticket's data is encrypted from prying eyes and (even more importantly) that the forms authentication system can guarantee that the ticket was not tampered with.</span></span>

<span data-ttu-id="3bc57-289">Um den Datenschutz von Daten für das Ticket zu gewährleisten, kann die Formulare Authentifizierungssystem Ticketdaten verschlüsseln.</span><span class="sxs-lookup"><span data-stu-id="3bc57-289">To ensure the privacy of the ticket's data, the forms authentication system can encrypt the ticket data.</span></span> <span data-ttu-id="3bc57-290">Fehler beim Verschlüsseln der Ticketdaten sendet potenziell vertraulichen Informationen über die Verbindung im nur-Text.</span><span class="sxs-lookup"><span data-stu-id="3bc57-290">Failure to encrypt the ticket data sends potentially sensitive information over the wire in plain-text.</span></span>

<span data-ttu-id="3bc57-291">Um ein Ticket Authentizität zu gewährleisten, muss der Forms-Authentifizierungssystem *überprüfen* des Tickets.</span><span class="sxs-lookup"><span data-stu-id="3bc57-291">To guarantee a ticket's authenticity, the forms authentication system must *validate* the ticket.</span></span> <span data-ttu-id="3bc57-292">Überprüfung dient die sicherstellen, dass ein bestimmtes Datenelement nicht geändert wurde, erfolgt über eine * [message Authentication Code (MAC)](http://en.wikipedia.org/wiki/Message_authentication_code)*.</span><span class="sxs-lookup"><span data-stu-id="3bc57-292">Validation is the act of ensuring that a particular piece of data has not been modified, and is accomplished via a *[message authentication code (MAC)](http://en.wikipedia.org/wiki/Message_authentication_code)*.</span></span> <span data-ttu-id="3bc57-293">Kurz gesagt, ist die MAC ein kleiner Teil der Informationen, die die Daten zu, die identifizieren (in diesem Fall das Ticket) überprüft werden muss.</span><span class="sxs-lookup"><span data-stu-id="3bc57-293">In a nutshell, the MAC is a small piece of information that identifies the data that needs to be validated (in this case, the ticket).</span></span> <span data-ttu-id="3bc57-294">Wenn die durch den MAC dargestellten Daten, geändert werden und klicken Sie dann die Mac- und die Daten nicht übereinstimmen.</span><span class="sxs-lookup"><span data-stu-id="3bc57-294">If the data represented by the MAC is modified, then the MAC and the data will not match up.</span></span> <span data-ttu-id="3bc57-295">Darüber hinaus ist es rechnerisch schwierig, Zugriff auf die Daten ändern, sowohl generieren seine eigenen MAC, um die geänderten Daten entsprechen.</span><span class="sxs-lookup"><span data-stu-id="3bc57-295">Moreover, it is computationally hard for a hacker to both modify the data and generate his own MAC to correspond with the modified data.</span></span>

<span data-ttu-id="3bc57-296">Beim Erstellen von (oder Ändern von) wird ein Ticket, das Forms-Authentifizierungssystem einen MAC erstellt und fügt ihn das Ticket Daten.</span><span class="sxs-lookup"><span data-stu-id="3bc57-296">When creating (or modifying) a ticket, the forms authentication system creates a MAC and attaches it to the ticket's data.</span></span> <span data-ttu-id="3bc57-297">Wenn eine nachfolgende Anforderung eingeht, vergleicht der Forms-Authentifizierungssystem die Mac- und Ticket-Daten, um die Echtheit des Ticketdaten überprüfen.</span><span class="sxs-lookup"><span data-stu-id="3bc57-297">When a subsequent request arrives, the forms authentication system compares the MAC and ticket data to validate the authenticity of the ticket data.</span></span> <span data-ttu-id="3bc57-298">Abbildung 3 wird dieser Workflow grafisch dargestellt.</span><span class="sxs-lookup"><span data-stu-id="3bc57-298">Figure 3 illustrates this workflow graphically.</span></span>


<span data-ttu-id="3bc57-299">[![Das Ticket Authentizität gewährleistet ist über einen MAC](forms-authentication-configuration-and-advanced-topics-cs/_static/image8.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="3bc57-299">[![The Ticket's Authenticity is Ensured through a MAC](forms-authentication-configuration-and-advanced-topics-cs/_static/image8.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image7.png)</span></span>

<span data-ttu-id="3bc57-300">**Abbildung 03**: The Ticket Authentizität gewährleistet ist, über einen MAC ([klicken Sie hier, um das Bild in voller Größe angezeigt](forms-authentication-configuration-and-advanced-topics-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="3bc57-300">**Figure 03**: The Ticket's Authenticity is Ensured through a MAC ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-cs/_static/image9.png))</span></span>


<span data-ttu-id="3bc57-301">Welche Maßnahmen auf das Authentifizierungsticket angewendet werden, hängt davon ab, die Einstellung für den Schutz in der &lt;Forms&gt; Element.</span><span class="sxs-lookup"><span data-stu-id="3bc57-301">What security measures are applied to the authentication ticket depends on the protection setting in the &lt;forms&gt; element.</span></span> <span data-ttu-id="3bc57-302">Die schutzeinstellung kann einen der folgenden drei Werte zugewiesen werden:</span><span class="sxs-lookup"><span data-stu-id="3bc57-302">The protection setting may be assigned to one of the following three values:</span></span>

- <span data-ttu-id="3bc57-303">Alle - das Ticket ist verschlüsselt und signiert (Standard).</span><span class="sxs-lookup"><span data-stu-id="3bc57-303">All - the ticket is both encrypted and digitally signed (the default).</span></span>
- <span data-ttu-id="3bc57-304">Verschlüsselung – nur die Verschlüsselung wird angewendet: keine MAC wird generiert.</span><span class="sxs-lookup"><span data-stu-id="3bc57-304">Encryption - only encryption is applied - no MAC is generated.</span></span>
- <span data-ttu-id="3bc57-305">None: das Ticket ist also weder verschlüsselt noch signiert.</span><span class="sxs-lookup"><span data-stu-id="3bc57-305">None - the ticket is neither encrypted nor digitally signed.</span></span>
- <span data-ttu-id="3bc57-306">Überprüfung - einem MAC ist generiert, aber die Ticketdaten über die Verbindung im nur-Text gesendet werden.</span><span class="sxs-lookup"><span data-stu-id="3bc57-306">Validation - a MAC is generated, but the ticket data is sent over the wire in plain-text.</span></span>

<span data-ttu-id="3bc57-307">Microsoft empfiehlt dringend, über die Einstellung "alle".</span><span class="sxs-lookup"><span data-stu-id="3bc57-307">Microsoft strongly recommends using the All setting.</span></span>

### <a name="setting-the-validation-and-decryption-keys"></a><span data-ttu-id="3bc57-308">Festlegen der Validierung und den Entschlüsselungsschlüssel</span><span class="sxs-lookup"><span data-stu-id="3bc57-308">Setting the Validation and Decryption Keys</span></span>

<span data-ttu-id="3bc57-309">Die Verschlüsselung und Hashalgorithmen, die von dem Authentifizierungssystem Forms verwendet, um zu verschlüsseln, und überprüfen das Authentifizierungsticket sind anpassbare über die [ &lt;MachineKey&gt; Element](https://msdn.microsoft.com/library/w8h3skw9.aspx) in "Web.config". Tabelle 2 zeigt die &lt;MachineKey&gt; Attribute des Elements und ihren möglichen Werten.</span><span class="sxs-lookup"><span data-stu-id="3bc57-309">The encryption and hashing algorithms used by the forms authentication system to encrypt and validate the authentication ticket are customizable through the [&lt;machineKey&gt; element](https://msdn.microsoft.com/library/w8h3skw9.aspx) in Web.config. Table 2 outlines the &lt;machineKey&gt; element's attributes and their possible values.</span></span>

| <span data-ttu-id="3bc57-310">**Attribut**</span><span class="sxs-lookup"><span data-stu-id="3bc57-310">**Attribute**</span></span> | <span data-ttu-id="3bc57-311">**Beschreibung**</span><span class="sxs-lookup"><span data-stu-id="3bc57-311">**Description**</span></span> |
| --- | --- |
| <span data-ttu-id="3bc57-312">Entschlüsselung</span><span class="sxs-lookup"><span data-stu-id="3bc57-312">decryption</span></span> | <span data-ttu-id="3bc57-313">Gibt den Algorithmus für die Verschlüsselung verwendet.</span><span class="sxs-lookup"><span data-stu-id="3bc57-313">Indicates the algorithm used for encryption.</span></span> <span data-ttu-id="3bc57-314">Dieses Attribut kann einen der folgenden vier Werten haben: - Auto - die Standardeinstellung. Bestimmt den Algorithmus basierend auf der Länge des Attributs DecryptionKey an.</span><span class="sxs-lookup"><span data-stu-id="3bc57-314">This attribute can have one of the following four values: - Auto - the default; determines the algorithm based on the length of the decryptionKey attribute.</span></span> <span data-ttu-id="3bc57-315">-AES - verwendet die [erweiterte Verschlüsselung (Advanced Encryption Standard, AES)](http://en.wikipedia.org/wiki/Advanced_Encryption_Standard) Algorithmus.</span><span class="sxs-lookup"><span data-stu-id="3bc57-315">- AES - uses the [Advanced Encryption Standard (AES)](http://en.wikipedia.org/wiki/Advanced_Encryption_Standard) algorithm.</span></span> <span data-ttu-id="3bc57-316">-DES - verwendet die [Standard DES (Data Encryption)](http://en.wikipedia.org/wiki/Data_Encryption_Standard) dieser Algorithmus wird als rechnerisch schwache und sollte nicht verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="3bc57-316">- DES - uses the [Data Encryption Standard (DES)](http://en.wikipedia.org/wiki/Data_Encryption_Standard) This algorithm is considered computationally weak and should not be used.</span></span> <span data-ttu-id="3bc57-317">-3DES - verwendet die [Triple DES](http://en.wikipedia.org/wiki/Triple_DES) -Algorithmus, der durch Anwenden des DES-Algorithmus dreimal funktioniert.</span><span class="sxs-lookup"><span data-stu-id="3bc57-317">- 3DES - uses the [Triple DES](http://en.wikipedia.org/wiki/Triple_DES) algorithm, which works by applying the DES algorithm three times.</span></span> |
| <span data-ttu-id="3bc57-318">decryptionKey</span><span class="sxs-lookup"><span data-stu-id="3bc57-318">decryptionKey</span></span> | <span data-ttu-id="3bc57-319">Der geheime Schlüssel des Verschlüsselungsalgorithmus verwendet.</span><span class="sxs-lookup"><span data-stu-id="3bc57-319">The secret key used by the encryption algorithm.</span></span> <span data-ttu-id="3bc57-320">Dieser Wert muss entweder eine hexadezimale Zeichenfolge, die entsprechende Länge (basierend auf den Wert in der Entschlüsselung), automatisch generieren oder entweder Wert angefügt, IsolateApps.</span><span class="sxs-lookup"><span data-stu-id="3bc57-320">This value must either be a hexadecimal string of the appropriate length (based on the value in decryption), AutoGenerate, or either value appended with,IsolateApps.</span></span> <span data-ttu-id="3bc57-321">Hinzufügen von IsolateApps weist ASP.NET für einen eindeutigen Wert für jede Anwendung verwenden.</span><span class="sxs-lookup"><span data-stu-id="3bc57-321">Adding IsolateApps instructs ASP.NET to use a unique value for each application.</span></span> <span data-ttu-id="3bc57-322">Der Standardwert ist AutoGenerate, IsolateApps.</span><span class="sxs-lookup"><span data-stu-id="3bc57-322">The default is AutoGenerate,IsolateApps.</span></span> |
| <span data-ttu-id="3bc57-323">Validierung</span><span class="sxs-lookup"><span data-stu-id="3bc57-323">validation</span></span> | <span data-ttu-id="3bc57-324">Gibt den Algorithmus für die Überprüfung verwendet.</span><span class="sxs-lookup"><span data-stu-id="3bc57-324">Indicates the algorithm used for validation.</span></span> <span data-ttu-id="3bc57-325">Dieses Attribut kann einen der folgenden vier Werten haben: - AES - verwendet den Algorithmus für die erweiterte Verschlüsselung (Advanced Encryption Standard, AES).</span><span class="sxs-lookup"><span data-stu-id="3bc57-325">This attribute can have one of the following four values: - AES - uses the Advanced Encryption Standard (AES) algorithm.</span></span> <span data-ttu-id="3bc57-326">-MD5 - verwendet die [Message-Digest 5 (MD5)](http://en.wikipedia.org/wiki/MD5) Algorithmus.</span><span class="sxs-lookup"><span data-stu-id="3bc57-326">- MD5 - uses the [Message-Digest 5 (MD5)](http://en.wikipedia.org/wiki/MD5) algorithm.</span></span> <span data-ttu-id="3bc57-327">-SHA1 - verwendet die [SHA1](http://en.wikipedia.org/wiki/Sha1) Algorithmus (Standard).</span><span class="sxs-lookup"><span data-stu-id="3bc57-327">- SHA1 - uses the [SHA1](http://en.wikipedia.org/wiki/Sha1) algorithm (the default).</span></span> <span data-ttu-id="3bc57-328">-3DES - mithilfe des Triple DES-Algorithmus.</span><span class="sxs-lookup"><span data-stu-id="3bc57-328">- 3DES - uses the Triple DES algorithm.</span></span> |
| <span data-ttu-id="3bc57-329">validationKey</span><span class="sxs-lookup"><span data-stu-id="3bc57-329">validationKey</span></span> | <span data-ttu-id="3bc57-330">Der geheime Schlüssel, die von den Validierungsalgorithmus verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="3bc57-330">The secret key used by the validation algorithm.</span></span> <span data-ttu-id="3bc57-331">Dieser Wert muss entweder eine hexadezimale Zeichenfolge, die entsprechende Länge (basierend auf den Wert bei der Validierung), automatisch generieren oder entweder Wert angefügt, IsolateApps.</span><span class="sxs-lookup"><span data-stu-id="3bc57-331">This value must either be a hexadecimal string of the appropriate length (based on the value in validation), AutoGenerate, or either value appended with,IsolateApps.</span></span> <span data-ttu-id="3bc57-332">Hinzufügen von IsolateApps weist ASP.NET für einen eindeutigen Wert für jede Anwendung verwenden.</span><span class="sxs-lookup"><span data-stu-id="3bc57-332">Adding IsolateApps instructs ASP.NET to use a unique value for each application.</span></span> <span data-ttu-id="3bc57-333">Der Standardwert ist AutoGenerate, IsolateApps.</span><span class="sxs-lookup"><span data-stu-id="3bc57-333">The default is AutoGenerate,IsolateApps.</span></span> |

<span data-ttu-id="3bc57-334">**Tabelle 2**: die &lt;MachineKey&gt; Elementattribute</span><span class="sxs-lookup"><span data-stu-id="3bc57-334">**Table 2**: The &lt;machineKey&gt; Element Attributes</span></span>

<span data-ttu-id="3bc57-335">Eine ausführliche Beschreibung dieser Optionen Verschlüsselung und gültigkeitsprüfung, und die vor- und Nachteile der verschiedenen Algorithmen ist nicht Gegenstand dieses Lernprogramm.</span><span class="sxs-lookup"><span data-stu-id="3bc57-335">A thorough discussion of these encryption and validation options, and the pros and cons of the various algorithms, is beyond the scope of this tutorial.</span></span> <span data-ttu-id="3bc57-336">Für eine ausführliche sehen Sie sich diese Probleme, einschließlich Anleitungen auf welche Verschlüsselung und gültigkeitsprüfung Algorithmen zu verwenden, welche Schlüssellängen und verwenden, und wie auf diese Schlüssel zu generieren, finden Sie am besten *Professional ASP.NET 2.0-Sicherheit, Mitgliedschaft und Rollenverwaltung *.</span><span class="sxs-lookup"><span data-stu-id="3bc57-336">For an in-depth look at these issues, including guidance on what encryption and validation algorithms to use, what key lengths to use, and how best to generate these keys, refer to *Professional ASP.NET 2.0 Security, Membership, and Role Management*.</span></span>

<span data-ttu-id="3bc57-337">Standardmäßig werden für die Verschlüsselung und Überprüfung verwendeten Schlüssel automatisch für jede Anwendung generiert und diese Schlüssel werden in der Local Security Authority (LSA) gespeichert.</span><span class="sxs-lookup"><span data-stu-id="3bc57-337">By default, the keys used for encryption and validation are generated automatically for each application, and these keys are stored in the Local Security Authority (LSA).</span></span> <span data-ttu-id="3bc57-338">Kurz gesagt, garantiert die Standardeinstellungen eindeutige Schlüssel für einen Server von Web-Webserver und jede Anwendung durch.</span><span class="sxs-lookup"><span data-stu-id="3bc57-338">In short, the default settings guarantee unique keys on a web server-by-web server and application-by-application basis.</span></span> <span data-ttu-id="3bc57-339">Dieses Standardverhalten funktioniert daher nicht für die beiden folgenden Szenarien:</span><span class="sxs-lookup"><span data-stu-id="3bc57-339">Consequently, this default behavior will not work for the two following scenarios:</span></span>

- <span data-ttu-id="3bc57-340">**Webfarmen** – in einem [Webfarm](http://en.wikipedia.org/wiki/Web_farm) Szenario einer einzelnen Web-Anwendung auf mehrere Webserver für Zwecke der Skalierbarkeit und Redundanz gehostet wird.</span><span class="sxs-lookup"><span data-stu-id="3bc57-340">**Web Farms** - in a [web farm](http://en.wikipedia.org/wiki/Web_farm) scenario, a single web application is hosted on multiple web servers for purposes of scalability and redundancy.</span></span> <span data-ttu-id="3bc57-341">Jede eingehende Anforderung ist verteilt, auf einen Server in der Farm, was bedeutet, dass während der gesamten Lebensdauer der Sitzung eines Benutzers, verschiedene Servern verwendet werden können, um seine verschiedenen Anforderungen zu verarbeiten.</span><span class="sxs-lookup"><span data-stu-id="3bc57-341">Each incoming request is dispatched to a server in the farm, meaning that over the lifetime of a user's session, different servers may be used to handle his various requests.</span></span> <span data-ttu-id="3bc57-342">Folglich jeder Server muss die gleichen Schlüssel für Verschlüsselung und gültigkeitsprüfung verwenden, sodass das Formularauthentifizierungsticket erstellt, verschlüsselte und überprüfte auf einem Server auf einem anderen Server in der Farm überprüft und entschlüsselt werden kann.</span><span class="sxs-lookup"><span data-stu-id="3bc57-342">Consequently, each server must use the same encryption and validation keys so that the forms authentication ticket created, encrypted, and validated on one server can be decrypted and validated on a different server in the farm.</span></span>
- <span data-ttu-id="3bc57-343">**Cross-Ticket Anwendungsfreigabe** -ein einzelne Webserver kann mehrere ASP.NET-Anwendungen hosten.</span><span class="sxs-lookup"><span data-stu-id="3bc57-343">**Cross Application Ticket Sharing** - a single web server may host multiple ASP.NET applications.</span></span> <span data-ttu-id="3bc57-344">Wenn Sie für diese verschiedenen Anwendungen eine einzelne Formularauthentifizierungsticket gemeinsam nutzen müssen, ist es unabdinglich, deren Verschlüsselung und gültigkeitsprüfung Schlüssel überein.</span><span class="sxs-lookup"><span data-stu-id="3bc57-344">If you need for these different applications to share a single forms authentication ticket, it is imperative that their encryption and validation keys match up.</span></span>

<span data-ttu-id="3bc57-345">Wenn in einer Webfarm festlegen oder Authentifizierungstickets alle Anwendungen auf demselben Server gemeinsam zu arbeiten, müssen so konfigurieren Sie die &lt;MachineKey&gt; Element, in welche Anwendungshosts betroffen sind, damit ihre DecryptionKey und Richten Sie Werte für "ValidationKey" entspricht.</span><span class="sxs-lookup"><span data-stu-id="3bc57-345">When working in a web farm setting or sharing authentication tickets across applications on the same server, you will need to configure the &lt;machineKey&gt; element in the affected applications so that their decryptionKey and validationKey values match up.</span></span>

<span data-ttu-id="3bc57-346">Während keiner der beiden oben genannten Szenarien für unsere beispielanwendung gültig ist, können wir geben Sie explizite DecryptionKey und Werte für "ValidationKey" entspricht und definieren die Algorithmen, die verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="3bc57-346">While neither of the above scenarios applies to our sample application, we can still specify explicit decryptionKey and validationKey values and define the algorithms to be used.</span></span> <span data-ttu-id="3bc57-347">Hinzufügen einer &lt;MachineKey&gt; auf die Datei "Web.config" festlegen:</span><span class="sxs-lookup"><span data-stu-id="3bc57-347">Add a &lt;machineKey&gt; setting to the Web.config file:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample5.xml)]

<span data-ttu-id="3bc57-348">Weitere Informationen finden Sie [Vorgehensweise: Konfigurieren von MachineKey in ASP.NET 2.0](https://msdn.microsoft.com/library/ms998288.aspx).</span><span class="sxs-lookup"><span data-stu-id="3bc57-348">For more information check out [How To: Configure MachineKey in ASP.NET 2.0](https://msdn.microsoft.com/library/ms998288.aspx).</span></span>

> [!NOTE]
> <span data-ttu-id="3bc57-349">Die Werte DecryptionKey und "ValidationKey" entspricht entnommen wurden [Steve Gibson](http://www.grc.com/stevegibson.htm)des [perfekten Kennwörter Webseite](https://www.grc.com/passwords.htm), die zufällige 64-Hexadezimalzeichen auf jeder Seite Besuch generiert.</span><span class="sxs-lookup"><span data-stu-id="3bc57-349">The decryptionKey and validationKey values were taken from [Steve Gibson](http://www.grc.com/stevegibson.htm)'s [Perfect Passwords web page](https://www.grc.com/passwords.htm), which generates 64 random hexadecimal characters on each page visit.</span></span> <span data-ttu-id="3bc57-350">Um zu verringern, die Wahrscheinlichkeit dieser Schlüssel, wie in der Produktionsanwendungen vornehmen, sollten Sie die oben aufgeführten Schlüssel auf der Seite perfekten Kennwörter durch zufällig generierten zu ersetzen.</span><span class="sxs-lookup"><span data-stu-id="3bc57-350">To lessen the likelihood of these keys making their way into your production applications, you are encouraged to replace the above keys with randomly generated ones from the Perfect Passwords page.</span></span>


## <a name="step-4-storing-additional-user-data-in-the-ticket"></a><span data-ttu-id="3bc57-351">Schritt 4: Speichern der zusätzliche Benutzerdaten im Ticket</span><span class="sxs-lookup"><span data-stu-id="3bc57-351">Step 4: Storing Additional User Data in the Ticket</span></span>

<span data-ttu-id="3bc57-352">Viele Webanwendungen Anzeigen von Informationen zu oder Anzeigen der Seite als Grundlage für den derzeit angemeldeten Benutzer.</span><span class="sxs-lookup"><span data-stu-id="3bc57-352">Many web applications display information about or base the page's display on the currently logged on user.</span></span> <span data-ttu-id="3bc57-353">Z. B. möglicherweise eine Webseite anzeigen, den Namen des Benutzers und das Datum, an das sie zuletzt in der oberen Ecke von jeder Seite angemeldet haben, auf.</span><span class="sxs-lookup"><span data-stu-id="3bc57-353">For example, a web page might show the user's name and the date she last logged on in the upper corner of every page.</span></span> <span data-ttu-id="3bc57-354">Das Formularauthentifizierungsticket speichert den aktuell angemeldeten Benutzernamen des Benutzers, aber wenn alle anderen Informationen benötigt wird, muss die Seite wechseln Sie zu Benutzerspeicher - typischerweise eine Datenbank - nachgeschlagen werden die Informationen, die nicht in das Authentifizierungsticket gespeichert.</span><span class="sxs-lookup"><span data-stu-id="3bc57-354">The forms authentication ticket stores the currently logged on user's username, but when any other information is needed, the page must go to the user store - typically a database - to lookup the information not stored in the authentication ticket.</span></span>

<span data-ttu-id="3bc57-355">Mit ein wenig Code können wir zusätzliche Benutzerinformationen in das Formularauthentifizierungsticket gespeichert.</span><span class="sxs-lookup"><span data-stu-id="3bc57-355">With a little bit of code we can store additional user information in the forms authentication ticket.</span></span> <span data-ttu-id="3bc57-356">Diese Daten können durch ausgedrückt werden, die [FormsAuthenticationTicket Klasse](https://msdn.microsoft.com/library/system.web.security.formsauthenticationticket.aspx)des [UserData Eigenschaft](https://msdn.microsoft.com/library/system.web.security.formsauthenticationticket.userdata.aspx).</span><span class="sxs-lookup"><span data-stu-id="3bc57-356">Such data can be expressed through the [FormsAuthenticationTicket class](https://msdn.microsoft.com/library/system.web.security.formsauthenticationticket.aspx)'s [UserData property](https://msdn.microsoft.com/library/system.web.security.formsauthenticationticket.userdata.aspx).</span></span> <span data-ttu-id="3bc57-357">Dies ist nützlich zum Ablegen kleine Mengen von Informationen über den Benutzer zu konzentrieren, die häufig erforderlich ist.</span><span class="sxs-lookup"><span data-stu-id="3bc57-357">This is a useful place to put small amounts of information about the user that is commonly needed.</span></span> <span data-ttu-id="3bc57-358">In "UserData"-Eigenschaft ist Bestandteil des Authentifizierungscookies Ticket und wie die anderen Felder der Ticket, verschlüsselt und überprüft angegebene Wert basierend auf dem Forms-Authentifizierungssystem-Konfiguration.</span><span class="sxs-lookup"><span data-stu-id="3bc57-358">The value specified in the UserData property is included as part of the authentication ticket cookie and, like the other ticket fields, is encrypted and validated based on the forms authentication system's configuration.</span></span> <span data-ttu-id="3bc57-359">Standardmäßig ist die UserData eine leere Zeichenfolge.</span><span class="sxs-lookup"><span data-stu-id="3bc57-359">By default, UserData is an empty string.</span></span>

<span data-ttu-id="3bc57-360">Damit Benutzerdaten in das Authentifizierungsticket speichern, müssen wir viel Code auf der Anmeldungsseite zu schreiben, holt der benutzerspezifische Informationen und speichert ihn in das Ticket.</span><span class="sxs-lookup"><span data-stu-id="3bc57-360">In order to store user data in the authentication ticket, we need to write a bit of code in the login page that grabs the user-specific information and stores it in the ticket.</span></span> <span data-ttu-id="3bc57-361">Da UserData eine Eigenschaft vom Typzeichenfolge ist, müssen die darin gespeicherten Daten ordnungsgemäß als eine Zeichenfolge serialisiert werden.</span><span class="sxs-lookup"><span data-stu-id="3bc57-361">Since UserData is a property of type string, the data stored in it must be properly serialized as a string.</span></span> <span data-ttu-id="3bc57-362">Angenommen Sie, dass unsere Benutzerspeicher, das Geburtsdatum des Benutzers und den Namen ihres Arbeitgebers enthalten, und wollten wir diese zwei Eigenschaftswerte in das Authentifizierungsticket zu speichern.</span><span class="sxs-lookup"><span data-stu-id="3bc57-362">For example, imagine that our user store included each user's date of birth and the name of their employer, and we wanted to store these two property values in the authentication ticket.</span></span> <span data-ttu-id="3bc57-363">Wir konnten diese Werte in eine Zeichenfolge serialisiert werden durch Verketten des Benutzers Datum Geburtsdatum der Zeichenfolge mit einem senkrechten Strich (|), gefolgt vom Namen Arbeitgeber.</span><span class="sxs-lookup"><span data-stu-id="3bc57-363">We could serialize these values into a string by concatenating the user's date of birth's string with a pipe ( | ), followed by the employer name.</span></span> <span data-ttu-id="3bc57-364">Für einen Benutzer auf 15 August 1974 geboren, die von Northwind Traders arbeitet, es würde die UserData-Eigenschaft zuweisen die Zeichenfolge: 1974-08-15 | Northwind Traders.</span><span class="sxs-lookup"><span data-stu-id="3bc57-364">For a user born on August 15, 1974 that works for Northwind Traders, we would assign the UserData property the string: 1974-08-15|Northwind Traders .</span></span>

<span data-ttu-id="3bc57-365">Es benötigt Zugriff auf die Daten in das Ticket gespeichert werden, können wir zu diesem Zweck die aktuelle Anforderung FormsAuthenticationTicket grabbing und Deserialisieren der UserData-Eigenschaft.</span><span class="sxs-lookup"><span data-stu-id="3bc57-365">Whenever we need to access the data stored in the ticket, we can do so by grabbing the current request's FormsAuthenticationTicket and deserializing the UserData property.</span></span> <span data-ttu-id="3bc57-366">Bei das Datum der Geburtsdatum und Arbeitgeber Beispiel würden wir die UserData-Zeichenfolge in beiden Teilzeichenfolgen, die auf Grundlage des Trennzeichens (|) aufgeteilt.</span><span class="sxs-lookup"><span data-stu-id="3bc57-366">In the case of the date of birth and employer name example, we would split the UserData string into two substrings based on the delimiter ( | ).</span></span>


<span data-ttu-id="3bc57-367">[![Zusätzliche Benutzerinformationen kann in das Authentifizierungsticket gespeichert werden](forms-authentication-configuration-and-advanced-topics-cs/_static/image11.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="3bc57-367">[![Additional User Information Can Be Stored in the Authentication Ticket](forms-authentication-configuration-and-advanced-topics-cs/_static/image11.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image10.png)</span></span>

<span data-ttu-id="3bc57-368">**Abbildung 04**: zusätzliche Benutzer Daten gespeichert werden können in das Authentifizierungsticket ([klicken Sie hier, um das Bild in voller Größe angezeigt](forms-authentication-configuration-and-advanced-topics-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="3bc57-368">**Figure 04**: Additional User Information Can Be Stored in the Authentication Ticket ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-cs/_static/image12.png))</span></span>


### <a name="writing-information-to-userdata"></a><span data-ttu-id="3bc57-369">Schreiben von Informationen in UserData</span><span class="sxs-lookup"><span data-stu-id="3bc57-369">Writing Information to UserData</span></span>

<span data-ttu-id="3bc57-370">Leider ist es nicht so einfach wie zu erwarten wäre, die eine Formularauthentifizierungsticket benutzerspezifische Informationen hinzugefügt.</span><span class="sxs-lookup"><span data-stu-id="3bc57-370">Unfortunately, adding user-specific information to a forms authentication ticket is not as straightforward as one might expect.</span></span> <span data-ttu-id="3bc57-371">Die UserData-Eigenschaft der Klasse FormsAuthenticationTicket ist schreibgeschützt und kann nur über den Klassenkonstruktor FormsAuthenticationTicket angegeben werden.</span><span class="sxs-lookup"><span data-stu-id="3bc57-371">The UserData property of the FormsAuthenticationTicket class is read-only and can only be specified through the FormsAuthenticationTicket class constructor.</span></span> <span data-ttu-id="3bc57-372">Wenn Sie die Eigenschaft UserData im Konstruktor angeben, müssen ebenfalls das ticket's andere Werte angeben: den Benutzernamen, das Datum, Ablauf und So weiter.</span><span class="sxs-lookup"><span data-stu-id="3bc57-372">When specifying the UserData property in the constructor, we also need to provide the ticket's other values: the username, the issue date, the expiration, and so on.</span></span> <span data-ttu-id="3bc57-373">Wenn die Anmeldeseite in dem vorherigen Lernprogramm erstellt haben, wurde dies alle für uns auf die FormsAuthentication-Klasse behandelt.</span><span class="sxs-lookup"><span data-stu-id="3bc57-373">When we created the login page in the preceding tutorial, this was all handled for us by the FormsAuthentication class.</span></span> <span data-ttu-id="3bc57-374">Wenn UserData FormsAuthenticationTicket hinzufügen, müssen wir den Code schreiben, um den Großteil der Funktionalität, die bereits von FormsAuthentication-Klasse bereitgestellte replizieren.</span><span class="sxs-lookup"><span data-stu-id="3bc57-374">When adding UserData to the FormsAuthenticationTicket, we will need to write code to replicate much of the functionality already provided by the FormsAuthentication class.</span></span>

<span data-ttu-id="3bc57-375">Betrachten Sie den erforderlichen Code für die Arbeit mit Benutzerdaten durch Aktualisieren der Seite "Login.aspx", um zusätzliche Informationen zu dem Benutzer das Authentifizierungsticket aufzuzeichnen.</span><span class="sxs-lookup"><span data-stu-id="3bc57-375">Let's explore the necessary code for working with UserData by updating the Login.aspx page to record additional information about the user to the authentication ticket.</span></span> <span data-ttu-id="3bc57-376">Nehmen Sie an, dass unsere Benutzerspeicher enthält Informationen über das Unternehmen für der Benutzer arbeitet und ihre Titel und wir diese Informationen in das Authentifizierungsticket erfassen möchten.</span><span class="sxs-lookup"><span data-stu-id="3bc57-376">Pretend that our user store contains information about the company the user works for and their title, and that we want to capture this information in the authentication ticket.</span></span> <span data-ttu-id="3bc57-377">Aktualisieren Sie den Anzeigezustand der Seite "Login.aspx" LoginButton-Click-Ereignishandler, sodass der Code wie folgt aussieht:</span><span class="sxs-lookup"><span data-stu-id="3bc57-377">Update the Login.aspx page's LoginButton Click event handler so that the code looks like the following:</span></span>

[!code-csharp[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample6.cs)]

<span data-ttu-id="3bc57-378">Nehmen wir ein Durchlaufen dieser Code zeilenweise zu einem Zeitpunkt.</span><span class="sxs-lookup"><span data-stu-id="3bc57-378">Let's step through this code one line at a time.</span></span> <span data-ttu-id="3bc57-379">Die Methode startet, durch die Definition von vier Zeichenfolgenarrays: Benutzer, Kennwörter, CompanyName und TitleAtCompany.</span><span class="sxs-lookup"><span data-stu-id="3bc57-379">The method starts by defining four string arrays: users, passwords, companyName, and titleAtCompany.</span></span> <span data-ttu-id="3bc57-380">Diese Arrays enthalten den Benutzernamen, Kennwörter, Firmennamen und Titel für die Benutzerkonten im System, der diese stehen drei: Scott Jisun und Sam.</span><span class="sxs-lookup"><span data-stu-id="3bc57-380">These arrays hold the usernames, passwords, company names, and titles for the user accounts in the system, of which there are three: Scott, Jisun, and Sam.</span></span> <span data-ttu-id="3bc57-381">In einer realen Anwendung würde diese Werte aus dem Benutzerspeicher nicht hartcodiert im Quellcode für die Seite abgefragt werden.</span><span class="sxs-lookup"><span data-stu-id="3bc57-381">In a real application, these values would be queried from the user store, not hard-coded in the page's source code.</span></span>

<span data-ttu-id="3bc57-382">Im vorherigen Lernprogramm Wenn die angegebenen Anmeldeinformationen gültig sind aufgerufen wir einfach FormsAuthentication.RedirectFromLoginPage (UserName.Text, RememberMe.Checked), die die folgenden Schritte ausgeführt:</span><span class="sxs-lookup"><span data-stu-id="3bc57-382">In the previous tutorial, if the supplied credentials were valid we simply called FormsAuthentication.RedirectFromLoginPage(UserName.Text, RememberMe.Checked), which performed the following steps:</span></span>

1. <span data-ttu-id="3bc57-383">Erstellt die Formulare Authentifizierungsticket</span><span class="sxs-lookup"><span data-stu-id="3bc57-383">Created the forms authentication ticket</span></span>
2. <span data-ttu-id="3bc57-384">Das Ticket in der entsprechenden Speicher geschrieben.</span><span class="sxs-lookup"><span data-stu-id="3bc57-384">Wrote the ticket to the appropriate store.</span></span> <span data-ttu-id="3bc57-385">Für Cookies basierende Authentifizierungstickets wird der Browser Cookies Auflistung verwendet. cookieless Authentifizierungstickets werden die Ticketdaten in der URL serialisiert.</span><span class="sxs-lookup"><span data-stu-id="3bc57-385">For cookies-based authentication tickets, the browser's cookies collection is used; for cookieless authentication tickets, the ticket data is serialized into the URL</span></span>
3. <span data-ttu-id="3bc57-386">Den Benutzer wird an die entsprechende Seite umgeleitet.</span><span class="sxs-lookup"><span data-stu-id="3bc57-386">Redirected the user to the appropriate page</span></span>

<span data-ttu-id="3bc57-387">Diese Schritte werden im obigen Code repliziert.</span><span class="sxs-lookup"><span data-stu-id="3bc57-387">These steps are replicated in the code above.</span></span> <span data-ttu-id="3bc57-388">Zunächst wird die Zeichenfolge, die wir in der Eigenschaft UserData schließlich gespeichert werden gebildet, indem Sie den Firmennamen und den vollständigen Titel, begrenzen die beiden Werte durch einen senkrechten Strich (|) kombiniert.</span><span class="sxs-lookup"><span data-stu-id="3bc57-388">First, the string we will eventually store in the UserData property is formed by combining the company name and the title, delimiting the two values with a pipe character ( | ).</span></span>

<span data-ttu-id="3bc57-389">string userDataString = string.Concat(companyName[i], "|", titleAtCompany[i]);</span><span class="sxs-lookup"><span data-stu-id="3bc57-389">string userDataString = string.Concat(companyName[i], "|", titleAtCompany[i]);</span></span>

<span data-ttu-id="3bc57-390">Als Nächstes die FormsAuthentication.GetAuthCookie Methode aufgerufen wird, wodurch das Authentifizierungsticket entsteht, verschlüsselt es gemäß den Konfigurationseinstellungen überprüft und platziert es in einem HttpCookie-Objekt.</span><span class="sxs-lookup"><span data-stu-id="3bc57-390">Next, the FormsAuthentication.GetAuthCookie method is invoked, which creates the authentication ticket, encrypts and validates it according to the configuration settings, and places it in an HttpCookie object.</span></span>

<span data-ttu-id="3bc57-391">HttpCookie AuthCookie = FormsAuthentication.GetAuthCookie (UserName.Text, RememberMe.Checked);</span><span class="sxs-lookup"><span data-stu-id="3bc57-391">HttpCookie authCookie = FormsAuthentication.GetAuthCookie(UserName.Text, RememberMe.Checked);</span></span>

<span data-ttu-id="3bc57-392">Um mit der das Cookie eingebettet FormAuthenticationTicket arbeiten, müssen wir die FormAuthentication Klasse aufrufen, [entschlüsseln Methode](https://msdn.microsoft.com/library/system.web.security.formsauthentication.decrypt.aspx), und übergeben Sie den Cookiewert.</span><span class="sxs-lookup"><span data-stu-id="3bc57-392">In order to work with the FormAuthenticationTicket embedded within the cookie, we need to call the FormAuthentication class's [Decrypt method](https://msdn.microsoft.com/library/system.web.security.formsauthentication.decrypt.aspx), passing in the cookie value.</span></span>

<span data-ttu-id="3bc57-393">FormsAuthenticationTicket Ticket = FormsAuthentication.Decrypt(authCookie.Value);</span><span class="sxs-lookup"><span data-stu-id="3bc57-393">FormsAuthenticationTicket ticket = FormsAuthentication.Decrypt(authCookie.Value);</span></span>

<span data-ttu-id="3bc57-394">Dann erstellen Sie eine *neue* FormsAuthenticationTicket-Instanz basierend auf den vorhandenen FormsAuthenticationTicket-Werte.</span><span class="sxs-lookup"><span data-stu-id="3bc57-394">We then create a *new* FormsAuthenticationTicket instance based on the existing FormsAuthenticationTicket's values.</span></span> <span data-ttu-id="3bc57-395">Dieses neue Ticket enthält jedoch die benutzerspezifische Informationen (UserDataString).</span><span class="sxs-lookup"><span data-stu-id="3bc57-395">However, this new ticket includes the user-specific information (userDataString).</span></span>

<span data-ttu-id="3bc57-396">FormsAuthenticationTicket NewTicket = neue FormsAuthenticationTicket (Ticket. Ticket-Version. Der Name, Ticket. IssueDate, ticket. Ablauf, Ticket. IsPersistent UserDataString);</span><span class="sxs-lookup"><span data-stu-id="3bc57-396">FormsAuthenticationTicket newTicket = new FormsAuthenticationTicket(ticket.Version, ticket.Name, ticket.IssueDate, ticket.Expiration, ticket.IsPersistent, userDataString);</span></span>

<span data-ttu-id="3bc57-397">Wir dann verschlüsseln (und überprüfen) die neue FormsAuthenticationTicket-Instanz durch Aufrufen der [verschlüsseln Methode](https://msdn.microsoft.com/library/system.web.security.formsauthentication.encrypt.aspx), und diese verschlüsselten (und überprüften) Daten zurück in AuthCookie gelegt.</span><span class="sxs-lookup"><span data-stu-id="3bc57-397">We then encrypt (and validate) the new FormsAuthenticationTicket instance by calling the [Encrypt method](https://msdn.microsoft.com/library/system.web.security.formsauthentication.encrypt.aspx), and put this encrypted (and validated) data back into authCookie.</span></span>

<span data-ttu-id="3bc57-398">authCookie.Value = FormsAuthentication.Encrypt(newTicket);</span><span class="sxs-lookup"><span data-stu-id="3bc57-398">authCookie.Value = FormsAuthentication.Encrypt(newTicket);</span></span>

<span data-ttu-id="3bc57-399">Schließlich AuthCookie der Response.Cookies-Auflistung hinzugefügt wird, und die GetRedirectUrl-Methode wird aufgerufen, um zu bestimmen, die entsprechende Seite, um den Benutzer zu senden.</span><span class="sxs-lookup"><span data-stu-id="3bc57-399">Finally, authCookie is added to the Response.Cookies collection and the GetRedirectUrl method is called to determine the appropriate page to send the user.</span></span>

[!code-csharp[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample7.cs)]

<span data-ttu-id="3bc57-400">Alle mit diesem Code ist erforderlich, da die UserData-Eigenschaft ist schreibgeschützt und das FormsAuthentication-Klasse keine Methoden zum Angeben von UserData Informationen in den Methoden GetAuthCookie, SetAuthCookie oder RedirectFromLoginPage bereit.</span><span class="sxs-lookup"><span data-stu-id="3bc57-400">All of this code is needed because the UserData property is read-only and the FormsAuthentication class does not provide any methods for specifying UserData information in its GetAuthCookie, SetAuthCookie, or RedirectFromLoginPage methods.</span></span>

> [!NOTE]
> <span data-ttu-id="3bc57-401">Der Code, den wir soeben untersucht speichert benutzerspezifische Informationen in eine auf Cookies basierende Authentifizierungsticket.</span><span class="sxs-lookup"><span data-stu-id="3bc57-401">The code we just examined stores user-specific information in a cookies-based authentication ticket.</span></span> <span data-ttu-id="3bc57-402">Die Klassen, die zum Serialisieren von des Formularauthentifizierungstickets an die URL sind für das .NET Framework intern.</span><span class="sxs-lookup"><span data-stu-id="3bc57-402">The classes responsible for serializing the forms authentication ticket to the URL are internal to the .NET Framework.</span></span> <span data-ttu-id="3bc57-403">Lange Story kurze, Sie können nicht Benutzerdaten in einem cookieless Formularauthentifizierungsticket speichern.</span><span class="sxs-lookup"><span data-stu-id="3bc57-403">Long story short, you cannot store user data in a cookieless forms authentication ticket.</span></span>


### <a name="accessing-the-userdata-information"></a><span data-ttu-id="3bc57-404">Zugreifen auf die UserData-Informationen</span><span class="sxs-lookup"><span data-stu-id="3bc57-404">Accessing the UserData Information</span></span>

<span data-ttu-id="3bc57-405">An diesem Punkt Firmennamen und Titel des Benutzers in das Formularauthentifizierungsticket UserData Eigenschaft gespeichert bei der Anmeldung.</span><span class="sxs-lookup"><span data-stu-id="3bc57-405">At this point each user's company name and title is stored in the forms authentication ticket's UserData property when they log in.</span></span> <span data-ttu-id="3bc57-406">Diese Informationen kann über das Authentifizierungsticket auf einer beliebigen Seite zugegriffen werden, ohne einen Trip zur Speicher Benutzers.</span><span class="sxs-lookup"><span data-stu-id="3bc57-406">This information can be accessed from the authentication ticket on any page without requiring a trip to the user store.</span></span> <span data-ttu-id="3bc57-407">Um zu veranschaulichen, wie diese Informationen aus der UserData-Eigenschaft abgerufen werden kann, wir aktualisieren "default.aspx", sodass die Begrüßungsnachricht enthält, nicht nur den Benutzernamen, jedoch auch das Unternehmen aus, dem sie für die funktionieren und deren Titel.</span><span class="sxs-lookup"><span data-stu-id="3bc57-407">To illustrate how this information can be retrieved from the UserData property, let's update Default.aspx so that its welcome message includes not only the user's name, but also the company they work for and their title.</span></span>

<span data-ttu-id="3bc57-408">"Default.aspx" wird derzeit ein AuthenticatedMessagePanel-Bereich mit einem Label-Steuerelement mit dem Namen WelcomeBackMessage enthält.</span><span class="sxs-lookup"><span data-stu-id="3bc57-408">Currently, Default.aspx contains an AuthenticatedMessagePanel Panel with a Label control named WelcomeBackMessage.</span></span> <span data-ttu-id="3bc57-409">In diesem Bereich wird nur für authentifizierte Benutzer angezeigt.</span><span class="sxs-lookup"><span data-stu-id="3bc57-409">This Panel is only displayed to authenticated users.</span></span> <span data-ttu-id="3bc57-410">Aktualisieren Sie den Code in die Seite "default.aspx" des\_Laden Sie Ereignishandler, sodass er wie folgt aussieht:</span><span class="sxs-lookup"><span data-stu-id="3bc57-410">Update the code in Default.aspx's Page\_Load event handler so that it looks like the following:</span></span>

[!code-csharp[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample8.cs)]

<span data-ttu-id="3bc57-411">Wenn Request.IsAuthenticated ist "true", Text-Eigenschaft der WelcomeBackMessage Willkommen zurück eingerichtet ist *Benutzername*.</span><span class="sxs-lookup"><span data-stu-id="3bc57-411">If Request.IsAuthenticated is true, then the WelcomeBackMessage's Text property is first set to Welcome back, *username*.</span></span> <span data-ttu-id="3bc57-412">Klicken Sie dann wird die User.Identity-Eigenschaft mit einem FormsIdentity-Objekt umgewandelt, damit wir den zugrunde liegenden FormsAuthenticationTicket zugreifen können.</span><span class="sxs-lookup"><span data-stu-id="3bc57-412">Then, the User.Identity property is cast to a FormsIdentity object so that we can access the underlying FormsAuthenticationTicket.</span></span> <span data-ttu-id="3bc57-413">Sobald wir FormsAuthenticationTicket haben, Deserialisieren wir die UserData-Eigenschaft in den Firmennamen und Titel.</span><span class="sxs-lookup"><span data-stu-id="3bc57-413">Once we have the FormsAuthenticationTicket, we deserialize the UserData property into the company name and title.</span></span> <span data-ttu-id="3bc57-414">Dies wird erreicht, und teilen Sie die Zeichenfolge in einen senkrechten Strich.</span><span class="sxs-lookup"><span data-stu-id="3bc57-414">This is accomplished by splitting the string on the pipe character.</span></span> <span data-ttu-id="3bc57-415">Anschließend werden die Firmennamen und Titel in der WelcomeBackMessage-Bezeichnung angezeigt.</span><span class="sxs-lookup"><span data-stu-id="3bc57-415">The company name and title are then displayed in the WelcomeBackMessage Label.</span></span>

<span data-ttu-id="3bc57-416">Abbildung 5 zeigt einen Screenshot, der die Anzeige in Aktion an.</span><span class="sxs-lookup"><span data-stu-id="3bc57-416">Figure 5 shows a screenshot of this display in action.</span></span> <span data-ttu-id="3bc57-417">Anmelden als Scott zeigt eine Begrüßungsnachricht zurück an, die Unternehmen und Titel des Scott enthält.</span><span class="sxs-lookup"><span data-stu-id="3bc57-417">Logging in as Scott displays a welcome back message that includes Scott's company and title.</span></span>


<span data-ttu-id="3bc57-418">[![Die derzeit angemeldeten Benutzer des Unternehmens und Titel werden angezeigt.](forms-authentication-configuration-and-advanced-topics-cs/_static/image14.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="3bc57-418">[![The Currently Logged On User's Company and Title are Displayed](forms-authentication-configuration-and-advanced-topics-cs/_static/image14.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image13.png)</span></span>

<span data-ttu-id="3bc57-419">**Abbildung 05**: des derzeit angemeldeten Benutzer des Unternehmens und Titel angezeigt werden ([klicken Sie hier, um das Bild in voller Größe angezeigt](forms-authentication-configuration-and-advanced-topics-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="3bc57-419">**Figure 05**: The Currently Logged On User's Company and Title are Displayed ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-cs/_static/image15.png))</span></span>


> [!NOTE]
> <span data-ttu-id="3bc57-420">Das Authentifizierungsticket UserData Eigenschaft dient als Cache für den Speicher des Benutzers.</span><span class="sxs-lookup"><span data-stu-id="3bc57-420">The authentication ticket's UserData property serves as a cache for the user store.</span></span> <span data-ttu-id="3bc57-421">Wie alle Cache muss aktualisiert werden, wenn die zugrunde liegenden Daten geändert werden.</span><span class="sxs-lookup"><span data-stu-id="3bc57-421">Like any cache, it needs to be updated when the underlying data is modified.</span></span> <span data-ttu-id="3bc57-422">Ist eine Webseite, von der aus Benutzer seines Profils aktualisieren können, müssen z. B. die Felder in der Eigenschaft UserData zwischengespeichert aktualisiert werden, die vom Benutzer vorgenommene Änderungen widerzuspiegeln.</span><span class="sxs-lookup"><span data-stu-id="3bc57-422">For example, if there is a web page from which users can update their profile, the fields cached in the UserData property must be refreshed to reflect the changes made by the user.</span></span>


## <a name="step-5-using-a-custom-principal"></a><span data-ttu-id="3bc57-423">Schritt 5: Verwenden von einem benutzerdefinierten Prinzipal</span><span class="sxs-lookup"><span data-stu-id="3bc57-423">Step 5: Using a Custom Principal</span></span>

<span data-ttu-id="3bc57-424">Jede eingehende Anforderung versucht die FormsAuthenticationModule zur Authentifizierung des Benutzers.</span><span class="sxs-lookup"><span data-stu-id="3bc57-424">On each incoming request the FormsAuthenticationModule attempts to authenticate the user.</span></span> <span data-ttu-id="3bc57-425">Wenn ein nicht abgelaufenen Authentifizierungsticket vorhanden ist, weist der FormsAuthenticationModule die HttpContext.User-Eigenschaft auf ein neues GenericPrincipal-Objekt.</span><span class="sxs-lookup"><span data-stu-id="3bc57-425">If a non-expired authentication ticket is present, the FormsAuthenticationModule assigns the HttpContext.User property to a new GenericPrincipal object.</span></span> <span data-ttu-id="3bc57-426">Dieses GenericPrincipal-Objekt hat eine Identität vom Typ FormsIdentity, die einen Verweis auf das Formularauthentifizierungsticket enthält.</span><span class="sxs-lookup"><span data-stu-id="3bc57-426">This GenericPrincipal object has an Identity of type FormsIdentity, which includes a reference to the forms authentication ticket.</span></span> <span data-ttu-id="3bc57-427">GenericPrincipal-Klasse enthält die bare mindestfunktionen, die durch eine Klasse, die IPrincipal implementiert erforderlich – Es muss nur noch eine Identity-Eigenschaft und eine IsInRole-Methode.</span><span class="sxs-lookup"><span data-stu-id="3bc57-427">The GenericPrincipal class contains the bare minimum functionality needed by a class that implements IPrincipal - it just has an Identity property and an IsInRole method.</span></span>

<span data-ttu-id="3bc57-428">Das principal-Objekt hat zwei Aufgaben: welche Rollen gibt an, der Benutzer gehört, und die Identität der Anmeldeinformationen.</span><span class="sxs-lookup"><span data-stu-id="3bc57-428">The principal object has two responsibilities: to indicate what roles the user belongs to and to provide identity information.</span></span> <span data-ttu-id="3bc57-429">Dies erfolgt über die IPrincipal-Schnittstelle IsInRole (*RoleName*)-Methode und die Identity-Eigenschaft bzw..</span><span class="sxs-lookup"><span data-stu-id="3bc57-429">This is accomplished through the IPrincipal interface's IsInRole(*roleName*) method and Identity property, respectively.</span></span> <span data-ttu-id="3bc57-430">GenericPrincipal-Klasse ermöglicht ein Zeichenfolgenarray mit Rollennamen, aus denen über ihren Konstruktor angegeben werden. die IsInRole (*RoleName*)-Methode lediglich überprüft, ob die übergebene in *RoleName* innerhalb des Zeichenfolgenarrays vorhanden ist.</span><span class="sxs-lookup"><span data-stu-id="3bc57-430">The GenericPrincipal class allows for a string array of role names to be specified via its constructor; its IsInRole(*roleName*) method merely checks to see if the passed in *roleName* exists within the string array.</span></span> <span data-ttu-id="3bc57-431">Die FormsAuthenticationModule GenericPrincipal erstellt, übergibt er in ein leeres Zeichenfolgenarray an die GenericPrincipal-Konstruktor.</span><span class="sxs-lookup"><span data-stu-id="3bc57-431">When the FormsAuthenticationModule creates the GenericPrincipal, it passes in an empty string array to the GenericPrincipal's constructor.</span></span> <span data-ttu-id="3bc57-432">Deshalb wird jeder Aufruf von IsInRole immer "false" zurückgegeben.</span><span class="sxs-lookup"><span data-stu-id="3bc57-432">Consequently, any call to IsInRole will always return false.</span></span>

<span data-ttu-id="3bc57-433">GenericPrincipal-Klasse erfüllt die Anforderungen für die meisten Forms zertifikatbasierte Authentifizierungsszenarien, in denen Rollen nicht verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="3bc57-433">The GenericPrincipal class meets the needs for most forms based authentication scenarios where roles are not used.</span></span> <span data-ttu-id="3bc57-434">Für solche Situationen, in denen die Rolle Standardbehandlung reicht nicht aus, oder wenn Sie ein benutzerdefiniertes Objekt für "IIdentity" wird der Benutzer zuordnen müssen, erstellen Sie ein benutzerdefiniertes IPrincipal Objekt während des Workflows für die Authentifizierung und die HttpContext.User-Eigenschaft zuweisen.</span><span class="sxs-lookup"><span data-stu-id="3bc57-434">For those situations where the default role handling is insufficient or when you need to associate a custom IIdentity object with the user, you can create a custom IPrincipal object during the authentication workflow and assign it to the HttpContext.User property.</span></span>

> [!NOTE]
> <span data-ttu-id="3bc57-435">Da wir in Zukunft, Lernprogramme angezeigt wird, wenn ASP. NET Rollen-Framework ist aktiviert er erstellt ein benutzerdefinierte principal-Objekt des Typs [RolePrincipal](https://msdn.microsoft.com/library/system.web.security.roleprincipal.aspx) und überschreibt das Forms-Authentifizierung erstellten GenericPrincipal-Objekt.</span><span class="sxs-lookup"><span data-stu-id="3bc57-435">As we will see in future tutorials, when ASP.NET's Roles framework is enabled it creates a custom principal object of type [RolePrincipal](https://msdn.microsoft.com/library/system.web.security.roleprincipal.aspx) and overwrites the forms authentication-created GenericPrincipal object.</span></span> <span data-ttu-id="3bc57-436">Dies geschieht, um dem Prinzipal IsInRole-Methode für die Kommunikation mit dem Rollen-Framework-API anpassen.</span><span class="sxs-lookup"><span data-stu-id="3bc57-436">It does this in order to customize the principal's IsInRole method to interface with the Roles framework's API.</span></span>


<span data-ttu-id="3bc57-437">Da wir nicht uns mit Rollen noch Bedenken haben, wäre der einzige Grund, den wir, zum Erstellen von eines benutzerdefinierten Prinzipals an diesem Punkt den Client haben würden ein benutzerdefiniertes Objekt für "IIdentity" wird dem Prinzipal zuordnen.</span><span class="sxs-lookup"><span data-stu-id="3bc57-437">Since we have not concerned ourselves with roles yet, the only reason we would have for creating a custom principal at this juncture would be to associate a custom IIdentity object to the principal.</span></span> <span data-ttu-id="3bc57-438">In Schritt 4 erläutert wird, zusätzliche Benutzerinformationen in das Authentifizierungsticket UserData-Eigenschaft, insbesondere zu speichern, des Benutzers Firmennamen und deren Titel.</span><span class="sxs-lookup"><span data-stu-id="3bc57-438">In Step 4 we looked at storing additional user information in the authentication ticket's UserData property, in particular the user's company name and their title.</span></span> <span data-ttu-id="3bc57-439">Die UserData Informationen ist jedoch nur über das Authentifizierungsticket zugegriffen werden kann und nur dann eine serialisierte Zeichenfolge übereinstimmt, was bedeutet, dass jedes Mal, wenn wir den Benutzerinformationen in das Ticket anzeigen möchten, wir analysieren, die UserData-Eigenschaft müssen.</span><span class="sxs-lookup"><span data-stu-id="3bc57-439">However, the UserData information is only accessible through the authentication ticket and only then as a serialized string, meaning that anytime we want to view the user information stored in the ticket we need to parse the UserData property.</span></span>

<span data-ttu-id="3bc57-440">Wir können die entwicklererfahrung durch Erstellen einer Klasse, die "IIdentity" wird implementiert und enthält Eigenschaften CompanyName und Titel verbessern.</span><span class="sxs-lookup"><span data-stu-id="3bc57-440">We can improve the developer experience by creating a class that implements IIdentity and includes CompanyName and Title properties.</span></span> <span data-ttu-id="3bc57-441">Auf diese Weise ein Entwickler Firmenname des aktuell angemeldeten Benutzers zugreifen kann und Titel direkt über die Eigenschaften "CompanyName" und "Title" ohne zu wissen, wie die Eigenschaft UserData analysieren erforderlich.</span><span class="sxs-lookup"><span data-stu-id="3bc57-441">That way, a developer can access the currently logged on user's company name and title directly through the CompanyName and Title properties without needed to know how to parse the UserData property.</span></span>

### <a name="creating-the-custom-identity-and-principal-classes"></a><span data-ttu-id="3bc57-442">Erstellen das benutzerdefinierte Identitäts- und Prinzipalklassen</span><span class="sxs-lookup"><span data-stu-id="3bc57-442">Creating the Custom Identity and Principal Classes</span></span>

<span data-ttu-id="3bc57-443">Für dieses Lernprogramm erstellen Sie wir die benutzerdefinierten Haupt- und Identitätsobjekte Objekte in der App\_Codeordner.</span><span class="sxs-lookup"><span data-stu-id="3bc57-443">For this tutorial, let's create the custom principal and identity objects in the App\_Code folder.</span></span> <span data-ttu-id="3bc57-444">Starten, indem Sie eine App\_Code Ordner zu Ihrem Projekt – mit der rechten Maustaste auf den Projektnamen im Projektmappen-Explorer, wählen Sie die Option ASP.NET-Ordner hinzufügen, und wählen Sie die App\_Code.</span><span class="sxs-lookup"><span data-stu-id="3bc57-444">Start by adding an App\_Code folder to your project - right-click on the project name in Solution Explorer, select the Add ASP.NET Folder option, and choose App\_Code.</span></span> <span data-ttu-id="3bc57-445">Die App\_Code ist ein spezieller ASP.NET-Ordner, die Dateien Klasse speziell für die Website enthält.</span><span class="sxs-lookup"><span data-stu-id="3bc57-445">The App\_Code folder is a special ASP.NET folder that holds class files specific to the website.</span></span>

> [!NOTE]
> <span data-ttu-id="3bc57-446">Die App\_Codeordner sollte nur verwendet werden, wenn Sie das Projekt über das Website-Projektmodell verwalten.</span><span class="sxs-lookup"><span data-stu-id="3bc57-446">The App\_Code folder should only be used when managing your project through the Website Project Model.</span></span> <span data-ttu-id="3bc57-447">Bei Verwendung der [Webanwendungsprojekt-Modell](https://msdn.microsoft.com/asp.net/Aa336618.aspx), erstellen Sie einen Standardordner und Hinzufügen von Klassen mit.</span><span class="sxs-lookup"><span data-stu-id="3bc57-447">If you are using the [Web Application Project Model](https://msdn.microsoft.com/asp.net/Aa336618.aspx), create a standard folder and add the classes to that.</span></span> <span data-ttu-id="3bc57-448">Sie könnten z. B. einen neuen Ordner namens Klassen hinzufügen und platzieren Sie es Ihren Code.</span><span class="sxs-lookup"><span data-stu-id="3bc57-448">For example, you could add a new folder named Classes, and place your code there.</span></span>


<span data-ttu-id="3bc57-449">Fügen Sie zwei neue Klassendateien an die App\_Codeordner, eine benannte CustomIdentity.cs und eine mit dem Namen CustomPrincipal.cs.</span><span class="sxs-lookup"><span data-stu-id="3bc57-449">Next, add two new class files to the App\_Code folder, one named CustomIdentity.cs and one named CustomPrincipal.cs.</span></span>


<span data-ttu-id="3bc57-450">[![Hinzufügen von der CustomIdentity und CustomPrincipal-Klassen zum Projekt](forms-authentication-configuration-and-advanced-topics-cs/_static/image17.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="3bc57-450">[![Add the CustomIdentity and CustomPrincipal Classes to Your Project](forms-authentication-configuration-and-advanced-topics-cs/_static/image17.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image16.png)</span></span>

<span data-ttu-id="3bc57-451">**Abbildung 06**: Hinzufügen von der CustomIdentity und der CustomPrincipal-Klassen zu einem Projekt ([klicken Sie hier, um das Bild in voller Größe angezeigt](forms-authentication-configuration-and-advanced-topics-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="3bc57-451">**Figure 06**: Add the CustomIdentity and CustomPrincipal Classes to Your Project ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-cs/_static/image18.png))</span></span>


<span data-ttu-id="3bc57-452">Der CustomIdentity-Klasse dient zum Implementieren der Schnittstelle "IIdentity" wird, die Eigenschaften für den Authentifizierungstyp, IsAuthenticated und Namen definiert.</span><span class="sxs-lookup"><span data-stu-id="3bc57-452">The CustomIdentity class is responsible for implementing the IIdentity interface, which defines the AuthenticationType, IsAuthenticated, and Name properties.</span></span> <span data-ttu-id="3bc57-453">Zusätzlich zu diesen erforderlichen Eigenschaften sind wir interessiert, Verfügbarmachen der zugrunde liegenden Formularauthentifizierungsticket als auch Eigenschaften für den Firmennamen und Titel des Benutzers.</span><span class="sxs-lookup"><span data-stu-id="3bc57-453">In addition to those required properties, we are interested in exposing the underlying forms authentication ticket as well as properties for the user's company name and title.</span></span> <span data-ttu-id="3bc57-454">Geben Sie den folgenden Code in der CustomIdentity-Klasse.</span><span class="sxs-lookup"><span data-stu-id="3bc57-454">Enter the following code into the CustomIdentity class.</span></span>

[!code-csharp[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample9.cs)]

<span data-ttu-id="3bc57-455">Beachten Sie, dass die Klasse eine Membervariable FormsAuthenticationTicket beinhaltet (\_Ticket) und, die diese Ticketinformationen muss durch den Konstruktor angegeben werden.</span><span class="sxs-lookup"><span data-stu-id="3bc57-455">Note that the class includes a FormsAuthenticationTicket member variable (\_ticket) and that this ticket information must be supplied through the constructor.</span></span> <span data-ttu-id="3bc57-456">Diese Ticketdaten werden beim Zurückgeben der Name der Identität verwendet. seine UserData-Eigenschaft wird analysiert, um die Werte für die Eigenschaften CompanyName "und" Title zurückzugeben.</span><span class="sxs-lookup"><span data-stu-id="3bc57-456">This ticket data is used in returning the identity's Name; its UserData property is parsed to return the values for the CompanyName and Title properties.</span></span>

<span data-ttu-id="3bc57-457">Als Nächstes erstellen Sie die CustomPrincipal-Klasse.</span><span class="sxs-lookup"><span data-stu-id="3bc57-457">Next, create the CustomPrincipal class.</span></span> <span data-ttu-id="3bc57-458">Da wir in diesem Zusammenhang nicht betroffenen Rollen sind akzeptiert Konstruktor der CustomPrincipal-Klasse nur ein CustomIdentity-Objekt. die IsInRole-Methode gibt immer "false" zurück.</span><span class="sxs-lookup"><span data-stu-id="3bc57-458">Since we are not concerned with roles at this juncture, the CustomPrincipal class's constructor accepts only a CustomIdentity object; its IsInRole method always returns false.</span></span>

[!code-csharp[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample10.cs)]

### <a name="assigning-a-customprincipal-object-to-the-incoming-requests-security-context"></a><span data-ttu-id="3bc57-459">Zuweisen einer CustomPrincipal-Objekt an die eingehende Anforderung Sicherheitskontext</span><span class="sxs-lookup"><span data-stu-id="3bc57-459">Assigning a CustomPrincipal Object to the Incoming Request's Security Context</span></span>

<span data-ttu-id="3bc57-460">Wir haben jetzt eine Klasse, die "IIdentity" wird Standardspezifikation CompanyName "und" Title-Eigenschaften verwenden erweitert, als auch eine benutzerdefinierte principal-Klasse, die benutzerdefinierte Identität verwendet.</span><span class="sxs-lookup"><span data-stu-id="3bc57-460">We now have a class that extends the default IIdentity specification to include CompanyName and Title properties, as well as a custom principal class that uses the custom identity.</span></span> <span data-ttu-id="3bc57-461">Wir sind bereit, um einen Einzelschritt der ASP.NET-Pipeline und weisen unsere benutzerdefinierte principal-Objekt an die eingehende Anforderung Sicherheitskontext.</span><span class="sxs-lookup"><span data-stu-id="3bc57-461">We are ready to step into the ASP.NET pipeline and assign our custom principal object to the incoming request's security context.</span></span>

<span data-ttu-id="3bc57-462">Die ASP.NET-Pipeline eine eingehende Anforderung akzeptiert und verarbeitet diese durch eine Reihe von Schritten.</span><span class="sxs-lookup"><span data-stu-id="3bc57-462">The ASP.NET pipeline takes an incoming request and processes it through a number of steps.</span></span> <span data-ttu-id="3bc57-463">Bei jedem Schritt wird ein bestimmtes Ereignis ausgelöst, wodurch für Entwickler, tippen Sie in der ASP.NET-Pipeline auf und ändern die Anforderung an bestimmten Punkten im Lebenszyklus.</span><span class="sxs-lookup"><span data-stu-id="3bc57-463">At each step, a particular event is raised, making it possible for developers to tap into the ASP.NET pipeline and modify the request at certain points in its lifecycle.</span></span> <span data-ttu-id="3bc57-464">Die FormsAuthenticationModule wartet z. B. ASP.NET zum Auslösen der [Ereignis AuthenticateRequest](https://msdn.microsoft.com/library/system.web.httpapplication.authenticaterequest.aspx), an diesem Punkt er die eingehende Anforderung für ein Authentifizierungsticket untersucht.</span><span class="sxs-lookup"><span data-stu-id="3bc57-464">The FormsAuthenticationModule, for example, waits for ASP.NET to raise the [AuthenticateRequest event](https://msdn.microsoft.com/library/system.web.httpapplication.authenticaterequest.aspx), at which point it inspects the incoming request for an authentication ticket.</span></span> <span data-ttu-id="3bc57-465">Wenn ein Authentifizierungsticket gefunden wird, wird ein GenericPrincipal-Objekt erstellt und der HttpContext.User-Eigenschaft zugewiesen.</span><span class="sxs-lookup"><span data-stu-id="3bc57-465">If an authentication ticket is found, a GenericPrincipal object is created and assigned to the HttpContext.User property.</span></span>

<span data-ttu-id="3bc57-466">Nach dem Ereignis AuthenticateRequest die ASP.NET-Pipeline löst die [PostAuthenticateRequest Ereignis](https://msdn.microsoft.com/library/system.web.httpapplication.postauthenticaterequest.aspx), welche ist, in dem wir das GenericPrincipal-Objekt erstellt, indem die FormsAuthenticationModule mit einer Instanz von ersetzen können unsere CustomPrincipal-Objekt.</span><span class="sxs-lookup"><span data-stu-id="3bc57-466">After the AuthenticateRequest event, the ASP.NET pipeline raises the [PostAuthenticateRequest event](https://msdn.microsoft.com/library/system.web.httpapplication.postauthenticaterequest.aspx), which is where we can replace the GenericPrincipal object created by the FormsAuthenticationModule with an instance of our CustomPrincipal object.</span></span> <span data-ttu-id="3bc57-467">Abbildung 7 zeigt dieses Workflows.</span><span class="sxs-lookup"><span data-stu-id="3bc57-467">Figure 7 depicts this workflow.</span></span>


<span data-ttu-id="3bc57-468">[![GenericPrincipal wird durch eine CustomPrincipal im Ereignis PostAuthenticationRequest ersetzt.](forms-authentication-configuration-and-advanced-topics-cs/_static/image20.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="3bc57-468">[![The GenericPrincipal is Replaced by a CustomPrincipal in the PostAuthenticationRequest Event](forms-authentication-configuration-and-advanced-topics-cs/_static/image20.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image19.png)</span></span>

<span data-ttu-id="3bc57-469">**Abbildung 07**: die GenericPrincipal wird durch eine CustomPrincipal im Ereignis PostAuthenticationRequest ersetzt ([klicken Sie hier, um das Bild in voller Größe angezeigt](forms-authentication-configuration-and-advanced-topics-cs/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="3bc57-469">**Figure 07**: The GenericPrincipal is Replaced by a CustomPrincipal in the PostAuthenticationRequest Event ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-cs/_static/image21.png))</span></span>


<span data-ttu-id="3bc57-470">Um Code in ASP.NET Pipeline Ereignisses ausführen, können wir den passenden Ereignishandler in "Global.asax" erstellen oder unser eigenes HTTP-Modul erstellen.</span><span class="sxs-lookup"><span data-stu-id="3bc57-470">In order to execute code in response to an ASP.NET pipeline event, we can either create the appropriate event handler in Global.asax or create our own HTTP Module.</span></span> <span data-ttu-id="3bc57-471">Erstellen Sie für dieses Lernprogramm nehmen wir die Ereignishandler in "Global.asax".</span><span class="sxs-lookup"><span data-stu-id="3bc57-471">For this tutorial let's create the event handler in Global.asax.</span></span> <span data-ttu-id="3bc57-472">Starten Sie, indem Sie die Website "Global.asax" hinzugefügt.</span><span class="sxs-lookup"><span data-stu-id="3bc57-472">Start by adding Global.asax to your website.</span></span> <span data-ttu-id="3bc57-473">Mit der rechten Maustaste auf den Projektnamen im Projektmappen-Explorer, und fügen Sie ein Element vom Typ globale Anwendungsklasse mit dem Namen "Global.asax" hinzu.</span><span class="sxs-lookup"><span data-stu-id="3bc57-473">Right-click on the project name in Solution Explorer and add an item of type Global Application Class named Global.asax.</span></span>


<span data-ttu-id="3bc57-474">[![Hinzufügen einer Datei "Global.asax" zu Ihrer Website](forms-authentication-configuration-and-advanced-topics-cs/_static/image23.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="3bc57-474">[![Add a Global.asax File to Your Website](forms-authentication-configuration-and-advanced-topics-cs/_static/image23.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image22.png)</span></span>

<span data-ttu-id="3bc57-475">**Abbildung 08**: Hinzufügen einer Datei "Global.asax" zu Ihrer Website ([klicken Sie hier, um das Bild in voller Größe angezeigt](forms-authentication-configuration-and-advanced-topics-cs/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="3bc57-475">**Figure 08**: Add a Global.asax File to Your Website ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-cs/_static/image24.png))</span></span>


<span data-ttu-id="3bc57-476">Die Standardvorlage "Global.asax" enthält die Ereignishandler für eine Reihe von ASP.NET-Pipelineereignisse, einschließlich Start und Ende und [Fehlerereignis](https://msdn.microsoft.com/library/system.web.httpapplication.error.aspx), o. ä.</span><span class="sxs-lookup"><span data-stu-id="3bc57-476">The default Global.asax template includes event handlers for a number of the ASP.NET pipeline events, including the Start, End and [Error event](https://msdn.microsoft.com/library/system.web.httpapplication.error.aspx), among others.</span></span> <span data-ttu-id="3bc57-477">Gerne an diese Ereignishandler entfernt werden, da es nicht für diese Anwendung benötigt werden.</span><span class="sxs-lookup"><span data-stu-id="3bc57-477">Feel free to remove these event handlers, as we do not need them for this application.</span></span> <span data-ttu-id="3bc57-478">Das Ereignis, dem wir interessiert ist PostAuthenticateRequest.</span><span class="sxs-lookup"><span data-stu-id="3bc57-478">The event we are interested in is PostAuthenticateRequest.</span></span> <span data-ttu-id="3bc57-479">Aktualisieren Sie die Datei "Global.asax" aus, damit das Markup etwa wie folgt aussieht:</span><span class="sxs-lookup"><span data-stu-id="3bc57-479">Update your Global.asax file so its markup looks similar to the following:</span></span>

[!code-aspx[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample11.aspx)]

<span data-ttu-id="3bc57-480">Die Anwendung\_OnPostAuthenticateRequest-Methode wird jedes Mal, den die ASP.NET-Laufzeit löst das PostAuthenticateRequest-Ereignis, die einmal für jede eingehende Seitenanforderung ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="3bc57-480">The Application\_OnPostAuthenticateRequest method executes each time the ASP.NET runtime raises the PostAuthenticateRequest event, which happens once on each incoming page request.</span></span> <span data-ttu-id="3bc57-481">Der Ereignishandler wird gestartet, indem überprüft wird, um festzustellen, ob der Benutzer authentifiziert wird und über Formularauthentifizierung authentifiziert wurde.</span><span class="sxs-lookup"><span data-stu-id="3bc57-481">The event handler starts by checking to see if the user is authenticated and was authenticated via forms authentication.</span></span> <span data-ttu-id="3bc57-482">Wenn dies der Fall ist, wird ein neues CustomIdentity-Objekt erstellt und die aktuelle Anforderung Authentifizierungsticket in seinem Konstruktor übergeben.</span><span class="sxs-lookup"><span data-stu-id="3bc57-482">If so, a new CustomIdentity object is created and passed the current request's authentication ticket in its constructor.</span></span> <span data-ttu-id="3bc57-483">Danach ein CustomPrincipal-Objekt erstellt und übergeben das gerade erstellte CustomIdentity-Objekt in seinem Konstruktor.</span><span class="sxs-lookup"><span data-stu-id="3bc57-483">Following that, a CustomPrincipal object is created and passed the just-created CustomIdentity object in its constructor.</span></span> <span data-ttu-id="3bc57-484">Schließlich wird der Sicherheitskontext für die aktuelle Anforderung auf das neu erstellte CustomPrincipal-Objekt zugewiesen.</span><span class="sxs-lookup"><span data-stu-id="3bc57-484">Finally, the current request's security context is assigned to the newly created CustomPrincipal object.</span></span>

<span data-ttu-id="3bc57-485">Beachten Sie, dass der letzte Schritt - Sicherheitskontext für die Anforderung der CustomPrincipal-Objekt zuordnen - zwei Eigenschaften den Prinzipal zugewiesen: HttpContext.User und Thread.CurrentPrincipal.</span><span class="sxs-lookup"><span data-stu-id="3bc57-485">Note that the last step - associating the CustomPrincipal object with the request's security context - assigns the principal to two properties: HttpContext.User and Thread.CurrentPrincipal.</span></span> <span data-ttu-id="3bc57-486">Diese zwei Zuweisungen sind erforderlich, durch das Verfahren begründet Sicherheitskontexten in ASP.NET behandelt werden.</span><span class="sxs-lookup"><span data-stu-id="3bc57-486">These two assignments are necessary because of the way security contexts are handled in ASP.NET.</span></span> <span data-ttu-id="3bc57-487">.NET Framework ordnet jeden ausgeführten Thread einen Sicherheitskontext; Diese Informationen sind verfügbar, als eine IPrincipal-Objekt, über die [Threadobjekt](https://msdn.microsoft.com/library/system.threading.thread.aspx)des [CurrentPrincipal Eigenschaft](https://msdn.microsoft.com/library/system.threading.thread.currentcontext.aspx).</span><span class="sxs-lookup"><span data-stu-id="3bc57-487">The .NET Framework associates a security context with each running thread; this information is available as an IPrincipal object through the [Thread object](https://msdn.microsoft.com/library/system.threading.thread.aspx)'s [CurrentPrincipal property](https://msdn.microsoft.com/library/system.threading.thread.currentcontext.aspx).</span></span> <span data-ttu-id="3bc57-488">Was ist eine verwirrend ist, dass ASP.NET eigene Sicherheitskontextinformationen (HttpContext.User).</span><span class="sxs-lookup"><span data-stu-id="3bc57-488">What is a confusing is that ASP.NET has its own security context information (HttpContext.User).</span></span>

<span data-ttu-id="3bc57-489">In bestimmten Szenarien wird die Eigenschaft Thread.CurrentPrincipal untersucht, beim Bestimmen des Sicherheitskontexts; in anderen Szenarien wird HttpContext.User verwendet.</span><span class="sxs-lookup"><span data-stu-id="3bc57-489">In certain scenarios, the Thread.CurrentPrincipal property is examined when determining the security context; in other scenarios, HttpContext.User is used.</span></span> <span data-ttu-id="3bc57-490">Beispielsweise bestehen Sicherheitsfunktionen, die Entwicklern deklarativ angeben, welche Benutzer ermöglichen, in .NET oder Rollen können eine Klasse instanziieren oder bestimmte Methoden aufrufen (finden Sie unter [Hinzufügen von Autorisierungsregeln für Geschäft und Daten mithilfe von Ebenen PrincipalPermissionAttributes](https://weblogs.asp.net/scottgu/archive/2006/10/04/Tip_2F00_Trick_3A00_-Adding-Authorization-Rules-to-Business-and-Data-Layers-using-PrincipalPermissionAttributes.aspx)).</span><span class="sxs-lookup"><span data-stu-id="3bc57-490">For example, there are security features in .NET that allow developers to declaratively state what users or roles can instantiate a class or invoke specific methods (see [Adding Authorization Rules to Business and Data Layers Using PrincipalPermissionAttributes](https://weblogs.asp.net/scottgu/archive/2006/10/04/Tip_2F00_Trick_3A00_-Adding-Authorization-Rules-to-Business-and-Data-Layers-using-PrincipalPermissionAttributes.aspx)).</span></span> <span data-ttu-id="3bc57-491">Im Hintergrund bestimmen diese deklarative Techniken des Sicherheitskontexts über die Thread.CurrentPrincipal-Eigenschaft.</span><span class="sxs-lookup"><span data-stu-id="3bc57-491">Underneath the covers, these declarative techniques determine the security context via the Thread.CurrentPrincipal property.</span></span>

<span data-ttu-id="3bc57-492">In anderen Szenarien ist die HttpContext.User-Eigenschaft verwendet.</span><span class="sxs-lookup"><span data-stu-id="3bc57-492">In other scenarios, the HttpContext.User property is used.</span></span> <span data-ttu-id="3bc57-493">Beispielsweise verwendet im vorherigen Lernprogramm wir diese Eigenschaft auf den angemeldeten Benutzernamen des Benutzers anzuzeigen.</span><span class="sxs-lookup"><span data-stu-id="3bc57-493">For example, in the previous tutorial we used this property to display the currently logged on user's username.</span></span> <span data-ttu-id="3bc57-494">Es ist offensichtlich, ist es dann zwingend erforderlich, dass die Sicherheitskontextinformationen in den Eigenschaften des Thread.CurrentPrincipal und HttpContext.User überein.</span><span class="sxs-lookup"><span data-stu-id="3bc57-494">Clearly, then, it is imperative that the security context information in the Thread.CurrentPrincipal and HttpContext.User properties match up.</span></span>

<span data-ttu-id="3bc57-495">Die ASP.NET-Laufzeit wird automatisch diese Eigenschaftswerte für uns synchronisiert.</span><span class="sxs-lookup"><span data-stu-id="3bc57-495">The ASP.NET runtime automatically syncs these property values for us.</span></span> <span data-ttu-id="3bc57-496">Allerdings erfolgt die Synchronisierung nach dem Ereignis AuthenticateRequest jedoch *vor* das PostAuthenticateRequest-Ereignis.</span><span class="sxs-lookup"><span data-stu-id="3bc57-496">However, this synchronization occurs after the AuthenticateRequest event, but *before* the PostAuthenticateRequest event.</span></span> <span data-ttu-id="3bc57-497">Daher beim Hinzufügen von eines benutzerdefinierten Prinzipals im Ereignis PostAuthenticateRequest müssen bestimmte die Thread.CurrentPrincipal, da sonst Thread.CurrentPrincipal manuell zugewiesen werden und HttpContext.User wird nicht mehr synchron. Finden Sie unter [Context.User Vs. Thread.CurrentPrincipal](http://leastprivilege.com/2005/11/23/context-user-vs-thread-currentprincipal/) für eine ausführlichere Erläuterung zu diesem Problem.</span><span class="sxs-lookup"><span data-stu-id="3bc57-497">Consequently, when adding a custom principal in the PostAuthenticateRequest event we need to be certain to manually assign the Thread.CurrentPrincipal or else Thread.CurrentPrincipal and HttpContext.User will be out of sync. See [Context.User vs. Thread.CurrentPrincipal](http://leastprivilege.com/2005/11/23/context-user-vs-thread-currentprincipal/) for a more detailed discussion on this issue.</span></span>

### <a name="accessing-the-companyname-and-title-properties"></a><span data-ttu-id="3bc57-498">Zugreifen auf die CompanyName und Titeleigenschaften</span><span class="sxs-lookup"><span data-stu-id="3bc57-498">Accessing the CompanyName and Title Properties</span></span>

<span data-ttu-id="3bc57-499">Wenn eine Anforderung eingeht und an das Modul für ASP.NET, der Anwendung verteilt wird\_OnPostAuthenticateRequest-Ereignishandler in "Global.asax" ausgelöst wird.</span><span class="sxs-lookup"><span data-stu-id="3bc57-499">Whenever a request arrives and is dispatched to the ASP.NET engine, the Application\_OnPostAuthenticateRequest event handler in Global.asax will fire.</span></span> <span data-ttu-id="3bc57-500">Wenn die Anforderung von der FormsAuthenticationModule erfolgreich authentifiziert wurden, wird der Ereignishandler ein neues CustomPrincipal-Objekt mit einem CustomIdentity-Objekt, das das Formularauthentifizierungsticket Grundlage erstellen.</span><span class="sxs-lookup"><span data-stu-id="3bc57-500">If the request has been successfully authenticated by the FormsAuthenticationModule, the event handler will create a new CustomPrincipal object with a CustomIdentity object based on the forms authentication ticket.</span></span> <span data-ttu-id="3bc57-501">Mit dieser Logik vorhanden ist ist der Zugriff auf Informationen zu den Firmennamen und Titel des aktuell angemeldeten Benutzers äußerst einfach.</span><span class="sxs-lookup"><span data-stu-id="3bc57-501">With this logic in place, accessing information about the currently logged on user's company name and title is incredibly straightforward.</span></span>

<span data-ttu-id="3bc57-502">Kehren Sie zur Seite\_Load-Ereignishandler in "default.aspx" in Schritt 4 wird, in dem Code das Authentifizierungsticket Formular abrufen und analysieren die UserData-Eigenschaft geschrieben, um Firmennamen und Titel des Benutzers anzuzeigen.</span><span class="sxs-lookup"><span data-stu-id="3bc57-502">Return to the Page\_Load event handler in Default.aspx, where in Step 4 we wrote code to retrieve the form authentication ticket and parse the UserData property in order to display the user's company name and title.</span></span> <span data-ttu-id="3bc57-503">Mit der CustomPrincipal und CustomIdentity-Objekte jetzt ist es nicht erforderlich, die Werte aus dem Ticket UserData Eigenschaft zu analysieren.</span><span class="sxs-lookup"><span data-stu-id="3bc57-503">With the CustomPrincipal and CustomIdentity objects in use now, there's no need to parse the values out of the ticket's UserData property.</span></span> <span data-ttu-id="3bc57-504">Rufen Sie stattdessen einfach einen Verweis auf das CustomIdentity-Objekt und verwenden Sie ihre Eigenschaften CompanyName "und" Title:</span><span class="sxs-lookup"><span data-stu-id="3bc57-504">Instead, simply get a reference to the CustomIdentity object and use its CompanyName and Title properties:</span></span>

[!code-csharp[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample12.cs)]

## <a name="summary"></a><span data-ttu-id="3bc57-505">Zusammenfassung</span><span class="sxs-lookup"><span data-stu-id="3bc57-505">Summary</span></span>

<span data-ttu-id="3bc57-506">In diesem Lernprogramm untersucht wir zum Anpassen der Forms-Authentifizierungssystem-Einstellungen über die Datei "Web.config". Erläutert, wie das Authentifizierungsticket Ablauf behandelt wird und wie mit den Schutzvorrichtungen Verschlüsselung und gültigkeitsprüfung verwendet werden, um das Ticket vor überprüfungs- und die Änderung zu schützen.</span><span class="sxs-lookup"><span data-stu-id="3bc57-506">In this tutorial we examined how to customize the forms authentication system's settings via Web.config. We looked at how the authentication ticket's expiration is handled and how the encryption and validation safeguards are used to protect the ticket from inspection and modification.</span></span> <span data-ttu-id="3bc57-507">Abschließend wird erläutert, mit das Authentifizierungsticket UserData Eigenschaft zum Speichern von zusätzliche Benutzerinformationen in das Ticket selbst und wie benutzerdefinierte Haupt- und Identitätsobjekte Objekte verwenden, um diese Informationen in einer Weise mehr entwicklerfreundlichsten verfügbar machen.</span><span class="sxs-lookup"><span data-stu-id="3bc57-507">Finally, we discussed using the authentication ticket's UserData property to store additional user information in the ticket itself, and how to use custom principal and identity objects to expose this information in a more developer-friendly manner.</span></span>

<span data-ttu-id="3bc57-508">In diesem Lernprogramm endet unsere Untersuchung der Formularauthentifizierung in ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="3bc57-508">This tutorial concludes our examination of forms authentication in ASP.NET.</span></span> <span data-ttu-id="3bc57-509">Der nächste Lernprogrammen beginnt unsere Reise in die Mitgliedschaft-Framework.</span><span class="sxs-lookup"><span data-stu-id="3bc57-509">The next tutorial starts our journey into the Membership framework.</span></span>

<span data-ttu-id="3bc57-510">Viel Spaß beim Programmieren!</span><span class="sxs-lookup"><span data-stu-id="3bc57-510">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="3bc57-511">Weiterführende Themen</span><span class="sxs-lookup"><span data-stu-id="3bc57-511">Further Reading</span></span>

<span data-ttu-id="3bc57-512">Weitere Informationen zu den Themen in diesem Lernprogramm erläutert finden Sie in den folgenden Ressourcen:</span><span class="sxs-lookup"><span data-stu-id="3bc57-512">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="3bc57-513">Formularauthentifizierung unterzogen, wodurch</span><span class="sxs-lookup"><span data-stu-id="3bc57-513">Dissecting Forms Authentication</span></span>](http://aspnet.4guysfromrolla.com/articles/072005-1.aspx)
- [<span data-ttu-id="3bc57-514">Erläutert: Formularauthentifizierung in ASP.NET 2.0</span><span class="sxs-lookup"><span data-stu-id="3bc57-514">Explained: Forms Authentication in ASP.NET 2.0</span></span>](https://msdn.microsoft.com/library/aa480476.aspx)
- [<span data-ttu-id="3bc57-515">Gewusst wie: Schützen Sie Formularauthentifizierung in ASP.NET 2.0</span><span class="sxs-lookup"><span data-stu-id="3bc57-515">How To: Protect Forms Authentication in ASP.NET 2.0</span></span>](https://msdn.microsoft.com/library/ms998310.aspx)
- <span data-ttu-id="3bc57-516">[Professionelle ASP.NET 2.0 Sicherheit, Mitgliedschaft und Rollenverwaltung](http://www.wrox.com/WileyCDA/WroxTitle/productCd-0764596985.html) (ISBN: 978-0-7645-9698-8)</span><span class="sxs-lookup"><span data-stu-id="3bc57-516">[Professional ASP.NET 2.0 Security, Membership, and Role Management](http://www.wrox.com/WileyCDA/WroxTitle/productCd-0764596985.html) (ISBN: 978-0-7645-9698-8)</span></span>
- [<span data-ttu-id="3bc57-517">Sichern von Anmeldesteuerelementen</span><span class="sxs-lookup"><span data-stu-id="3bc57-517">Securing Login Controls</span></span>](https://msdn.microsoft.com/library/ms178346.aspx)
- [<span data-ttu-id="3bc57-518">Die &lt;Authentifizierung&gt; Element</span><span class="sxs-lookup"><span data-stu-id="3bc57-518">The &lt;authentication&gt; Element</span></span>](https://msdn.microsoft.com/library/532aee0e.aspx)
- [<span data-ttu-id="3bc57-519">Die &lt;Forms&gt; -Element für &lt;Authentifizierung&gt;</span><span class="sxs-lookup"><span data-stu-id="3bc57-519">The &lt;forms&gt; Element for &lt;authentication&gt;</span></span>](https://msdn.microsoft.com/library/1d3t3c61.aspx)
- [<span data-ttu-id="3bc57-520">Die &lt;MachineKey&gt; Element</span><span class="sxs-lookup"><span data-stu-id="3bc57-520">The &lt;machineKey&gt; Element</span></span>](https://msdn.microsoft.com/library/w8h3skw9.aspx)
- [<span data-ttu-id="3bc57-521">Grundlegendes zu den Formularauthentifizierungsticket und Cookies</span><span class="sxs-lookup"><span data-stu-id="3bc57-521">Understanding the Forms Authentication Ticket and Cookie</span></span>](https://support.microsoft.com/kb/910443)

### <a name="video-training-on-topics-contained-in-this-tutorial"></a><span data-ttu-id="3bc57-522">Lehrvideos auf die Themen in diesem Lernprogramm</span><span class="sxs-lookup"><span data-stu-id="3bc57-522">Video Training on Topics Contained in this Tutorial</span></span>

- [<span data-ttu-id="3bc57-523">Gewusst wie: Ändern der Authentifizierungseigenschaften Formulare</span><span class="sxs-lookup"><span data-stu-id="3bc57-523">How to Change the Forms Authentication Properties</span></span>](../../../videos/authentication/how-to-change-the-forms-authentication-properties.md)
- [<span data-ttu-id="3bc57-524">Zum Einrichten und Verwenden von Cookies Authentifizierung in einer ASP.NET-Anwendung</span><span class="sxs-lookup"><span data-stu-id="3bc57-524">How to Setup and Use Cookie-less Authentication in an ASP.NET Application</span></span>](../../../videos/authentication/how-to-setup-and-use-cookie-less-authentication-in-an-aspnet-application.md)
- [<span data-ttu-id="3bc57-525">Verschieben der ASP-Formularanmeldung</span><span class="sxs-lookup"><span data-stu-id="3bc57-525">ASP Forms Login Relocation</span></span>](../../../videos/authentication/asp-forms-login-relocation.md)
- [<span data-ttu-id="3bc57-526">Benutzerdefinierte Schlüsselkonfiguration für die Formularanmeldung</span><span class="sxs-lookup"><span data-stu-id="3bc57-526">Forms Login Custom Key Configuration</span></span>](../../../videos/authentication/forms-login-custom-key-configuration.md)
- [<span data-ttu-id="3bc57-527">Hinzufügen von benutzerdefinierten Daten zur Authentifizierungsmethode</span><span class="sxs-lookup"><span data-stu-id="3bc57-527">Add Custom Data to the Authentication Method</span></span>](../../../videos/authentication/add-custom-data-to-the-authentication-method.md)
- [<span data-ttu-id="3bc57-528">Verwenden von benutzerdefinierten Prinzipalobjekten</span><span class="sxs-lookup"><span data-stu-id="3bc57-528">Use Custom Principal Objects</span></span>](../../../videos/authentication/use-custom-principal-objects.md)

### <a name="about-the-author"></a><span data-ttu-id="3bc57-529">Informationen zum Autor</span><span class="sxs-lookup"><span data-stu-id="3bc57-529">About the Author</span></span>

<span data-ttu-id="3bc57-530">Scott Mitchell, Autor von mehreren ASP/ASP.NET-Büchern und Gründer von 4GuysFromRolla.com, bereits seit 1998 mit Microsoft-Web-Technologien gearbeitet.</span><span class="sxs-lookup"><span data-stu-id="3bc57-530">Scott Mitchell, author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="3bc57-531">Scott fungiert als ein unabhängiger Berater, Trainer und Writer.</span><span class="sxs-lookup"><span data-stu-id="3bc57-531">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="3bc57-532">Sein neueste Buch wird * [Sams Schulen selbst ASP.NET 2.0 in 24 Stunden](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span><span class="sxs-lookup"><span data-stu-id="3bc57-532">His latest book is *[Sams Teach Yourself ASP.NET 2.0 in 24 Hours](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span></span> <span data-ttu-id="3bc57-533">Scott erreicht werden kann, zur [ mitchell@4guysfromrolla.com ](mailto:mitchell@4guysfromrolla.com) oder über seinen Blog unter [ http://ScottOnWriting.NET ](http://scottonwriting.net/).</span><span class="sxs-lookup"><span data-stu-id="3bc57-533">Scott can be reached at [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="3bc57-534">Besonderen Dank an</span><span class="sxs-lookup"><span data-stu-id="3bc57-534">Special Thanks To</span></span>

<span data-ttu-id="3bc57-535">Diese Reihe von Lernprogrammen wurde durch viele nützliche Bearbeiter überprüft.</span><span class="sxs-lookup"><span data-stu-id="3bc57-535">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="3bc57-536">Lead Prüfer für dieses Lernprogramm wurde Alicja Maziarz.</span><span class="sxs-lookup"><span data-stu-id="3bc57-536">Lead reviewer for this tutorial was Alicja Maziarz.</span></span> <span data-ttu-id="3bc57-537">Meine bevorstehende MSDN-Artikel Überprüfen von Interesse?</span><span class="sxs-lookup"><span data-stu-id="3bc57-537">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="3bc57-538">Wenn dies der Fall ist, löschen Sie mich zeilenweise [ mitchell@4GuysFromRolla.com ](mailto:mitchell@4guysfromrolla.com).</span><span class="sxs-lookup"><span data-stu-id="3bc57-538">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4guysfromrolla.com).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="3bc57-539">[Zurück](an-overview-of-forms-authentication-cs.md)
> [Weiter](security-basics-and-asp-net-support-vb.md)</span><span class="sxs-lookup"><span data-stu-id="3bc57-539">[Previous](an-overview-of-forms-authentication-cs.md)
[Next](security-basics-and-asp-net-support-vb.md)</span></span>
