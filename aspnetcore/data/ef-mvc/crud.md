---
title: ASP.NET Core MVC mit EF-Kern - CRUD - 2-10
author: tdykstra
description: 
manager: wpickett
ms.author: tdykstra
ms.date: 03/15/2017
ms.prod: asp.net-core
ms.technology: aspnet
ms.topic: get-started-article
uid: data/ef-mvc/crud
ms.openlocfilehash: a7e0d4ff3d57e42dd7e33ffb5f26f2143520be87
ms.sourcegitcommit: a510f38930abc84c4b302029d019a34dfe76823b
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 01/30/2018
---
# <a name="create-read-update-and-delete---ef-core-with-aspnet-core-mvc-tutorial-2-of-10"></a><span data-ttu-id="93e5c-102">Erstellen Sie, lesen Sie, aktualisieren Sie und löschen Sie-EF-Core mit ASP.NET Core MVC-Lernprogramm (2 von 10)</span><span class="sxs-lookup"><span data-stu-id="93e5c-102">Create, Read, Update, and Delete - EF Core with ASP.NET Core MVC tutorial (2 of 10)</span></span>

<span data-ttu-id="93e5c-103">Durch [Tom Dykstra](https://github.com/tdykstra) und [Rick Anderson](https://twitter.com/RickAndMSFT)</span><span class="sxs-lookup"><span data-stu-id="93e5c-103">By [Tom Dykstra](https://github.com/tdykstra) and [Rick Anderson](https://twitter.com/RickAndMSFT)</span></span>

<span data-ttu-id="93e5c-104">Die Contoso-University Beispielwebanwendung veranschaulicht, wie ASP.NET Core MVC-Webanwendungen, die mit Entity Framework Core und Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="93e5c-104">The Contoso University sample web application demonstrates how to create ASP.NET Core MVC web applications using Entity Framework Core and Visual Studio.</span></span> <span data-ttu-id="93e5c-105">Informationen über die Reihe von Lernprogrammen finden Sie unter [im ersten Lernprogramm, in der Reihe](intro.md).</span><span class="sxs-lookup"><span data-stu-id="93e5c-105">For information about the tutorial series, see [the first tutorial in the series](intro.md).</span></span>

<span data-ttu-id="93e5c-106">Im vorherigen Lernprogramm erstellt Sie eine MVC-Anwendung, die gespeichert und Daten mit dem Entity Framework und SQL Server LocalDB angezeigt.</span><span class="sxs-lookup"><span data-stu-id="93e5c-106">In the previous tutorial, you created an MVC application that stores and displays data using the Entity Framework and SQL Server LocalDB.</span></span> <span data-ttu-id="93e5c-107">In diesem Lernprogramm müssen Sie überprüfen und anpassen, die CRUD-Vorgänge (erstellen, lesen, aktualisieren und löschen) Code, der die MVC-Gerüstbau automatisch für Sie in den Controller und Ansichten erstellt.</span><span class="sxs-lookup"><span data-stu-id="93e5c-107">In this tutorial, you'll review and customize the CRUD (create, read, update, delete) code that the MVC scaffolding automatically creates for you in controllers and views.</span></span>

> [!NOTE] 
> <span data-ttu-id="93e5c-108">Es ist allgemein üblich, des Repositorymusters zu implementieren, um eine Abstraktionsebene zwischen Ihrem Domänencontroller und die Datenzugriffsebene zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="93e5c-108">It's a common practice to implement the repository pattern in order to create an abstraction layer between your controller and the data access layer.</span></span> <span data-ttu-id="93e5c-109">Um diese Lernprogramme einfach und konzentriert sich auf durcharbeiten zum Verwenden von Entity Framework selbst zu halten, verwenden sie nicht die Repositorys.</span><span class="sxs-lookup"><span data-stu-id="93e5c-109">To keep these tutorials simple and focused on teaching how to use the Entity Framework itself, they don't use repositories.</span></span> <span data-ttu-id="93e5c-110">Informationen des Repositorys mit EF finden Sie unter [im letzten Lernprogramm dieser Reihe](advanced.md).</span><span class="sxs-lookup"><span data-stu-id="93e5c-110">For information about repositories with EF, see [the last tutorial in this series](advanced.md).</span></span>

<span data-ttu-id="93e5c-111">In diesem Lernprogramm arbeiten Sie mit den folgenden Webseiten:</span><span class="sxs-lookup"><span data-stu-id="93e5c-111">In this tutorial, you'll work with the following web pages:</span></span>

![Seite "Details" Student](crud/_static/student-details.png)

![Seite "Student erstellen"](crud/_static/student-create.png)

![Student bearbeiten (Seite)](crud/_static/student-edit.png)

![Seite "Student löschen"](crud/_static/student-delete.png)

## <a name="customize-the-details-page"></a><span data-ttu-id="93e5c-116">Anpassen der Seite "Details"</span><span class="sxs-lookup"><span data-stu-id="93e5c-116">Customize the Details page</span></span>

<span data-ttu-id="93e5c-117">Der scaffolded Code für die Studenten Indexseite außer acht gelassen der `Enrollments` -Eigenschaft, da diese Eigenschaft eine Auflistung enthält.</span><span class="sxs-lookup"><span data-stu-id="93e5c-117">The scaffolded code for the Students Index page left out the `Enrollments` property, because that property holds a collection.</span></span> <span data-ttu-id="93e5c-118">In der **Details** Seite zeigen Sie den Inhalt der Auflistung in einer HTML-Tabelle.</span><span class="sxs-lookup"><span data-stu-id="93e5c-118">In the **Details** page, you'll display the contents of the collection in an HTML table.</span></span>

<span data-ttu-id="93e5c-119">In *Controllers/StudentsController.cs*, die Aktionsmethode Details anzeigen, verwendet der `SingleOrDefaultAsync` Methode zum Abrufen einer einzelnes `Student` Entität.</span><span class="sxs-lookup"><span data-stu-id="93e5c-119">In *Controllers/StudentsController.cs*, the action method for the Details view uses the `SingleOrDefaultAsync` method to retrieve a single `Student` entity.</span></span> <span data-ttu-id="93e5c-120">Fügen Sie Code, der aufruft `Include`.</span><span class="sxs-lookup"><span data-stu-id="93e5c-120">Add code that calls `Include`.</span></span> <span data-ttu-id="93e5c-121">`ThenInclude`, und `AsNoTracking` Methoden, wie im folgenden hervorgehobenen Code gezeigt.</span><span class="sxs-lookup"><span data-stu-id="93e5c-121">`ThenInclude`,  and `AsNoTracking` methods, as shown in the following highlighted code.</span></span>

[!code-csharp[Main](intro/samples/cu/Controllers/StudentsController.cs?name=snippet_Details&highlight=8-12)]

<span data-ttu-id="93e5c-122">Die `Include` und `ThenInclude` Methoden dazu führen, dass den Kontext beim Laden der `Student.Enrollments` Navigationseigenschaft, und innerhalb jeder Registrierung der `Enrollment.Course` Navigationseigenschaft.</span><span class="sxs-lookup"><span data-stu-id="93e5c-122">The `Include` and `ThenInclude` methods cause the context to load the `Student.Enrollments` navigation property, and within each enrollment the `Enrollment.Course` navigation property.</span></span>  <span data-ttu-id="93e5c-123">Erfahren Sie mehr über diese Methoden in der [lesen verknüpfte Daten](read-related-data.md) Lernprogramm.</span><span class="sxs-lookup"><span data-stu-id="93e5c-123">You'll learn more about these methods in the [reading related data](read-related-data.md) tutorial.</span></span>

<span data-ttu-id="93e5c-124">Die `AsNoTracking` Methode verbessert die Leistung in Szenarien, in dem die zurückgegebenen Entitäten wird nicht in den aktuellen Kontext Lebensdauer aktualisiert werden.</span><span class="sxs-lookup"><span data-stu-id="93e5c-124">The `AsNoTracking` method improves performance in scenarios where the entities returned won't be updated in the current context's lifetime.</span></span> <span data-ttu-id="93e5c-125">Erfahren Sie mehr über `AsNoTracking` am Ende dieses Lernprogramms.</span><span class="sxs-lookup"><span data-stu-id="93e5c-125">You'll learn more about `AsNoTracking` at the end of this tutorial.</span></span>

### <a name="route-data"></a><span data-ttu-id="93e5c-126">Weiterleitung von Daten</span><span class="sxs-lookup"><span data-stu-id="93e5c-126">Route data</span></span>

<span data-ttu-id="93e5c-127">Der Schlüssel-Wert, der an die `Details` Methode stammen aus *Weiterleiten von Daten*.</span><span class="sxs-lookup"><span data-stu-id="93e5c-127">The key value that's passed to the `Details` method comes from *route data*.</span></span> <span data-ttu-id="93e5c-128">Routendaten sind Daten, die der Modellbinder in einem Segment der URL gefunden.</span><span class="sxs-lookup"><span data-stu-id="93e5c-128">Route data is data that the model binder found in a segment of the URL.</span></span> <span data-ttu-id="93e5c-129">Die Standardroute gibt z. B. Controller, Aktion und Id Segmente:</span><span class="sxs-lookup"><span data-stu-id="93e5c-129">For example, the default route specifies controller, action, and id segments:</span></span>

[!code-csharp[Main](intro/samples/cu/Startup.cs?name=snippet_Route&highlight=5)]

<span data-ttu-id="93e5c-130">In der folgenden URL wird die Standardroute Dozenten wie den Controller, der Index als Aktion, und mit der Id 1 zugeordnet; Hierbei handelt es sich um Datenwerte für die Route.</span><span class="sxs-lookup"><span data-stu-id="93e5c-130">In the following URL, the default route maps Instructor as the controller, Index as the action, and 1 as the id; these are route data values.</span></span>

```
http://localhost:1230/Instructor/Index/1?courseID=2021
```

<span data-ttu-id="93e5c-131">Der letzte Teil der URL ("? CourseID 2021 =") ist ein Abfrage-Zeichenfolgenwert.</span><span class="sxs-lookup"><span data-stu-id="93e5c-131">The last part of the URL ("?courseID=2021") is a query string value.</span></span> <span data-ttu-id="93e5c-132">Übergibt der Modellbinder auch den ID-Wert, der `Details` Methode `id` Parameter an, wenn Sie es als ein Wert der Abfragezeichenfolge übergeben:</span><span class="sxs-lookup"><span data-stu-id="93e5c-132">The model binder will also pass the ID value to the `Details` method `id` parameter if you pass it as a query string value:</span></span>

```
http://localhost:1230/Instructor/Index?id=1&CourseID=2021
```

<span data-ttu-id="93e5c-133">Hyperlink-URLs werden in die Indexseite von Tag Helper-Anweisungen in der Razor-Ansicht erstellt.</span><span class="sxs-lookup"><span data-stu-id="93e5c-133">In the Index page, hyperlink URLs are created by tag helper statements in the Razor view.</span></span> <span data-ttu-id="93e5c-134">Im folgenden Razor-Code der `id` Parameter entspricht der Standardroute daher `id` die Routendaten hinzugefügt wird.</span><span class="sxs-lookup"><span data-stu-id="93e5c-134">In the following Razor code, the `id` parameter matches the default route, so `id` is added to the route data.</span></span>

```html
<a asp-action="Edit" asp-route-id="@item.ID">Edit</a>
```

<span data-ttu-id="93e5c-135">Dadurch wird der folgenden HTML-Code generiert beim `item.ID` 6:</span><span class="sxs-lookup"><span data-stu-id="93e5c-135">This generates the following HTML when `item.ID` is 6:</span></span>

```html
<a href="/Students/Edit/6">Edit</a>
```

<span data-ttu-id="93e5c-136">Im folgenden Razor-Code `studentID` einen Parameter in die Standardroute stimmt nicht überein, damit sie als eine Abfragezeichenfolge hinzugefügt wird.</span><span class="sxs-lookup"><span data-stu-id="93e5c-136">In the following Razor code, `studentID` doesn't match a parameter in the default route, so it's added as a query string.</span></span>

```html
<a asp-action="Edit" asp-route-studentID="@item.ID">Edit</a>
```

<span data-ttu-id="93e5c-137">Dadurch wird der folgenden HTML-Code generiert beim `item.ID` 6:</span><span class="sxs-lookup"><span data-stu-id="93e5c-137">This generates the following HTML when `item.ID` is 6:</span></span>

```html
<a href="/Students/Edit?studentID=6">Edit</a>
```

<span data-ttu-id="93e5c-138">Weitere Informationen zu den Tag-Hilfsprogrammen, finden Sie unter [Tag Hilfsprogramme in ASP.NET Core](xref:mvc/views/tag-helpers/intro).</span><span class="sxs-lookup"><span data-stu-id="93e5c-138">For more information about tag helpers, see [Tag helpers in ASP.NET Core](xref:mvc/views/tag-helpers/intro).</span></span>

### <a name="add-enrollments-to-the-details-view"></a><span data-ttu-id="93e5c-139">Die Detailansicht Registrierung hinzugefügt</span><span class="sxs-lookup"><span data-stu-id="93e5c-139">Add enrollments to the Details view</span></span>

<span data-ttu-id="93e5c-140">Open *Views/Students/Details.cshtml*.</span><span class="sxs-lookup"><span data-stu-id="93e5c-140">Open *Views/Students/Details.cshtml*.</span></span> <span data-ttu-id="93e5c-141">Jedes Feld wird angezeigt, mit `DisplayNameFor` und `DisplayFor` -Hilfen, wie im folgenden Beispiel gezeigt:</span><span class="sxs-lookup"><span data-stu-id="93e5c-141">Each field is displayed using `DisplayNameFor` and `DisplayFor` helpers, as shown in the following example:</span></span>

[!code-html[](intro/samples/cu/Views/Students/Details.cshtml?range=13-18&highlight=2,5)]

<span data-ttu-id="93e5c-142">Nachdem das letzte Feld und unmittelbar vor der schließenden `</dl>` kennzeichnen, fügen Sie folgenden Code aus, um eine Liste der Bereitstellungen anzuzeigen:</span><span class="sxs-lookup"><span data-stu-id="93e5c-142">After the last field and immediately before the closing `</dl>` tag, add the following code to display a list of enrollments:</span></span>

[!code-html[](intro/samples/cu/Views/Students/Details.cshtml?range=31-52)]

<span data-ttu-id="93e5c-143">Wenn Code Einzug falsch ist, nachdem Sie den Code einfügen, drücken Sie STRG + K + D, um sie zu korrigieren.</span><span class="sxs-lookup"><span data-stu-id="93e5c-143">If code indentation is wrong after you paste the code, press CTRL-K-D to correct it.</span></span>

<span data-ttu-id="93e5c-144">Dieser Code durchläuft die Entitäten in der `Enrollments` Navigationseigenschaft.</span><span class="sxs-lookup"><span data-stu-id="93e5c-144">This code loops through the entities in the `Enrollments` navigation property.</span></span> <span data-ttu-id="93e5c-145">Für jede Anmeldung zeigt es den Kurstitel und die Dienstqualität dargestellt.</span><span class="sxs-lookup"><span data-stu-id="93e5c-145">For each enrollment, it displays the course title and the grade.</span></span> <span data-ttu-id="93e5c-146">Der Titel des Kurses wird abgerufen, aus der Kurs-Entität, die in gespeichert ist die `Course` Navigationseigenschaft der Registrierung Entität.</span><span class="sxs-lookup"><span data-stu-id="93e5c-146">The course title is retrieved from the Course entity that's stored in the `Course` navigation property of the Enrollments entity.</span></span>

<span data-ttu-id="93e5c-147">Die app auszuführen, wählen Sie die **Studenten** Registerkarte, und klicken Sie auf die **Details** Link, um ein Student.</span><span class="sxs-lookup"><span data-stu-id="93e5c-147">Run the app, select the **Students** tab, and click the **Details** link for a student.</span></span> <span data-ttu-id="93e5c-148">Sie können die Liste der Kurse und den Qualitäten für den ausgewählten Schüler anzuzeigen:</span><span class="sxs-lookup"><span data-stu-id="93e5c-148">You see the list of courses and grades for the selected student:</span></span>

![Seite "Details" Student](crud/_static/student-details.png)

## <a name="update-the-create-page"></a><span data-ttu-id="93e5c-150">Aktualisieren Sie die Seite "erstellen"</span><span class="sxs-lookup"><span data-stu-id="93e5c-150">Update the Create page</span></span>

<span data-ttu-id="93e5c-151">In *StudentsController.cs*, ändern Sie die HttpPost `Create` Methode durch eine Try-Catch-Block hinzufügen und Entfernen von-ID aus der `Bind` Attribut.</span><span class="sxs-lookup"><span data-stu-id="93e5c-151">In *StudentsController.cs*, modify the HttpPost `Create` method by adding a try-catch block and removing ID from the `Bind` attribute.</span></span>

[!code-csharp[Main](intro/samples/cu/Controllers/StudentsController.cs?name=snippet_Create&highlight=4,6-7,14-21)]

<span data-ttu-id="93e5c-152">Dieser Code fügt die Student-Entität erstellt, indem der ASP.NET MVC-Modellbinder für die Entität Studenten festgelegt, und klicken Sie dann die Änderungen in der Datenbank gespeichert.</span><span class="sxs-lookup"><span data-stu-id="93e5c-152">This code adds the Student entity created by the ASP.NET MVC model binder to the Students entity set and then saves the changes to the database.</span></span> <span data-ttu-id="93e5c-153">(Modellbinder bezieht sich auf die ASP.NET MVC-Funktionalität, die Sie zum Arbeiten mit Daten, die von einem Formular übermittelt erleichtert, ein Modellbinder übermittelte Formularwerte in CLR-Typen konvertiert, und übergibt sie an die Aktionsmethode im Parameters.</span><span class="sxs-lookup"><span data-stu-id="93e5c-153">(Model binder refers to the ASP.NET MVC functionality that makes it easier for you to work with data submitted by a form; a model binder converts posted form values to CLR types and passes them to the action method in parameters.</span></span> <span data-ttu-id="93e5c-154">In diesem Fall instanziiert der Modellbinder eine Student-Entität für Sie Eigenschaftswerte aus der Auflistung Formular verwenden.)</span><span class="sxs-lookup"><span data-stu-id="93e5c-154">In this case, the model binder instantiates a Student entity for you using property values from the Form collection.)</span></span>

<span data-ttu-id="93e5c-155">Sie entfernt `ID` aus der `Bind` Attribut, da-ID des Primärschlüsselwerts ist die SQL Server automatisch festgelegt wird, wenn die Zeile eingefügt wird.</span><span class="sxs-lookup"><span data-stu-id="93e5c-155">You removed `ID` from the `Bind` attribute because ID is the primary key value which SQL Server will set automatically when the row is inserted.</span></span> <span data-ttu-id="93e5c-156">Eingaben des Benutzers festgelegt nicht den ID-Wert.</span><span class="sxs-lookup"><span data-stu-id="93e5c-156">Input from the user doesn't set the ID value.</span></span>

<span data-ttu-id="93e5c-157">Anders als die `Bind` Try-Catch-Block befindet, die einzige Änderung, die Sie an den scaffolded Code vorgenommen haben.</span><span class="sxs-lookup"><span data-stu-id="93e5c-157">Other than the `Bind` attribute, the try-catch block is the only change you've made to the scaffolded code.</span></span> <span data-ttu-id="93e5c-158">Wenn eine Ausnahme, die abgeleitet `DbUpdateException` wird erfasst, während die Änderungen gespeichert werden, wird eine allgemeine Fehlermeldung angezeigt.</span><span class="sxs-lookup"><span data-stu-id="93e5c-158">If an exception that derives from `DbUpdateException` is caught while the changes are being saved, a generic error message is displayed.</span></span> <span data-ttu-id="93e5c-159">`DbUpdateException`Ausnahmen werden manchmal etwas anderes außerhalb der Anwendung statt auf einen Programmierfehler verursacht, damit der Benutzer informiert wird, versuchen Sie es erneut.</span><span class="sxs-lookup"><span data-stu-id="93e5c-159">`DbUpdateException` exceptions are sometimes caused by something external to the application rather than a programming error, so the user is advised to try again.</span></span> <span data-ttu-id="93e5c-160">Obwohl in diesem Beispiel nicht implementiert wird, würde eine Qualität produktionsanwendung protokolliert die Ausnahme.</span><span class="sxs-lookup"><span data-stu-id="93e5c-160">Although not implemented in this sample, a production quality application would log the exception.</span></span> <span data-ttu-id="93e5c-161">Weitere Informationen finden Sie unter der **Protokoll Einblicke** im Abschnitt [Überwachung und Telemetrie (Building Real-World Cloud Apps with Azure)](https://docs.microsoft.com/aspnet/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/monitoring-and-telemetry).</span><span class="sxs-lookup"><span data-stu-id="93e5c-161">For more information, see the **Log for insight** section in [Monitoring and Telemetry (Building Real-World Cloud Apps with Azure)](https://docs.microsoft.com/aspnet/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/monitoring-and-telemetry).</span></span>

<span data-ttu-id="93e5c-162">Die `ValidateAntiForgeryToken` Attribut hilft dabei, siteübergreifende Anforderung Websiteübergreifender Anforderungsfälschungsangriffe zu verhindern.</span><span class="sxs-lookup"><span data-stu-id="93e5c-162">The `ValidateAntiForgeryToken` attribute helps prevent cross-site request forgery (CSRF) attacks.</span></span> <span data-ttu-id="93e5c-163">Das Token wird automatisch eingefügt, in der Sicht durch die [FormTagHelper](xref:mvc/views/working-with-forms#the-form-tag-helper) und enthalten ist, wenn das Formular vom Benutzer gesendet wird.</span><span class="sxs-lookup"><span data-stu-id="93e5c-163">The token is automatically injected into the view by the [FormTagHelper](xref:mvc/views/working-with-forms#the-form-tag-helper) and is included when the form is submitted by the user.</span></span> <span data-ttu-id="93e5c-164">Das Token wird überprüft, indem die `ValidateAntiForgeryToken` Attribut.</span><span class="sxs-lookup"><span data-stu-id="93e5c-164">The token is validated by the `ValidateAntiForgeryToken` attribute.</span></span> <span data-ttu-id="93e5c-165">Weitere Informationen zu CSRF, finden Sie unter [Anti-Anforderungsfälschung](../../security/anti-request-forgery.md).</span><span class="sxs-lookup"><span data-stu-id="93e5c-165">For more information about CSRF, see [Anti-Request Forgery](../../security/anti-request-forgery.md).</span></span>

<a id="overpost"></a>
### <a name="security-note-about-overposting"></a><span data-ttu-id="93e5c-166">Sicherheitshinweis zum overposting</span><span class="sxs-lookup"><span data-stu-id="93e5c-166">Security note about overposting</span></span>

<span data-ttu-id="93e5c-167">Die `Bind` -Attribut, das auf den scaffolded Code enthält die `Create` Methode ist eine Möglichkeit zum Schutz vor Overposting in Szenarien zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="93e5c-167">The `Bind` attribute that the scaffolded code includes on the `Create` method is one way to protect against overposting in create scenarios.</span></span> <span data-ttu-id="93e5c-168">Nehmen wir beispielsweise an, die Student-Entität enthält eine `Secret` -Eigenschaft, die Sie nicht, dass dieser Webseite festlegen möchten.</span><span class="sxs-lookup"><span data-stu-id="93e5c-168">For example, suppose the Student entity includes a `Secret` property that you don't want this web page to set.</span></span>

```csharp
public class Student
{
    public int ID { get; set; }
    public string LastName { get; set; }
    public string FirstMidName { get; set; }
    public DateTime EnrollmentDate { get; set; }
    public string Secret { get; set; }
}
```

<span data-ttu-id="93e5c-169">Auch wenn Sie besitzen eine `Secret` Feld auf der Webseite, die ein Hacker konnte ein Tool wie Fiddler verwenden, oder Schreiben von JavaScript, zum Bereitstellen einer `Secret` Wert bilden.</span><span class="sxs-lookup"><span data-stu-id="93e5c-169">Even if you don't have a `Secret` field on the web page, a hacker could use a tool such as Fiddler, or write some JavaScript, to post a `Secret` form value.</span></span> <span data-ttu-id="93e5c-170">Ohne die `Bind` Attribut beschränken die Felder, die der Modellbinder verwendet, bei der Erstellung einer Student-Instanz den Modellbinder würde, die abholen `Secret` Wert bilden, und verwenden, um die Entitätsinstanz Student erstellen.</span><span class="sxs-lookup"><span data-stu-id="93e5c-170">Without the `Bind` attribute limiting the fields that the model binder uses when it creates a Student instance, the model binder would pick up that `Secret` form value and use it to create the Student entity instance.</span></span> <span data-ttu-id="93e5c-171">Und dann nach Belieben Hackers für angegebene Wert die `Secret` Formularfeld wird in der Datenbank aktualisiert werden.</span><span class="sxs-lookup"><span data-stu-id="93e5c-171">Then whatever value the hacker specified for the `Secret` form field would be updated in your database.</span></span> <span data-ttu-id="93e5c-172">Die folgende Abbildung zeigt das Hinzufügen von Fiddler-Tool die `Secret` Feld (mit dem Wert "OverPost"), um die übermittelte Formularwerte.</span><span class="sxs-lookup"><span data-stu-id="93e5c-172">The following image shows the Fiddler tool adding the `Secret` field (with the value "OverPost") to the posted form values.</span></span>

![Hinzufügen eines geheimen Felds Fiddler](crud/_static/fiddler.png)

<span data-ttu-id="93e5c-174">Der Wert "OverPost" würde dann erfolgreich hinzugefügt der `Secret` Eigenschaft des eingefügten Zeile, obwohl Sie nie beabsichtigt waren, dass auf der Webseite auf diese Eigenschaft festgelegt werden.</span><span class="sxs-lookup"><span data-stu-id="93e5c-174">The value "OverPost" would then be successfully added to the `Secret` property of the inserted row, although you never intended that the web page be able to set that property.</span></span>

<span data-ttu-id="93e5c-175">Sie können Overposting in bearbeiten Szenarien verhindern, indem Sie zuerst die Entität aus der Datenbank liest und dem anschließenden Aufrufen `TryUpdateModel`, und übergeben Sie eine explizite zulässigen Eigenschaften-Liste.</span><span class="sxs-lookup"><span data-stu-id="93e5c-175">You can prevent overposting in edit scenarios by reading the entity from the database first and then calling `TryUpdateModel`, passing in an explicit allowed properties list.</span></span> <span data-ttu-id="93e5c-176">Dies ist die Methode, die in diesen Lernprogrammen verwendet.</span><span class="sxs-lookup"><span data-stu-id="93e5c-176">That's the method used in these tutorials.</span></span>

<span data-ttu-id="93e5c-177">Eine alternative Möglichkeit, Overposting zu vermeiden, die von vielen Entwicklern bevorzugt wird, ist Ansichtsmodelle anstelle von Entitätsklassen mit wurden die modellbindung verwenden.</span><span class="sxs-lookup"><span data-stu-id="93e5c-177">An alternative way to prevent overposting that's preferred by many developers is to use view models rather than entity classes with model binding.</span></span> <span data-ttu-id="93e5c-178">Schließen Sie nur die Eigenschaften, die Sie in das Ansichtsmodell aktualisieren möchten.</span><span class="sxs-lookup"><span data-stu-id="93e5c-178">Include only the properties you want to update in the view model.</span></span> <span data-ttu-id="93e5c-179">Sobald die MVC-modellbindung abgeschlossen ist, kopieren Sie die Modelleigenschaften Ansicht auf die Entitätsinstanz, optional mit einem Tool wie AutoMapper.</span><span class="sxs-lookup"><span data-stu-id="93e5c-179">Once the MVC model binder has finished, copy the view model properties to the entity instance, optionally using a tool such as AutoMapper.</span></span> <span data-ttu-id="93e5c-180">Verwendung `_context.Entry` auf die Entitätsinstanz, legen Sie seinen Status auf `Unchanged`, und legen Sie dann `Property("PropertyName").IsModified` auf "true" für jede Eigenschaft der Entität, die in das Ansichtsmodell enthalten ist.</span><span class="sxs-lookup"><span data-stu-id="93e5c-180">Use `_context.Entry` on the entity instance to set its state to `Unchanged`, and then set `Property("PropertyName").IsModified` to true on each entity property that's included in the view model.</span></span> <span data-ttu-id="93e5c-181">Diese Methode funktioniert in beiden bearbeiten und Erstellen von Szenarien.</span><span class="sxs-lookup"><span data-stu-id="93e5c-181">This method works in both edit and create scenarios.</span></span>

### <a name="test-the-create-page"></a><span data-ttu-id="93e5c-182">Testen Sie die Seite "erstellen"</span><span class="sxs-lookup"><span data-stu-id="93e5c-182">Test the Create page</span></span>

<span data-ttu-id="93e5c-183">Der Code in *Views/Students/Create.cshtml* verwendet `label`, `input`, und `span` (für validierungsmeldungen) Hilfen für jedes Feld zu kennzeichnen.</span><span class="sxs-lookup"><span data-stu-id="93e5c-183">The code in *Views/Students/Create.cshtml* uses `label`, `input`, and `span` (for validation messages) tag helpers for each field.</span></span>

<span data-ttu-id="93e5c-184">Die app auszuführen, wählen Sie die **Studenten** Registerkarte, und klicken Sie auf **neu erstellen**.</span><span class="sxs-lookup"><span data-stu-id="93e5c-184">Run the app, select the **Students** tab, and click **Create New**.</span></span>

<span data-ttu-id="93e5c-185">Geben Sie Namen und ein Datum.</span><span class="sxs-lookup"><span data-stu-id="93e5c-185">Enter names and a date.</span></span> <span data-ttu-id="93e5c-186">Versuchen Sie, ein ungültiges Datum eingeben, wenn Sie Ihren Browser, die Optionen bereit.</span><span class="sxs-lookup"><span data-stu-id="93e5c-186">Try entering an invalid date if your browser lets you do that.</span></span> <span data-ttu-id="93e5c-187">(Von einigen Browsern erzwingen eine Datumsauswahl verwenden.) Klicken Sie dann auf **erstellen** um die Fehlermeldung anzuzeigen.</span><span class="sxs-lookup"><span data-stu-id="93e5c-187">(Some browsers force you to use a date picker.) Then click **Create** to see the error message.</span></span>

![Datum-Validierungsfehler](crud/_static/date-error.png)

<span data-ttu-id="93e5c-189">Dies ist eine serverseitige Validierung, die Sie in der Standardeinstellung erhalten. in einem späteren Lernprogramm sehen Sie, wie Attribute hinzugefügt, die Code für die clientseitige Validierung ebenfalls generiert.</span><span class="sxs-lookup"><span data-stu-id="93e5c-189">This is server-side validation that you get by default; in a later tutorial you'll see how to add attributes that will generate code for client-side validation also.</span></span> <span data-ttu-id="93e5c-190">Die folgende hervorgehobene Code zeigt die Modell-Überprüfung in der `Create` Methode.</span><span class="sxs-lookup"><span data-stu-id="93e5c-190">The following highlighted code shows the model validation check in the `Create` method.</span></span>

[!code-csharp[Main](intro/samples/cu/Controllers/StudentsController.cs?name=snippet_Create&highlight=8)]

<span data-ttu-id="93e5c-191">Ändern Sie das Datum in einen gültigen Wert ein, und klicken Sie auf **erstellen** , finden in der neuen Studenten in angezeigt werden die **Index** Seite.</span><span class="sxs-lookup"><span data-stu-id="93e5c-191">Change the date to a valid value and click **Create** to see the new student appear in the **Index** page.</span></span>

## <a name="update-the-edit-page"></a><span data-ttu-id="93e5c-192">Aktualisieren Sie die Seite "Bearbeiten"</span><span class="sxs-lookup"><span data-stu-id="93e5c-192">Update the Edit page</span></span>

<span data-ttu-id="93e5c-193">In *StudentController.cs*, die HttpGet `Edit` -Methode (der die `HttpPost` Attribut) verwendet die `SingleOrDefaultAsync` Methode, um die ausgewählte Student-Entität abzurufen, wie Sie gesehen, in haben der `Details` Methode.</span><span class="sxs-lookup"><span data-stu-id="93e5c-193">In *StudentController.cs*, the HttpGet `Edit` method (the one without the `HttpPost` attribute) uses the `SingleOrDefaultAsync` method to retrieve the selected Student entity, as you saw in the `Details` method.</span></span> <span data-ttu-id="93e5c-194">Sie müssen diese Methode ändern.</span><span class="sxs-lookup"><span data-stu-id="93e5c-194">You don't need to change this method.</span></span>

### <a name="recommended-httppost-edit-code-read-and-update"></a><span data-ttu-id="93e5c-195">HttpPost Bearbeiten von Code empfohlen: Lesen und aktualisieren</span><span class="sxs-lookup"><span data-stu-id="93e5c-195">Recommended HttpPost Edit code: Read and update</span></span>

<span data-ttu-id="93e5c-196">Ersetzen Sie die Aktionsmethode HttpPost bearbeiten, durch den folgenden Code.</span><span class="sxs-lookup"><span data-stu-id="93e5c-196">Replace the HttpPost Edit action method with the following code.</span></span>

[!code-csharp[Main](intro/samples/cu/Controllers/StudentsController.cs?name=snippet_ReadFirst)]

<span data-ttu-id="93e5c-197">Eine bewährte Sicherheitsmethode um zu verhindern, dass Overposting Implementierung dieser Änderungen.</span><span class="sxs-lookup"><span data-stu-id="93e5c-197">These changes implement a security best practice to prevent overposting.</span></span> <span data-ttu-id="93e5c-198">Die Scaffolder generiert eine `Bind` Attribut, und die Entität erstellt, indem die Modellbinder, die Entitätenmenge mit hinzugefügt eine `Modified` Flag.</span><span class="sxs-lookup"><span data-stu-id="93e5c-198">The scaffolder generated a `Bind` attribute and added the entity created by the model binder to the entity set with a `Modified` flag.</span></span> <span data-ttu-id="93e5c-199">Code für viele Szenarien empfohlen befindet sich nicht, da die `Bind` Attribut löscht vorhandenen Daten in Feldern, die nicht aufgeführt, der `Include` Parameter.</span><span class="sxs-lookup"><span data-stu-id="93e5c-199">That code isn't recommended for many scenarios because the `Bind` attribute clears out any pre-existing data in fields not listed in the `Include` parameter.</span></span>

<span data-ttu-id="93e5c-200">Der neue Code liest, die vorhandene Entität und ruft `TryUpdateModel` Felder in die abgerufene Entität aktualisieren [basierend auf Benutzereingaben in das gesendete Formulardaten](xref:mvc/models/model-binding#how-model-binding-works).</span><span class="sxs-lookup"><span data-stu-id="93e5c-200">The new code reads the existing entity and calls `TryUpdateModel` to update fields in the retrieved entity [based on user input in the posted form data](xref:mvc/models/model-binding#how-model-binding-works).</span></span> <span data-ttu-id="93e5c-201">Die automatische änderungsnachverfolgung der Entity Framework legt die `Modified` Flag für die Felder, die durch die Formulareingabe geändert werden.</span><span class="sxs-lookup"><span data-stu-id="93e5c-201">The Entity Framework's automatic change tracking sets the `Modified` flag on the fields that are changed by form input.</span></span> <span data-ttu-id="93e5c-202">Wenn die `SaveChanges` -Methode aufgerufen wird, Entity Framework erstellt SQL-Anweisungen, um die Datenbankzeile zu aktualisieren.</span><span class="sxs-lookup"><span data-stu-id="93e5c-202">When the `SaveChanges` method is called, the Entity Framework creates SQL statements to update the database row.</span></span> <span data-ttu-id="93e5c-203">Parallelitätskonflikte werden ignoriert, und nur die Tabellenspalten, die vom Benutzer aktualisiert wurden, werden in der Datenbank aktualisiert.</span><span class="sxs-lookup"><span data-stu-id="93e5c-203">Concurrency conflicts are ignored, and only the table columns that were updated by the user are updated in the database.</span></span> <span data-ttu-id="93e5c-204">(Einem späteren Lernprogramm zeigt, wie Parallelitätskonflikte behandelt.)</span><span class="sxs-lookup"><span data-stu-id="93e5c-204">(A later tutorial shows how to handle concurrency conflicts.)</span></span>

<span data-ttu-id="93e5c-205">Als bewährte Methode, um zu verhindern, overposting die Felder, die von aktualisierbar sein sollen die **bearbeiten** Seite sind in der Zulassungsliste enthalten in der `TryUpdateModel` Parameter.</span><span class="sxs-lookup"><span data-stu-id="93e5c-205">As a best practice to prevent overposting, the fields that you want to be updateable by the **Edit** page are whitelisted in the `TryUpdateModel` parameters.</span></span> <span data-ttu-id="93e5c-206">(Die leere Zeichenfolge, die vor der Liste der Felder in der Parameterliste ist für ein Präfix für die Verwendung mit den Namen der Form Felder.) Derzeit sind keine zusätzlichen Felder, die Sie schützen möchten, jedoch mit den Feldern, die den Modellbinder binden soll sichergestellt werden, wenn Sie Felder in der Zukunft in das Datenmodell hinzufügen, diese sich automatisch geschützt sind, bis Sie explizit hier hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="93e5c-206">(The empty string preceding the list of fields in the parameter list is for a prefix to use with the form fields names.) Currently there are no extra fields that you're protecting, but listing the fields that you want the model binder to bind ensures that if you add fields to the data model in the future, they're automatically protected until you explicitly add them here.</span></span>

<span data-ttu-id="93e5c-207">Als Ergebnis dieser Änderungen, die Methodensignatur des HttpPost `Edit` Methode ist identisch mit der HttpGet `Edit` Methode; daher haben Sie die Methode umbenannt `EditPost`.</span><span class="sxs-lookup"><span data-stu-id="93e5c-207">As a result of these changes, the method signature of the HttpPost `Edit` method is the same as the HttpGet `Edit` method; therefore you've renamed the method `EditPost`.</span></span>

### <a name="alternative-httppost-edit-code-create-and-attach"></a><span data-ttu-id="93e5c-208">Alternativer HttpPost bearbeiten-Code: Erstellen und Anfügen</span><span class="sxs-lookup"><span data-stu-id="93e5c-208">Alternative HttpPost Edit code: Create and attach</span></span>

<span data-ttu-id="93e5c-209">Der empfohlene HttpPost bearbeiten Code stellt sicher, dass nur die geänderte Spalten aktualisiert, und behält die Daten in den Eigenschaften, die Sie nicht möchten, die aus Gründen der modellbindung.</span><span class="sxs-lookup"><span data-stu-id="93e5c-209">The recommended HttpPost edit code ensures that only changed columns get updated and preserves data in properties that you don't want included for model binding.</span></span> <span data-ttu-id="93e5c-210">Die Read-First-Ansatz erfordert jedoch eine zusätzliche Datenbank lesen, und kann dazu führen, mehr komplexen Code für die Behandlung von Parallelitätskonflikten.</span><span class="sxs-lookup"><span data-stu-id="93e5c-210">However, the read-first approach requires an extra database read, and can result in more complex code for handling concurrency conflicts.</span></span> <span data-ttu-id="93e5c-211">Eine Alternative besteht Anfügen einer Entität, die von den Modellbinder für den Kontext EF erstellt und als geändert markiert.</span><span class="sxs-lookup"><span data-stu-id="93e5c-211">An alternative is to attach an entity created by the model binder to the EF context and mark it as modified.</span></span> <span data-ttu-id="93e5c-212">(Aktualisieren Sie das Projekt nicht mit dem folgenden Code ist es nur um eine optionale Vorgehensweise veranschaulichen angezeigt.)</span><span class="sxs-lookup"><span data-stu-id="93e5c-212">(Don't update your project with this code, it's only shown to illustrate an optional approach.)</span></span> 

[!code-csharp[Main](intro/samples/cu/Controllers/StudentsController.cs?name=snippet_CreateAndAttach)]

<span data-ttu-id="93e5c-213">Sie können diesen Ansatz verwenden, wenn das Webseiten-Benutzeroberfläche alle Felder in der Entität enthält und können ggf. aktualisieren.</span><span class="sxs-lookup"><span data-stu-id="93e5c-213">You can use this approach when the web page UI includes all of the fields in the entity and can update any of them.</span></span>

<span data-ttu-id="93e5c-214">Der scaffolded Code die Methode zum Erstellen und Anfügen verwendet jedoch nur fängt `DbUpdateConcurrencyException` Ausnahmen und gibt 404-Fehlercodes.</span><span class="sxs-lookup"><span data-stu-id="93e5c-214">The scaffolded code uses the create-and-attach approach but only catches `DbUpdateConcurrencyException` exceptions and returns 404 error codes.</span></span>  <span data-ttu-id="93e5c-215">Gezeigten Beispiel fängt alle Datenbank-Update-Ausnahme ab und zeigt eine Fehlermeldung an.</span><span class="sxs-lookup"><span data-stu-id="93e5c-215">The example shown catches any database update exception and displays an error message.</span></span>

### <a name="entity-states"></a><span data-ttu-id="93e5c-216">Status der Entität</span><span class="sxs-lookup"><span data-stu-id="93e5c-216">Entity States</span></span>

<span data-ttu-id="93e5c-217">Der Datenbankkontext der nachverfolgt, ob Entitäten im Arbeitsspeicher mit ihren entsprechenden Zeilen in der Datenbank synchronisiert sind, und diese Informationen bestimmt, was geschieht, wenn Sie rufen die `SaveChanges` Methode.</span><span class="sxs-lookup"><span data-stu-id="93e5c-217">The database context keeps track of whether entities in memory are in sync with their corresponding rows in the database, and this information determines what happens when you call the `SaveChanges` method.</span></span> <span data-ttu-id="93e5c-218">Wenn Sie z. B. eine neue Entität zum Übergeben der `Add` Methode, die Zustand der Entität, um festgelegt ist `Added`.</span><span class="sxs-lookup"><span data-stu-id="93e5c-218">For example, when you pass a new entity to the `Add` method, that entity's state is set to `Added`.</span></span> <span data-ttu-id="93e5c-219">Klicken Sie dann beim Aufrufen der `SaveChanges` -Methode, der Datenbankkontext stellt einen SQL INSERT-Befehl.</span><span class="sxs-lookup"><span data-stu-id="93e5c-219">Then when you call the `SaveChanges` method, the database context issues a SQL INSERT command.</span></span>

<span data-ttu-id="93e5c-220">Eine Entität kann in einem der folgenden Zustände werden:</span><span class="sxs-lookup"><span data-stu-id="93e5c-220">An entity may be in one of the following states:</span></span>

* <span data-ttu-id="93e5c-221">`Added`</span><span class="sxs-lookup"><span data-stu-id="93e5c-221">`Added`.</span></span> <span data-ttu-id="93e5c-222">Die Entität ist nicht in der Datenbank noch vorhanden.</span><span class="sxs-lookup"><span data-stu-id="93e5c-222">The entity doesn't yet exist in the database.</span></span> <span data-ttu-id="93e5c-223">Die `SaveChanges` -Methode gibt eine INSERT-Anweisung.</span><span class="sxs-lookup"><span data-stu-id="93e5c-223">The `SaveChanges` method issues an INSERT statement.</span></span>

* <span data-ttu-id="93e5c-224">`Unchanged`</span><span class="sxs-lookup"><span data-stu-id="93e5c-224">`Unchanged`.</span></span> <span data-ttu-id="93e5c-225">Keine Aktionen erforderlich, mit diese Entität durch erfolgen die `SaveChanges` Methode.</span><span class="sxs-lookup"><span data-stu-id="93e5c-225">Nothing needs to be done with this entity by the `SaveChanges` method.</span></span> <span data-ttu-id="93e5c-226">Wenn Sie eine Entität aus der Datenbank lesen, beginnt die Entität mit diesem Status.</span><span class="sxs-lookup"><span data-stu-id="93e5c-226">When you read an entity from the database, the entity starts out with this status.</span></span>

* <span data-ttu-id="93e5c-227">`Modified`</span><span class="sxs-lookup"><span data-stu-id="93e5c-227">`Modified`.</span></span> <span data-ttu-id="93e5c-228">Einige oder alle Eigenschaftswerte für die Entität wurden geändert.</span><span class="sxs-lookup"><span data-stu-id="93e5c-228">Some or all of the entity's property values have been modified.</span></span> <span data-ttu-id="93e5c-229">Die `SaveChanges` -Methode gibt eine UPDATE-Anweisung.</span><span class="sxs-lookup"><span data-stu-id="93e5c-229">The `SaveChanges` method issues an UPDATE statement.</span></span>

* <span data-ttu-id="93e5c-230">`Deleted`</span><span class="sxs-lookup"><span data-stu-id="93e5c-230">`Deleted`.</span></span> <span data-ttu-id="93e5c-231">Die Entität wurde zum Löschen markiert wurde.</span><span class="sxs-lookup"><span data-stu-id="93e5c-231">The entity has been marked for deletion.</span></span> <span data-ttu-id="93e5c-232">Die `SaveChanges` -Methode gibt eine DELETE-Anweisung.</span><span class="sxs-lookup"><span data-stu-id="93e5c-232">The `SaveChanges` method issues a DELETE statement.</span></span>

* <span data-ttu-id="93e5c-233">`Detached`</span><span class="sxs-lookup"><span data-stu-id="93e5c-233">`Detached`.</span></span> <span data-ttu-id="93e5c-234">Die Entität ist nicht vom Kontext Datenbank nachverfolgt.</span><span class="sxs-lookup"><span data-stu-id="93e5c-234">The entity isn't being tracked by the database context.</span></span>

<span data-ttu-id="93e5c-235">Zustandsänderungen werden in einer Desktopanwendung in der Regel automatisch festgelegt.</span><span class="sxs-lookup"><span data-stu-id="93e5c-235">In a desktop application, state changes are typically set automatically.</span></span> <span data-ttu-id="93e5c-236">Lesen eine Entität, und nehmen Sie Änderungen an einige Eigenschaftswerte.</span><span class="sxs-lookup"><span data-stu-id="93e5c-236">You read an entity and make changes to some of its property values.</span></span> <span data-ttu-id="93e5c-237">Dies bewirkt, dass automatisch geändert werden, um zugehörige Entitätsstatus `Modified`.</span><span class="sxs-lookup"><span data-stu-id="93e5c-237">This causes its entity state to automatically be changed to `Modified`.</span></span> <span data-ttu-id="93e5c-238">Klicken Sie dann beim Aufrufen `SaveChanges`, Entity Framework generiert eine SQL UPDATE-Anweisung, die nur die tatsächlichen Eigenschaften aktualisiert, die Sie geändert haben.</span><span class="sxs-lookup"><span data-stu-id="93e5c-238">Then when you call `SaveChanges`, the Entity Framework generates a SQL UPDATE statement that updates only the actual properties that you changed.</span></span>

<span data-ttu-id="93e5c-239">In einer Web-app die `DbContext` , die anfänglich liest eine Entität und zeigt seine Daten bearbeitet werden freigegeben, nachdem eine Seite gerendert wird.</span><span class="sxs-lookup"><span data-stu-id="93e5c-239">In a web app, the `DbContext` that initially reads an entity and displays its data to be edited is disposed after a page is rendered.</span></span> <span data-ttu-id="93e5c-240">Wenn die HttpPost `Edit` Aktionsmethode aufgerufen wird, erfolgt eine neue webanforderung aus, und Sie haben eine neue Instanz der dem `DbContext`.</span><span class="sxs-lookup"><span data-stu-id="93e5c-240">When the HttpPost `Edit` action method is called,  a new web request is made and you have a new instance of the `DbContext`.</span></span> <span data-ttu-id="93e5c-241">Wenn Sie die Entität in diesem neuen Kontext erneut lesen, simulieren Sie desktop-Verarbeitung.</span><span class="sxs-lookup"><span data-stu-id="93e5c-241">If you re-read the entity in that new context, you simulate desktop processing.</span></span>

<span data-ttu-id="93e5c-242">Aber wenn Sie möchten der zusätzlichen Lesevorgang, müssen Sie das Entitätsobjekt erstellt, indem die modellbindung verwenden.</span><span class="sxs-lookup"><span data-stu-id="93e5c-242">But if you don't want to do the extra read operation, you have to use the entity object created by the model binder.</span></span>  <span data-ttu-id="93e5c-243">Die einfachste Möglichkeit hierzu ist für den Entitätsstatus "geändert" festzulegen, wie in den zuvor aufgeführten alternative HttpPost bearbeiten Code verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="93e5c-243">The simplest way to do this is to set the entity state to Modified as is done in the alternative HttpPost Edit code shown earlier.</span></span> <span data-ttu-id="93e5c-244">Klicken Sie dann beim Aufrufen `SaveChanges`, Entity Framework alle Spalten der Datenbankzeile aktualisiert, da der Kontext kann nicht wissen, welche Eigenschaften Sie geändert haben.</span><span class="sxs-lookup"><span data-stu-id="93e5c-244">Then when you call `SaveChanges`, the Entity Framework updates all columns of the database row, because the context has no way to know which properties you changed.</span></span>

<span data-ttu-id="93e5c-245">Wenn Sie die Read-First-Ansatz vermeiden möchten, aber außerdem SQL UPDATE-Anweisung, um nur die Felder zu aktualisieren, die der Benutzer tatsächlich geändert werden soll, ist der Code komplexer.</span><span class="sxs-lookup"><span data-stu-id="93e5c-245">If you want to avoid the read-first approach, but you also want the SQL UPDATE statement to update only the fields that the user actually changed, the code is more complex.</span></span> <span data-ttu-id="93e5c-246">Müssen Sie die ursprünglichen Werte in irgendeiner Form speichern (z. B. mithilfe der ausgeblendete Felder), damit sie verfügbar wenn sind HttpPost `Edit` Methode wird aufgerufen.</span><span class="sxs-lookup"><span data-stu-id="93e5c-246">You have to save the original values in some way (such as by using hidden fields) so that they're available when the HttpPost `Edit` method is called.</span></span> <span data-ttu-id="93e5c-247">Anschließend können Sie eine Student-Entität mit den ursprünglichen Werten Aufruf erstellen die `Attach` Methode mit diesem Originalversion der Entität, Werten der Entität mit den neuen Werten aktualisiert, und rufen dann `SaveChanges`.</span><span class="sxs-lookup"><span data-stu-id="93e5c-247">Then you can create a Student entity using the original values, call the `Attach` method with that original version of the entity, update the entity's values to the new values, and then call `SaveChanges`.</span></span>

### <a name="test-the-edit-page"></a><span data-ttu-id="93e5c-248">Testen Sie die Seite "Bearbeiten"</span><span class="sxs-lookup"><span data-stu-id="93e5c-248">Test the Edit page</span></span>

<span data-ttu-id="93e5c-249">Die app auszuführen, wählen Sie die **Studenten** tab, dann klicken Sie auf eine **bearbeiten** Link.</span><span class="sxs-lookup"><span data-stu-id="93e5c-249">Run the app, select the **Students** tab, then click an **Edit** hyperlink.</span></span>

![Studenten bearbeiten (Seite)](crud/_static/student-edit.png)

<span data-ttu-id="93e5c-251">Ändern Sie einige der Daten und klicken Sie auf **speichern**.</span><span class="sxs-lookup"><span data-stu-id="93e5c-251">Change some of the data and click **Save**.</span></span> <span data-ttu-id="93e5c-252">Die **Index** Seite geöffnet, und die geänderten Daten sehen.</span><span class="sxs-lookup"><span data-stu-id="93e5c-252">The **Index** page opens and you see the changed data.</span></span>

## <a name="update-the-delete-page"></a><span data-ttu-id="93e5c-253">Aktualisieren Sie die Seite "löschen"</span><span class="sxs-lookup"><span data-stu-id="93e5c-253">Update the Delete page</span></span>

<span data-ttu-id="93e5c-254">In *StudentController.cs*, der Vorlagencode für die HttpGet `Delete` -Methode verwendet die `SingleOrDefaultAsync` Methode, um die ausgewählte Student-Entität abzurufen, wie Sie in den Details und bearbeiten Methoden gesehen haben.</span><span class="sxs-lookup"><span data-stu-id="93e5c-254">In *StudentController.cs*, the template code for the HttpGet `Delete` method uses the `SingleOrDefaultAsync` method to retrieve the selected Student entity, as you saw in the Details and Edit methods.</span></span> <span data-ttu-id="93e5c-255">Allerdings zum Implementieren eine benutzerdefinierte Fehlermeldung angezeigt, wenn der Aufruf von `SaveChanges` ein Fehler auftritt, fügen Sie einige Funktionen dieser Methode und seine entsprechende Ansicht.</span><span class="sxs-lookup"><span data-stu-id="93e5c-255">However, to implement a custom error message when the call to `SaveChanges` fails, you'll add some functionality to this method and its corresponding view.</span></span>

<span data-ttu-id="93e5c-256">Wie Sie gesehen, für das Update haben und Vorgänge zu erstellen, erfordern Löschvorgänge zwei Aktionsmethoden.</span><span class="sxs-lookup"><span data-stu-id="93e5c-256">As you saw for update and create operations, delete operations require two action methods.</span></span> <span data-ttu-id="93e5c-257">Die Methode, die als Antwort auf eine GET-Anforderung aufgerufen wird, zeigt eine Sicht, die dem Benutzer hat die Möglichkeit, zu genehmigen, oder brechen Sie den Löschvorgang.</span><span class="sxs-lookup"><span data-stu-id="93e5c-257">The method that's called in response to a GET request displays a view that gives the user a chance to approve or cancel the delete operation.</span></span> <span data-ttu-id="93e5c-258">Wenn der Benutzer genehmigt wird, wird eine POST-Anforderung erstellt.</span><span class="sxs-lookup"><span data-stu-id="93e5c-258">If the user approves it, a POST request is created.</span></span> <span data-ttu-id="93e5c-259">Wenn dies geschieht, HttpPost `Delete` Methode wird aufgerufen, und diese Methode führt dann tatsächlich den Löschvorgang.</span><span class="sxs-lookup"><span data-stu-id="93e5c-259">When that happens, the HttpPost `Delete` method is called and then that method actually performs the delete operation.</span></span>

<span data-ttu-id="93e5c-260">Fügen Sie einen Try / Catch-Block, HttpPost `Delete` Methode zum Behandeln von Fehlern, die auftreten können, wenn die Datenbank aktualisiert wird.</span><span class="sxs-lookup"><span data-stu-id="93e5c-260">You'll add a try-catch block to the HttpPost `Delete` method to handle any errors that might occur when the database is updated.</span></span> <span data-ttu-id="93e5c-261">Wenn ein Fehler auftritt, ruft die Löschmethode HttpPost HttpGet Delete-Methode, und übergeben sie einen Parameter, der angibt, dass ein Fehler aufgetreten ist.</span><span class="sxs-lookup"><span data-stu-id="93e5c-261">If an error occurs, the HttpPost Delete method calls the HttpGet Delete method, passing it a parameter that indicates that an error has occurred.</span></span> <span data-ttu-id="93e5c-262">Die HttpGet Delete-Methode zeigt die Seite "Bestätigung" zusammen mit der Fehlermeldung, dass der Benutzer eine Möglichkeit zum Abbrechen oder Wiederholen Sie den Vorgang dann erneut an.</span><span class="sxs-lookup"><span data-stu-id="93e5c-262">The HttpGet Delete method then redisplays the confirmation page along with the error message, giving the user an opportunity to cancel or try again.</span></span>

<span data-ttu-id="93e5c-263">Ersetzen Sie die HttpGet `Delete` -Aktionsmethode durch folgenden Code wird die Fehlerberichterstattung verwaltet.</span><span class="sxs-lookup"><span data-stu-id="93e5c-263">Replace the HttpGet `Delete` action method with the following code, which manages error reporting.</span></span>

[!code-csharp[Main](intro/samples/cu/Controllers/StudentsController.cs?name=snippet_DeleteGet&highlight=1,9,16-21)]

<span data-ttu-id="93e5c-264">Dieser Code akzeptiert einen optionalen Parameter, der angibt, ob die Methode, nach einem Fehler aufgerufen wurde, um Änderungen zu speichern.</span><span class="sxs-lookup"><span data-stu-id="93e5c-264">This code accepts an optional parameter that indicates whether the method was called after a failure to save changes.</span></span> <span data-ttu-id="93e5c-265">Dieser Parameter ist "false", wenn die HttpGet `Delete` Methode wird aufgerufen, ohne Sie zu einem vorherigen Fehler.</span><span class="sxs-lookup"><span data-stu-id="93e5c-265">This parameter is false when the HttpGet `Delete` method is called without a previous failure.</span></span> <span data-ttu-id="93e5c-266">Bei Aufruf durch die HttpPost `Delete` Methode als Reaktion auf eine Datenbank-Aktualisierungsfehler, der Parameter ist "true", und eine Fehlermeldung an die Ansicht übergeben wird.</span><span class="sxs-lookup"><span data-stu-id="93e5c-266">When it's called by the HttpPost `Delete` method in response to a database update error, the parameter is true and an error message is passed to the view.</span></span>

### <a name="the-read-first-approach-to-httppost-delete"></a><span data-ttu-id="93e5c-267">Die Read-First-Ansatz zur HttpPost löschen</span><span class="sxs-lookup"><span data-stu-id="93e5c-267">The read-first approach to HttpPost Delete</span></span>

<span data-ttu-id="93e5c-268">Ersetzen Sie die HttpPost `Delete` Aktionsmethode (mit dem Namen `DeleteConfirmed`) durch den folgenden Code dem führt des eigentlichen Löschvorgangs und fängt alle Datenbank-Update-Fehler ab.</span><span class="sxs-lookup"><span data-stu-id="93e5c-268">Replace the HttpPost `Delete` action method (named `DeleteConfirmed`) with the following code, which performs the actual delete operation and catches any database update errors.</span></span>

[!code-csharp[Main](intro/samples/cu/Controllers/StudentsController.cs?name=snippet_DeleteWithReadFirst&highlight=6,8-11,13-14,18-23)]

<span data-ttu-id="93e5c-269">Dieser Code Ruft die ausgewählte Entität ruft dann die `Remove` Methode, um die Entität Status festgelegt wird, um `Deleted`.</span><span class="sxs-lookup"><span data-stu-id="93e5c-269">This code retrieves the selected entity, then calls the `Remove` method to set the entity's status to `Deleted`.</span></span> <span data-ttu-id="93e5c-270">Wenn `SaveChanges` aufgerufen wird, wird eine SQL-DELETE-Befehl generiert wird.</span><span class="sxs-lookup"><span data-stu-id="93e5c-270">When `SaveChanges` is called, a SQL DELETE command is generated.</span></span>

### <a name="the-create-and-attach-approach-to-httppost-delete"></a><span data-ttu-id="93e5c-271">Der Ansatz erstellen und anfügen, HttpPost löschen</span><span class="sxs-lookup"><span data-stu-id="93e5c-271">The create-and-attach approach to HttpPost Delete</span></span>

<span data-ttu-id="93e5c-272">Ist das Verbessern der Leistung einer Anwendung hoher Priorität, vermeiden Sie unnötige SQL-Abfrage durch Instanziieren einer Student-Entität, die mit nur der primäre Schlüssel, Wert festlegen und dann der Entitätszustand auf `Deleted`.</span><span class="sxs-lookup"><span data-stu-id="93e5c-272">If improving performance in a high-volume application is a priority, you could avoid an unnecessary SQL query by instantiating a Student entity using only the primary key value and then setting the entity state to `Deleted`.</span></span> <span data-ttu-id="93e5c-273">Das ist alles, die das Entity Framework benötigt wird, um die Entität zu löschen.</span><span class="sxs-lookup"><span data-stu-id="93e5c-273">That's all that the Entity Framework needs in order to delete the entity.</span></span> <span data-ttu-id="93e5c-274">(Fügen Sie diesen Code in Ihrem Projekt nicht; er wird hier nur um eine Alternative zu veranschaulichen.)</span><span class="sxs-lookup"><span data-stu-id="93e5c-274">(Don't put this code in your project; it's here just to illustrate an alternative.)</span></span>

[!code-csharp[Main](intro/samples/cu/Controllers/StudentsController.cs?name=snippet_DeleteWithoutReadFirst&highlight=7-8)]

<span data-ttu-id="93e5c-275">Wenn die Entität zugehörige Daten hat, die ebenfalls gelöscht werden soll, stellen Sie sicher, dass diese kaskadierte Löschung in der Datenbank konfiguriert ist.</span><span class="sxs-lookup"><span data-stu-id="93e5c-275">If the entity has related data that should also be deleted, make sure that cascade delete is configured in the database.</span></span> <span data-ttu-id="93e5c-276">Bei diesem Ansatz zum Löschen der Entität EF bemerken möglicherweise nicht, dass verknüpfte Entitäten zu löschenden vorhanden sind.</span><span class="sxs-lookup"><span data-stu-id="93e5c-276">With this approach to entity deletion, EF might not realize there are related entities to be deleted.</span></span>

### <a name="update-the-delete-view"></a><span data-ttu-id="93e5c-277">Aktualisieren der Ansicht löschen</span><span class="sxs-lookup"><span data-stu-id="93e5c-277">Update the Delete view</span></span>

<span data-ttu-id="93e5c-278">In *Views/Student/Delete.cshtml*, eine Fehlermeldung zwischen h2 Überschrift und der h3-Überschrift, hinzufügen, wie im folgenden Beispiel gezeigt:</span><span class="sxs-lookup"><span data-stu-id="93e5c-278">In *Views/Student/Delete.cshtml*, add an error message between the h2 heading and the h3 heading, as shown in the following example:</span></span>

[!code-html[](intro/samples/cu/Views/Students/Delete.cshtml?range=7-9&highlight=2)]

<span data-ttu-id="93e5c-279">Die app auszuführen, wählen Sie die **Studenten** Registerkarte, und klicken Sie auf eine **löschen** Link:</span><span class="sxs-lookup"><span data-stu-id="93e5c-279">Run the app, select the **Students** tab, and click a **Delete** hyperlink:</span></span>

![Seite "Bestätigung" löschen](crud/_static/student-delete.png)

<span data-ttu-id="93e5c-281">Klicken Sie auf **löschen**.</span><span class="sxs-lookup"><span data-stu-id="93e5c-281">Click **Delete**.</span></span> <span data-ttu-id="93e5c-282">Die Indexseite wird ohne die gelöschten Studenten angezeigt.</span><span class="sxs-lookup"><span data-stu-id="93e5c-282">The Index page is displayed without the deleted student.</span></span> <span data-ttu-id="93e5c-283">(Ein Beispiel für den Fehlerbehandlungscode in Aktion im Lernprogramm Parallelität angezeigt.)</span><span class="sxs-lookup"><span data-stu-id="93e5c-283">(You'll see an example of the error handling code in action in the concurrency tutorial.)</span></span>

## <a name="closing-database-connections"></a><span data-ttu-id="93e5c-284">Schließen von Verbindungen mit der Datenbank</span><span class="sxs-lookup"><span data-stu-id="93e5c-284">Closing database connections</span></span>

<span data-ttu-id="93e5c-285">Um die Ressourcen freizugeben, die eine Verbindung mit Datenbank enthält, muss die Kontextinstanz so bald wie möglich freigegeben werden, wenn Sie damit fertig sind.</span><span class="sxs-lookup"><span data-stu-id="93e5c-285">To free up the resources that a database connection holds, the context instance must be disposed as soon as possible when you are done with it.</span></span> <span data-ttu-id="93e5c-286">Die integrierte ASP.NET Core [Abhängigkeitsinjektion](../../fundamentals/dependency-injection.md) übernimmt diese Aufgabe für Sie.</span><span class="sxs-lookup"><span data-stu-id="93e5c-286">The ASP.NET Core built-in [dependency injection](../../fundamentals/dependency-injection.md) takes care of that task for you.</span></span>

<span data-ttu-id="93e5c-287">In *Startup.cs*, rufen Sie die [AddDbContext Erweiterungsmethode](https://github.com/aspnet/EntityFrameworkCore/blob/03bcb5122e3f577a84498545fcf130ba79a3d987/src/Microsoft.EntityFrameworkCore/EntityFrameworkServiceCollectionExtensions.cs) für die Bereitstellung der `DbContext` -Klasse in ASP.NET DI-Container.</span><span class="sxs-lookup"><span data-stu-id="93e5c-287">In *Startup.cs*, you call the [AddDbContext extension method](https://github.com/aspnet/EntityFrameworkCore/blob/03bcb5122e3f577a84498545fcf130ba79a3d987/src/Microsoft.EntityFrameworkCore/EntityFrameworkServiceCollectionExtensions.cs) to provision the `DbContext` class in the ASP.NET DI container.</span></span> <span data-ttu-id="93e5c-288">Methode der Lebensdauer von Diensten fest, um `Scoped` standardmäßig.</span><span class="sxs-lookup"><span data-stu-id="93e5c-288">That method sets the service lifetime to `Scoped` by default.</span></span> <span data-ttu-id="93e5c-289">`Scoped`bedeutet, dass die Lebensdauer eines Objekts Kontext mit der Lebensdauer der Web-Anforderung Zeitangabe und die `Dispose` Methode wird automatisch am Ende der webanforderung aufgerufen werden.</span><span class="sxs-lookup"><span data-stu-id="93e5c-289">`Scoped` means the context object lifetime coincides with the web request life time, and the `Dispose` method will be called automatically at the end of the web request.</span></span>

## <a name="handling-transactions"></a><span data-ttu-id="93e5c-290">Behandeln von Transaktionen</span><span class="sxs-lookup"><span data-stu-id="93e5c-290">Handling Transactions</span></span>

<span data-ttu-id="93e5c-291">Standardmäßig wird das Entity Framework implizit Transaktionen implementiert.</span><span class="sxs-lookup"><span data-stu-id="93e5c-291">By default the Entity Framework implicitly implements transactions.</span></span> <span data-ttu-id="93e5c-292">In Szenarien, in dem Sie Änderungen auf mehrere Zeilen oder Tabellen, und rufen dann `SaveChanges`, Entity Framework wird automatisch sichergestellt, dass alle Änderungen erfolgreich abgeschlossen oder alle fehlschlagen.</span><span class="sxs-lookup"><span data-stu-id="93e5c-292">In scenarios where you make changes to multiple rows or tables and then call `SaveChanges`, the Entity Framework automatically makes sure that either all of your changes succeed or they all fail.</span></span> <span data-ttu-id="93e5c-293">Wenn einige Änderungen zuerst fertig sind, und klicken Sie dann ein Fehler tritt auf, werden diese Änderungen automatisch zurückgesetzt.</span><span class="sxs-lookup"><span data-stu-id="93e5c-293">If some changes are done first and then an error happens, those changes are automatically rolled back.</span></span> <span data-ttu-id="93e5c-294">Für Szenarien, in denen mehr, – beispielsweise gesteuert müssen wenn Vorgängen, die außerhalb von Entity Framework in einer Transaktion--enthalten sein sollen, finden Sie unter [Transaktionen](https://docs.microsoft.com/ef/core/saving/transactions).</span><span class="sxs-lookup"><span data-stu-id="93e5c-294">For scenarios where you need more control -- for example, if you want to include operations done outside of Entity Framework in a transaction -- see [Transactions](https://docs.microsoft.com/ef/core/saving/transactions).</span></span>

## <a name="no-tracking-queries"></a><span data-ttu-id="93e5c-295">No-Überwachungsabfragen</span><span class="sxs-lookup"><span data-stu-id="93e5c-295">No-tracking queries</span></span>

<span data-ttu-id="93e5c-296">Wenn ein Datenbankkontext Ruft die Tabellenzeilen ab und erstellt von Entitätsobjekten, die sie darstellen, werden von nachverfolgt standardmäßig er, ob die Entitäten im Arbeitsspeicher synchron, sind was in der Datenbank ist.</span><span class="sxs-lookup"><span data-stu-id="93e5c-296">When a database context retrieves table rows and creates entity objects that represent them, by default it keeps track of whether the entities in memory are in sync with what's in the database.</span></span> <span data-ttu-id="93e5c-297">Die Daten im Arbeitsspeicher als Cache fungiert und werden verwendet, wenn Sie eine Entität aktualisieren.</span><span class="sxs-lookup"><span data-stu-id="93e5c-297">The data in memory acts as a cache and is used when you update an entity.</span></span> <span data-ttu-id="93e5c-298">Dieses Zwischenspeichern ist häufig in einer Webanwendung nicht erforderlich, da Kontext Instanzen sind in der Regel kurzlebige (ein neuer Schlüssel wird erstellt und freigegeben für jede Anforderung) sowie den Kontext, liest eine Entität ist in der Regel verworfen werden, bevor diese Entität erneut verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="93e5c-298">This caching is often unnecessary in a web application because context instances are typically short-lived (a new one is created and disposed for each request) and the context that reads an entity is typically disposed before that entity is used again.</span></span>

<span data-ttu-id="93e5c-299">Sie können die Überwachung von Entitätsobjekten im Arbeitsspeicher deaktivieren, durch Aufrufen der `AsNoTracking` Methode.</span><span class="sxs-lookup"><span data-stu-id="93e5c-299">You can disable tracking of entity objects in memory by calling the `AsNoTracking` method.</span></span> <span data-ttu-id="93e5c-300">Typische Szenarios, in denen Sie möchten, die, umfassen Folgendes:</span><span class="sxs-lookup"><span data-stu-id="93e5c-300">Typical scenarios in which you might want to do that include the following:</span></span>

* <span data-ttu-id="93e5c-301">Während der Lebensdauer der Kontext müssen Sie keine Entitäten aktualisieren, und ist nicht erforderlich, um EF [Navigationseigenschaften automatisch zu laden, Entitäten, die abgerufen, indem eine eigene Abfrage](read-related-data.md).</span><span class="sxs-lookup"><span data-stu-id="93e5c-301">During the context lifetime you don't need to update any entities, and you don't need EF to [automatically load navigation properties with  entities retrieved by separate queries](read-related-data.md).</span></span> <span data-ttu-id="93e5c-302">Häufig werden diese Bedingungen in einem Controller HttpGet Aktionsmethoden erfüllt.</span><span class="sxs-lookup"><span data-stu-id="93e5c-302">Frequently these conditions are met in a controller's HttpGet action methods.</span></span>

* <span data-ttu-id="93e5c-303">Ausführen einer Abfrage, die eine große Datenmenge abruft, und wird nur ein kleiner Teil der zurückgegebenen Daten aktualisiert werden.</span><span class="sxs-lookup"><span data-stu-id="93e5c-303">You are running a query that retrieves a large volume of data, and only a small portion of the returned data will be updated.</span></span> <span data-ttu-id="93e5c-304">Es ist möglicherweise effizienter, Deaktivieren der Überwachung für große Abfrage, und führen Sie eine Abfrage später für einige Entitäten, die aktualisiert werden müssen.</span><span class="sxs-lookup"><span data-stu-id="93e5c-304">It may be more efficient to turn off tracking for the large query, and run a query later for the few entities that need to be updated.</span></span>

* <span data-ttu-id="93e5c-305">Sie eine Entität anfügen, um es zu aktualisieren möchten, aber zuvor abgerufenen dieselbe Entität für unterschiedliche Zwecke erfüllen.</span><span class="sxs-lookup"><span data-stu-id="93e5c-305">You want to attach an entity in order to update it, but earlier you retrieved the same entity for a different purpose.</span></span> <span data-ttu-id="93e5c-306">Da die Entität bereits vom Kontext Datenbank nachverfolgt wird, können Sie die Entität nicht anfügen, die Sie ändern möchten.</span><span class="sxs-lookup"><span data-stu-id="93e5c-306">Because the entity is already being tracked by the database context, you can't attach the entity that you want to change.</span></span> <span data-ttu-id="93e5c-307">Eine Methode für diese Situation ist das Aufrufen `AsNoTracking` auf der oben dargestellten Abfrage.</span><span class="sxs-lookup"><span data-stu-id="93e5c-307">One way to handle this situation is to call `AsNoTracking` on the earlier query.</span></span>

<span data-ttu-id="93e5c-308">Weitere Informationen finden Sie unter [Vs nachverfolgen. No-Tracking](https://docs.microsoft.com/ef/core/querying/tracking).</span><span class="sxs-lookup"><span data-stu-id="93e5c-308">For more information, see [Tracking vs. No-Tracking](https://docs.microsoft.com/ef/core/querying/tracking).</span></span>

## <a name="summary"></a><span data-ttu-id="93e5c-309">Zusammenfassung</span><span class="sxs-lookup"><span data-stu-id="93e5c-309">Summary</span></span>

<span data-ttu-id="93e5c-310">Sie verfügen jetzt über einen vollständigen Satz von Seiten, die einfache CRUD-Operationen für Student Entitäten ausführen.</span><span class="sxs-lookup"><span data-stu-id="93e5c-310">You now have a complete set of pages that perform simple CRUD operations for Student entities.</span></span> <span data-ttu-id="93e5c-311">In den nächsten Lernprogrammen erweitern Sie die Funktionalität der **Index** Seite durch Hinzufügen von sortieren, Filtern und Paging.</span><span class="sxs-lookup"><span data-stu-id="93e5c-311">In the next tutorial you'll expand the functionality of the **Index** page by adding sorting, filtering, and paging.</span></span>

>[!div class="step-by-step"]
<span data-ttu-id="93e5c-312">[Zurück](intro.md)
[Weiter](sort-filter-page.md)</span><span class="sxs-lookup"><span data-stu-id="93e5c-312">[Previous](intro.md)
[Next](sort-filter-page.md)</span></span>  
