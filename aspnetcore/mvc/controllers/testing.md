---
title: Testen von Controllerlogik in ASP.NET Core
author: ardalis
description: Informationen zum Testen von Controllerlogik in ASP.NET Core mit Moq und xUnit
manager: wpickett
ms.author: riande
ms.date: 10/14/2016
ms.prod: asp.net-core
ms.technology: aspnet
ms.topic: article
uid: mvc/controllers/testing
ms.openlocfilehash: 51b7a02c697807c9e3504b70f89370126ee0e781
ms.sourcegitcommit: 5130b3034165f5cf49d829fe7475a84aa33d2693
ms.translationtype: HT
ms.contentlocale: de-DE
ms.lasthandoff: 05/03/2018
---
# <a name="test-controller-logic-in-aspnet-core"></a><span data-ttu-id="ba51a-103">Testen von Controllerlogik in ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="ba51a-103">Test controller logic in ASP.NET Core</span></span>

<span data-ttu-id="ba51a-104">Von [Steve Smith](https://ardalis.com/)</span><span class="sxs-lookup"><span data-stu-id="ba51a-104">By [Steve Smith](https://ardalis.com/)</span></span>

<span data-ttu-id="ba51a-105">Controller in ASP.NET MVC-Apps sollten möglichst klein sein und sich überwiegend mit Aspekten der Benutzeroberfläche befassen.</span><span class="sxs-lookup"><span data-stu-id="ba51a-105">Controllers in ASP.NET MVC apps should be small and focused on user-interface concerns.</span></span> <span data-ttu-id="ba51a-106">Große Controller, die sich mit anderen Belangen als der Benutzeroberfläche befassen, können schwerer getestet und verwaltet werden.</span><span class="sxs-lookup"><span data-stu-id="ba51a-106">Large controllers that deal with non-UI concerns are more difficult to test and maintain.</span></span>

<span data-ttu-id="ba51a-107">[Beispiel anzeigen oder von GitHub herunterladen](https://github.com/aspnet/Docs/tree/master/aspnetcore/mvc/controllers/testing/sample).</span><span class="sxs-lookup"><span data-stu-id="ba51a-107">[View or download sample from GitHub](https://github.com/aspnet/Docs/tree/master/aspnetcore/mvc/controllers/testing/sample)</span></span>

## <a name="testing-controllers"></a><span data-ttu-id="ba51a-108">Testen von Controllern</span><span class="sxs-lookup"><span data-stu-id="ba51a-108">Testing controllers</span></span>

<span data-ttu-id="ba51a-109">Controller sind ein zentraler Bestandteil jeder ASP.NET Core MVC-Anwendung.</span><span class="sxs-lookup"><span data-stu-id="ba51a-109">Controllers are a central part of any ASP.NET Core MVC application.</span></span> <span data-ttu-id="ba51a-110">Daher sollten Sie auch darauf vertrauen können, dass sie in Ihrer App wie beabsichtigt funktionieren.</span><span class="sxs-lookup"><span data-stu-id="ba51a-110">As such, you should have confidence they behave as intended for your app.</span></span> <span data-ttu-id="ba51a-111">Automatisierte Tests können Ihnen dieses Vertrauen vermitteln. Sie können zudem dabei helfen, Fehler aufzudecken, bevor diese die Produktion erreichen.</span><span class="sxs-lookup"><span data-stu-id="ba51a-111">Automated tests can provide you with this confidence and can detect errors before they reach production.</span></span> <span data-ttu-id="ba51a-112">Sie sollten auf keinen Fall unnötige Aufgaben innerhalb der Controller platzieren. Zudem sollten die Tests ausschließlich auf die Controlleraufgaben ausgerichtet sein.</span><span class="sxs-lookup"><span data-stu-id="ba51a-112">It's important to avoid placing unnecessary responsibilities within your controllers and ensure your tests focus only on controller responsibilities.</span></span>

<span data-ttu-id="ba51a-113">Controllerlogik sollte minimal und nicht auf Geschäftslogik oder Infrastruktur ausgerichtet sein (wie z.B. Datenzugriff).</span><span class="sxs-lookup"><span data-stu-id="ba51a-113">Controller logic should be minimal and not be focused on business logic or infrastructure concerns (for example, data access).</span></span> <span data-ttu-id="ba51a-114">Testen Sie die Controllerlogik, nicht das Framework.</span><span class="sxs-lookup"><span data-stu-id="ba51a-114">Test controller logic, not the framework.</span></span> <span data-ttu-id="ba51a-115">Testen Sie das *Verhalten* des Controllers bei gültigen oder ungültigen Eingaben.</span><span class="sxs-lookup"><span data-stu-id="ba51a-115">Test how the controller *behaves* based on valid or invalid inputs.</span></span> <span data-ttu-id="ba51a-116">Testen Sie die Antworten des Controllers auf der Grundlage des Ergebnisses des Geschäftsvorgangs, den er ausführt.</span><span class="sxs-lookup"><span data-stu-id="ba51a-116">Test controller responses based on the result of the business operation it performs.</span></span>

<span data-ttu-id="ba51a-117">Typische Aufgaben des Controllers:</span><span class="sxs-lookup"><span data-stu-id="ba51a-117">Typical controller responsibilities:</span></span>

* <span data-ttu-id="ba51a-118">Überprüfen von `ModelState.IsValid`</span><span class="sxs-lookup"><span data-stu-id="ba51a-118">Verify `ModelState.IsValid`.</span></span>
* <span data-ttu-id="ba51a-119">Zurückgeben einer Fehlerantwort, wenn `ModelState` ungültig ist</span><span class="sxs-lookup"><span data-stu-id="ba51a-119">Return an error response if `ModelState` is invalid.</span></span>
* <span data-ttu-id="ba51a-120">Abrufen einer Geschäftsentität aus dem Persistenzspeicher</span><span class="sxs-lookup"><span data-stu-id="ba51a-120">Retrieve a business entity from persistence.</span></span>
* <span data-ttu-id="ba51a-121">Ausführen einer Aktion für die Geschäftsentität</span><span class="sxs-lookup"><span data-stu-id="ba51a-121">Perform an action on the business entity.</span></span>
* <span data-ttu-id="ba51a-122">Speichern der Geschäftsentität im Persistenzspeicher</span><span class="sxs-lookup"><span data-stu-id="ba51a-122">Save the business entity to persistence.</span></span>
* <span data-ttu-id="ba51a-123">Zurückgeben eines entsprechenden `IActionResult`</span><span class="sxs-lookup"><span data-stu-id="ba51a-123">Return an appropriate `IActionResult`.</span></span>

## <a name="unit-testing"></a><span data-ttu-id="ba51a-124">Unittest</span><span class="sxs-lookup"><span data-stu-id="ba51a-124">Unit testing</span></span>

<span data-ttu-id="ba51a-125">Ein [Komponententest](/dotnet/articles/core/testing/unit-testing-with-dotnet-test) beinhaltet das Testen einer App-Komponente isoliert von ihrer Infrastruktur und ihren Abhängigkeiten.</span><span class="sxs-lookup"><span data-stu-id="ba51a-125">[Unit testing](/dotnet/articles/core/testing/unit-testing-with-dotnet-test) involves testing a part of an app in isolation from its infrastructure and dependencies.</span></span> <span data-ttu-id="ba51a-126">Bei einem Komponententest der Controllerlogik werden nur die Inhalte einer einzelnen Aktion getestet, nicht das Verhalten ihrer Abhängigkeiten oder des Frameworks selbst.</span><span class="sxs-lookup"><span data-stu-id="ba51a-126">When unit testing controller logic, only the contents of a single action is tested, not the behavior of its dependencies or of the framework itself.</span></span> <span data-ttu-id="ba51a-127">Konzentrieren Sie sich bei der Durchführung eines Komponententests für Ihre Controlleraktionen daher nur auf deren Verhalten.</span><span class="sxs-lookup"><span data-stu-id="ba51a-127">As you unit test your controller actions, make sure you focus only on its behavior.</span></span> <span data-ttu-id="ba51a-128">Bei einem Komponententest des Controllers werden z.B. [Filter](filters.md), [Routing](../../fundamentals/routing.md), [Modellbindung](../models/model-binding.md) o.Ä. vermieden.</span><span class="sxs-lookup"><span data-stu-id="ba51a-128">A controller unit test avoids things like [filters](filters.md), [routing](../../fundamentals/routing.md), or [model binding](../models/model-binding.md).</span></span> <span data-ttu-id="ba51a-129">Durch die Fokussierung auf nur einen Aspekt sind Komponententests in der Regel einfach zu schreiben und schnell in der Ausführung.</span><span class="sxs-lookup"><span data-stu-id="ba51a-129">By focusing on testing just one thing, unit tests are generally simple to write and quick to run.</span></span> <span data-ttu-id="ba51a-130">Gut geschriebene Komponententests können häufig ohne großen Mehraufwand ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="ba51a-130">A well-written set of unit tests can be run frequently without much overhead.</span></span> <span data-ttu-id="ba51a-131">Komponententests erkennen jedoch keine Probleme bei der Interaktion zwischen den Komponenten. Dazu dienen [Integrationstests](xref:mvc/controllers/testing#integration-testing).</span><span class="sxs-lookup"><span data-stu-id="ba51a-131">However, unit tests don't detect issues in the interaction between components, which is the purpose of [integration tests](xref:mvc/controllers/testing#integration-testing).</span></span>

<span data-ttu-id="ba51a-132">Wenn Sie benutzerdefinierte Filter, Routen usw. schreiben, sollten Sie für diese einen Komponententest durchführen. Er sollte jedoch nicht Bestandteil eines Tests für eine bestimmte Controlleraktion sein.</span><span class="sxs-lookup"><span data-stu-id="ba51a-132">If you're writing custom filters, routes, etc, you should unit test them, but not as part of your tests on a particular controller action.</span></span> <span data-ttu-id="ba51a-133">Die Tests sollten vielmehr isoliert ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="ba51a-133">They should be tested in isolation.</span></span>

> [!TIP]
> <span data-ttu-id="ba51a-134">[Erstellen und Ausführen von Komponententests mit Visual Studio](/visualstudio/test/unit-test-your-code).</span><span class="sxs-lookup"><span data-stu-id="ba51a-134">[Create and run unit tests with Visual Studio](/visualstudio/test/unit-test-your-code).</span></span>

<span data-ttu-id="ba51a-135">Überprüfen Sie den folgenden Controller, um Komponententests zu veranschaulichen.</span><span class="sxs-lookup"><span data-stu-id="ba51a-135">To demonstrate unit testing, review the following controller.</span></span> <span data-ttu-id="ba51a-136">Es wird eine Liste von Brainstormingsitzungen angezeigt. Außerdem können neue Brainstormingsitzungen mit einer POST-Anforderung erstellt werden:</span><span class="sxs-lookup"><span data-stu-id="ba51a-136">It displays a list of brainstorming sessions and allows new brainstorming sessions to be created with a POST:</span></span>

[!code-csharp[](testing/sample/TestingControllersSample/src/TestingControllersSample/Controllers/HomeController.cs?highlight=12,16,21,42,43)]

<span data-ttu-id="ba51a-137">Der Controller befolgt das [Prinzip der expliziten Abhängigkeiten](http://deviq.com/explicit-dependencies-principle/). Es wird Dependency Injection erwartet, wodurch dem Controller eine Instanz von `IBrainstormSessionRepository` bereitgestellt wird.</span><span class="sxs-lookup"><span data-stu-id="ba51a-137">The controller is following the [explicit dependencies principle](http://deviq.com/explicit-dependencies-principle/), expecting dependency injection to provide it with an instance of `IBrainstormSessionRepository`.</span></span> <span data-ttu-id="ba51a-138">Dadurch kann der Test relativ leicht mithilfe eines Pseudoobjektframeworks, wie z.B. [Moq](https://www.nuget.org/packages/Moq/), ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="ba51a-138">This makes it fairly easy to test using a mock object framework, like [Moq](https://www.nuget.org/packages/Moq/).</span></span> <span data-ttu-id="ba51a-139">Die `HTTP GET Index`-Methode verfügt weder über Schleifen noch über Verzweigungen und ruft nur eine Methode auf.</span><span class="sxs-lookup"><span data-stu-id="ba51a-139">The `HTTP GET Index` method has no looping or branching and only calls one method.</span></span> <span data-ttu-id="ba51a-140">Zum Testen der `Index`-Methode muss überprüft werden, ob ein `ViewResult` zurückgegeben wird, mit einem `ViewModel` aus der `List`-Methode des Repositorys.</span><span class="sxs-lookup"><span data-stu-id="ba51a-140">To test this `Index` method, we need to verify that a `ViewResult` is returned, with a `ViewModel` from the repository's `List` method.</span></span>

[!code-csharp[](testing/sample/TestingControllersSample/tests/TestingControllersSample.Tests/UnitTests/HomeControllerTests.cs?highlight=17-18&range=1-33,76-95)]

<span data-ttu-id="ba51a-141">Mit der `HomeController`-`HTTP POST Index`-Methode (siehe oben) sollte Folgendes überprüft werden:</span><span class="sxs-lookup"><span data-stu-id="ba51a-141">The `HomeController` `HTTP POST Index` method (shown above) should verify:</span></span>

* <span data-ttu-id="ba51a-142">Die Aktionsmethode gibt für `ViewResult` eine ungültige Anforderung zurück mit den entsprechenden Daten, wenn `ModelState.IsValid` `false` ist.</span><span class="sxs-lookup"><span data-stu-id="ba51a-142">The action method returns a Bad Request `ViewResult` with the appropriate data when `ModelState.IsValid` is `false`</span></span>

* <span data-ttu-id="ba51a-143">Die `Add`-Methode im Repository wird aufgerufen, und ein `RedirectToActionResult` mit den korrekten Argumenten wird zurückgegeben, wenn `ModelState.IsValid` TRUE ist.</span><span class="sxs-lookup"><span data-stu-id="ba51a-143">The `Add` method on the repository is called and a `RedirectToActionResult` is returned with the correct arguments when `ModelState.IsValid` is true.</span></span>

<span data-ttu-id="ba51a-144">Ein ungültiger Modellstatus kann getestet werden, indem mithilfe von `AddModelError` wie im ersten Test unten gezeigt Fehler hinzugefügt werden.</span><span class="sxs-lookup"><span data-stu-id="ba51a-144">Invalid model state can be tested by adding errors using `AddModelError` as shown in the first test below.</span></span>

[!code-csharp[](testing/sample/TestingControllersSample/tests/TestingControllersSample.Tests/UnitTests/HomeControllerTests.cs?highlight=8,15-16,37-39&range=35-75)]

<span data-ttu-id="ba51a-145">Im ersten Test wird bestätigt, dass bei ungültigem `ModelState` das gleiche `ViewResult` zurückgegeben wird wie für eine `GET`-Anforderung.</span><span class="sxs-lookup"><span data-stu-id="ba51a-145">The first test confirms when `ModelState` isn't valid, the same `ViewResult` is returned as for a `GET` request.</span></span> <span data-ttu-id="ba51a-146">Beachten Sie, dass der Test für ein ungültiges Modell gar nicht erfolgreich durchgeführt werden soll.</span><span class="sxs-lookup"><span data-stu-id="ba51a-146">Note that the test doesn't attempt to pass in an invalid model.</span></span> <span data-ttu-id="ba51a-147">Da die Modellbindung nicht ausgeführt wird, wäre dies ohnehin nicht möglich (obwohl bei einem [Integrationstest](xref:mvc/controllers/testing#integration-testing) eine Trainingsmodellbindung verwendet wird).</span><span class="sxs-lookup"><span data-stu-id="ba51a-147">That wouldn't work anyway since model binding isn't running (though an [integration test](xref:mvc/controllers/testing#integration-testing) would use exercise model binding).</span></span> <span data-ttu-id="ba51a-148">In diesem Fall wird nicht die Modellbindung getestet.</span><span class="sxs-lookup"><span data-stu-id="ba51a-148">In this case, model binding isn't being tested.</span></span> <span data-ttu-id="ba51a-149">Bei diesen Komponententests wird nur das Verhalten des Codes in der Aktionsmethode getestet.</span><span class="sxs-lookup"><span data-stu-id="ba51a-149">These unit tests are only testing what the code in the action method does.</span></span>

<span data-ttu-id="ba51a-150">Im zweiten Test wird überprüft, ob bei gültigem `ModelState` eine neue `BrainstormSession` (über das Repository) hinzugefügt wird. Die Methode gibt ein `RedirectToActionResult` mit den erwarteten Eigenschaften zurück.</span><span class="sxs-lookup"><span data-stu-id="ba51a-150">The second test verifies that when `ModelState` is valid, a new `BrainstormSession` is added (via the repository), and the method returns a `RedirectToActionResult` with the expected properties.</span></span> <span data-ttu-id="ba51a-151">Simulierte Aufrufe, die nicht aufgerufen werden, werden normalerweise ignoriert. Durch Aufrufen von `Verifiable` am Ende des Einrichtungsaufrufs können sie im Test jedoch überprüft werden.</span><span class="sxs-lookup"><span data-stu-id="ba51a-151">Mocked calls that aren't called are normally ignored, but calling `Verifiable` at the end of the setup call allows it to be verified in the test.</span></span> <span data-ttu-id="ba51a-152">Dies erfolgt mit dem Aufruf `mockRepo.Verify`. Damit schlägt der Test fehl, wenn die erwartete Methode nicht aufgerufen wurde.</span><span class="sxs-lookup"><span data-stu-id="ba51a-152">This is done with the call to `mockRepo.Verify`, which will fail the test if the expected method wasn't called.</span></span>

> [!NOTE]
> <span data-ttu-id="ba51a-153">Mit der in diesem Beispiel verwendeten Moq-Bibliothek können überprüfbare (oder „strikte“) Pseudoobjekte mit nicht überprüfbaren Pseudoobjekten (auch „nicht-strikte“ Pseudoobjekte oder „Stubs“ genannt) ganz einfach kombiniert werden.</span><span class="sxs-lookup"><span data-stu-id="ba51a-153">The Moq library used in this sample makes it easy to mix verifiable, or "strict", mocks with non-verifiable mocks (also called "loose" mocks or stubs).</span></span> <span data-ttu-id="ba51a-154">Weitere Informationen finden Sie unter [Customizing Mock behavior with Moq](https://github.com/Moq/moq4/wiki/Quickstart#customizing-mock-behavior) (Anpassen des Verhaltens von Pseudoobjekten mit Moq).</span><span class="sxs-lookup"><span data-stu-id="ba51a-154">Learn more about [customizing Mock behavior with Moq](https://github.com/Moq/moq4/wiki/Quickstart#customizing-mock-behavior).</span></span>

<span data-ttu-id="ba51a-155">Ein anderer Controller in der App zeigt Informationen zu einer bestimmten Brainstormingsitzung an.</span><span class="sxs-lookup"><span data-stu-id="ba51a-155">Another controller in the app displays information related to a particular brainstorming session.</span></span> <span data-ttu-id="ba51a-156">Er verfügt auch über Programmlogik für den Umgang mit ungültigen ID-Werten:</span><span class="sxs-lookup"><span data-stu-id="ba51a-156">It includes some logic to deal with invalid id values:</span></span>

[!code-csharp[](./testing/sample/TestingControllersSample/src/TestingControllersSample/Controllers/SessionController.cs?highlight=19,20,21,22,25,26,27,28)]

<span data-ttu-id="ba51a-157">Die Controlleraktion verfügt über drei Fälle, die getestet werden können, und zwar einen für jede `return`-Anweisung:</span><span class="sxs-lookup"><span data-stu-id="ba51a-157">The controller action has three cases to test, one for each `return` statement:</span></span>

[!code-csharp[](testing/sample/TestingControllersSample/tests/TestingControllersSample.Tests/UnitTests/SessionControllerTests.cs?highlight=27,28,29,46,47,64,65,66,67,68)]

<span data-ttu-id="ba51a-158">Die App stellt Funktionen als Web-API bereit (eine Liste mit Ideen, die einer Brainstormingsitzung zugeordnet werden, sowie eine Methode zum Hinzufügen von neuen Ideen zu einer Sitzung):</span><span class="sxs-lookup"><span data-stu-id="ba51a-158">The app exposes functionality as a web API (a list of ideas associated with a brainstorming session and a method for adding new ideas to a session):</span></span>

<a name="ideas-controller"></a>

[!code-csharp[](testing/sample/TestingControllersSample/src/TestingControllersSample/Api/IdeasController.cs?highlight=21,22,27,30,31,32,33,34,35,36,41,42,46,52,65)]

<span data-ttu-id="ba51a-159">Die `ForSession`-Methode gibt eine Liste von `IdeaDTO`-Typen zurück.</span><span class="sxs-lookup"><span data-stu-id="ba51a-159">The `ForSession` method returns a list of `IdeaDTO` types.</span></span> <span data-ttu-id="ba51a-160">Geben Sie Ihre Geschäftsdomänenentitäten nicht direkt über API-Aufrufe zurück, da sie häufig mehr Daten enthalten, als die Client-API anfordert. Außerdem verknüpfen sie unnötigerweise das interne Domänenmodell Ihrer App mit der extern zur Verfügung gestellten API.</span><span class="sxs-lookup"><span data-stu-id="ba51a-160">Avoid returning your business domain entities directly via API calls, since frequently they include more data than the API client requires, and they unnecessarily couple your app's internal domain model with the API you expose externally.</span></span> <span data-ttu-id="ba51a-161">Die Zuordnung zwischen Domänenentitäten und den Typen, die Sie über das Netzwerk zurückgeben, kann manuell ausgeführt werden (wie hier gezeigt mithilfe von LINQ-`Select`) oder mithilfe einer Bibliothek wie etwa [AutoMapper](https://github.com/AutoMapper/AutoMapper).</span><span class="sxs-lookup"><span data-stu-id="ba51a-161">Mapping between domain entities and the types you will return over the wire can be done manually (using a LINQ `Select` as shown here) or using a library like [AutoMapper](https://github.com/AutoMapper/AutoMapper)</span></span>

<span data-ttu-id="ba51a-162">Die Komponententests für die API-Methoden `Create` und `ForSession`:</span><span class="sxs-lookup"><span data-stu-id="ba51a-162">The unit tests for the `Create` and `ForSession` API methods:</span></span>

[!code-csharp[](testing/sample/TestingControllersSample/tests/TestingControllersSample.Tests/UnitTests/ApiIdeasControllerTests.cs?highlight=18,23,29,33,38-39,43,50,58-59,68-70,76-78&range=1-83,121-135)]

<span data-ttu-id="ba51a-163">Fügen Sie wie bereits erwähnt dem Controller einen Modellfehler als Teil des Tests hinzu, um das Verhalten der Methode bei ungültigem `ModelState` zu testen.</span><span class="sxs-lookup"><span data-stu-id="ba51a-163">As stated previously, to test the behavior of the method when `ModelState` is invalid, add a model error to the controller as part of the test.</span></span> <span data-ttu-id="ba51a-164">Testen Sie in den Komponententests nicht die Modellvalidierung oder -bindung. Testen Sie nur das Verhalten Ihrer Aktionsmethode bei einem bestimmten `ModelState`-Wert.</span><span class="sxs-lookup"><span data-stu-id="ba51a-164">Don't try to test model validation or model binding in your unit tests - just test your action method's behavior when confronted with a particular `ModelState` value.</span></span>

<span data-ttu-id="ba51a-165">Der zweite Test hängt davon ab, ob das Repository NULL zurückgibt. Daher wird das Pseudorepository so konfiguriert, dass es NULL zurückgibt.</span><span class="sxs-lookup"><span data-stu-id="ba51a-165">The second test depends on the repository returning null, so the mock repository is configured to return null.</span></span> <span data-ttu-id="ba51a-166">Es ist nicht nötig, eine Testdatenbank (z.B. im Arbeitsspeicher) und eine Abfrage zu erstellen, die dieses Ergebnis zurückgibt. Dies können Sie auch wie bereits gezeigt in einer einzigen Anweisung erledigen.</span><span class="sxs-lookup"><span data-stu-id="ba51a-166">There's no need to create a test database (in memory or otherwise) and construct a query that will return this result - it can be done in a single statement as shown.</span></span>

<span data-ttu-id="ba51a-167">Im letzten Test wird überprüft, ob die `Update`-Methode des Repositorys aufgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="ba51a-167">The last test verifies that the repository's `Update` method is called.</span></span> <span data-ttu-id="ba51a-168">Wie schon zuvor wird das Pseudoobjekt mit `Verifiable` aufgerufen. Anschließend wird die `Verify`-Methode des Pseudorepositorys aufgerufen, um zu bestätigen, dass die überprüfbare Methode ausgeführt wurde.</span><span class="sxs-lookup"><span data-stu-id="ba51a-168">As we did previously, the mock is called with `Verifiable` and then the mocked repository's `Verify` method is called to confirm the verifiable method was executed.</span></span> <span data-ttu-id="ba51a-169">Es gehört nicht zu den Aufgaben eines Komponententests sicherzustellen, dass die Daten von der `Update`-Methode gespeichert wurden. Dies kann mit einem Integrationstest durchgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="ba51a-169">It's not a unit test responsibility to ensure that the `Update` method saved the data; that can be done with an integration test.</span></span>

## <a name="integration-testing"></a><span data-ttu-id="ba51a-170">Integrationstests</span><span class="sxs-lookup"><span data-stu-id="ba51a-170">Integration testing</span></span>

<span data-ttu-id="ba51a-171">Mit [Integrationstests](../../testing/integration-testing.md) soll sichergestellt werden, dass die separaten Module innerhalb einer App korrekt zusammenarbeiten.</span><span class="sxs-lookup"><span data-stu-id="ba51a-171">[Integration tests](../../testing/integration-testing.md) is done to ensure separate modules within your app work correctly together.</span></span> <span data-ttu-id="ba51a-172">Alle Aspekte, die Sie mit einem Komponententest testen können, können in der Regel auch mit einem Integrationstest getestet werden. Umgekehrt gilt diese Aussage jedoch nicht.</span><span class="sxs-lookup"><span data-stu-id="ba51a-172">Generally, anything you can test with a unit test, you can also test with an integration test, but the reverse isn't true.</span></span> <span data-ttu-id="ba51a-173">Integrationstests sind jedoch meist viel langsamer als Komponententests.</span><span class="sxs-lookup"><span data-stu-id="ba51a-173">However, integration tests tend to be much slower than unit tests.</span></span> <span data-ttu-id="ba51a-174">Daher sollten Sie wann immer möglich Komponententests durchführen und Integrationstests nur für Szenarios verwenden, an denen mehrere Mitwirkende beteiligt sind.</span><span class="sxs-lookup"><span data-stu-id="ba51a-174">Thus, it's best to test whatever you can with unit tests, and use integration tests for scenarios that involve multiple collaborators.</span></span>

<span data-ttu-id="ba51a-175">Auch wenn sie manchmal nützlich sein können, werden Pseudoobjekte selten in Integrationstests verwendet.</span><span class="sxs-lookup"><span data-stu-id="ba51a-175">Although they may still be useful, mock objects are rarely used in integration tests.</span></span> <span data-ttu-id="ba51a-176">In Komponententests kann mit Pseudoobjekten effektiv überprüft werden, wie sich Mitwirkende außerhalb der getesteten Komponente zu Testzwecken verhalten sollten.</span><span class="sxs-lookup"><span data-stu-id="ba51a-176">In unit testing, mock objects are an effective way to control how collaborators outside of the unit being tested should behave for the purposes of the test.</span></span> <span data-ttu-id="ba51a-177">In einem Integrationstest sollen echte Mitwirkende bestätigen, dass das gesamte Subsystem korrekt zusammenarbeitet.</span><span class="sxs-lookup"><span data-stu-id="ba51a-177">In an integration test, real collaborators are used to confirm the whole subsystem works together correctly.</span></span>

### <a name="application-state"></a><span data-ttu-id="ba51a-178">Status der Anwendung</span><span class="sxs-lookup"><span data-stu-id="ba51a-178">Application state</span></span>

<span data-ttu-id="ba51a-179">Ein wichtiger Aspekt beim Ausführen von Integrationstests ist die Festlegung des Status der Anwendung.</span><span class="sxs-lookup"><span data-stu-id="ba51a-179">One important consideration when performing integration testing is how to set your app's state.</span></span> <span data-ttu-id="ba51a-180">Tests müssen unabhängig voneinander ausgeführt werden. Daher sollte sich die App zu Beginn jedes Tests in einem bekannten Zustand befinden.</span><span class="sxs-lookup"><span data-stu-id="ba51a-180">Tests need to run independent of one another, and so each test should start with the app in a known state.</span></span> <span data-ttu-id="ba51a-181">Dies ist kein Problem, wenn Ihre App eine Datenbank oder einen Persistenzspeicher verwendet.</span><span class="sxs-lookup"><span data-stu-id="ba51a-181">If your app doesn't use a database or have any persistence, this may not be an issue.</span></span> <span data-ttu-id="ba51a-182">Die meisten echten Apps speichern ihren Status in der Praxis jedoch auf einem Datenspeicher. Daher könnte jede Änderung durch einen Test Auswirkungen auf weitere Tests besitzen, sofern der Datenspeicher nicht zurückgesetzt wird.</span><span class="sxs-lookup"><span data-stu-id="ba51a-182">However, most real-world apps persist their state to some kind of data store, so any modifications made by one test could impact another test unless the data store is reset.</span></span> <span data-ttu-id="ba51a-183">Wenn Sie den integrierten `TestServer` verwenden, können Sie in den Integrationstests auf einfache Weise ASP.NET Core-Apps hosten. Doch damit erhalten Sie nicht unbedingt Zugriff auf die verwendeten Daten.</span><span class="sxs-lookup"><span data-stu-id="ba51a-183">Using the built-in `TestServer`, it's very straightforward to host ASP.NET Core apps within our integration tests, but that doesn't necessarily grant access to the data it will use.</span></span> <span data-ttu-id="ba51a-184">Wenn Sie eine tatsächliche Datenbank verwenden, können Sie beispielsweise eine Verbindung zwischen der App und einer Testdatenbank herstellen, auf die die Tests Zugriff haben. So wird sichergestellt, dass die App in einen bekannten Zustand zurückgesetzt wird, bevor der nächste Test ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="ba51a-184">If you're using an actual database, one approach is to have the app connect to a test database, which your tests can access and ensure is reset to a known state before each test executes.</span></span>

<span data-ttu-id="ba51a-185">In dieser Beispielanwendung wird die Unterstützung der InMemoryDatabase von Entity Framework Core verwendet. Daher kann für das Testprojekt nicht einfach eine Verbindung hergestellt werden.</span><span class="sxs-lookup"><span data-stu-id="ba51a-185">In this sample application, I'm using Entity Framework Core's InMemoryDatabase support, so I can't just connect to it from my test project.</span></span> <span data-ttu-id="ba51a-186">Stattdessen wird eine `InitializeDatabase`-Methode aus der `Startup`-Klasse der App bereitgestellt, die beim Starten der App aufgerufen wird, wenn sie sich in der `Development`-Umgebung befindet.</span><span class="sxs-lookup"><span data-stu-id="ba51a-186">Instead, I expose an `InitializeDatabase` method from the app's `Startup` class, which I call when the app starts up if it's in the `Development` environment.</span></span> <span data-ttu-id="ba51a-187">Die Integrationstests profitieren hiervon automatisch, solange die Umgebung auf `Development` festgelegt ist.</span><span class="sxs-lookup"><span data-stu-id="ba51a-187">My integration tests automatically benefit from this as long as they set the environment to `Development`.</span></span> <span data-ttu-id="ba51a-188">So müssen Sie nicht an das Zurücksetzen der Datenbank denken, da die InMemoryDatabase bei jedem Starten der App zurückgesetzt wird.</span><span class="sxs-lookup"><span data-stu-id="ba51a-188">I don't have to worry about resetting the database, since the InMemoryDatabase is reset each time the app restarts.</span></span>

<span data-ttu-id="ba51a-189">Die `Startup`-Klasse:</span><span class="sxs-lookup"><span data-stu-id="ba51a-189">The `Startup` class:</span></span>

[!code-csharp[](testing/sample/TestingControllersSample/src/TestingControllersSample/Startup.cs?highlight=19,20,34,35,43,52)]

<span data-ttu-id="ba51a-190">Die in Integrationstests häufig verwendete `GetTestSession`-Methode wird weiter unten gezeigt.</span><span class="sxs-lookup"><span data-stu-id="ba51a-190">You'll see the `GetTestSession` method used frequently in the integration tests below.</span></span>

### <a name="accessing-views"></a><span data-ttu-id="ba51a-191">Zugreifen auf Ansichten</span><span class="sxs-lookup"><span data-stu-id="ba51a-191">Accessing views</span></span>

<span data-ttu-id="ba51a-192">In jeder Integrationstestklasse wird der `TestServer` konfiguriert, der die ASP.NET Core-App ausführt.</span><span class="sxs-lookup"><span data-stu-id="ba51a-192">Each integration test class configures the `TestServer` that will run the ASP.NET Core app.</span></span> <span data-ttu-id="ba51a-193">Standardmäßig hostet der `TestServer` die Web-App in dem Ordner, in dem sie ausgeführt wird – in diesem Fall dem Testprojektordner.</span><span class="sxs-lookup"><span data-stu-id="ba51a-193">By default, `TestServer` hosts the web app in the folder where it's running - in this case, the test project folder.</span></span> <span data-ttu-id="ba51a-194">Wenn Sie versuchen, Controlleraktionen zu testen, die `ViewResult` zurückgeben, wird Ihnen daher möglicherweise der folgende Fehler angezeigt:</span><span class="sxs-lookup"><span data-stu-id="ba51a-194">Thus, when you attempt to test controller actions that return `ViewResult`, you may see this error:</span></span>

```
The view 'Index' wasn't found. The following locations were searched:
(list of locations)
```

<span data-ttu-id="ba51a-195">Zum Beheben dieses Problems müssen Sie das Inhaltsstammverzeichnis des Servers so konfigurieren, dass es die Ansichten für das getestete Projekt finden kann.</span><span class="sxs-lookup"><span data-stu-id="ba51a-195">To correct this issue, you need to configure the server's content root, so it can locate the views for the project being tested.</span></span> <span data-ttu-id="ba51a-196">Rufen Sie hierzu wie folgt `UseContentRoot` in der `TestFixture`-Klasse auf:</span><span class="sxs-lookup"><span data-stu-id="ba51a-196">This is done by a call to `UseContentRoot` in the `TestFixture` class, shown below:</span></span>

[!code-csharp[](testing/sample/TestingControllersSample/tests/TestingControllersSample.Tests/IntegrationTests/TestFixture.cs?highlight=30,33)]

<span data-ttu-id="ba51a-197">Die `TestFixture`-Klasse dient zum Konfigurieren und Erstellen des `TestServer` sowie zum Einrichten eines `HttpClient` zur Kommunikation mit dem `TestServer`.</span><span class="sxs-lookup"><span data-stu-id="ba51a-197">The `TestFixture` class is responsible for configuring and creating the `TestServer`, setting up an `HttpClient` to communicate with the `TestServer`.</span></span> <span data-ttu-id="ba51a-198">Jeder Integrationstest verwendet die `Client`-Eigenschaft, um eine Verbindung zum Testserver herzustellen und eine Anforderung zu senden.</span><span class="sxs-lookup"><span data-stu-id="ba51a-198">Each of the integration tests uses the `Client` property to connect to the test server and make a request.</span></span>

[!code-csharp[](testing/sample/TestingControllersSample/tests/TestingControllersSample.Tests/IntegrationTests/HomeControllerTests.cs?highlight=20,26,29,30,31,35,38,39,40,41,44,47,48)]

<span data-ttu-id="ba51a-199">Im ersten Test weiter oben enthält `responseString` den tatsächlich gerenderten HTML-Code aus der Ansicht. Dieser kann überprüft werden, um sicherzustellen, dass er die erwarteten Ergebnisse enthält.</span><span class="sxs-lookup"><span data-stu-id="ba51a-199">In the first test above, the `responseString` holds the actual rendered HTML from the View, which can be inspected to confirm it contains expected results.</span></span>

<span data-ttu-id="ba51a-200">Im zweiten Test wird eine Formularbereitstellung mit einem eindeutigen Sitzungsnamen erstellt und für die App bereitgestellt. Dann wird überprüft, ob die erwartete Umleitung zurückgegeben wird.</span><span class="sxs-lookup"><span data-stu-id="ba51a-200">The second test constructs a form POST with a unique session name and POSTs it to the app, then verifies that the expected redirect is returned.</span></span>

### <a name="api-methods"></a><span data-ttu-id="ba51a-201">API-Methoden</span><span class="sxs-lookup"><span data-stu-id="ba51a-201">API methods</span></span>

<span data-ttu-id="ba51a-202">Stellt Ihrer App Web-APIs bereit, sollten Sie mit automatisierten Tests bestätigen lassen, dass diese erwartungsgemäß ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="ba51a-202">If your app exposes web APIs, it's a good idea to have automated tests confirm they execute as expected.</span></span> <span data-ttu-id="ba51a-203">Der integrierte `TestServer` erleichtert das Testen von Web-APIs.</span><span class="sxs-lookup"><span data-stu-id="ba51a-203">The built-in `TestServer` makes it easy to test web APIs.</span></span> <span data-ttu-id="ba51a-204">Wenn Ihre API-Methoden Modellbindung verwenden, sollten Sie `ModelState.IsValid` immer überprüfen. Integrationstests eignen sich hervorragend dazu, das korrekte Funktionieren der Modellvalidierung zu überprüfen.</span><span class="sxs-lookup"><span data-stu-id="ba51a-204">If your API methods are using model binding, you should always check `ModelState.IsValid`, and integration tests are the right place to confirm that your model validation is working properly.</span></span>

<span data-ttu-id="ba51a-205">Die folgenden Tests beziehen sich auf die `Create`-Methode in der oben gezeigten [IdeasController](xref:mvc/controllers/testing#ideas-controller)-Klasse:</span><span class="sxs-lookup"><span data-stu-id="ba51a-205">The following set of tests target the `Create` method in the [IdeasController](xref:mvc/controllers/testing#ideas-controller) class shown above:</span></span>

[!code-csharp[](testing/sample/TestingControllersSample/tests/TestingControllersSample.Tests/IntegrationTests/ApiIdeasControllerTests.cs)]

<span data-ttu-id="ba51a-206">Im Gegensatz zu den Integrationstests für Aktionen, die HTML-Ansichten zurückgeben, können Web-API-Methoden, die Ergebnisse zurückgeben, in der Regel wie im letzten Test oben gezeigt als stark typisierte Objekte deserialisiert werden.</span><span class="sxs-lookup"><span data-stu-id="ba51a-206">Unlike integration tests of actions that returns HTML views, web API methods that return results can usually be deserialized as strongly typed objects, as the last test above shows.</span></span> <span data-ttu-id="ba51a-207">In diesem Fall deserialisiert der Test das Ergebnis in eine `BrainstormSession`-Instanz und bestätigt, dass die Idee der Liste von Ideen korrekt hinzugefügt wurde.</span><span class="sxs-lookup"><span data-stu-id="ba51a-207">In this case, the test deserializes the result to a `BrainstormSession` instance, and confirms that the idea was correctly added to its collection of ideas.</span></span>

<span data-ttu-id="ba51a-208">Weitere Beispiele für Integrationstests finden Sie im [Beispielprojekt](https://github.com/aspnet/Docs/tree/master/aspnetcore/mvc/controllers/testing/sample) für diesen Artikel.</span><span class="sxs-lookup"><span data-stu-id="ba51a-208">You'll find additional examples of integration tests in this article's [sample project](https://github.com/aspnet/Docs/tree/master/aspnetcore/mvc/controllers/testing/sample).</span></span>
