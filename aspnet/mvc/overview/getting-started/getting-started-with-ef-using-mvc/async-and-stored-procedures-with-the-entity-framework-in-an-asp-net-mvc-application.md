---
uid: mvc/overview/getting-started/getting-started-with-ef-using-mvc/async-and-stored-procedures-with-the-entity-framework-in-an-asp-net-mvc-application
title: Async und gespeicherten Prozeduren mit dem Entity Framework in einer ASP.NET MVC-Anwendung | Microsoft Docs
author: tdykstra
description: Die Contoso-University Beispielwebanwendung veranschaulicht, wie ASP.NET MVC 5-Anwendungen, die mit dem Entity Framework 6 Code First und Visual Studio erstellen...
ms.author: aspnetcontent
manager: wpickett
ms.date: 11/07/2014
ms.topic: article
ms.assetid: 27d110fc-d1b7-4628-a763-26f1e6087549
ms.technology: dotnet-mvc
ms.prod: .net-framework
msc.legacyurl: /mvc/overview/getting-started/getting-started-with-ef-using-mvc/async-and-stored-procedures-with-the-entity-framework-in-an-asp-net-mvc-application
msc.type: authoredcontent
ms.openlocfilehash: 84cf427c7da7905444568ac34534e9ed98a7d8c8
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 04/06/2018
---
<a name="async-and-stored-procedures-with-the-entity-framework-in-an-aspnet-mvc-application"></a><span data-ttu-id="00bb4-103">Async und gespeicherten Prozeduren mit dem Entity Framework in einer ASP.NET MVC-Anwendung</span><span class="sxs-lookup"><span data-stu-id="00bb4-103">Async and Stored Procedures with the Entity Framework in an ASP.NET MVC Application</span></span>
====================
<span data-ttu-id="00bb4-104">durch [Tom Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="00bb4-104">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

<span data-ttu-id="00bb4-105">[Herunterladen des abgeschlossenen Projekts](http://code.msdn.microsoft.com/ASPNET-MVC-Application-b01a9fe8) oder [PDF herunterladen](http://download.microsoft.com/download/0/F/B/0FBFAA46-2BFD-478F-8E56-7BF3C672DF9D/Getting%20Started%20with%20Entity%20Framework%206%20Code%20First%20using%20MVC%205.pdf)</span><span class="sxs-lookup"><span data-stu-id="00bb4-105">[Download Completed Project](http://code.msdn.microsoft.com/ASPNET-MVC-Application-b01a9fe8) or [Download PDF](http://download.microsoft.com/download/0/F/B/0FBFAA46-2BFD-478F-8E56-7BF3C672DF9D/Getting%20Started%20with%20Entity%20Framework%206%20Code%20First%20using%20MVC%205.pdf)</span></span>

> <span data-ttu-id="00bb4-106">Die Contoso-University Beispielwebanwendung veranschaulicht, wie ASP.NET MVC 5-Anwendungen, die mit dem Entity Framework 6 Code First und Visual Studio 2013.</span><span class="sxs-lookup"><span data-stu-id="00bb4-106">The Contoso University sample web application demonstrates how to create ASP.NET MVC 5 applications using the Entity Framework 6 Code First and Visual Studio 2013.</span></span> <span data-ttu-id="00bb4-107">Informationen zu dieser Tutorialreihe finden Sie im [ersten Tutorial der Reihe](creating-an-entity-framework-data-model-for-an-asp-net-mvc-application.md).</span><span class="sxs-lookup"><span data-stu-id="00bb4-107">For information about the tutorial series, see [the first tutorial in the series](creating-an-entity-framework-data-model-for-an-asp-net-mvc-application.md).</span></span>


<span data-ttu-id="00bb4-108">In früheren Lernprogrammen haben Sie gelernt, lesen und Aktualisieren von Daten mit dem synchronen Programmiermodell.</span><span class="sxs-lookup"><span data-stu-id="00bb4-108">In earlier tutorials you learned how to read and update data using the synchronous programming model.</span></span> <span data-ttu-id="00bb4-109">In diesem Lernprogramm erfahren Sie, wie das asynchrone Programmiermodell implementieren.</span><span class="sxs-lookup"><span data-stu-id="00bb4-109">In this tutorial you see how to implement the asynchronous programming model.</span></span> <span data-ttu-id="00bb4-110">Asynchronem Code können auf eine Anwendung, die eine bessere Leistung ausgeführt werden, da es eine bessere Verwendung von Server-Ressourcen ermöglicht.</span><span class="sxs-lookup"><span data-stu-id="00bb4-110">Asynchronous code can help an application perform better because it makes better use of server resources.</span></span>

<span data-ttu-id="00bb4-111">In diesem Lernprogramm wird auch zum Verwenden von gespeicherter Prozeduren für INSERT-, Update- und Delete-Operationen für eine Entität angezeigt werden.</span><span class="sxs-lookup"><span data-stu-id="00bb4-111">In this tutorial you'll also see how to use stored procedures for insert, update, and delete operations on an entity.</span></span>

<span data-ttu-id="00bb4-112">Schließlich müssen Sie die Anwendung in Azure, zusammen mit allen Änderungen an der Datenbank erneut bereitstellen, die Sie seit der ersten Ausführung implementiert haben, die Sie bereitgestellt haben.</span><span class="sxs-lookup"><span data-stu-id="00bb4-112">Finally, you'll redeploy the application to Azure, along with all of the database changes that you've implemented since the first time you deployed.</span></span>

<span data-ttu-id="00bb4-113">In den folgenden Abbildungen werden die Seiten dargestellt, mit denen Sie arbeiten werden.</span><span class="sxs-lookup"><span data-stu-id="00bb4-113">The following illustrations show some of the pages that you'll work with.</span></span>

![Seite "Abteilung"](async-and-stored-procedures-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image1.png)

![Abteilung erstellen](async-and-stored-procedures-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image2.png)

## <a name="why-bother-with-asynchronous-code"></a><span data-ttu-id="00bb4-116">Warum kümmern Sie asynchronen code</span><span class="sxs-lookup"><span data-stu-id="00bb4-116">Why bother with asynchronous code</span></span>

<span data-ttu-id="00bb4-117">Der Webserver verfügt nur über eine begrenzte Anzahl von Threads. Daher werden bei hoher Auslastung möglicherweise alle verfügbaren Threads gleichzeitig verwendet.</span><span class="sxs-lookup"><span data-stu-id="00bb4-117">A web server has a limited number of threads available, and in high load situations all of the available threads might be in use.</span></span> <span data-ttu-id="00bb4-118">Wenn dies der Fall ist, kann der Server keine neuen Anforderungen verarbeiten, bis die Threads wieder freigegeben werden.</span><span class="sxs-lookup"><span data-stu-id="00bb4-118">When that happens, the server can't process new requests until the threads are freed up.</span></span> <span data-ttu-id="00bb4-119">Wenn synchroner Code verwendet wird, kann es sein, dass zwar viele Threads belegt sind, diese aber keine Vorgänge ausführen, da sie auf den Abschluss der E/A-Vorgänge warten.</span><span class="sxs-lookup"><span data-stu-id="00bb4-119">With synchronous code, many threads may be tied up while they aren't actually doing any work because they're waiting for I/O to complete.</span></span> <span data-ttu-id="00bb4-120">Wenn asynchroner Code verwendet wird, werden Threads für den Server freigegeben, wenn diese nur auf den Abschluss der E/A-Vorgänge warten, damit andere Anforderungen verarbeitet werden können.</span><span class="sxs-lookup"><span data-stu-id="00bb4-120">With asynchronous code, when a process is waiting for I/O to complete, its thread is freed up for the server to use for processing other requests.</span></span> <span data-ttu-id="00bb4-121">Folglich kann asynchronen Code Serverressourcen effizienter und der Server ist aktiviert, um weitere ohne Verzögerungen-Datenverkehr zu bewältigen.</span><span class="sxs-lookup"><span data-stu-id="00bb4-121">As a result, asynchronous code enables server resources to be use more efficiently, and the server is enabled to handle more traffic without delays.</span></span>

<span data-ttu-id="00bb4-122">In früheren Versionen von .NET schreiben und Testen asynchronen Code war komplex, fehleranfällig und schwierig zu debuggen.</span><span class="sxs-lookup"><span data-stu-id="00bb4-122">In earlier versions of .NET, writing and testing asynchronous code was complex, error prone, and hard to debug.</span></span> <span data-ttu-id="00bb4-123">In .NET 4.5 ist schreiben, testen und Debuggen asynchronen Code sehr viel einfacher, dass Sie in der Regel asynchronen Code schreiben soll, es sei denn, Sie einen Grund nicht für haben.</span><span class="sxs-lookup"><span data-stu-id="00bb4-123">In .NET 4.5, writing, testing, and debugging asynchronous code is so much easier that you should generally write asynchronous code unless you have a reason not to.</span></span> <span data-ttu-id="00bb4-124">Asynchronen Code eine kleine Menge an Mehraufwand einschleusen, aber die Leistungseinbußen bei unerheblich, während für Situationen mit hohem Datenverkehr ist mit niedrigem Datenverkehr Situationen möglicher Leistungssteigerungen erhebliche ist.</span><span class="sxs-lookup"><span data-stu-id="00bb4-124">Asynchronous code does introduce a small amount of overhead, but for low traffic situations the performance hit is negligible, while for high traffic situations, the potential performance improvement is substantial.</span></span>

<span data-ttu-id="00bb4-125">Weitere Informationen zur asynchronen Programmierung finden Sie unter [verwenden .NET 4.5 asynchrone Unterstützung, um zu vermeiden, Aufrufe blockiert](../../../../aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/web-development-best-practices.md#async).</span><span class="sxs-lookup"><span data-stu-id="00bb4-125">For more information about asynchronous programming, see [Use .NET 4.5's async support to avoid blocking calls](../../../../aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/web-development-best-practices.md#async).</span></span>

## <a name="create-the-department-controller"></a><span data-ttu-id="00bb4-126">Erstellen Sie die Department-controller</span><span class="sxs-lookup"><span data-stu-id="00bb4-126">Create the Department controller</span></span>

<span data-ttu-id="00bb4-127">Erstellen Sie einen Abteilung-Controller, wählen Sie die gleiche Weise wie die früheren Controller, mit Ausnahme von dieser Zeit haben, die **verwenden asynchrone Controller** Aktionen Kontrollkästchen.</span><span class="sxs-lookup"><span data-stu-id="00bb4-127">Create a Department controller the same way you did the earlier controllers, except this time select the **Use async controller** actions check box.</span></span>

![Abteilung Controller Gerüst](async-and-stored-procedures-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image3.png)

<span data-ttu-id="00bb4-129">Die folgenden Merkmale anzeigen können, die synchronem Code für hinzugefügt wurde die `Index` Methode, um asynchrone erleichtern:</span><span class="sxs-lookup"><span data-stu-id="00bb4-129">The following highlights show what was added to the synchronous code for the `Index` method to make it asynchronous:</span></span>

[!code-csharp[Main](async-and-stored-procedures-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample1.cs?highlight=1,4)]

<span data-ttu-id="00bb4-130">Vier Änderungen wurden angewendet, um die Entity Framework-Datenbankabfrage asynchron auszuführende zu aktivieren:</span><span class="sxs-lookup"><span data-stu-id="00bb4-130">Four changes were applied to enable the Entity Framework database query to execute asynchronously:</span></span>

- <span data-ttu-id="00bb4-131">Die Methode wird gekennzeichnet, mit der `async` Schlüsselwort, das der Compiler, um Rückrufe für Teile des Methodentextes zu generieren und zum automatischen Erstellen von gibt die `Task<ActionResult>` -Objekt, das zurückgegeben wird.</span><span class="sxs-lookup"><span data-stu-id="00bb4-131">The method is marked with the `async` keyword, which tells the compiler to generate callbacks for parts of the method body and to automatically create the `Task<ActionResult>` object that is returned.</span></span>
- <span data-ttu-id="00bb4-132">Der Rückgabetyp geändert wurde `ActionResult` auf `Task<ActionResult>`.</span><span class="sxs-lookup"><span data-stu-id="00bb4-132">The return type was changed from `ActionResult` to `Task<ActionResult>`.</span></span> <span data-ttu-id="00bb4-133">Die `Task<T>` Typ stellt derzeit ausgeführte Arbeit mit einem Ergebnis vom Typ `T`.</span><span class="sxs-lookup"><span data-stu-id="00bb4-133">The `Task<T>` type represents ongoing work with a result of type `T`.</span></span>
- <span data-ttu-id="00bb4-134">Die `await` -Schlüsselwort auf den Aufruf des Webdiensts angewendet wurde.</span><span class="sxs-lookup"><span data-stu-id="00bb4-134">The `await` keyword was applied to the web service call.</span></span> <span data-ttu-id="00bb4-135">Wenn der Compiler dieses Schlüsselwort sieht, teilt hinter den Kulissen er die Methode in zwei Teile.</span><span class="sxs-lookup"><span data-stu-id="00bb4-135">When the compiler sees this keyword, behind the scenes it splits the method into two parts.</span></span> <span data-ttu-id="00bb4-136">Der erste Teil endet mit dem Vorgang, der asynchron gestartet wird.</span><span class="sxs-lookup"><span data-stu-id="00bb4-136">The first part ends with the operation that is started asynchronously.</span></span> <span data-ttu-id="00bb4-137">Der zweite Teil ist eine Rückrufmethode abgelegt, die aufgerufen wird, wenn der Vorgang abgeschlossen ist.</span><span class="sxs-lookup"><span data-stu-id="00bb4-137">The second part is put into a callback method that is called when the operation completes.</span></span>
- <span data-ttu-id="00bb4-138">Die asynchrone Version von den `ToList` Erweiterungsmethode aufgerufen wurde.</span><span class="sxs-lookup"><span data-stu-id="00bb4-138">The asynchronous version of the `ToList` extension method was called.</span></span>

<span data-ttu-id="00bb4-139">Warum ist die `departments.ToList` -Anweisung geändert, aber nicht die `departments = db.Departments` Anweisung?</span><span class="sxs-lookup"><span data-stu-id="00bb4-139">Why is the `departments.ToList` statement modified but not the `departments = db.Departments` statement?</span></span> <span data-ttu-id="00bb4-140">Der Grund ist, dass nur die Anweisungen, die dazu führen, dass Abfragen oder Befehle an die Datenbank gesendet werden asynchron ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="00bb4-140">The reason is that only statements that cause queries or commands to be sent to the database are executed asynchronously.</span></span> <span data-ttu-id="00bb4-141">Die `departments = db.Departments` Anweisung richtet eine Abfrage, aber die Abfrage wird nicht ausgeführt, bis die `ToList` -Methode aufgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="00bb4-141">The `departments = db.Departments` statement sets up a query but the query is not executed until the `ToList` method is called.</span></span> <span data-ttu-id="00bb4-142">Daher nur die `ToList` Methode asynchron ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="00bb4-142">Therefore, only the `ToList` method is executed asynchronously.</span></span>

<span data-ttu-id="00bb4-143">In der `Details` Methode und die `HttpGet` `Edit` und `Delete` Methoden, die `Find` Methode ist dasjenige, das bewirkt, dass eine Abfrage auf die Datenbank gesendet werden, damit die Methode ist, die asynchron ausgeführt wird:</span><span class="sxs-lookup"><span data-stu-id="00bb4-143">In the `Details` method and the `HttpGet` `Edit` and `Delete` methods, the `Find` method is the one that causes a query to be sent to the database, so that's the method that gets executed asynchronously:</span></span>

[!code-csharp[Main](async-and-stored-procedures-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample2.cs?highlight=7)]

<span data-ttu-id="00bb4-144">In der `Create`, `HttpPost Edit`, und `DeleteConfirmed` Methoden, ist die `SaveChanges` -Methodenaufruf, der bewirkt, dass einen Befehl ausgeführt wird, nicht-Anweisungen wie z. B. `db.Departments.Add(department)` nur führen die Entitäten im Arbeitsspeicher geändert werden.</span><span class="sxs-lookup"><span data-stu-id="00bb4-144">In the `Create`, `HttpPost Edit`, and `DeleteConfirmed` methods, it is the `SaveChanges` method call that causes a command to be executed, not statements such as `db.Departments.Add(department)` which only cause entities in memory to be modified.</span></span>

[!code-csharp[Main](async-and-stored-procedures-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample3.cs?highlight=6)]

<span data-ttu-id="00bb4-145">Open *Views\Department\Index.cshtml*, und Ersetzen Sie den Code durch den folgenden Code:</span><span class="sxs-lookup"><span data-stu-id="00bb4-145">Open *Views\Department\Index.cshtml*, and replace the template code with the following code:</span></span>

[!code-cshtml[Main](async-and-stored-procedures-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample4.cshtml?highlight=3,5,20-22,36-38)]

<span data-ttu-id="00bb4-146">Dieser Code ändert den Titel aus dem Index, Abteilungen, verschiebt der Administratorname nach rechts, und stellt den vollständigen Namen des Administrators.</span><span class="sxs-lookup"><span data-stu-id="00bb4-146">This code changes the title from Index to Departments, moves the Administrator name to the right, and provides the full name of the administrator.</span></span>

<span data-ttu-id="00bb4-147">Erstellen, löschen, Details, und Bearbeiten von Ansichten, ändern Sie die Beschriftung für das `InstructorID` Feld "Administrator" auf die gleiche Weise wie Sie das Namensfeld Abteilung "Abteilung" in den Kurs Ansichten geändert.</span><span class="sxs-lookup"><span data-stu-id="00bb4-147">In the Create, Delete, Details, and Edit views, change the caption for the `InstructorID` field to "Administrator" the same way you changed the department name field to "Department" in the Course views.</span></span>

<span data-ttu-id="00bb4-148">Verwenden Sie Sichten in das Erstellen und Bearbeiten von den folgenden Code:</span><span class="sxs-lookup"><span data-stu-id="00bb4-148">In the Create and Edit views use the following code:</span></span>

[!code-cshtml[Main](async-and-stored-procedures-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample5.cshtml)]

<span data-ttu-id="00bb4-149">Verwenden Sie in den Ansichten löschen und die Details des folgenden Codes ein:</span><span class="sxs-lookup"><span data-stu-id="00bb4-149">In the Delete and Details views use the following code:</span></span>

[!code-cshtml[Main](async-and-stored-procedures-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample6.cshtml)]

<span data-ttu-id="00bb4-150">Führen Sie die Anwendung, und klicken Sie auf die **Abteilungen** Registerkarte.</span><span class="sxs-lookup"><span data-stu-id="00bb4-150">Run the application, and click the **Departments** tab.</span></span>

![Seite "Abteilung"](async-and-stored-procedures-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image4.png)

<span data-ttu-id="00bb4-152">Alles funktioniert genauso wie bei anderen Controller, aber in diesem Controller alle SQL-Abfragen asynchron ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="00bb4-152">Everything works the same as in the other controllers, but in this controller all of the SQL queries are executing asynchronously.</span></span>

<span data-ttu-id="00bb4-153">Einige Punkte zu beachten, wenn Sie asynchrone Programmierung mit dem Entity Framework verwenden:</span><span class="sxs-lookup"><span data-stu-id="00bb4-153">Some things to be aware of when you are using asynchronous programming with the Entity Framework:</span></span>

- <span data-ttu-id="00bb4-154">Die Async-Code ist nicht threadsicher.</span><span class="sxs-lookup"><span data-stu-id="00bb4-154">The async code is not thread safe.</span></span> <span data-ttu-id="00bb4-155">In anderen Worten heißt, versuchen Sie nicht für mehrere Vorgänge parallel verwenden dieselbe Kontextinstanz.</span><span class="sxs-lookup"><span data-stu-id="00bb4-155">In other words, in other words, don't try to do multiple operations in parallel using the same context instance.</span></span>
- <span data-ttu-id="00bb4-156">Wenn Sie von den Leistungsvorteilen des asynchronen Codes profitieren möchten, vergewissern Sie sich, dass auch alle Bibliothekspakete, die Sie verwenden (z.B. zum Paging) asynchronen Code verwenden, wenn sie Entity Framework Core-Methoden aufrufen, die Abfragen an die Datenbank senden.</span><span class="sxs-lookup"><span data-stu-id="00bb4-156">If you want to take advantage of the performance benefits of async code, make sure that any library packages that you're using (such as for paging), also use async if they call any Entity Framework methods that cause queries to be sent to the database.</span></span>

## <a name="use-stored-procedures-for-inserting-updating-and-deleting"></a><span data-ttu-id="00bb4-157">Verwenden Sie gespeicherte Prozeduren zum Einfügen, aktualisieren und löschen</span><span class="sxs-lookup"><span data-stu-id="00bb4-157">Use stored procedures for inserting, updating, and deleting</span></span>

<span data-ttu-id="00bb4-158">Einige Entwickler und Datenbankadministratoren möchten gespeicherte Prozeduren für den Datenbankzugriff verwenden.</span><span class="sxs-lookup"><span data-stu-id="00bb4-158">Some developers and DBAs prefer to use stored procedures for database access.</span></span> <span data-ttu-id="00bb4-159">In früheren Versionen von Entity Framework können Sie Daten mithilfe einer gespeicherten Prozedur durch Abrufen [Ausführen einer unformatierten SQL-Abfrage](advanced-entity-framework-scenarios-for-an-mvc-web-application.md), aber Sie können nicht zum Verwenden gespeicherter Prozeduren für Updatevorgänge EF anweisen.</span><span class="sxs-lookup"><span data-stu-id="00bb4-159">In earlier versions of Entity Framework you can retrieve data using a stored procedure by [executing a raw SQL query](advanced-entity-framework-scenarios-for-an-mvc-web-application.md), but you can't instruct EF to use stored procedures for update operations.</span></span> <span data-ttu-id="00bb4-160">In EF 6 ist es einfach zu Code First zur Verwendung gespeicherter Prozeduren konfigurieren.</span><span class="sxs-lookup"><span data-stu-id="00bb4-160">In EF 6 it's easy to configure Code First to use stored procedures.</span></span>

1. <span data-ttu-id="00bb4-161">In *DAL\SchoolContext.cs*, den hervorgehobenen Code zum Hinzufügen der `OnModelCreating` Methode.</span><span class="sxs-lookup"><span data-stu-id="00bb4-161">In *DAL\SchoolContext.cs*, add the highlighted code to the `OnModelCreating` method.</span></span>

    [!code-csharp[Main](async-and-stored-procedures-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample7.cs?highlight=9)]

    <span data-ttu-id="00bb4-162">Dieser Code weist Entity Framework verwenden Sie gespeicherte Prozeduren für Einfüge-, update und delete-Operationen auf der `Department` Entität.</span><span class="sxs-lookup"><span data-stu-id="00bb4-162">This code instructs Entity Framework to use stored procedures for insert, update, and delete operations on the `Department` entity.</span></span>
2. <span data-ttu-id="00bb4-163">Geben Sie im Paket Konsole verwalten den folgenden Befehl aus:</span><span class="sxs-lookup"><span data-stu-id="00bb4-163">In Package Manage Console, enter the following command:</span></span>

    `add-migration DepartmentSP`

    <span data-ttu-id="00bb4-164">Open *Migrationen\&Lt; Zeitstempel&gt;\_DepartmentSP.cs* sehen Sie den Code in die `Up` Methode zum Einfügen, aktualisieren und Löschen gespeicherter Prozeduren:</span><span class="sxs-lookup"><span data-stu-id="00bb4-164">Open *Migrations\&lt;timestamp&gt;\_DepartmentSP.cs* to see the code in the `Up` method that creates Insert, Update, and Delete stored procedures:</span></span>

    [!code-csharp[Main](async-and-stored-procedures-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample8.cs?highlight=3-4,26-27,42-43)]
3. <span data-ttu-id="00bb4-165">Geben Sie im Paket Konsole verwalten den folgenden Befehl aus:</span><span class="sxs-lookup"><span data-stu-id="00bb4-165">In Package Manage Console, enter the following command:</span></span>

     `update-database`
4. <span data-ttu-id="00bb4-166">Führen Sie die Anwendung im Debugmodus befindet, klicken Sie auf die **Abteilungen** Registerkarte, und klicken Sie dann auf **neu erstellen**.</span><span class="sxs-lookup"><span data-stu-id="00bb4-166">Run the application in debug mode, click the **Departments** tab, and then click **Create New**.</span></span>
5. <span data-ttu-id="00bb4-167">Geben Sie Daten für eine Abteilung ein, und klicken Sie dann auf **erstellen**.</span><span class="sxs-lookup"><span data-stu-id="00bb4-167">Enter data for a new department, and then click **Create**.</span></span>

     ![Abteilung erstellen](async-and-stored-procedures-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image5.png)
6. <span data-ttu-id="00bb4-169">In Visual Studio sehen Sie sich die Protokolle in der **Ausgabe** Fenster zu sehen, dass eine gespeicherte Prozedur zum Einfügen der neuen Zeile der Abteilung verwendet wurde.</span><span class="sxs-lookup"><span data-stu-id="00bb4-169">In Visual Studio, look at the logs in the **Output** window to see that a stored procedure was used to insert the new Department row.</span></span>

     ![Abteilung Insert SP](async-and-stored-procedures-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image6.png)

<span data-ttu-id="00bb4-171">Code wird zuerst Standardnamen gespeicherte Prozedur erstellt.</span><span class="sxs-lookup"><span data-stu-id="00bb4-171">Code First creates default stored procedure names.</span></span> <span data-ttu-id="00bb4-172">Wenn Sie eine vorhandene Datenbank verwenden, müssen Sie die Namen der gespeicherten Prozedur anpassen, um gespeicherte Prozeduren, die bereits in der Datenbank definierten verwenden.</span><span class="sxs-lookup"><span data-stu-id="00bb4-172">If you are using an existing database, you might need to customize the stored procedure names in order to use stored procedures already defined in the database.</span></span> <span data-ttu-id="00bb4-173">Informationen hierzu finden Sie unter [Entity Framework Code erste Insert/Update/Delete Stored Procedures](https://msdn.microsoft.com/data/dn468673).</span><span class="sxs-lookup"><span data-stu-id="00bb4-173">For information about how to do that, see [Entity Framework Code First Insert/Update/Delete Stored Procedures](https://msdn.microsoft.com/data/dn468673).</span></span>

<span data-ttu-id="00bb4-174">Wenn Sie anpassen, welche gespeicherten Prozeduren werden generiert werden sollen, können Sie die scaffolded Code für die Migrationen bearbeiten `Up` -Methode, die gespeicherte Prozedur erstellt.</span><span class="sxs-lookup"><span data-stu-id="00bb4-174">If you want to customize what generated stored procedures do, you can edit the scaffolded code for the migrations `Up` method that creates the stored procedure.</span></span> <span data-ttu-id="00bb4-175">Auf diese Weise werden die Änderungen bei jedem wiedergegeben, dass die Migration wird ausgeführt, und gelten für die Produktionsdatenbank bei Migrationen wird automatisch in der Produktion nach der Bereitstellung ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="00bb4-175">That way your changes are reflected whenever that migration is run and will be applied to your production database when migrations runs automatically in production after deployment.</span></span>

<span data-ttu-id="00bb4-176">Wenn Sie eine vorhandene gespeicherte Prozedur, die in eine vorherige Migration erstellt wurde, ändern möchten, können Sie mithilfe des Befehls Add-Migration um eine leere Migration zu generieren und dann manuell Code schreiben, aufgerufen der [AlterStoredProcedure](https://msdn.microsoft.com/library/system.data.entity.migrations.dbmigration.alterstoredprocedure.aspx) Methode .</span><span class="sxs-lookup"><span data-stu-id="00bb4-176">If you want to change an existing stored procedure that was created in a previous migration, you can use the Add-Migration command to generate a blank migration, and then manually write code that calls the [AlterStoredProcedure](https://msdn.microsoft.com/library/system.data.entity.migrations.dbmigration.alterstoredprocedure.aspx) method.</span></span>

## <a name="deploy-to-azure"></a><span data-ttu-id="00bb4-177">In Azure bereitstellen</span><span class="sxs-lookup"><span data-stu-id="00bb4-177">Deploy to Azure</span></span>

<span data-ttu-id="00bb4-178">In diesem Abschnitt müssen Sie das optionale abgeschlossener **Bereitstellen der app in Azure** im Abschnitt der [Migration und Bereitstellung](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application.md) Lernprogramm dieser Reihe.</span><span class="sxs-lookup"><span data-stu-id="00bb4-178">This section requires you to have completed the optional **Deploying the app to Azure** section in the [Migrations and Deployment](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application.md) tutorial of this series.</span></span> <span data-ttu-id="00bb4-179">Wenn Sie Migrationen Fehler, die Sie aufgetreten durch Löschen der Datenbank in Ihrem lokalen Projekt behoben, überspringen Sie diesen Abschnitt.</span><span class="sxs-lookup"><span data-stu-id="00bb4-179">If you had migrations errors that you resolved by deleting the database in your local project, skip this section.</span></span>

1. <span data-ttu-id="00bb4-180">In Visual Studio mit der Maustaste des Projekts im **Projektmappen-Explorer** , und wählen Sie **veröffentlichen** aus dem Kontextmenü.</span><span class="sxs-lookup"><span data-stu-id="00bb4-180">In Visual Studio, right-click the project in **Solution Explorer** and select **Publish** from the context menu.</span></span>
2. <span data-ttu-id="00bb4-181">Klicken Sie auf **Veröffentlichen**.</span><span class="sxs-lookup"><span data-stu-id="00bb4-181">Click **Publish**.</span></span>

    <span data-ttu-id="00bb4-182">Visual Studio wird die Anwendung in Azure bereitgestellt und die Anwendung geöffnet, in Ihrem Standardbrowser in Azure ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="00bb4-182">Visual Studio deploys the application to Azure, and the application opens in your default browser, running in Azure.</span></span>
3. <span data-ttu-id="00bb4-183">Testen der Anwendung, überprüfen Sie, ob sie funktioniert.</span><span class="sxs-lookup"><span data-stu-id="00bb4-183">Test the application to verify it's working.</span></span>

    <span data-ttu-id="00bb4-184">Beim ersten einer Seite ausführen, auf die Datenbank zugreift, wird das Entity Framework ausgeführt aller die Migrationen `Up` Methoden erforderlich, um die Datenbank mit dem aktuellen Datenmodell auf dem neuesten Stand zu bringen.</span><span class="sxs-lookup"><span data-stu-id="00bb4-184">The first time you run a page that accesses the database, the Entity Framework runs all of the migrations `Up` methods required to bring the database up to date with the current data model.</span></span> <span data-ttu-id="00bb4-185">Sie können jetzt alle Web-Seiten verwenden, die Sie seit der letzten Ausführung, die Sie bereitgestellt haben hinzugefügt, einschließlich der Abteilung-Seiten, die Sie in diesem Lernprogramm hinzugefügt.</span><span class="sxs-lookup"><span data-stu-id="00bb4-185">You can now use all of the web pages that you added since the last time you deployed, including the Department pages that you added in this tutorial.</span></span>

## <a name="summary"></a><span data-ttu-id="00bb4-186">Zusammenfassung</span><span class="sxs-lookup"><span data-stu-id="00bb4-186">Summary</span></span>

<span data-ttu-id="00bb4-187">In diesem Lernprogramm haben Sie gesehen zum Server-Effizienz verbessern, indem Sie Code schreiben, der asynchron ausgeführt wird und wie mit gespeicherten Prozeduren zum Einfügen, aktualisieren und delete-Operationen.</span><span class="sxs-lookup"><span data-stu-id="00bb4-187">In this tutorial you saw how to improve server efficiency by writing code that executes asynchronously, and how to use stored procedures for insert, update, and delete operations.</span></span> <span data-ttu-id="00bb4-188">In den nächsten Lernprogrammen sehen Sie, wie Sie Datenverluste zu vermeiden, wenn mehrere Benutzer versuchen, denselben Datensatz zur gleichen Zeit zu bearbeiten.</span><span class="sxs-lookup"><span data-stu-id="00bb4-188">In the next tutorial, you'll see how to prevent data loss when multiple users try to edit the same record at the same time.</span></span>

<span data-ttu-id="00bb4-189">Links zu anderen Entity Framework-Ressourcen finden Sie in der [ASP.NET Data Access - Ressourcen empfohlen](../../../../whitepapers/aspnet-data-access-content-map.md).</span><span class="sxs-lookup"><span data-stu-id="00bb4-189">Links to other Entity Framework resources can be found in the [ASP.NET Data Access - Recommended Resources](../../../../whitepapers/aspnet-data-access-content-map.md).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="00bb4-190">[Zurück](updating-related-data-with-the-entity-framework-in-an-asp-net-mvc-application.md)
> [Weiter](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application.md)</span><span class="sxs-lookup"><span data-stu-id="00bb4-190">[Previous](updating-related-data-with-the-entity-framework-in-an-asp-net-mvc-application.md)
[Next](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application.md)</span></span>
