---
uid: mvc/overview/older-versions-1/nerddinner/build-a-model-with-business-rule-validations
title: Erstellen eines Modells mit Business Regel Überprüfungen | Microsoft Docs
author: microsoft
description: Schritt 3 veranschaulicht, wie ein Modell zu erstellen, können wir, um beide Abfrage verwenden und die Datenbank für unsere NerdDinner-Anwendung zu aktualisieren.
ms.author: aspnetcontent
manager: wpickett
ms.date: 07/27/2010
ms.topic: article
ms.assetid: 0bc191b2-4311-479a-a83a-7f1b1c32e6fe
ms.technology: dotnet-mvc
ms.prod: .net-framework
msc.legacyurl: /mvc/overview/older-versions-1/nerddinner/build-a-model-with-business-rule-validations
msc.type: authoredcontent
ms.openlocfilehash: c5a482474fd2f41836f70952306ada5cd9136455
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 04/06/2018
---
<a name="build-a-model-with-business-rule-validations"></a><span data-ttu-id="bcb34-103">Erstellen eines Modells mit Business Regel Überprüfungen</span><span class="sxs-lookup"><span data-stu-id="bcb34-103">Build a Model with Business Rule Validations</span></span>
====================
<span data-ttu-id="bcb34-104">durch [Microsoft](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="bcb34-104">by [Microsoft](https://github.com/microsoft)</span></span>

[<span data-ttu-id="bcb34-105">PDF herunterladen</span><span class="sxs-lookup"><span data-stu-id="bcb34-105">Download PDF</span></span>](http://aspnetmvcbook.s3.amazonaws.com/aspnetmvc-nerdinner_v1.pdf)

> <span data-ttu-id="bcb34-106">Dies ist Schritt 3 mit einer kostenlosen ["NerdDinner" Anwendung Lernprogramm](introducing-the-nerddinner-tutorial.md) , die Durchläufe-durch die Schritte zum Erstellen einer kleinen, aber abgeschlossen haben, Webanwendung, die mithilfe von ASP.NET MVC-1.</span><span class="sxs-lookup"><span data-stu-id="bcb34-106">This is step 3 of a free ["NerdDinner" application tutorial](introducing-the-nerddinner-tutorial.md) that walks-through how to build a small, but complete, web application using ASP.NET MVC 1.</span></span>
> 
> <span data-ttu-id="bcb34-107">Schritt 3 veranschaulicht, wie ein Modell zu erstellen, können wir, um beide Abfrage verwenden und die Datenbank für unsere NerdDinner-Anwendung zu aktualisieren.</span><span class="sxs-lookup"><span data-stu-id="bcb34-107">Step 3 shows how to create a model that we can use to both query and update the database for our NerdDinner application.</span></span>
> 
> <span data-ttu-id="bcb34-108">Bei Verwendung von ASP.NET MVC 3 empfehlen wir führen Sie die [erste Schritte mit MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) oder [MVC Music Store](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) Lernprogramme.</span><span class="sxs-lookup"><span data-stu-id="bcb34-108">If you are using ASP.NET MVC 3, we recommend you follow the [Getting Started With MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) or [MVC Music Store](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) tutorials.</span></span>


## <a name="nerddinner-step-3-building-the-model"></a><span data-ttu-id="bcb34-109">NerdDinner, Schritt 3: Erstellen des Modells</span><span class="sxs-lookup"><span data-stu-id="bcb34-109">NerdDinner Step 3: Building the Model</span></span>

<span data-ttu-id="bcb34-110">Bezieht sich der Begriff "Modell" auf die Objekte, die die Daten von der Anwendung sowie die entsprechenden Domänenlogik, überprüfungs- und Geschäftsregeln mit den es darstellen, in einem Model-View-Controller-Framework.</span><span class="sxs-lookup"><span data-stu-id="bcb34-110">In a model-view-controller framework the term "model" refers to the objects that represent the data of the application, as well as the corresponding domain logic that integrates validation and business rules with it.</span></span> <span data-ttu-id="bcb34-111">Das Modell ist in vielerlei Hinsicht die "Basis" einer MVC-basierte Anwendung und später im Grunde eingehendem steuert das Verhalten des Zertifikats.</span><span class="sxs-lookup"><span data-stu-id="bcb34-111">The model is in many ways the "heart" of an MVC-based application, and as we'll see later fundamentally drives the behavior of it.</span></span>

<span data-ttu-id="bcb34-112">ASP.NET MVC-Framework unterstützt eine beliebige Data Access-Technologie verwenden, und Entwickler haben die Wahl aus einer Vielzahl von umfangreichen .NET Datenoptionen auf ihre Modelle, einschließlich implementieren: LINQ to Entitäten, die LINQ to SQL, NHibernate, LLBLGen Pro, SubSonic, WilsonORM oder nur die unformatierten ADO. NET-DataReaders oder DataSets.</span><span class="sxs-lookup"><span data-stu-id="bcb34-112">The ASP.NET MVC framework supports using any data access technology, and developers can choose from a variety of rich .NET data options to implement their models including: LINQ to Entities, LINQ to SQL, NHibernate, LLBLGen Pro, SubSonic, WilsonORM, or just raw ADO.NET DataReaders or DataSets.</span></span>

<span data-ttu-id="bcb34-113">Unsere NerdDinner-Anwendung werden wir LINQ to SQL verwenden, um ein einfaches Modell zu erstellen, das unsere Datenbankentwurf ziemlich genau entspricht, und einige benutzerdefinierte Validierungsregeln Datenlogik und Geschäftsregeln hinzugefügt.</span><span class="sxs-lookup"><span data-stu-id="bcb34-113">For our NerdDinner application we are going to use LINQ to SQL to create a simple model that corresponds fairly closely to our database design, and adds some custom validation logic and business rules.</span></span> <span data-ttu-id="bcb34-114">Wir anschließend Implementieren einer Repository-Klasse, die abstrakte unterwegs hilft der dauerhaftigkeitsimplementierung Daten vom Rest der Anwendung und ermöglicht uns problemlos Einheit testen.</span><span class="sxs-lookup"><span data-stu-id="bcb34-114">We will then implement a repository class that helps abstract away the data persistence implementation from the rest of the application, and enables us to easily unit test it.</span></span>

### <a name="linq-to-sql"></a><span data-ttu-id="bcb34-115">LINQ to SQL</span><span class="sxs-lookup"><span data-stu-id="bcb34-115">LINQ to SQL</span></span>

<span data-ttu-id="bcb34-116">LINQ to SQL ist ein ORM (objektrelationale Zuordnungen), die als Teil von .NET 3.5 geliefert wird.</span><span class="sxs-lookup"><span data-stu-id="bcb34-116">LINQ to SQL is an ORM (object relational mapper) that ships as part of .NET 3.5.</span></span>

<span data-ttu-id="bcb34-117">LINQ to SQL bietet eine einfache Möglichkeit, die Datenbanktabellen .NET Klassen zuordnen, die wir für code können.</span><span class="sxs-lookup"><span data-stu-id="bcb34-117">LINQ to SQL provides an easy way to map database tables to .NET classes we can code against.</span></span> <span data-ttu-id="bcb34-118">Für unsere NerdDinner Anwendung verwenden wir es, um die Tabellen Abendessen und Antwort in unserer Datenbank für Dinner und Antwort-Klassen zuordnen.</span><span class="sxs-lookup"><span data-stu-id="bcb34-118">For our NerdDinner application we'll use it to map the Dinners and RSVP tables within our database to Dinner and RSVP classes.</span></span> <span data-ttu-id="bcb34-119">Die Spalten der Tabellen Abendessen und Antwort entsprechen den Eigenschaften auf der Dinner und Antwort-Klasse.</span><span class="sxs-lookup"><span data-stu-id="bcb34-119">The columns of the Dinners and RSVP tables will correspond to properties on the Dinner and RSVP classes.</span></span> <span data-ttu-id="bcb34-120">Jedes Objekt Dinner und Antwort wird eine separate Zeile innerhalb der Abendessen oder Antwort Tabellen in der Datenbank darstellen.</span><span class="sxs-lookup"><span data-stu-id="bcb34-120">Each Dinner and RSVP object will represent a separate row within the Dinners or RSVP tables in the database.</span></span>

<span data-ttu-id="bcb34-121">LINQ to SQL kann wir zu vermeiden, dass manuell erstellt SQL-Anweisungen zum Abrufen und Aktualisieren von Essen und Antwort Objekte mit Datenbankdaten.</span><span class="sxs-lookup"><span data-stu-id="bcb34-121">LINQ to SQL allows us to avoid having to manually construct SQL statements to retrieve and update Dinner and RSVP objects with database data.</span></span> <span data-ttu-id="bcb34-122">Stattdessen definieren wir die Dinner und Antwort-Klassen, wie die Zuordnung zum/aus der Datenbank und die Beziehungen zwischen ihnen.</span><span class="sxs-lookup"><span data-stu-id="bcb34-122">Instead, we'll define the Dinner and RSVP classes, how they map to/from the database, and the relationships between them.</span></span> <span data-ttu-id="bcb34-123">LINQ to SQL übernimmt dann generieren Sie die entsprechenden SQL-Ausführungslogik zur Laufzeit verwendet werden soll, wenn wir interagieren, und sie verwenden sorgfältig.</span><span class="sxs-lookup"><span data-stu-id="bcb34-123">LINQ to SQL will then takes care of generating the appropriate SQL execution logic to use at runtime when we interact and use them.</span></span>

<span data-ttu-id="bcb34-124">Wir können die LINQ-sprachunterstützung in VB und c# verwenden, um ausdrucksvolle Abfragen schreiben, die Dinner und Antwort abrufen Objekte aus der Datenbank.</span><span class="sxs-lookup"><span data-stu-id="bcb34-124">We can use the LINQ language support within VB and C# to write expressive queries that retrieve Dinner and RSVP objects from the database.</span></span> <span data-ttu-id="bcb34-125">Dadurch wird die Menge an Datencode schreiben, wir müssen minimiert und erlaubt es uns wirklich saubere Anwendungen zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="bcb34-125">This minimizes the amount of data code we need to write, and allows us to build really clean applications.</span></span>

### <a name="adding-linq-to-sql-classes-to-our-project"></a><span data-ttu-id="bcb34-126">Hinzufügen von LINQ to SQL-Klassen zum Projekt</span><span class="sxs-lookup"><span data-stu-id="bcb34-126">Adding LINQ to SQL Classes to our project</span></span>

<span data-ttu-id="bcb34-127">Wir beginnen, indem Sie mit der rechten Maustaste auf den Ordner "Modelle" im Projekt, und wählen Sie die **Add -&gt;neues Element** Menübefehl:</span><span class="sxs-lookup"><span data-stu-id="bcb34-127">We'll begin by right-clicking on the "Models" folder within our project, and select the **Add-&gt;New Item** menu command:</span></span>

![](build-a-model-with-business-rule-validations/_static/image1.png)

<span data-ttu-id="bcb34-128">Hierdurch wird das Dialogfeld "Neues Element hinzufügen" angezeigt.</span><span class="sxs-lookup"><span data-stu-id="bcb34-128">This will bring up the "Add New Item" dialog.</span></span> <span data-ttu-id="bcb34-129">Wir filtern, indem Sie die "Datenkategorie" und wählen Sie die Vorlage "LINQ to SQL-Klassen" darin:</span><span class="sxs-lookup"><span data-stu-id="bcb34-129">We'll filter by the "Data" category and select the "LINQ to SQL Classes" template within it:</span></span>

![](build-a-model-with-business-rule-validations/_static/image2.png)

<span data-ttu-id="bcb34-130">Wir nennen Sie das Element "NerdDinner" und klicken Sie auf die Schaltfläche "Hinzufügen".</span><span class="sxs-lookup"><span data-stu-id="bcb34-130">We'll name the item "NerdDinner" and click the "Add" button.</span></span> <span data-ttu-id="bcb34-131">Visual Studio eine Datei NerdDinner.dbml unsere \Models-Verzeichnis hinzufügen, und öffnen Sie dann die LINQ to SQL Objektrelationaler Designer:</span><span class="sxs-lookup"><span data-stu-id="bcb34-131">Visual Studio will add a NerdDinner.dbml file under our \Models directory, and then open the LINQ to SQL object relational designer:</span></span>

![](build-a-model-with-business-rule-validations/_static/image3.png)

### <a name="creating-data-model-classes-with-linq-to-sql"></a><span data-ttu-id="bcb34-132">Erstellen von Modellklassen für Daten mit LINQ to SQL</span><span class="sxs-lookup"><span data-stu-id="bcb34-132">Creating Data Model Classes with LINQ to SQL</span></span>

<span data-ttu-id="bcb34-133">LINQ to SQL kann wir schnell Modellklassen Daten aus vorhandenen Datenbankschema zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="bcb34-133">LINQ to SQL enables us to quickly create data model classes from existing database schema.</span></span> <span data-ttu-id="bcb34-134">To-do dies wir die NerdDinner-Datenbank im Server-Explorer öffnen und wählen Sie die Tabellen in diesem Modell werden soll:</span><span class="sxs-lookup"><span data-stu-id="bcb34-134">To-do this we'll open the NerdDinner database in the Server Explorer, and select the Tables we want to model in it:</span></span>

![](build-a-model-with-business-rule-validations/_static/image4.png)

<span data-ttu-id="bcb34-135">Wir können dann die Tabellen in der LINQ auf SQL-Designeroberfläche ziehen.</span><span class="sxs-lookup"><span data-stu-id="bcb34-135">We can then drag the tables onto the LINQ to SQL designer surface.</span></span> <span data-ttu-id="bcb34-136">Wenn wir diese LINQ to SQL durchführen Dinner automatisch erstellt und die Antwort-Klassen, die mit dem Schema der Tabellen (mit Klasseneigenschaften, die den Spalten der Datenbanktabelle zugeordnet wird):</span><span class="sxs-lookup"><span data-stu-id="bcb34-136">When we do this LINQ to SQL will automatically create Dinner and RSVP classes using the schema of the tables (with class properties that map to the database table columns):</span></span>

![](build-a-model-with-business-rule-validations/_static/image5.png)

<span data-ttu-id="bcb34-137">Standardmäßig ist die LINQ to SQL "in den plural setzt Designer automatisch" Tabellen- und Spaltennamen beim Erstellen von Klassen, die anhand eines Datenbankschemas.</span><span class="sxs-lookup"><span data-stu-id="bcb34-137">By default the LINQ to SQL designer automatically "pluralizes" table and column names when it creates classes based on a database schema.</span></span> <span data-ttu-id="bcb34-138">Zum Beispiel: die Tabelle "Abendessen" im vorliegenden Beispiel in einer Klasse "Dinner" geführt hat.</span><span class="sxs-lookup"><span data-stu-id="bcb34-138">For example: the "Dinners" table in our example above resulted in a "Dinner" class.</span></span> <span data-ttu-id="bcb34-139">Benennen von dieser Klasse unterstützt unsere Modelle mit .NET Benennungskonventionen konsistent zu machen und in der Regel suchen, dass der Designer Korrekturen dies einrichten einfache (insbesondere, wenn viele Tabellen hinzufügen).</span><span class="sxs-lookup"><span data-stu-id="bcb34-139">This class naming helps make our models consistent with .NET naming conventions, and I usually find that having the designer fix this up convenient (especially when adding lots of tables).</span></span> <span data-ttu-id="bcb34-140">Wenn Sie nicht möchten, dass der Name einer Klasse oder eine Eigenschaft, die der Designer generiert jedoch, dass Sie immer außer Kraft setzen und auf den Namen eines gewünschten ändern können.</span><span class="sxs-lookup"><span data-stu-id="bcb34-140">If you don't like the name of a class or property that the designer generates, though, you can always override it and change it to any name you want.</span></span> <span data-ttu-id="bcb34-141">Sie erreichen dies durch Bearbeiten der Entität bzw. der Eigenschaft Name inline im Designer oder durch diese über das Eigenschaftenraster zu ändern.</span><span class="sxs-lookup"><span data-stu-id="bcb34-141">You can do this either by editing the entity/property name in-line within the designer or by modifying it via the property grid.</span></span>

<span data-ttu-id="bcb34-142">LINQ to SQL-Designer auch der Primär-/Fremdschlüssel-Beziehungen der Tabellen überprüft und automatisch auf ihrer Grundlage standardmäßig erstellt "Beziehung Zuordnungen" zwischen den anderen Modellklassen, die es erstellt.</span><span class="sxs-lookup"><span data-stu-id="bcb34-142">By default the LINQ to SQL designer also inspects the primary key/foreign key relationships of the tables, and based on them automatically creates default "relationship associations" between the different model classes it creates.</span></span> <span data-ttu-id="bcb34-143">Angenommen, wenn wir die Abendessen gezogen und Antwort, der auf LINQ to SQL-Designer eine Zuordnung 1: n-Beziehung zwischen den beiden Tabellen wurde abgeleitet basiert sowohl, dass die Antwort-Tabelle einen Fremdschlüssel für die Tabelle Abendessen hatten (Dies wird angegeben, durch den Pfeil in der -Designer):</span><span class="sxs-lookup"><span data-stu-id="bcb34-143">For example, when we dragged the Dinners and RSVP tables onto the LINQ to SQL designer a one-to-many relationship association between the two was inferred based on the fact that the RSVP table had a foreign-key to the Dinners table (this is indicated by the arrow in the designer):</span></span>

![](build-a-model-with-business-rule-validations/_static/image6.png)

<span data-ttu-id="bcb34-144">Die oben genannten Zuordnung bewirkt, LINQ to SQL die Antwort-Klasse eine stark typisierte "Dinner"-Eigenschaft hinzu, mit denen Entwickler können auf der Dinner mit einer bestimmten Antwort verknüpft ist.</span><span class="sxs-lookup"><span data-stu-id="bcb34-144">The above association will cause LINQ to SQL to add a strongly typed "Dinner" property to the RSVP class that developers can use to access the Dinner associated with a given RSVP.</span></span> <span data-ttu-id="bcb34-145">Es führt auch dazu, dass die Dinner-Klasse, um eine Auflistungseigenschaft "RSVPs" verfügen, die ermöglicht es Entwicklern, abrufen und aktualisieren die Antwort-Objekte, die mit einer bestimmten Dinner zugeordnet sind.</span><span class="sxs-lookup"><span data-stu-id="bcb34-145">It will also cause the Dinner class to have a "RSVPs" collection property that enables developers to retrieve and update RSVP objects associated with a particular Dinner.</span></span>

<span data-ttu-id="bcb34-146">Im folgenden sehen Sie ein Beispiel für Intellisense in Visual Studio, wenn wir ein neues Objekt für die Antwort zu erstellen und eine Dinner Einladung Auflistung hinzuzufügen.</span><span class="sxs-lookup"><span data-stu-id="bcb34-146">Below you can see an example of intellisense within Visual Studio when we create a new RSVP object and add it to a Dinner's RSVPs collection.</span></span> <span data-ttu-id="bcb34-147">Beachten Sie, wie LINQ to SQL automatisch die entsprechenden eine Auflistung von "Einladung" für das Objekt Dinner hinzugefügt:</span><span class="sxs-lookup"><span data-stu-id="bcb34-147">Notice how LINQ to SQL automatically added a "RSVPs" collection on the Dinner object:</span></span>

![](build-a-model-with-business-rule-validations/_static/image7.png)

<span data-ttu-id="bcb34-148">Durch Hinzufügen der Antwort-Objekt auf der Dinner Einladung Auflistung sagen wir LINQ to SQL eine foreign Key-Beziehung zwischen der Dinner und die Antwort-Zeile in der Datenbank zugeordnet:</span><span class="sxs-lookup"><span data-stu-id="bcb34-148">By adding the RSVP object to the Dinner's RSVPs collection we are telling LINQ to SQL to associate a foreign-key relationship between the Dinner and the RSVP row in our database:</span></span>

![](build-a-model-with-business-rule-validations/_static/image8.png)

<span data-ttu-id="bcb34-149">Wenn Ihnen nicht gefallen wie der Designer modelliert oder mit dem Namen einer Tabelle Zuordnung verfügt, können Sie sie überschreiben.</span><span class="sxs-lookup"><span data-stu-id="bcb34-149">If you don't like how the designer has modeled or named a table association, you can override it.</span></span> <span data-ttu-id="bcb34-150">Einfach klicken Sie auf den Pfeil Zuordnung im Designer und den Zugriff auf ihre Eigenschaften über das Eigenschaftenraster, um umbenennen, löschen oder ändern Sie sie.</span><span class="sxs-lookup"><span data-stu-id="bcb34-150">Just click on the association arrow within the designer and access its properties via the property grid to rename, delete or modify it.</span></span> <span data-ttu-id="bcb34-151">Für unsere Anwendung NerdDinner jedoch die Standardregeln für die Zuordnung funktioniert gut für die Modell-Datenklassen, die wir erstellen und es können nur das Standardverhalten.</span><span class="sxs-lookup"><span data-stu-id="bcb34-151">For our NerdDinner application, though, the default association rules work well for the data model classes we are building and we can just use the default behavior.</span></span>

### <a name="nerddinnerdatacontext-class"></a><span data-ttu-id="bcb34-152">NerdDinnerDataContext-Klasse</span><span class="sxs-lookup"><span data-stu-id="bcb34-152">NerdDinnerDataContext Class</span></span>

<span data-ttu-id="bcb34-153">Visual Studio erstellt automatisch .NET Klassen, die die Modelle und datenbankbeziehungen mit LINQ to SQL-Designer definiert darstellen.</span><span class="sxs-lookup"><span data-stu-id="bcb34-153">Visual Studio will automatically create .NET classes that represent the models and database relationships defined using the LINQ to SQL designer.</span></span> <span data-ttu-id="bcb34-154">Für jede LINQ to SQL-Designer-Datei der Projektmappe hinzugefügt wird auch eine LINQ to SQL-DataContext-Klasse generiert.</span><span class="sxs-lookup"><span data-stu-id="bcb34-154">A LINQ to SQL DataContext class is also generated for each LINQ to SQL designer file added to the solution.</span></span> <span data-ttu-id="bcb34-155">Da wir unsere LINQ to SQL-Klassenelement "NerdDinner" benannt, wird der DataContext-Klasse, die erstellt wurde "NerdDinnerDataContext" aufgerufen.</span><span class="sxs-lookup"><span data-stu-id="bcb34-155">Because we named our LINQ to SQL class item "NerdDinner", the DataContext class created will be called "NerdDinnerDataContext".</span></span> <span data-ttu-id="bcb34-156">Diese Klasse NerdDinnerDataContext ist die primäre Methode, mit denen, die wir mit der Datenbank interagiert wird.</span><span class="sxs-lookup"><span data-stu-id="bcb34-156">This NerdDinnerDataContext class is the primary way we will interact with the database.</span></span>

<span data-ttu-id="bcb34-157">Unsere NerdDinnerDataContext Klasse macht zwei Eigenschaften - "Abendessen" und "RSVPs -", die die beiden Tabellen darstellen, die wir in der Datenbank erstellt.</span><span class="sxs-lookup"><span data-stu-id="bcb34-157">Our NerdDinnerDataContext class exposes two properties - "Dinners" and "RSVPs" - that represent the two tables we modeled within the database.</span></span> <span data-ttu-id="bcb34-158">Wir können c# verwenden zum Schreiben von LINQ-Abfragen für diese Eigenschaften in der Abfrage und rufen Sie Essen und Antwort-Objekte aus der Datenbank.</span><span class="sxs-lookup"><span data-stu-id="bcb34-158">We can use C# to write LINQ queries against those properties to query and retrieve Dinner and RSVP objects from the database.</span></span>

<span data-ttu-id="bcb34-159">Der folgende Code veranschaulicht, wie ein NerdDinnerDataContext-Objekt instanziiert, und führen eine LINQ-Abfrage für eine Sequenz von Abendessen abrufen, die in der Zukunft liegen.</span><span class="sxs-lookup"><span data-stu-id="bcb34-159">The following code demonstrates how to instantiate a NerdDinnerDataContext object and perform a LINQ query against it to obtain a sequence of Dinners that occur in the future.</span></span> <span data-ttu-id="bcb34-160">Beim Schreiben von LINQ-Abfrage, stellt Visual Studio vollständige IntelliSense-Funktionalität bereit, und die von ihr zurückgegebenen Objekte sind stark typisiert und unterstützen auch Intellisense:</span><span class="sxs-lookup"><span data-stu-id="bcb34-160">Visual Studio provides full intellisense when writing the LINQ query, and the objects returned from it are strongly-typed and also support intellisense:</span></span>

![](build-a-model-with-business-rule-validations/_static/image9.png)

<span data-ttu-id="bcb34-161">Außerdem uns Dinner und Antwort Objekte Abfragen, verfolgt eine NerdDinnerDataContext automatisch auch alle Änderungen, die wir anschließend an die Dinner und Antwort Objekte vorzunehmen, die wir über ihn abzurufen.</span><span class="sxs-lookup"><span data-stu-id="bcb34-161">In addition to allowing us to query for Dinner and RSVP objects, a NerdDinnerDataContext also automatically tracks any changes we subsequently make to the Dinner and RSVP objects we retrieve through it.</span></span> <span data-ttu-id="bcb34-162">Wir können diese Funktion verwenden, um leicht die Änderungen zu speichern, wieder in der Datenbank – ohne explizite SQL Update Code schreiben zu müssen.</span><span class="sxs-lookup"><span data-stu-id="bcb34-162">We can use this functionality to easily save the changes back to the database - without having to write any explicit SQL update code.</span></span>

<span data-ttu-id="bcb34-163">Der folgenden Code wird beispielsweise veranschaulicht, wie eine LINQ-Abfrage verwenden, um ein einzelnes Dinner-Objekt aus der Datenbank abrufen, aktualisieren zwei Eigenschaften Dinner und speichern Sie die Änderungen wieder in der Datenbank:</span><span class="sxs-lookup"><span data-stu-id="bcb34-163">For example, the code below demonstrates how to use a LINQ query to retrieve a single Dinner object from the database, update two of the Dinner properties, and then save the changes back to the database:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample1.cs)]

<span data-ttu-id="bcb34-164">Das NerdDinnerDataContext-Objekt im Code über verfolgt automatisch die Eigenschaft vorgenommenen Dinner-Objekts, das wir daraus abgerufen.</span><span class="sxs-lookup"><span data-stu-id="bcb34-164">The NerdDinnerDataContext object in the code above automatically tracked the property changes made to the Dinner object we retrieved from it.</span></span> <span data-ttu-id="bcb34-165">Wenn wir die Methode "SubmitChanges()" aufgerufen wird, führt es eine entsprechende SQL "UPDATE"-Anweisung, mit der Datenbank beibehalten, werden die aktualisierten Werte zurück.</span><span class="sxs-lookup"><span data-stu-id="bcb34-165">When we called the "SubmitChanges()" method, it will execute an appropriate SQL "UPDATE" statement to the database to persist the updated values back.</span></span>

### <a name="creating-a-dinnerrepository-class"></a><span data-ttu-id="bcb34-166">Erstellen einer DinnerRepository-Klasse</span><span class="sxs-lookup"><span data-stu-id="bcb34-166">Creating a DinnerRepository Class</span></span>

<span data-ttu-id="bcb34-167">Bei kleineren Anwendungen ist es manchmal für die Controller funktionieren direkt mit einer LINQ to SQL-DataContext-Klasse, und Einbetten von LINQ-Abfragen in die Controller haben.</span><span class="sxs-lookup"><span data-stu-id="bcb34-167">For small applications it is sometimes fine to have Controllers work directly against a LINQ to SQL DataContext class, and embed LINQ queries within the Controllers.</span></span> <span data-ttu-id="bcb34-168">Wie größere Anwendungen erhalten, kann dieser Ansatz sich schwierig zu verwalten und zu testen.</span><span class="sxs-lookup"><span data-stu-id="bcb34-168">As applications get larger, though, this approach becomes cumbersome to maintain and test.</span></span> <span data-ttu-id="bcb34-169">Sie können auch Sie uns Ihre Meinung duplizieren die gleichen LINQ-Abfragen an mehreren Stellen führen.</span><span class="sxs-lookup"><span data-stu-id="bcb34-169">It can also lead to us duplicating the same LINQ queries in multiple places.</span></span>

<span data-ttu-id="bcb34-170">Ein Ansatz besteht darin, die kann Anwendungen leichter zu verwalten und Testen ist die Verwendung von "Repositorymusters".</span><span class="sxs-lookup"><span data-stu-id="bcb34-170">One approach that can make applications easier to maintain and test is to use a "repository" pattern.</span></span> <span data-ttu-id="bcb34-171">Eine Repository-Klasse hilft dabei, Daten abzufragen und Persistenzlogik und sofort abstrahiert die Implementierungsdetails der Datenpersistenz aus der Anwendung zu kapseln.</span><span class="sxs-lookup"><span data-stu-id="bcb34-171">A repository class helps encapsulate data querying and persistence logic, and abstracts away the implementation details of the data persistence from the application.</span></span> <span data-ttu-id="bcb34-172">Zusätzlich zu den Anwendungscode Bereinigung vorgenommen werden, können unter Verwendung eines Repositorymusters erleichtert jedoch das Speicher-Implementierungen von Daten in der Zukunft ändern, und sie Komponententests eine Anwendung ohne einer realen Datenbank zu ermöglichen.</span><span class="sxs-lookup"><span data-stu-id="bcb34-172">In addition to making application code cleaner, using a repository pattern can make it easier to change data storage implementations in the future, and it can help facilitate unit testing an application without requiring a real database.</span></span>

<span data-ttu-id="bcb34-173">Für unsere NerdDinner Anwendung definieren wir eine DinnerRepository-Klasse, mit der folgenden Signatur:</span><span class="sxs-lookup"><span data-stu-id="bcb34-173">For our NerdDinner application we'll define a DinnerRepository class with the below signature:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample2.cs)]

<span data-ttu-id="bcb34-174">*Hinweis: In diesem Kapitel wir extrahieren eine Schnittstelle IDinnerRepository von dieser Klasse und Abhängigkeitsinjektion mit ihm auf unserem Controllern aktivieren. Zunächst werden aber wir zum Starten einfach und direkt mit der Klasse DinnerRepository funktioniert.*</span><span class="sxs-lookup"><span data-stu-id="bcb34-174">*Note: Later in this chapter we'll extract an IDinnerRepository interface from this class and enable dependency injection with it on our Controllers. To begin with, though, we are going to start simple and just work directly with the DinnerRepository class.*</span></span>

<span data-ttu-id="bcb34-175">Diese Klasse implementieren wir mit der rechten Maustaste auf unserem "Modelle" Ordner und wählen Sie die **Add -&gt;neues Element** Menübefehl.</span><span class="sxs-lookup"><span data-stu-id="bcb34-175">To implement this class we'll right-click on our "Models" folder and choose the **Add-&gt;New Item** menu command.</span></span> <span data-ttu-id="bcb34-176">Innerhalb des Dialogfelds "Neues Element hinzufügen" Wir wählen Sie die Vorlage "Class" und nennen Sie die Datei "DinnerRepository.cs":</span><span class="sxs-lookup"><span data-stu-id="bcb34-176">Within the "Add New Item" dialog we'll select the "Class" template and name the file "DinnerRepository.cs":</span></span>

![](build-a-model-with-business-rule-validations/_static/image10.png)

<span data-ttu-id="bcb34-177">Dann können wir unsere DinnerRespository-Klasse, die mit den folgenden Code implementieren:</span><span class="sxs-lookup"><span data-stu-id="bcb34-177">We can then implement our DinnerRespository class using the code below:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample3.cs)]

### <a name="retrieving-updating-inserting-and-deleting-using-the-dinnerrepository-class"></a><span data-ttu-id="bcb34-178">Abrufen, aktualisieren, einfügen und Löschen mithilfe der DinnerRepository-Klasse</span><span class="sxs-lookup"><span data-stu-id="bcb34-178">Retrieving, Updating, Inserting and Deleting using the DinnerRepository class</span></span>

<span data-ttu-id="bcb34-179">Nun, da wir unsere DinnerRepository-Klasse erstellt haben, sehen wir uns einige Codebeispiele, in denen allgemeine Aufgaben veranschaulicht, die wir damit tun können:</span><span class="sxs-lookup"><span data-stu-id="bcb34-179">Now that we've created our DinnerRepository class, let's look at a few code examples that demonstrate common tasks we can do with it:</span></span>

#### <a name="querying-examples"></a><span data-ttu-id="bcb34-180">Beispiele für Abfragen</span><span class="sxs-lookup"><span data-stu-id="bcb34-180">Querying Examples</span></span>

<span data-ttu-id="bcb34-181">Der folgende Code Ruft eine einzelne Dinner mithilfe des Werts DinnerID ab:</span><span class="sxs-lookup"><span data-stu-id="bcb34-181">The code below retrieves a single Dinner using the DinnerID value:</span></span>


[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample4.cs)]

<span data-ttu-id="bcb34-182">Der folgende Code Ruft alle anstehenden Abendessen und Schleifen über diese ab:</span><span class="sxs-lookup"><span data-stu-id="bcb34-182">The code below retrieves all upcoming dinners and loops over them:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample5.cs)]

#### <a name="insert-and-update-examples"></a><span data-ttu-id="bcb34-183">INSERT- und Update-Beispiele</span><span class="sxs-lookup"><span data-stu-id="bcb34-183">Insert and Update Examples</span></span>

<span data-ttu-id="bcb34-184">Der folgende Code veranschaulicht das Hinzufügen von zwei neuen Abendessen angezeigt.</span><span class="sxs-lookup"><span data-stu-id="bcb34-184">The code below demonstrates adding two new dinners.</span></span> <span data-ttu-id="bcb34-185">Hinzufügungen/Änderungen im Repository nicht an die Datenbank übergeben, bis die Methode "Save()" aufgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="bcb34-185">Additions/modifications to the repository aren't committed to the database until the "Save()" method is called on it.</span></span> <span data-ttu-id="bcb34-186">LINQ to SQL umschließt alle Änderungen automatisch in einer Datenbanktransaktion –, damit alle Änderungen der Fall sein, oder keine von ihnen ausführen, wenn unsere Repository gespeichert:</span><span class="sxs-lookup"><span data-stu-id="bcb34-186">LINQ to SQL automatically wraps all changes in a database transaction – so either all changes happen or none of them do when our repository saves:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample6.cs)]

<span data-ttu-id="bcb34-187">Der folgende Code Ruft ein vorhandenes Dinner-Objekt ab und zwei Eigenschaften darauf ändert.</span><span class="sxs-lookup"><span data-stu-id="bcb34-187">The code below retrieves an existing Dinner object, and modifies two properties on it.</span></span> <span data-ttu-id="bcb34-188">Die Änderungen sind wieder in der Datenbank ein Commit ausgeführt, wenn die Methode "Save()" für unsere Repository aufgerufen wird:</span><span class="sxs-lookup"><span data-stu-id="bcb34-188">The changes are committed back to the database when the "Save()" method is called on our repository:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample7.cs)]

<span data-ttu-id="bcb34-189">Der folgende Code Ruft eine Dinner und anschließend eine Antwort hinzugefügt.</span><span class="sxs-lookup"><span data-stu-id="bcb34-189">The code below retrieves a dinner and then adds an RSVP to it.</span></span> <span data-ttu-id="bcb34-190">Dies geschieht mithilfe der Einladung-Auflistung auf der Dinner-Objekt, das LINQ to SQL für uns erstellt werden (da es eine Primärschlüssel-Schlüssel/Fremdschlüssel-Beziehung zwischen den beiden in der Datenbank ist).</span><span class="sxs-lookup"><span data-stu-id="bcb34-190">It does this using the RSVPs collection on the Dinner object that LINQ to SQL created for us (because there is a primary-key/foreign-key relationship between the two in the database).</span></span> <span data-ttu-id="bcb34-191">Diese Änderung ist wieder in der Datenbank als neue Antwort Tabellenzeile beibehalten, wenn die Methode "Save()" für das Repository aufgerufen wird:</span><span class="sxs-lookup"><span data-stu-id="bcb34-191">This change is persisted back to the database as a new RSVP table row when the "Save()" method is called on the repository:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample8.cs)]

#### <a name="delete-example"></a><span data-ttu-id="bcb34-192">Beispiel für Delete</span><span class="sxs-lookup"><span data-stu-id="bcb34-192">Delete Example</span></span>

<span data-ttu-id="bcb34-193">Der folgende Code Ruft ein vorhandenes Dinner-Objekt ab und markiert es gelöscht werden soll.</span><span class="sxs-lookup"><span data-stu-id="bcb34-193">The code below retrieves an existing Dinner object, and then marks it to be deleted.</span></span> <span data-ttu-id="bcb34-194">Beim Aufrufen der Methode "Save()" im Repository führt es wieder in der Datenbank löschen commit:</span><span class="sxs-lookup"><span data-stu-id="bcb34-194">When the "Save()" method is called on the repository it will commit the delete back to the database:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample9.cs)]

### <a name="integrating-validation-and-business-rule-logic-with-model-classes"></a><span data-ttu-id="bcb34-195">Modellklassen integrieren Überprüfung und Regel Geschäftslogik</span><span class="sxs-lookup"><span data-stu-id="bcb34-195">Integrating Validation and Business Rule Logic with Model Classes</span></span>

<span data-ttu-id="bcb34-196">Integration von Validierungs- und Geschäftsregel Logik ein wesentlicher Bestandteil des jeder Anwendung ist, die mit Daten arbeitet.</span><span class="sxs-lookup"><span data-stu-id="bcb34-196">Integrating validation and business rule logic is a key part of any application that works with data.</span></span>

#### <a name="schema-validation"></a><span data-ttu-id="bcb34-197">Schema-Validierung</span><span class="sxs-lookup"><span data-stu-id="bcb34-197">Schema Validation</span></span>

<span data-ttu-id="bcb34-198">Wenn Modellklassen mit LINQ to SQL-Designer definiert sind, entsprechen die Datentypen der Eigenschaften in das Modell Datenklassen die Datentypen der Datenbanktabelle.</span><span class="sxs-lookup"><span data-stu-id="bcb34-198">When model classes are defined using the LINQ to SQL designer, the datatypes of the properties in the data model classes correspond to the datatypes of the database table.</span></span> <span data-ttu-id="bcb34-199">Zum Beispiel: Wenn die Spalte "EventDate" in der Tabelle Abendessen "Datetime" ist, werden die Datenmodellklasse von LINQ to SQL erstellt vom Typ "DateTime" (Dies ist eine integrierte .NET-Datentyp).</span><span class="sxs-lookup"><span data-stu-id="bcb34-199">For example: if the "EventDate" column in the Dinners table is a "datetime", the data model class created by LINQ to SQL will be of type "DateTime" (which is a built-in .NET datatype).</span></span> <span data-ttu-id="bcb34-200">Dies bedeutet, dass Sie Kompilierungsfehler angezeigt werden, wenn Sie versuchen, eine ganze Zahl oder einen booleschen Wert aus dem Code zugewiesen, und es ein Fehler automatisch ausgelöst wird, wenn Sie versuchen, einen ungültige Zeichenfolgen-Datentyp, zur Laufzeit implizit zu konvertieren.</span><span class="sxs-lookup"><span data-stu-id="bcb34-200">This means you will get compile errors if you attempt to assign an integer or boolean to it from code, and it will raise an error automatically if you attempt to implicitly convert a non-valid string type to it at runtime.</span></span>

<span data-ttu-id="bcb34-201">LINQ to SQL wird auch automatisch Escapezeichen SQL-Werten für Sie verarbeitet, wenn die Zeichenfolgen - verwenden Sie vor SQL Injection-Angriffen zu schützen, wenn sie verwendet.</span><span class="sxs-lookup"><span data-stu-id="bcb34-201">LINQ to SQL will also automatically handles escaping SQL values for you when using strings - which helps protect you against SQL injection attacks when using it.</span></span>

#### <a name="validation-and-business-rule-logic"></a><span data-ttu-id="bcb34-202">Überprüfung und Geschäftslogik-Regel</span><span class="sxs-lookup"><span data-stu-id="bcb34-202">Validation and Business Rule Logic</span></span>

<span data-ttu-id="bcb34-203">Schema-Validation eignet sich als ersten Schritt, jedoch selten reicht.</span><span class="sxs-lookup"><span data-stu-id="bcb34-203">Schema validation is useful as a first step, but is rarely sufficient.</span></span> <span data-ttu-id="bcb34-204">In den meisten realen Szenarien erfordern die Fähigkeit, umfangreichere Validierungslogik angeben, die erstrecken sich über mehrere Eigenschaften, Code ausführen und häufig die Übersicht über Wirkungsbereichs des Zustands eines Modells können (z. B.: wird es erstellt/aktualisiert/gelöscht oder in einem Zustand domänenspezifische "z. B. archiviert).</span><span class="sxs-lookup"><span data-stu-id="bcb34-204">Most real-world scenarios require the ability to specify richer validation logic that can span multiple properties, execute code, and often have awareness of a model's state (for example: is it being created /updated/deleted, or within a domain-specific state like "archived").</span></span> <span data-ttu-id="bcb34-205">Es gibt eine Vielzahl von verschiedenen Mustern und Frameworks, die zum Definieren und Anwenden von Validierungsregeln auf Modellklassen verwendet werden können, und es gibt mehrere .NET Framework-basierte Frameworks es, die verwendet werden können, um dieses Problem zu.</span><span class="sxs-lookup"><span data-stu-id="bcb34-205">There are a variety of different patterns and frameworks that can be used to define and apply validation rules to model classes, and there are several .NET based frameworks out there that can be used to help with this.</span></span> <span data-ttu-id="bcb34-206">Sie können sehr viel jeder von ihnen in ASP.NET MVC-Anwendungen verwenden.</span><span class="sxs-lookup"><span data-stu-id="bcb34-206">You can use pretty much any of them within ASP.NET MVC applications.</span></span>

<span data-ttu-id="bcb34-207">Im Rahmen unserer Anwendung NerdDinner verwenden wir ein relativ einfach und selbsterklärend Muster, in denen verfügbar zu machen wir eine IsValid-Eigenschaft und eine GetRuleViolations()-Methode auf unserem Dinner Model-Objekts.</span><span class="sxs-lookup"><span data-stu-id="bcb34-207">For the purposes of our NerdDinner application, we'll use a relatively simple and straight-forward pattern where we expose an IsValid property and a GetRuleViolations() method on our Dinner model object.</span></span> <span data-ttu-id="bcb34-208">"True" oder "false", je nachdem, ob die Überprüfung und Geschäftsregeln gültig sind, gibt die IsValid-Eigenschaft zurück.</span><span class="sxs-lookup"><span data-stu-id="bcb34-208">The IsValid property will return true or false depending on whether the validation and business rules are all valid.</span></span> <span data-ttu-id="bcb34-209">Die GetRuleViolations()-Methode wird eine Liste der Regelfehler zurückgegeben.</span><span class="sxs-lookup"><span data-stu-id="bcb34-209">The GetRuleViolations() method will return a list of any rule errors.</span></span>

<span data-ttu-id="bcb34-210">IsValid und GetRuleViolations() implementieren für unsere Dinner Modell wir unser Projekt eine "partielle Klasse" hinzu.</span><span class="sxs-lookup"><span data-stu-id="bcb34-210">We'll implement IsValid and GetRuleViolations() for our Dinner model by adding a "partial class" to our project.</span></span> <span data-ttu-id="bcb34-211">Partielle Klassen können verwendet werden, um die Klassen, die von einem VS-Designer (z. B. die Dinner-Klasse, die von LINQ to SQL-Designer generierten) verwaltet Methoden/Eigenschaften/Ereignisse hinzugefügt und das Tool von der auszuführenden mit Code zu vermeiden.</span><span class="sxs-lookup"><span data-stu-id="bcb34-211">Partial classes can be used to add methods/properties/events to classes maintained by a VS designer (like the Dinner class generated by the LINQ to SQL designer) and help avoid the tool from messing with our code.</span></span> <span data-ttu-id="bcb34-212">Wir können unsere Projekt eine neue partielle Klasse hinzugefügt, mit der rechten Maustaste auf den Ordner \Models, und wählen Sie dann den Befehl "Neues Element hinzufügen".</span><span class="sxs-lookup"><span data-stu-id="bcb34-212">We can add a new partial class to our project by right-clicking on the \Models folder, and then select the "Add New Item" menu command.</span></span> <span data-ttu-id="bcb34-213">Wir können dann die Vorlage "Class" innerhalb des Dialogfelds "Neues Element hinzufügen" auswählen und nennen Sie sie Dinner.cs.</span><span class="sxs-lookup"><span data-stu-id="bcb34-213">We can then choose the "Class" template within the "Add New Item" dialog and name it Dinner.cs.</span></span>

![](build-a-model-with-business-rule-validations/_static/image11.png)

<span data-ttu-id="bcb34-214">Klicken auf die Schaltfläche "Hinzufügen" wird eine Dinner.cs-Datei zum Projekt hinzufügen, und öffnen sie in der IDE.</span><span class="sxs-lookup"><span data-stu-id="bcb34-214">Clicking the "Add" button will add a Dinner.cs file to our project and open it within the IDE.</span></span> <span data-ttu-id="bcb34-215">Wir können dann implementieren, eine grundlegende Regel Erzwingung Framework verwenden den folgenden Code:</span><span class="sxs-lookup"><span data-stu-id="bcb34-215">We can then implement a basic rule/validation enforcement framework using the below code:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample10.cs)]

<span data-ttu-id="bcb34-216">Einige Hinweise zu den oben aufgeführten Code:</span><span class="sxs-lookup"><span data-stu-id="bcb34-216">A few notes about the above code:</span></span>

- <span data-ttu-id="bcb34-217">Die Dinner-Klasse wird mit einem "partiell" Schlüsselwort – vorangestellt, d. h. der darin enthaltene Code wird mit der Klasse generiert/aufrechterhalten kombiniert werden, indem die LINQ to SQL-Designer und in eine einzelne Klasse kompiliert werden.</span><span class="sxs-lookup"><span data-stu-id="bcb34-217">The Dinner class is prefaced with a "partial" keyword – which means the code contained within it will be combined with the class generated/maintained by the LINQ to SQL designer and compiled into a single class.</span></span>
- <span data-ttu-id="bcb34-218">Die RuleViolation-Klasse ist eine Hilfsklasse, die wir dem Projekt hinzufügen, die wir weitere Details zu einem Verstoß gegen eine Codeanalyseregel bereitstellen können.</span><span class="sxs-lookup"><span data-stu-id="bcb34-218">The RuleViolation class is a helper class we'll add to the project that allows us to provide more details about a rule violation.</span></span>
- <span data-ttu-id="bcb34-219">Die Dinner.GetRuleViolations() Methode bewirkt, dass unsere Überprüfung und Geschäftsregeln ausgewertet werden soll (implementieren wir ihnen in Kürze).</span><span class="sxs-lookup"><span data-stu-id="bcb34-219">The Dinner.GetRuleViolations() method causes our validation and business rules to be evaluated (we'll implement them shortly).</span></span> <span data-ttu-id="bcb34-220">Anschließend zurückgegeben wieder eine Sequenz von RuleViolation-Objekten, die weitere Details zu Regelfehlern bereitstellen.</span><span class="sxs-lookup"><span data-stu-id="bcb34-220">It then returns back a sequence of RuleViolation objects that provide more details about any rule errors.</span></span>
- <span data-ttu-id="bcb34-221">Die Dinner.IsValid-Eigenschaft enthält eine einfache Hilfsfunktion-Eigenschaft, die angibt, ob das Objekt Dinner alle aktiven RuleViolations verfügt.</span><span class="sxs-lookup"><span data-stu-id="bcb34-221">The Dinner.IsValid property provides a convenient helper property that indicates whether the Dinner object has any active RuleViolations.</span></span> <span data-ttu-id="bcb34-222">Es kann von einem Entwickler verwenden jedoch stattdessen das Dinner jederzeit proaktiv überprüft werden (und löst keine Ausnahme aus).</span><span class="sxs-lookup"><span data-stu-id="bcb34-222">It can be proactively checked by a developer using the Dinner object at anytime (and does not raise an exception).</span></span>
- <span data-ttu-id="bcb34-223">Die Dinner.OnValidate() partielle Methode handelt es sich um einen Hook, den LINQ to SQL bietet, der uns ermöglicht, die benachrichtigt werden, solange das Dinner-Objekt ist in der Datenbank beibehalten werden sollen.</span><span class="sxs-lookup"><span data-stu-id="bcb34-223">The Dinner.OnValidate() partial method is a hook that LINQ to SQL provides that allows us to be notified anytime the Dinner object is about to be persisted within the database.</span></span> <span data-ttu-id="bcb34-224">Unsere OnValidate()"-Implementierung, die oben genannten gewährleistet, dass die Dinner keine RuleViolations aufweist, nachdem es gespeichert wurde.</span><span class="sxs-lookup"><span data-stu-id="bcb34-224">Our OnValidate() implementation above ensures that the Dinner has no RuleViolations before it is saved.</span></span> <span data-ttu-id="bcb34-225">Ist in einem ungültigen Zustand er eine Ausnahme auslöst, wodurch LINQ to SQL die Transaktion abbricht.</span><span class="sxs-lookup"><span data-stu-id="bcb34-225">If it is in an invalid state it raises an exception, which will cause LINQ to SQL to abort the transaction.</span></span>

<span data-ttu-id="bcb34-226">Dieser Ansatz bietet ein einfache Framework, dem wir auf die überprüfungs- und Geschäftsregeln in integrieren können.</span><span class="sxs-lookup"><span data-stu-id="bcb34-226">This approach provides a simple framework that we can integrate validation and business rules into.</span></span> <span data-ttu-id="bcb34-227">Fügen Sie jetzt die folgenden Regeln, um unsere GetRuleViolations()-Methode:</span><span class="sxs-lookup"><span data-stu-id="bcb34-227">For now let's add the below rules to our GetRuleViolations() method:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample11.cs)]

<span data-ttu-id="bcb34-228">Wir werden die "yield Return"-Funktion von c# verwenden, um eine Sequenz von jeder RuleViolations zurückgeben.</span><span class="sxs-lookup"><span data-stu-id="bcb34-228">We are using the "yield return" feature of C# to return a sequence of any RuleViolations.</span></span> <span data-ttu-id="bcb34-229">Die ersten sechs Regel Überprüfungen, die oben genannten erzwingen einfach an, dass Zeichenfolgeneigenschaften auf unserem Dinner null oder leer sein können.</span><span class="sxs-lookup"><span data-stu-id="bcb34-229">The first six rule checks above simply enforce that string properties on our Dinner cannot be null or empty.</span></span> <span data-ttu-id="bcb34-230">Die letzte Regel ist etwas interessanter und Aufrufe PhoneValidator.IsValidNumber(), um eine Hilfsmethode, dass wir unsere Projekt, um zu überprüfen, ob die ContactPhone hinzufügen können Zahl Format entspricht der Dinner des Landes.</span><span class="sxs-lookup"><span data-stu-id="bcb34-230">The last rule is a little more interesting, and calls a PhoneValidator.IsValidNumber() helper method that we can add to our project to verify that the ContactPhone number format matches the Dinner's country.</span></span>

<span data-ttu-id="bcb34-231">Wir können. NET reguläre Unterstützung zur Implementierung dieser Unterstützung der Phone-Validierung.</span><span class="sxs-lookup"><span data-stu-id="bcb34-231">We can use .NET's regular expression support to implement this phone validation support.</span></span> <span data-ttu-id="bcb34-232">Im folgenden finden Sie eine einfache PhoneValidator-Implementierung, die wir hinzufügen können unsere Projekt, das wir länderspezifische Regex-Muster Überprüfungen hinzufügen können:</span><span class="sxs-lookup"><span data-stu-id="bcb34-232">Below is a simple PhoneValidator implementation that we can add to our project that enables us to add country-specific Regex pattern checks:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample12.cs)]

#### <a name="handling-validation-and-business-logic-violations"></a><span data-ttu-id="bcb34-233">Behandeln von Überprüfung und Business Logic Verstöße</span><span class="sxs-lookup"><span data-stu-id="bcb34-233">Handling Validation and Business Logic Violations</span></span>

<span data-ttu-id="bcb34-234">Nun, dass wir den oben genannten Überprüfung und Business Regelcode, jederzeit wir versucht, eine zum Erstellen oder Aktualisieren einer Dinner hinzugefügt haben, werden unsere Logik Validierungsregeln ausgewertet und erzwungen werden.</span><span class="sxs-lookup"><span data-stu-id="bcb34-234">Now that we've added the above validation and business rule code, any time we try to create or update a Dinner, our validation logic rules will be evaluated and enforced.</span></span>

<span data-ttu-id="bcb34-235">Entwickler können schreiben Sie code wie unten proaktiv bestimmen Sie, ob ein Dinner Objekt gültig ist, und rufen Sie eine Liste aller Verstöße darin ohne Auslösen von Ausnahmen:</span><span class="sxs-lookup"><span data-stu-id="bcb34-235">Developers can write code like below to proactively determine if a Dinner object is valid, and retrieve a list of all violations in it without raising any exceptions:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample13.cs)]

<span data-ttu-id="bcb34-236">Wenn Sie versuchen, eine Dinner in einem ungültigen Zustand zu speichern, wird eine Ausnahme ausgelöst werden, wenn wir die Save()-Methode in der DinnerRepository aufrufen.</span><span class="sxs-lookup"><span data-stu-id="bcb34-236">If we attempt to save a Dinner in an invalid state, an exception will be raised when we call the Save() method on the DinnerRepository.</span></span> <span data-ttu-id="bcb34-237">Dies tritt auf, da LINQ to SQL automatisch unsere Dinner.OnValidate() partielle Methode aufruft, bevor der Dinner Änderungen gespeichert, und wir Dinner.OnValidate(), um eine Ausnahme auszulösen, wenn alle Verletzungen von Schwellenwertregeln in das Dinner vorhanden Code hinzugefügt.</span><span class="sxs-lookup"><span data-stu-id="bcb34-237">This occurs because LINQ to SQL automatically calls our Dinner.OnValidate() partial method before it saves the Dinner's changes, and we added code to Dinner.OnValidate() to raise an exception if any rule violations exist in the Dinner.</span></span> <span data-ttu-id="bcb34-238">Diese Ausnahme abfangen Sie können und reaktiv Abrufen einer Liste Verstöße gegen die diesen Fehler beheben:</span><span class="sxs-lookup"><span data-stu-id="bcb34-238">We can catch this exception and reactively retrieve a list of the violations to fix:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample14.cs)]

<span data-ttu-id="bcb34-239">Da unsere Überprüfung und Geschäftsregeln unsere Modellebene, und nicht innerhalb der UI-Ebene implementiert werden, werden sie angewendet und in allen Szenarios innerhalb der Anwendung verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="bcb34-239">Because our validation and business rules are implemented within our model layer, and not within the UI layer, they will be applied and used across all scenarios within our application.</span></span> <span data-ttu-id="bcb34-240">Wir können später ändern oder Geschäftsregeln hinzuzufügen und alle Codes, funktioniert mit unserem Dinner Objekte werden berücksichtigt.</span><span class="sxs-lookup"><span data-stu-id="bcb34-240">We can later change or add business rules and have all code that works with our Dinner objects honor them.</span></span>

<span data-ttu-id="bcb34-241">Geschäftsregeln an einem Ort ändern ist, ohne diese Änderungen in der gesamten Anwendung und Benutzeroberflächen-Logik ripple ein Anzeichen für eine gut geschriebene Anwendung und einen Vorteil, mit dem ein MVC-Framework kann durchzusetzen.</span><span class="sxs-lookup"><span data-stu-id="bcb34-241">Having the flexibility to change business rules in one place, without having these changes ripple throughout the application and UI logic, is a sign of a well-written application, and a benefit that an MVC framework helps encourage.</span></span>

### <a name="next-step"></a><span data-ttu-id="bcb34-242">Nächster Schritt</span><span class="sxs-lookup"><span data-stu-id="bcb34-242">Next Step</span></span>

<span data-ttu-id="bcb34-243">Wir haben jetzt ein Modell, mit denen wir können Abfragen sowohl die Datenbank zu aktualisieren.</span><span class="sxs-lookup"><span data-stu-id="bcb34-243">We've now got a model that we can use to both query and update our database.</span></span>

<span data-ttu-id="bcb34-244">Nehmen wir jetzt einige Controller und Ansichten dem Projekt hinzugefügt, das es verwenden können, um eine HTML-UI-Erfahrung herum zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="bcb34-244">Let's now add some controllers and views to the project that we can use to build an HTML UI experience around it.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="bcb34-245">[Zurück](create-a-database.md)
> [Weiter](use-controllers-and-views-to-implement-a-listingdetails-ui.md)</span><span class="sxs-lookup"><span data-stu-id="bcb34-245">[Previous](create-a-database.md)
[Next](use-controllers-and-views-to-implement-a-listingdetails-ui.md)</span></span>
