---
title: Filter
author: ardalis
description: Erfahren Sie, wie *Filter* funktionieren, und wie Sie sie in ASP.NET Core MVC verwenden.
manager: wpickett
ms.author: tdykstra
ms.date: 12/12/2016
ms.prod: asp.net-core
ms.technology: aspnet
ms.topic: article
uid: mvc/controllers/filters
ms.openlocfilehash: 2ba3c226cc57f8a3fb26b4119ae9e575eff522f9
ms.sourcegitcommit: f2a11a89037471a77ad68a67533754b7bb8303e2
ms.translationtype: HT
ms.contentlocale: de-DE
ms.lasthandoff: 02/01/2018
---
# <a name="filters"></a><span data-ttu-id="70b32-103">Filter</span><span class="sxs-lookup"><span data-stu-id="70b32-103">Filters</span></span>

<span data-ttu-id="70b32-104">Von [Tom Dykstra](https://github.com/tdykstra/) und [Steve Smith](https://ardalis.com/)</span><span class="sxs-lookup"><span data-stu-id="70b32-104">By [Tom Dykstra](https://github.com/tdykstra/) and [Steve Smith](https://ardalis.com/)</span></span>

<span data-ttu-id="70b32-105">In ASP.Net Core MVC ermöglichen *Filter* Ihnen, Code vor oder nach bestimmten Stufen der Anforderungsverarbeitungspipeline auszuführen.</span><span class="sxs-lookup"><span data-stu-id="70b32-105">*Filters* in ASP.NET Core MVC allow you to run code before or after certain stages in the request processing pipeline.</span></span>

 <span data-ttu-id="70b32-106">Eingebaute Filter behandeln Aufgaben wie die Autorisierung (Verhindern des Zugriffs auf Ressourcen, die für einen Benutzer nicht genehmigt sind), wodurch sichergestellt wird, dass alle Anforderungen HTTPS verwenden und Antworten zwischenspeichern (Kurzschließen der Anforderungspipeline für die Rückgabe einer zwischengespeicherten Antwort).</span><span class="sxs-lookup"><span data-stu-id="70b32-106">Built-in filters handle tasks such as authorization (preventing access to resources a user isn't authorized for), ensuring that all requests use HTTPS, and response caching (short-circuiting the request pipeline to return a cached response).</span></span> 

<span data-ttu-id="70b32-107">Sie können benutzerdefinierte Filter erstellen, um übergreifende Belange für Ihre Anwendung zu behandeln.</span><span class="sxs-lookup"><span data-stu-id="70b32-107">You can create custom filters to handle cross-cutting concerns for your application.</span></span> <span data-ttu-id="70b32-108">Filter sind die Lösung, wenn Sie vermeiden möchten, Code über mehrere Aktionen hinweg zu duplizieren.</span><span class="sxs-lookup"><span data-stu-id="70b32-108">Anytime you want to avoid duplicating code across actions, filters are the solution.</span></span> <span data-ttu-id="70b32-109">Sie können zum Beispiel Code für die Fehlerbehandlung in einem Ausnahmefilter konsolidieren.</span><span class="sxs-lookup"><span data-stu-id="70b32-109">For example, you can consolidate error handling code in a exception filter.</span></span>

<span data-ttu-id="70b32-110">[Beispiel anzeigen oder von GitHub herunterladen](https://github.com/aspnet/Docs/tree/master/aspnetcore/mvc/controllers/filters/sample).</span><span class="sxs-lookup"><span data-stu-id="70b32-110">[View or download sample from GitHub](https://github.com/aspnet/Docs/tree/master/aspnetcore/mvc/controllers/filters/sample).</span></span>

## <a name="how-do-filters-work"></a><span data-ttu-id="70b32-111">Wie funktionieren Filter?</span><span class="sxs-lookup"><span data-stu-id="70b32-111">How do filters work?</span></span>

<span data-ttu-id="70b32-112">Filter werden in der *MVC-Aktionsaufrufpipeline* ausgeführt, die manchmal auch als *Filterpipeline* bezeichnet wird.</span><span class="sxs-lookup"><span data-stu-id="70b32-112">Filters run within the *MVC action invocation pipeline*, sometimes referred to as the *filter pipeline*.</span></span>  <span data-ttu-id="70b32-113">Die Filterpipeline wird ausgeführt, nachdem MVC die auszuführende Aktion ausgewählt hat.</span><span class="sxs-lookup"><span data-stu-id="70b32-113">The filter pipeline runs after MVC selects the action to execute.</span></span>

![Die Anforderung wird von weiterer Middleware, Routingmiddleware, Aktionsauswahl und der MVC-Aktionsaufrufpipeline verarbeitet.](filters/_static/filter-pipeline-1.png)

### <a name="filter-types"></a><span data-ttu-id="70b32-116">Filtertypen</span><span class="sxs-lookup"><span data-stu-id="70b32-116">Filter types</span></span>

<span data-ttu-id="70b32-117">Jeder Filtertyp wird zu einem anderen Zeitpunkt in der Filterpipeline ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="70b32-117">Each filter type is executed at a different stage in the filter pipeline.</span></span>

* <span data-ttu-id="70b32-118">[Autorisierungfilter](#authorization-filters) werden zuerst ausgeführt und werden verwendet, um festzustellen, ob der aktuelle Benutzer für die aktuelle Anforderung berechtigt ist.</span><span class="sxs-lookup"><span data-stu-id="70b32-118">[Authorization filters](#authorization-filters) run first and are used to determine whether the current user is authorized for the current request.</span></span> <span data-ttu-id="70b32-119">Sie können die Pipeline kurzschließen, wenn eine Anforderung nicht autorisiert ist.</span><span class="sxs-lookup"><span data-stu-id="70b32-119">They can short-circuit the pipeline if a request is unauthorized.</span></span> 

* <span data-ttu-id="70b32-120">[Ressourcenfilter](#resource-filters) sind die ersten Filter, die eine Anforderung nach der Autorisierung behandeln.</span><span class="sxs-lookup"><span data-stu-id="70b32-120">[Resource filters](#resource-filters) are the first to handle a request after authorization.</span></span>  <span data-ttu-id="70b32-121">Diese Filter können vor der restlichen Filterpipeline, und nachdem der Rest der Filterpipeline abgeschlossen wurde, Code ausführen.</span><span class="sxs-lookup"><span data-stu-id="70b32-121">They can run code before the rest of the filter pipeline, and after the rest of the pipeline has completed.</span></span> <span data-ttu-id="70b32-122">Sie helfen dabei, das Zwischenspeichern zu implementieren, oder beim Kurzschließen der Filterpipeline zur Verbesserung der Leistung.</span><span class="sxs-lookup"><span data-stu-id="70b32-122">They're useful to implement caching or otherwise short-circuit the filter pipeline for performance reasons.</span></span> <span data-ttu-id="70b32-123">Da sie vor der Modellbindung ausgeführt werden, sind sie für alles nützlich, was Einfluss auf die Modellbindung ausüben muss.</span><span class="sxs-lookup"><span data-stu-id="70b32-123">Since they run before model binding, they're useful for anything that needs to influence model binding.</span></span>

* <span data-ttu-id="70b32-124">[Aktionsfilter](#action-filters) können, vor und nach dem Aufruf einer individuelle Aktionsmethode, Code ausführen.</span><span class="sxs-lookup"><span data-stu-id="70b32-124">[Action filters](#action-filters) can run code immediately before and after an individual action method is called.</span></span> <span data-ttu-id="70b32-125">Sie können zur Bearbeitung der Argumente, die an eine Aktion übermittelt werden, und des Ergebnisses, das von der Aktion zurückgegeben wird, verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="70b32-125">They can be used to manipulate the arguments passed into an action and the result returned from the action.</span></span>

* <span data-ttu-id="70b32-126">[Ausnahmefilter](#exception-filters) werden dazu verwendet, globale Richtlinien auf unbehandelte Ausnahmen anzuwenden, die auftreten, bevor etwas in den Antworttext geschrieben wurde.</span><span class="sxs-lookup"><span data-stu-id="70b32-126">[Exception filters](#exception-filters) are used to apply global policies to unhandled exceptions that occur before anything has been written to the response body.</span></span>

* <span data-ttu-id="70b32-127">[Ergebnisfilter](#result-filters) können, vor und nach dem Ergebnis einer ausgeführten individuellen Aktion, Code ausführen.</span><span class="sxs-lookup"><span data-stu-id="70b32-127">[Result filters](#result-filters) can run code immediately before and after the execution of individual action results.</span></span> <span data-ttu-id="70b32-128">Sie werden nur ausgeführt, wenn die Aktionsmethode erfolgreich ausgeführt wurde, und wenn sie für eine Logik nützlich sind, die die Ausführung eines Formatierers oder einer Ansicht umgeben muss.</span><span class="sxs-lookup"><span data-stu-id="70b32-128">They run only when the action method has executed successfully and are useful for logic that must surround view or formatter execution.</span></span>

<span data-ttu-id="70b32-129">Das folgende Diagramm veranschaulicht, wie diese Filtertypen mit der Filterpipeline interagieren.</span><span class="sxs-lookup"><span data-stu-id="70b32-129">The following diagram shows how these filter types interact in the filter pipeline.</span></span>

![Die Anforderung wird von Autorisierungsfilter, Ressourcenfilter, Modellbindung, Aktionsfilter, Aktionsausführung sowie Aktionsergebniskonvertierung, Ausnahmefilter, Ergebnisfilter und Ergebnisausführung verarbeitet.](filters/_static/filter-pipeline-2.png)

## <a name="implementation"></a><span data-ttu-id="70b32-132">Implementierung</span><span class="sxs-lookup"><span data-stu-id="70b32-132">Implementation</span></span>

<span data-ttu-id="70b32-133">Filter unterstützen sowohl synchrone als auch asynchrone Implementierungen über verschiedene Schnittstellendefinitionen.</span><span class="sxs-lookup"><span data-stu-id="70b32-133">Filters support both synchronous and asynchronous implementations through different interface definitions.</span></span> <span data-ttu-id="70b32-134">Wählen Sie je nach Art der auszuführenden Aufgabe entweder synchron oder asynchron.</span><span class="sxs-lookup"><span data-stu-id="70b32-134">Choose either the sync or async variant depending on the kind of task you need to perform.</span></span> 

<span data-ttu-id="70b32-135">Synchrone Filter, die Code sowohl vor als auch nach ihrer Pipeline ausführen können, definieren die Methoden On*Stage*Executing und On*Stage*Executed.</span><span class="sxs-lookup"><span data-stu-id="70b32-135">Synchronous filters that can run code both before and after their pipeline stage define On*Stage*Executing and On*Stage*Executed methods.</span></span> <span data-ttu-id="70b32-136">Zum Beispiel wird `OnActionExecuting` aufgerufen, bevor die Aktionsmethode aufgerufen wird, und `OnActionExecuted` wird aufgerufen, nachdem die Aktionsmethode zurückgegeben wird.</span><span class="sxs-lookup"><span data-stu-id="70b32-136">For example, `OnActionExecuting` is called before the action method is called, and `OnActionExecuted` is called after the action method returns.</span></span>

[!code-csharp[Main](./filters/sample/src/FiltersSample/Filters/SampleActionFilter.cs?highlight=6,8,13)]

<span data-ttu-id="70b32-137">Asynchrone Filter definieren eine einzelne On*Stage*ExecutionAsync-Methode.</span><span class="sxs-lookup"><span data-stu-id="70b32-137">Asynchronous filters define a single On*Stage*ExecutionAsync method.</span></span> <span data-ttu-id="70b32-138">Diese Methode verwendet einen *FilterType*ExecutionDelegate-Delegaten, der die Pipelinestufe des Filters ausführt.</span><span class="sxs-lookup"><span data-stu-id="70b32-138">This method takes a *FilterType*ExecutionDelegate delegate which executes the filter's pipeline stage.</span></span> <span data-ttu-id="70b32-139">Zum Beispiel ruft `ActionExecutionDelegate` die Aktionsmethode auf, und Sie können Code ausführen, bevor oder nachdem Sie sie aufrufen.</span><span class="sxs-lookup"><span data-stu-id="70b32-139">For example, `ActionExecutionDelegate` calls the action method, and you can execute code before and after you call it.</span></span>

[!code-csharp[Main](./filters/sample/src/FiltersSample/Filters/SampleAsyncActionFilter.cs?highlight=6,8-10,13)]

<span data-ttu-id="70b32-140">Sie können Schnittstellen für mehrere Filterstufen in eine einzelne Klasse implementieren.</span><span class="sxs-lookup"><span data-stu-id="70b32-140">You can implement interfaces for multiple filter stages in a single class.</span></span> <span data-ttu-id="70b32-141">Zum Beispiel implementiert die abstrakte Klasse [ActionFilterAttribute](https://docs.microsoft.com/aspnet/core/api/microsoft.aspnetcore.mvc.filters.actionfilterattribute) sowohl `IActionFilter` und `IResultFilter` als auch deren asynchrone Gegenstücke.</span><span class="sxs-lookup"><span data-stu-id="70b32-141">For example, the [ActionFilterAttribute](https://docs.microsoft.com/aspnet/core/api/microsoft.aspnetcore.mvc.filters.actionfilterattribute) abstract class implements both `IActionFilter` and `IResultFilter`, as well as their async equivalents.</span></span>

> [!NOTE]
> <span data-ttu-id="70b32-142">Implementieren Sie **entweder** die synchrone oder asynchrone Version einer Filterschnittstelle, aber nicht beide.</span><span class="sxs-lookup"><span data-stu-id="70b32-142">Implement **either** the synchronous or the async version of a filter interface, not both.</span></span> <span data-ttu-id="70b32-143">Das Framework prüft zuerst, ob der Filter die asynchrone Schnittstelle implementiert, und wenn dies der Fall ist, ruft es sie auf.</span><span class="sxs-lookup"><span data-stu-id="70b32-143">The framework checks first to see if the filter implements the async interface, and if so, it calls that.</span></span> <span data-ttu-id="70b32-144">Wenn dies nicht der Fall ist, ruft es die Methode(n) der synchronen Schnittstelle auf.</span><span class="sxs-lookup"><span data-stu-id="70b32-144">If not, it calls the synchronous interface's method(s).</span></span> <span data-ttu-id="70b32-145">Wenn Sie beide Schnittstellen für eine Klasse implementieren würden, würde nur die asynchrone Methode aufgerufen werden.</span><span class="sxs-lookup"><span data-stu-id="70b32-145">If you were to implement both interfaces on one class, only the async method would be called.</span></span> <span data-ttu-id="70b32-146">Wenn Sie abstrakte Klassen wie [ActionFilterAttribute](https://docs.microsoft.com/aspnet/core/api/microsoft.aspnetcore.mvc.filters.actionfilterattribute) verwenden, würden Sie nur die synchronen oder asynchronen Methoden für jeden Filtertyp überschreiben.</span><span class="sxs-lookup"><span data-stu-id="70b32-146">When using abstract classes like [ActionFilterAttribute](https://docs.microsoft.com/aspnet/core/api/microsoft.aspnetcore.mvc.filters.actionfilterattribute) you would override only the synchronous methods or the async method for each filter type.</span></span>

### <a name="ifilterfactory"></a><span data-ttu-id="70b32-147">IFilterFactory</span><span class="sxs-lookup"><span data-stu-id="70b32-147">IFilterFactory</span></span>

<span data-ttu-id="70b32-148">`IFilterFactory` implementiert `IFilter`.</span><span class="sxs-lookup"><span data-stu-id="70b32-148">`IFilterFactory` implements `IFilter`.</span></span> <span data-ttu-id="70b32-149">Deshalb kann eine `IFilterFactory`-Instanz an einer beliebigen Stelle in der Filterpipeline als `IFilter`-Instanz verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="70b32-149">Therefore, an `IFilterFactory` instance can be used as an `IFilter` instance anywhere in the filter pipeline.</span></span> <span data-ttu-id="70b32-150">Wenn das Framework den Aufruf des Filters vorbereitet, versucht es ihn in `IFilterFactory` umzuwandeln.</span><span class="sxs-lookup"><span data-stu-id="70b32-150">When the framework prepares to invoke the filter, it attempts to cast it to an `IFilterFactory`.</span></span> <span data-ttu-id="70b32-151">Wenn diese Umwandlung gelingt, wird die Methode `CreateInstance` aufgerufen, um die Instanz `IFilter` zu erstellen, die aufgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="70b32-151">If that cast succeeds, the `CreateInstance` method is called to create the `IFilter` instance that will be invoked.</span></span> <span data-ttu-id="70b32-152">Dies bietet ein sehr flexibles Design, da die exakte Filterpipeline nicht explizit festgelegt sein muss, wenn die Anwendung gestartet wird.</span><span class="sxs-lookup"><span data-stu-id="70b32-152">This provides a very flexible design, since the precise filter pipeline doesn't need to be set explicitly when the application starts.</span></span>

<span data-ttu-id="70b32-153">Als weiteres Verfahren zum Erstellen von Filtern, können Sie `IFilterFactory` in Ihre eigenen Implementierungen von Attributen integrieren:</span><span class="sxs-lookup"><span data-stu-id="70b32-153">You can implement `IFilterFactory` on your own attribute implementations as another approach to creating filters:</span></span>

[!code-csharp[Main](./filters/sample/src/FiltersSample/Filters/AddHeaderWithFactoryAttribute.cs?name=snippet_IFilterFactory&highlight=1,4,5,6,7)]

### <a name="built-in-filter-attributes"></a><span data-ttu-id="70b32-154">Integrierte Filterattribute</span><span class="sxs-lookup"><span data-stu-id="70b32-154">Built-in filter attributes</span></span>

<span data-ttu-id="70b32-155">Das Framework enthält integrierte attributbasierte Filter, die Sie als Unterklasse erstellen und anpassen können.</span><span class="sxs-lookup"><span data-stu-id="70b32-155">The framework includes built-in attribute-based filters that you can subclass and customize.</span></span> <span data-ttu-id="70b32-156">Zum Beispiel fügt der folgende Ergebnisfilter der Antwort einen Header hinzu.</span><span class="sxs-lookup"><span data-stu-id="70b32-156">For example, the following Result filter adds a header to the response.</span></span>

<a name="add-header-attribute"></a>

[!code-csharp[Main](./filters/sample/src/FiltersSample/Filters/AddHeaderAttribute.cs?highlight=5,16)]

<span data-ttu-id="70b32-157">Wie im obigen Beispiel dargestellt wird, können Filter mithilfe von Attributen Argumente akzeptieren.</span><span class="sxs-lookup"><span data-stu-id="70b32-157">Attributes allow filters to accept arguments, as shown in the example above.</span></span> <span data-ttu-id="70b32-158">Sie können dieses Attribut einem Controller oder einer Aktionsmethode hinzufügen, und den Namen und Wert des HTTP-Headers angeben:</span><span class="sxs-lookup"><span data-stu-id="70b32-158">You would add this attribute to a controller or action method and specify the name and value of the HTTP header:</span></span>

[!code-csharp[Main](./filters/sample/src/FiltersSample/Controllers/SampleController.cs?name=snippet_AddHeader&highlight=1)]

<span data-ttu-id="70b32-159">Das Ergebnis der Aktion `Index` wird unten angezeigt – die Antwortheader werden unten rechts angezeigt.</span><span class="sxs-lookup"><span data-stu-id="70b32-159">The result of the `Index` action is shown below - the response headers are displayed on the bottom right.</span></span>

![Entwicklertools von Microsoft Edge zeigen Antwortheader an, einschließlich Autor Steve Smith @ardalis](filters/_static/add-header.png)

<span data-ttu-id="70b32-161">Einige der Filterschnittstellen besitzen entsprechende Attribute, die als Basisklassen für benutzerdefinierte Implementierungen verwendet werden können.</span><span class="sxs-lookup"><span data-stu-id="70b32-161">Several of the filter interfaces have corresponding attributes that can be used as base classes for custom implementations.</span></span>

<span data-ttu-id="70b32-162">Filterattribute:</span><span class="sxs-lookup"><span data-stu-id="70b32-162">Filter attributes:</span></span>

* `ActionFilterAttribute`
* `ExceptionFilterAttribute`
* `ResultFilterAttribute`
* `FormatFilterAttribute`
* `ServiceFilterAttribute`
* `TypeFilterAttribute`

<span data-ttu-id="70b32-163">`TypeFilterAttribute` und `ServiceFilterAttribute` werden [weiter unten in diesem Artikel](#dependency-injection) erklärt.</span><span class="sxs-lookup"><span data-stu-id="70b32-163">`TypeFilterAttribute` and `ServiceFilterAttribute` are explained [later in this article](#dependency-injection).</span></span>

## <a name="filter-scopes-and-order-of-execution"></a><span data-ttu-id="70b32-164">Filterbereiche und Reihenfolge der Ausführung</span><span class="sxs-lookup"><span data-stu-id="70b32-164">Filter scopes and order of execution</span></span>

<span data-ttu-id="70b32-165">Der Pipeline kann an einem von drei *Bereichen* ein Filter hinzugefügt werden.</span><span class="sxs-lookup"><span data-stu-id="70b32-165">A filter can be added to the pipeline at one of three *scopes*.</span></span> <span data-ttu-id="70b32-166">Sie können einen Filter einer bestimmten Aktionsmethode oder Controllerklasse hinzufügen, indem Sie ein Attribut verwenden.</span><span class="sxs-lookup"><span data-stu-id="70b32-166">You can add a filter to a particular action method or to a controller class by using an attribute.</span></span> <span data-ttu-id="70b32-167">Sie können einen Filter auch global registrieren (für alle Controller und Aktionen), indem Sie ihn der Auflistung `MvcOptions.Filters` in der Methode `ConfigureServices` der Klasse `Startup` hinzufügen:</span><span class="sxs-lookup"><span data-stu-id="70b32-167">Or you can register a filter globally (for all controllers and actions) by adding it to the `MvcOptions.Filters` collection in the `ConfigureServices` method in the `Startup` class:</span></span>

[!code-csharp[Main](./filters/sample/src/FiltersSample/Startup.cs?name=snippet_ConfigureServices&highlight=5-8)]

### <a name="default-order-of-execution"></a><span data-ttu-id="70b32-168">Standardreihenfolge der Ausführung</span><span class="sxs-lookup"><span data-stu-id="70b32-168">Default order of execution</span></span>

<span data-ttu-id="70b32-169">Wenn es mehrere Filter für eine bestimmte Stufe der Pipeline gibt, bestimmt der Bereich die Standardreihenfolge der Filterausführung.</span><span class="sxs-lookup"><span data-stu-id="70b32-169">When there are multiple filters for a particular stage of the pipeline, scope determines the default order of filter execution.</span></span>  <span data-ttu-id="70b32-170">Globale Filter umfassen Klassenfilter, welche hingegen Methodenfilter umfassen.</span><span class="sxs-lookup"><span data-stu-id="70b32-170">Global filters surround class filters, which in turn surround method filters.</span></span> <span data-ttu-id="70b32-171">Diese Verschachtelung ähnelt russischen Puppen, weil jede Erweiterung des Bereichs den vorherigen Bereich umschließt wie eine [Matroschka](https://wikipedia.org/wiki/Matryoshka_doll).</span><span class="sxs-lookup"><span data-stu-id="70b32-171">This is sometimes referred to as "Russian doll" nesting, as each increase in scope is wrapped around the previous scope, like a [nesting doll](https://wikipedia.org/wiki/Matryoshka_doll).</span></span> <span data-ttu-id="70b32-172">Normalerweise erhalten Sie das erwünschte überschreibende Verhalten, ohne dass Sie die Reihenfolge explizit bestimmen müssen.</span><span class="sxs-lookup"><span data-stu-id="70b32-172">You generally get the desired overriding behavior without having to explicitly determine ordering.</span></span>

<span data-ttu-id="70b32-173">Der *nach dem Ereignis* auszuführende Filtercode wird in umgekehrter Reihenfolge zum Code *vor dem Ereignis* ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="70b32-173">As a result of this nesting, the *after* code of filters runs in the reverse order of the *before* code.</span></span> <span data-ttu-id="70b32-174">Die Sequenz sieht folgendermaßen aus:</span><span class="sxs-lookup"><span data-stu-id="70b32-174">The sequence looks like this:</span></span>

* <span data-ttu-id="70b32-175">Der *before*-Code der Filter, die global angewendet werden</span><span class="sxs-lookup"><span data-stu-id="70b32-175">The *before* code of filters applied globally</span></span>
  * <span data-ttu-id="70b32-176">Der *before*-Code der Filter, die auf Controller angewendet werden</span><span class="sxs-lookup"><span data-stu-id="70b32-176">The *before* code of filters applied to controllers</span></span>
    * <span data-ttu-id="70b32-177">Der *before*-Code der Filter, die auf Aktionsmethoden angewendet werden</span><span class="sxs-lookup"><span data-stu-id="70b32-177">The *before* code of filters applied to action methods</span></span>
    * <span data-ttu-id="70b32-178">Der *after*-Code der Filter, die auf Aktionsmethoden angewendet werden</span><span class="sxs-lookup"><span data-stu-id="70b32-178">The *after* code of filters applied to action methods</span></span>
  * <span data-ttu-id="70b32-179">Der *after*-Code der Filter, die auf Controller angewendet werden</span><span class="sxs-lookup"><span data-stu-id="70b32-179">The *after* code of filters applied to controllers</span></span>
* <span data-ttu-id="70b32-180">Der *after*-Code der Filter, die global angewendet werden</span><span class="sxs-lookup"><span data-stu-id="70b32-180">The *after* code of filters applied globally</span></span>
  
<span data-ttu-id="70b32-181">Hier ist ein Beispiel, das die Reihenfolge, in der Filtermethoden für synchrone Aktionsfilter aufgerufen werden, veranschaulicht.</span><span class="sxs-lookup"><span data-stu-id="70b32-181">Here's an example that illustrates the order in which filter methods are called for synchronous Action filters.</span></span>

| <span data-ttu-id="70b32-182">Sequenz</span><span class="sxs-lookup"><span data-stu-id="70b32-182">Sequence</span></span> | <span data-ttu-id="70b32-183">Filterbereich</span><span class="sxs-lookup"><span data-stu-id="70b32-183">Filter scope</span></span> | <span data-ttu-id="70b32-184">Filtermethode</span><span class="sxs-lookup"><span data-stu-id="70b32-184">Filter method</span></span> |
|:--------:|:------------:|:-------------:|
| <span data-ttu-id="70b32-185">1</span><span class="sxs-lookup"><span data-stu-id="70b32-185">1</span></span> | <span data-ttu-id="70b32-186">Global</span><span class="sxs-lookup"><span data-stu-id="70b32-186">Global</span></span> | `OnActionExecuting` |
| <span data-ttu-id="70b32-187">2</span><span class="sxs-lookup"><span data-stu-id="70b32-187">2</span></span> | <span data-ttu-id="70b32-188">Controller</span><span class="sxs-lookup"><span data-stu-id="70b32-188">Controller</span></span> | `OnActionExecuting` |
| <span data-ttu-id="70b32-189">3</span><span class="sxs-lookup"><span data-stu-id="70b32-189">3</span></span> | <span data-ttu-id="70b32-190">Methode</span><span class="sxs-lookup"><span data-stu-id="70b32-190">Method</span></span> | `OnActionExecuting` |
| <span data-ttu-id="70b32-191">4</span><span class="sxs-lookup"><span data-stu-id="70b32-191">4</span></span> | <span data-ttu-id="70b32-192">Methode</span><span class="sxs-lookup"><span data-stu-id="70b32-192">Method</span></span> | `OnActionExecuted` |
| <span data-ttu-id="70b32-193">5</span><span class="sxs-lookup"><span data-stu-id="70b32-193">5</span></span> | <span data-ttu-id="70b32-194">Controller</span><span class="sxs-lookup"><span data-stu-id="70b32-194">Controller</span></span> | `OnActionExecuted` |
| <span data-ttu-id="70b32-195">6</span><span class="sxs-lookup"><span data-stu-id="70b32-195">6</span></span> | <span data-ttu-id="70b32-196">Global</span><span class="sxs-lookup"><span data-stu-id="70b32-196">Global</span></span> | `OnActionExecuted` |

<span data-ttu-id="70b32-197">Diese Sequenz zeigt, dass der Methodenfilter im Controllerfilter geschachtelt ist, und dass der Controllerfilter im globalen Filter geschachtelt ist.</span><span class="sxs-lookup"><span data-stu-id="70b32-197">This sequence shows that the method filter is nested within the controller filter, and the controller filter is nested within the global filter.</span></span> <span data-ttu-id="70b32-198">Anders ausgedrückt: Wenn Sie sich in der Methode On*Stage*ExecutionAsync des asynchronen Filters befinden, werden alle Filter mit einem engeren Bereich ausgeführt, während Ihr Code sich auf dem Stapel befindet.</span><span class="sxs-lookup"><span data-stu-id="70b32-198">To put it another way, if you're inside an async filter's On*Stage*ExecutionAsync method, all of the filters with a tighter scope run while your code is on the stack.</span></span>

> [!NOTE]
> <span data-ttu-id="70b32-199">Jeder Controller, der von der Basisklasse `Controller` erbt, enthält die Methoden `OnActionExecuting` und `OnActionExecuted`.</span><span class="sxs-lookup"><span data-stu-id="70b32-199">Every controller that inherits from the `Controller` base class includes `OnActionExecuting` and `OnActionExecuted` methods.</span></span> <span data-ttu-id="70b32-200">Diese Methode umschließt die Filter, die für eine bestimmte Aktion ausgeführt werden: `OnActionExecuting` wird vor allen anderen Filtern aufgerufen, und `OnActionExecuted` wird nach allen Filtern aufgerufen.</span><span class="sxs-lookup"><span data-stu-id="70b32-200">These methods wrap the filters that run for a given action:  `OnActionExecuting` is called before any of the filters, and `OnActionExecuted` is called after all of the filters.</span></span>

### <a name="overriding-the-default-order"></a><span data-ttu-id="70b32-201">Überschreiben der Standardreihenfolge</span><span class="sxs-lookup"><span data-stu-id="70b32-201">Overriding the default order</span></span>

<span data-ttu-id="70b32-202">Sie können die Standardsequenz der Ausführung überschreiben, indem Sie `IOrderedFilter` implementieren.</span><span class="sxs-lookup"><span data-stu-id="70b32-202">You can override the default sequence of execution by implementing `IOrderedFilter`.</span></span> <span data-ttu-id="70b32-203">Diese Schnittstelle macht die Eigenschaft `Order` verfügbar, die bei der Bestimmung der Ausführungsreihenfolge Vorrang vor dem Bereich hat.</span><span class="sxs-lookup"><span data-stu-id="70b32-203">This interface exposes an `Order` property that takes precedence over scope to determine the order of execution.</span></span> <span data-ttu-id="70b32-204">Bei einem Filter mit einem niedrigeren `Order`-Wert wird der *before*-Code vor dem Code eines Filters mit einem höheren `Order`-Wert ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="70b32-204">A filter with a lower `Order` value will have its *before* code executed before that of a filter with a higher value of `Order`.</span></span> <span data-ttu-id="70b32-205">Bei einem Filter mit einem niedrigeren `Order`-Wert wird der *after*-Code nach dem Code eines Filters mit einem höheren `Order`-Wert ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="70b32-205">A filter with a lower `Order` value will have its *after* code executed after that of a filter with a higher `Order` value.</span></span> <span data-ttu-id="70b32-206">Sie können einen Konstruktorparameter verwenden, um die Eigenschaft `Order` festzulegen:</span><span class="sxs-lookup"><span data-stu-id="70b32-206">You can set the `Order` property by using a constructor parameter:</span></span>

```csharp
[MyFilter(Name = "Controller Level Attribute", Order=1)]
```

<span data-ttu-id="70b32-207">Wenn Sie dieselben drei Aktionsfilter wie im obigen Beispiel verwenden, die Eigenschaft `Order` des Controllers und des globalen Filters jedoch auf jeweils 1 und 2 festlegen, wäre die Ausführungsreihenfolge umgekehrt.</span><span class="sxs-lookup"><span data-stu-id="70b32-207">If you have the same 3 Action filters shown in the preceding example but set the `Order` property of the controller and global filters to 1 and 2 respectively, the order of execution would be reversed.</span></span>

| <span data-ttu-id="70b32-208">Sequenz</span><span class="sxs-lookup"><span data-stu-id="70b32-208">Sequence</span></span> | <span data-ttu-id="70b32-209">Filterbereich</span><span class="sxs-lookup"><span data-stu-id="70b32-209">Filter scope</span></span> | <span data-ttu-id="70b32-210">`Order`-Eigenschaft</span><span class="sxs-lookup"><span data-stu-id="70b32-210">`Order` property</span></span> | <span data-ttu-id="70b32-211">Filtermethode</span><span class="sxs-lookup"><span data-stu-id="70b32-211">Filter method</span></span> |
|:--------:|:------------:|:-----------------:|:-------------:|
| <span data-ttu-id="70b32-212">1</span><span class="sxs-lookup"><span data-stu-id="70b32-212">1</span></span> | <span data-ttu-id="70b32-213">Methode</span><span class="sxs-lookup"><span data-stu-id="70b32-213">Method</span></span> | <span data-ttu-id="70b32-214">0</span><span class="sxs-lookup"><span data-stu-id="70b32-214">0</span></span> | `OnActionExecuting` |
| <span data-ttu-id="70b32-215">2</span><span class="sxs-lookup"><span data-stu-id="70b32-215">2</span></span> | <span data-ttu-id="70b32-216">Controller</span><span class="sxs-lookup"><span data-stu-id="70b32-216">Controller</span></span> | <span data-ttu-id="70b32-217">1</span><span class="sxs-lookup"><span data-stu-id="70b32-217">1</span></span>  | `OnActionExecuting` |
| <span data-ttu-id="70b32-218">3</span><span class="sxs-lookup"><span data-stu-id="70b32-218">3</span></span> | <span data-ttu-id="70b32-219">Global</span><span class="sxs-lookup"><span data-stu-id="70b32-219">Global</span></span> | <span data-ttu-id="70b32-220">2</span><span class="sxs-lookup"><span data-stu-id="70b32-220">2</span></span>  | `OnActionExecuting` |
| <span data-ttu-id="70b32-221">4</span><span class="sxs-lookup"><span data-stu-id="70b32-221">4</span></span> | <span data-ttu-id="70b32-222">Global</span><span class="sxs-lookup"><span data-stu-id="70b32-222">Global</span></span> | <span data-ttu-id="70b32-223">2</span><span class="sxs-lookup"><span data-stu-id="70b32-223">2</span></span>  | `OnActionExecuted` |
| <span data-ttu-id="70b32-224">5</span><span class="sxs-lookup"><span data-stu-id="70b32-224">5</span></span> | <span data-ttu-id="70b32-225">Controller</span><span class="sxs-lookup"><span data-stu-id="70b32-225">Controller</span></span> | <span data-ttu-id="70b32-226">1</span><span class="sxs-lookup"><span data-stu-id="70b32-226">1</span></span>  | `OnActionExecuted` |
| <span data-ttu-id="70b32-227">6</span><span class="sxs-lookup"><span data-stu-id="70b32-227">6</span></span> | <span data-ttu-id="70b32-228">Methode</span><span class="sxs-lookup"><span data-stu-id="70b32-228">Method</span></span> | <span data-ttu-id="70b32-229">0</span><span class="sxs-lookup"><span data-stu-id="70b32-229">0</span></span>  | `OnActionExecuted` |

<span data-ttu-id="70b32-230">Die Eigenschaft `Order` hat eine höhere Priorität als der Bereich bei der Bestimmung der Reihenfolge, in der Filter ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="70b32-230">The `Order` property trumps scope when determining the order in which filters will run.</span></span> <span data-ttu-id="70b32-231">Filter werden erst nach der Reihenfolge sortiert, und dann werden Gleichstände über den Bereich aufgelöst.</span><span class="sxs-lookup"><span data-stu-id="70b32-231">Filters are sorted first by order, then scope is used to break ties.</span></span> <span data-ttu-id="70b32-232">Alle integrierten Filter implementieren `IOrderedFilter` und legen den Standardwert von `Order` auf 0 (null) fest, damit der Bereich die Reihenfolge bestimmt, sofern Sie `Order` auf einen Wert festlegen, der nicht 0 (null) ist.</span><span class="sxs-lookup"><span data-stu-id="70b32-232">All of the built-in filters implement `IOrderedFilter` and set the default `Order` value to 0, so scope determines order unless you set `Order` to a non-zero value.</span></span>

## <a name="cancellation-and-short-circuiting"></a><span data-ttu-id="70b32-233">Abbrechen und Kurzschließen</span><span class="sxs-lookup"><span data-stu-id="70b32-233">Cancellation and short circuiting</span></span>

<span data-ttu-id="70b32-234">Sie können die Filterpipeline jederzeit kurzschließen, indem Sie die Eigenschaft `Result` auf den Parameter `context` in der Filtermethode festlegen.</span><span class="sxs-lookup"><span data-stu-id="70b32-234">You can short-circuit the filter pipeline at any point by setting the `Result` property on the `context` parameter provided to the filter method.</span></span> <span data-ttu-id="70b32-235">Zum Beispiel verhindert der folgende Ressourcenfilter, dass der Rest der Pipeline ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="70b32-235">For instance, the following Resource filter prevents the rest of the pipeline from executing.</span></span>

<a name="short-circuiting-resource-filter"></a>

[!code-csharp[Main](./filters/sample/src/FiltersSample/Filters/ShortCircuitingResourceFilterAttribute.cs?highlight=12,13,14,15)]

<span data-ttu-id="70b32-236">Im folgenden Code verwenden sowohl der Filter `ShortCircuitingResourceFilter` und der Filter `AddHeader` die Aktionsmethode `SomeResource` als Ziel.</span><span class="sxs-lookup"><span data-stu-id="70b32-236">In the following code, both the `ShortCircuitingResourceFilter` and the `AddHeader` filter target the `SomeResource` action method.</span></span> <span data-ttu-id="70b32-237">Da `ShortCircuitingResourceFilter` allerdings zuerst ausgeführt wird (weil es ein Ressourcenfilter und `AddHeader` ein Aktionsfilter ist) und die restliche Pipeline kurzschließt, wird der Filter `AddHeader` nicht für die Aktion `SomeResource` ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="70b32-237">However, because the `ShortCircuitingResourceFilter` runs first (because it's a Resource Filter and `AddHeader` is an Action Filter) and short-circuits the rest of the pipeline, the `AddHeader` filter never runs for the `SomeResource` action.</span></span> <span data-ttu-id="70b32-238">Dieses Verhalten wäre unverändert, wenn beide Filter auf Aktionsmethodenebene angewandt werden würden, wenn `ShortCircuitingResourceFilter` zuerst ausgeführt wird (z.B. wegen seines Filtertyps oder expliziter Verwendung der Eigenschaft `Order`).</span><span class="sxs-lookup"><span data-stu-id="70b32-238">This behavior would be the same if both filters were applied at the action method level, provided the `ShortCircuitingResourceFilter` ran first (because of its filter type, or explicit use of `Order` property, for instance).</span></span>

[!code-csharp[Main](./filters/sample/src/FiltersSample/Controllers/SampleController.cs?name=snippet_AddHeader&highlight=1,9)]

## <a name="dependency-injection"></a><span data-ttu-id="70b32-239">Dependency Injection</span><span class="sxs-lookup"><span data-stu-id="70b32-239">Dependency injection</span></span>

<span data-ttu-id="70b32-240">Filter können nach Typ oder Instanz hinzugefügt werden.</span><span class="sxs-lookup"><span data-stu-id="70b32-240">Filters can be added by type or by instance.</span></span> <span data-ttu-id="70b32-241">Wenn Sie eine Instanz hinzufügen, wird diese Instanz für jede Anforderung verwendet.</span><span class="sxs-lookup"><span data-stu-id="70b32-241">If you add an instance, that instance will be used for every request.</span></span> <span data-ttu-id="70b32-242">Wenn Sie einen Typ hinzufügen, wird der Filter typ-aktiviert, d.h. für jede Anforderung wird eine Instanz erstellt, und alle Konstruktorabhängigkeiten werden durch [Dependency Injection](../../fundamentals/dependency-injection.md) (DI) aufgefüllt.</span><span class="sxs-lookup"><span data-stu-id="70b32-242">If you add a type, it will be type-activated, meaning an instance will be created for each request and any constructor dependencies will be populated by [dependency injection](../../fundamentals/dependency-injection.md) (DI).</span></span> <span data-ttu-id="70b32-243">Das Hinzufügen eines Filters über einen Typ entspricht `filters.Add(new TypeFilterAttribute(typeof(MyFilter)))`.</span><span class="sxs-lookup"><span data-stu-id="70b32-243">Adding a filter by type is equivalent to `filters.Add(new TypeFilterAttribute(typeof(MyFilter)))`.</span></span>

<span data-ttu-id="70b32-244">Filter, die als Attribute implementiert und Controllerklassen oder Aktionsmethoden direkt hinzugefügt werden, können keine Konstruktorabhängigkeiten von [Dependency Injection](../../fundamentals/dependency-injection.md) (DI) erhalten.</span><span class="sxs-lookup"><span data-stu-id="70b32-244">Filters that are implemented as attributes and added directly to controller classes or action methods cannot have constructor dependencies provided by [dependency injection](../../fundamentals/dependency-injection.md) (DI).</span></span> <span data-ttu-id="70b32-245">Dies liegt daran, dass die Konstruktorparameter für Attribute dort bereitgestellt werden müssen, wo sie angewendet werden.</span><span class="sxs-lookup"><span data-stu-id="70b32-245">This is because attributes must have their constructor parameters supplied where they're applied.</span></span> <span data-ttu-id="70b32-246">Dies ist eine Einschränkung der Funktionsweise von Attributen.</span><span class="sxs-lookup"><span data-stu-id="70b32-246">This is a limitation of how attributes work.</span></span>

<span data-ttu-id="70b32-247">Wenn Ihre Filter Abhängigkeiten enthalten, die Sie von DI beziehen, gibt es mehrere unterstützte Ansätze.</span><span class="sxs-lookup"><span data-stu-id="70b32-247">If your filters have dependencies that you need to access from DI, there are several supported approaches.</span></span> <span data-ttu-id="70b32-248">Sie können Ihren Filter auf eine Klasse oder eine Aktionsmethode anwenden, indem Sie eine der folgenden Methoden verwenden:</span><span class="sxs-lookup"><span data-stu-id="70b32-248">You can apply your filter to a class or action method using one of the following:</span></span>

* `ServiceFilterAttribute`
* `TypeFilterAttribute`
* <span data-ttu-id="70b32-249">`IFilterFactory` in Ihrem Attribut implementiert</span><span class="sxs-lookup"><span data-stu-id="70b32-249">`IFilterFactory` implemented on your attribute</span></span>

> [!NOTE]
> <span data-ttu-id="70b32-250">Sie sollten die Protokollierung von DI verwenden.</span><span class="sxs-lookup"><span data-stu-id="70b32-250">One dependency you might want to get from DI is a logger.</span></span> <span data-ttu-id="70b32-251">Es wird jedoch empfohlen, dass Sie vermeiden, Filter ausschließlich für die Protokollierung zu erstellen und zu verwenden, da [integrierte Frameworkprotokollierungsfeatures](xref:fundamentals/logging/index) möglicherweise bereits das enthalten, was Sie brauchen.</span><span class="sxs-lookup"><span data-stu-id="70b32-251">However, avoid creating and using filters purely for logging purposes, since the [built-in framework logging features](xref:fundamentals/logging/index) may already provide what you need.</span></span> <span data-ttu-id="70b32-252">Wenn Sie Ihren Filtern die Protokollierung hinzufügen, sollten diese sich auf Probleme mit Geschäftsdomänen oder auf das spezifische Verhalten Ihres Filters beziehen anstelle von MVC-Aktionen oder anderen Frameworkereignissen.</span><span class="sxs-lookup"><span data-stu-id="70b32-252">If you're going to add logging to your filters, it should focus on business domain concerns or behavior specific to your filter, rather than MVC actions or other framework events.</span></span>

### <a name="servicefilterattribute"></a><span data-ttu-id="70b32-253">ServiceFilterAttribute</span><span class="sxs-lookup"><span data-stu-id="70b32-253">ServiceFilterAttribute</span></span>

<span data-ttu-id="70b32-254">Ein `ServiceFilter` ruft eine Instanz des Filter von DI ab.</span><span class="sxs-lookup"><span data-stu-id="70b32-254">A `ServiceFilter` retrieves an instance of the filter from DI.</span></span> <span data-ttu-id="70b32-255">Fügen Sie dem Container den Filter in `ConfigureServices` hinzu, und verweisen Sie auf ihn in einem `ServiceFilter`-Attribut.</span><span class="sxs-lookup"><span data-stu-id="70b32-255">You add the filter to the container in `ConfigureServices`, and reference it in a `ServiceFilter` attribute</span></span>

[!code-csharp[Main](./filters/sample/src/FiltersSample/Startup.cs?name=snippet_ConfigureServices&highlight=11)]

[!code-csharp[Main](../../mvc/controllers/filters/sample/src/FiltersSample/Controllers/HomeController.cs?name=snippet_ServiceFilter&highlight=1)]

<span data-ttu-id="70b32-256">Die Verwendung von `ServiceFilter` ohne Registrierung der Filtertypergebnisse löst eine Ausnahme aus:</span><span class="sxs-lookup"><span data-stu-id="70b32-256">Using `ServiceFilter` without registering the filter type results in an exception:</span></span>

```
System.InvalidOperationException: No service for type
'FiltersSample.Filters.AddHeaderFilterWithDI' has been registered.
```

<span data-ttu-id="70b32-257">Durch `ServiceFilterAttribute` wird `IFilterFactory` implementiert, wodurch eine einzelne Methode für die Erstellung einer `IFilter`-Instanz verfügbar gemacht wird.</span><span class="sxs-lookup"><span data-stu-id="70b32-257">`ServiceFilterAttribute` implements `IFilterFactory`, which exposes a single method for creating an `IFilter` instance.</span></span> <span data-ttu-id="70b32-258">Im Fall von `ServiceFilterAttribute` wird die Methode `CreateInstance` der Schnittstelle `IFilterFactory` implementiert, um den angegebenen Typ des Dienstecontainers (DI) zu laden.</span><span class="sxs-lookup"><span data-stu-id="70b32-258">In the case of `ServiceFilterAttribute`, the `IFilterFactory` interface's `CreateInstance` method is implemented to load the specified type from the services container (DI).</span></span>

### <a name="typefilterattribute"></a><span data-ttu-id="70b32-259">TypeFilterAttribute</span><span class="sxs-lookup"><span data-stu-id="70b32-259">TypeFilterAttribute</span></span>

<span data-ttu-id="70b32-260">`TypeFilterAttribute` ähnelt `ServiceFilterAttribute` (und implementiert ebenfalls `IFilterFactory`), aber sein Typ wird nicht direkt vom DI-Container aufgelöst.</span><span class="sxs-lookup"><span data-stu-id="70b32-260">`TypeFilterAttribute` is very similar to `ServiceFilterAttribute` (and also implements `IFilterFactory`), but its type isn't resolved directly from the DI container.</span></span> <span data-ttu-id="70b32-261">Stattdessen wird der Typ mithilfe von `Microsoft.Extensions.DependencyInjection.ObjectFactory` instanziiert.</span><span class="sxs-lookup"><span data-stu-id="70b32-261">Instead, it instantiates the type by using `Microsoft.Extensions.DependencyInjection.ObjectFactory`.</span></span>

<span data-ttu-id="70b32-262">Aufgrund dieses Unterschieds müssen Typen, auf die mithilfe von `TypeFilterAttribute` verwiesen wird, nicht zuerst im Container registriert werden (dennoch werden ihre Abhängigkeiten vom Container erfüllt).</span><span class="sxs-lookup"><span data-stu-id="70b32-262">Because of this difference, types that are referenced using the `TypeFilterAttribute` don't need to be registered with the container first (but they will still have their dependencies fulfilled by the container).</span></span> <span data-ttu-id="70b32-263">Darüber hinaus kann `TypeFilterAttribute` Konstruktorargumente optional für den betreffenden Typ akzeptieren.</span><span class="sxs-lookup"><span data-stu-id="70b32-263">Also, `TypeFilterAttribute` can optionally accept constructor arguments for the type in question.</span></span> <span data-ttu-id="70b32-264">Das folgende Beispiel demonstriert, wie Sie Argumente durch Verwendung von `TypeFilterAttribute` an einen Typ übergeben:</span><span class="sxs-lookup"><span data-stu-id="70b32-264">The following example demonstrates how to pass arguments to a type using `TypeFilterAttribute`:</span></span>

[!code-csharp[Main](../../mvc/controllers/filters/sample/src/FiltersSample/Controllers/HomeController.cs?name=snippet_TypeFilter&highlight=1,2)]

<span data-ttu-id="70b32-265">Wenn Sie einen Filter haben, der keine Argumente benötigt, aber Konstruktorabhängigkeiten besitzt, die durch DI erfüllt werden müssen, können Sie Ihr eigenes benanntes Attribut auf Klassen und Methoden anwenden (anstelle von `[TypeFilter(typeof(FilterType))]`).</span><span class="sxs-lookup"><span data-stu-id="70b32-265">If you have a filter that doesn't require any arguments, but which has constructor dependencies that need to be filled by DI, you can use your own named attribute on classes and methods instead of `[TypeFilter(typeof(FilterType))]`).</span></span> <span data-ttu-id="70b32-266">Im folgenden Filter wird gezeigt, wie dies implementiert werden kann:</span><span class="sxs-lookup"><span data-stu-id="70b32-266">The following filter shows how this can be implemented:</span></span>

[!code-csharp[Main](./filters/sample/src/FiltersSample/Filters/SampleActionFilterAttribute.cs?name=snippet_TypeFilterAttribute&highlight=1,3,7)]

<span data-ttu-id="70b32-267">Dieser Filter kann mithilfe der Syntax `[SampleActionFilter]` auf Klassen oder Methoden angewendet werden, um nicht `[TypeFilter]` oder `[ServiceFilter]` verwenden zu müssen.</span><span class="sxs-lookup"><span data-stu-id="70b32-267">This filter can be applied to classes or methods using the `[SampleActionFilter]` syntax, instead of having to use `[TypeFilter]` or `[ServiceFilter]`.</span></span>

## <a name="authorization-filters"></a><span data-ttu-id="70b32-268">Autorisierungsfilter</span><span class="sxs-lookup"><span data-stu-id="70b32-268">Authorization filters</span></span>

<span data-ttu-id="70b32-269">*Autorisierungsfilter* steuern den Zugriff auf Aktionsmethoden und sind die ersten Filter, die in der Filterpipeline ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="70b32-269">*Authorization filters* control access to action methods and are the first filters to be executed within the filter pipeline.</span></span> <span data-ttu-id="70b32-270">Sie haben nur eine before-Methode, im Gegensatz zu den meisten Filtern, die before- und after-Methoden unterstützen.</span><span class="sxs-lookup"><span data-stu-id="70b32-270">They have only a before method, unlike most filters that support before and after methods.</span></span> <span data-ttu-id="70b32-271">Sie sollten nur einen eigenen Autorisierungsfilter schreiben, wenn Sie Ihr eigenes Autorisierungsframework schreiben.</span><span class="sxs-lookup"><span data-stu-id="70b32-271">You should only write a custom authorization filter if you are writing your own authorization framework.</span></span> <span data-ttu-id="70b32-272">Statt einen benutzerdefinierten Filter zu schreiben, wird empfohlen, dass Sie Ihre Autorisierungsrichtlinien konfigurieren oder eine benutzerdefinierte Autorisierungsrichtlinie schreiben.</span><span class="sxs-lookup"><span data-stu-id="70b32-272">Prefer configuring your authorization policies or writing a custom authorization policy over writing a custom filter.</span></span> <span data-ttu-id="70b32-273">Die Implementierung eines integrierten Filters ist nur für das Aufrufen des Autorisierungssystems zuständig.</span><span class="sxs-lookup"><span data-stu-id="70b32-273">The built-in filter implementation is just responsible for calling the authorization system.</span></span>

<span data-ttu-id="70b32-274">Beachten Sie, dass Sie Ausnahmen nicht innerhalb von Autorisierungsfiltern auslösen sollten, da die Ausnahme dann nicht behandeln würde (Ausnahmefilter behandeln sie nicht).</span><span class="sxs-lookup"><span data-stu-id="70b32-274">Note that you shouldn't throw exceptions within authorization filters, since nothing will handle the exception (exception filters won't handle them).</span></span> <span data-ttu-id="70b32-275">Verwenden Sie stattdessen eine Abfrage, oder finden Sie einen anderen Weg.</span><span class="sxs-lookup"><span data-stu-id="70b32-275">Instead, issue a challenge or find another way.</span></span>

<span data-ttu-id="70b32-276">Weitere Informationen finden Sie unter [Autorisierung](../../security/authorization/index.md).</span><span class="sxs-lookup"><span data-stu-id="70b32-276">Learn more about [Authorization](../../security/authorization/index.md).</span></span>

## <a name="resource-filters"></a><span data-ttu-id="70b32-277">Ressourcenfilter</span><span class="sxs-lookup"><span data-stu-id="70b32-277">Resource filters</span></span>

<span data-ttu-id="70b32-278">*Ressourcenfilter* implementieren entweder die `IResourceFilter`- oder `IAsyncResourceFilter`-Schnittstelle, und ihre Ausführung umschließt einen Großteil der Filterpipeline.</span><span class="sxs-lookup"><span data-stu-id="70b32-278">*Resource filters* implement either the `IResourceFilter` or `IAsyncResourceFilter` interface, and their execution wraps most of the filter pipeline.</span></span> <span data-ttu-id="70b32-279">(Nur [Autorisierungsfilter](#authorization-filters) werden vor ihnen ausgeführt.) Ressourcenfilter sind besonders nützlich, wenn Sie die meiste Arbeit einer Anforderung kurzschließen müssen.</span><span class="sxs-lookup"><span data-stu-id="70b32-279">(Only [Authorization filters](#authorization-filters) run before them.) Resource filters are especially useful if you need to short-circuit most of the work a request is doing.</span></span> <span data-ttu-id="70b32-280">Ein zwischenspeichernder Filter kann z.B. den Rest der Pipeline umgehen, wenn die Antwort sich bereits im Cache befindet.</span><span class="sxs-lookup"><span data-stu-id="70b32-280">For example, a caching filter can avoid the rest of the pipeline if the response is already in the cache.</span></span>

<span data-ttu-id="70b32-281">Der weiter oben dargestellte [kurzschließende Ressourcenfilter](#short-circuiting-resource-filter) ist ein Beispiel für einen Ressourcenfilter.</span><span class="sxs-lookup"><span data-stu-id="70b32-281">The [short circuiting resource filter](#short-circuiting-resource-filter) shown earlier is one example of a resource filter.</span></span> <span data-ttu-id="70b32-282">Ein weiteres Beispiel ist [DisableFormValueModelBindingAttribute](https://github.com/aspnet/Entropy/blob/rel/1.1.1/samples/Mvc.FileUpload/Filters/DisableFormValueModelBindingAttribute.cs), was verhindert, dass die Modellbindung auf Formulardaten zugreift.</span><span class="sxs-lookup"><span data-stu-id="70b32-282">Another example is [DisableFormValueModelBindingAttribute](https://github.com/aspnet/Entropy/blob/rel/1.1.1/samples/Mvc.FileUpload/Filters/DisableFormValueModelBindingAttribute.cs), which prevents model binding from accessing the form data.</span></span> <span data-ttu-id="70b32-283">Es ist nützlich, wenn Sie wissen, dass Sie große Dateiuploads erhalten werden, und verhindern wollen, dass das Formular in den Arbeitsspeicher gelesen wird.</span><span class="sxs-lookup"><span data-stu-id="70b32-283">It's useful for cases where you know that you're going to receive large file uploads and want to prevent the form from being read into memory.</span></span>

## <a name="action-filters"></a><span data-ttu-id="70b32-284">Aktionsfilter</span><span class="sxs-lookup"><span data-stu-id="70b32-284">Action filters</span></span>

<span data-ttu-id="70b32-285">*Aktionsfilter* implementieren entweder die `IActionFilter`- oder `IAsyncActionFilter`-Schnittstelle, und ihre Ausführung umgibt die Ausführung von Aktionsmethoden.</span><span class="sxs-lookup"><span data-stu-id="70b32-285">*Action filters* implement either the `IActionFilter` or `IAsyncActionFilter` interface, and their execution surrounds the execution of action methods.</span></span>

<span data-ttu-id="70b32-286">Hier ist ein Beispiel für einen Aktionsfilter:</span><span class="sxs-lookup"><span data-stu-id="70b32-286">Here's a sample action filter:</span></span>

[!code-csharp[Main](./filters/sample/src/FiltersSample/Filters/SampleActionFilter.cs?name=snippet_ActionFilter)]

<span data-ttu-id="70b32-287">[ActionExecutingContext](https://docs.microsoft.com/aspnet/core/api/microsoft.aspnetcore.mvc.filters.actionexecutingcontext) stellt die folgenden Eigenschaften zur Verfügung:</span><span class="sxs-lookup"><span data-stu-id="70b32-287">The [ActionExecutingContext](https://docs.microsoft.com/aspnet/core/api/microsoft.aspnetcore.mvc.filters.actionexecutingcontext) provides the following properties:</span></span>

* <span data-ttu-id="70b32-288">`ActionArguments` erlaubt Ihnen, die Bearbeitung der Eingaben in die Aktion.</span><span class="sxs-lookup"><span data-stu-id="70b32-288">`ActionArguments` - lets you manipulate the inputs to the action.</span></span>
* <span data-ttu-id="70b32-289">`Controller` erlaubt Ihnen die Bearbeitung der Controllerinstanz.</span><span class="sxs-lookup"><span data-stu-id="70b32-289">`Controller` - lets you manipulate the controller instance.</span></span> 
* <span data-ttu-id="70b32-290">`Result` schließt die Ausführung der Aktionsmethode und nachfolgende Aktionsfilter kurz.</span><span class="sxs-lookup"><span data-stu-id="70b32-290">`Result` - setting this short-circuits execution of the action method and subsequent action filters.</span></span> <span data-ttu-id="70b32-291">Eine Ausnahme auszulösen verhindert auch die Ausführung der Aktionsmethode und nachfolgender Filter, wird jedoch wie ein Fehler behandelt, und nicht wie ein erfolgreiches Ergebnis.</span><span class="sxs-lookup"><span data-stu-id="70b32-291">Throwing an exception also prevents execution of the action method and subsequent filters, but is treated as a failure instead of a successful result.</span></span>

<span data-ttu-id="70b32-292">[ActionExecutedContext](https://docs.microsoft.com/aspnet/core/api/microsoft.aspnetcore.mvc.filters.actionexecutedcontext) stellt `Controller` und `Result` sowie folgende Eigenschaften zur Verfügung:</span><span class="sxs-lookup"><span data-stu-id="70b32-292">The [ActionExecutedContext](https://docs.microsoft.com/aspnet/core/api/microsoft.aspnetcore.mvc.filters.actionexecutedcontext) provides `Controller` and `Result` plus the following properties:</span></span>

* <span data-ttu-id="70b32-293">`Canceled` ist TRUE, wenn die Aktionsausführung durch einen anderen Filter kurzgeschlossen wurde.</span><span class="sxs-lookup"><span data-stu-id="70b32-293">`Canceled` - will be true if the action execution was short-circuited by another filter.</span></span>
* <span data-ttu-id="70b32-294">`Exception` ist ungleich NULL, wenn die Aktion oder ein nachfolgender Aktionsfilter eine Ausnahme ausgelöst hat.</span><span class="sxs-lookup"><span data-stu-id="70b32-294">`Exception` - will be non-null if the action or a subsequent action filter threw an exception.</span></span> <span data-ttu-id="70b32-295">Diese Eigenschaft auf NULL zu setzen, „behandelt“ eine Ausnahme, und `Result` wird ausgeführt, als ob es standardgemäß von der Aktionsmethode zurückgegeben wurde.</span><span class="sxs-lookup"><span data-stu-id="70b32-295">Setting this property to null effectively 'handles' an exception, and `Result` will be executed as if it were returned from the action method normally.</span></span>

<span data-ttu-id="70b32-296">Bei einem `IAsyncActionFilter` führt ein Aufruf von `ActionExecutionDelegate` alle nachfolgenden Aktionsfilter und die Aktionsmethode aus und gibt `ActionExecutedContext` zurück.</span><span class="sxs-lookup"><span data-stu-id="70b32-296">For an `IAsyncActionFilter`, a call to the `ActionExecutionDelegate` executes any subsequent action filters and the action method, returning an `ActionExecutedContext`.</span></span> <span data-ttu-id="70b32-297">Weisen Sie einer Ergebnisinstanz `ActionExecutingContext.Result` zu, und rufen Sie nicht `ActionExecutionDelegate` auf, um die Pipeline kurzzuschließen.</span><span class="sxs-lookup"><span data-stu-id="70b32-297">To short-circuit, assign `ActionExecutingContext.Result` to some result instance and don't call the `ActionExecutionDelegate`.</span></span>

<span data-ttu-id="70b32-298">Das Framework stellt ein abstraktes `ActionFilterAttribute` bereit, dass Sie als Unterklasse verwenden können.</span><span class="sxs-lookup"><span data-stu-id="70b32-298">The framework provides an abstract `ActionFilterAttribute` that you can subclass.</span></span> 

<span data-ttu-id="70b32-299">Sie können einen Aktionsfilter verwenden, um den Modellstatus automatisch zu überprüfen und Fehler zurückzugeben, wenn der Status ungültig ist:</span><span class="sxs-lookup"><span data-stu-id="70b32-299">You can use an action filter to automatically validate model state and return any errors if the state is invalid:</span></span>

[!code-csharp[Main](./filters/sample/src/FiltersSample/Filters/ValidateModelAttribute.cs)]

<span data-ttu-id="70b32-300">Die Methode `OnActionExecuted` wird nach der Aktionsmethode ausgeführt, und sie kann die Ergebnisse der Aktion durch die Eigenschaft `ActionExecutedContext.Result` sehen und bearbeiten.</span><span class="sxs-lookup"><span data-stu-id="70b32-300">The `OnActionExecuted` method runs after the action method and can see and manipulate the results of the action through the `ActionExecutedContext.Result` property.</span></span> <span data-ttu-id="70b32-301">`ActionExecutedContext.Canceled` wird auf TRUE festgelegt, wenn die Ausführung der Aktion durch einen anderen Filter kurzgeschlossen wurde.</span><span class="sxs-lookup"><span data-stu-id="70b32-301">`ActionExecutedContext.Canceled` will be set to true if the action execution was short-circuited by another filter.</span></span> <span data-ttu-id="70b32-302">`ActionExecutedContext.Exception` wird auf einen Wert festgelegt, der ungleich NULL ist, wenn eine Aktion oder ein nachfolgender Aktionsfilter eine Ausnahme ausgelöst hat.</span><span class="sxs-lookup"><span data-stu-id="70b32-302">`ActionExecutedContext.Exception` will be set to a non-null value if the action or a subsequent action filter threw an exception.</span></span> <span data-ttu-id="70b32-303">`ActionExecutedContext.Exception` auf NULL zu setzen, „behandelt“ eine Ausnahme, und `ActionExectedContext.Result` wird dann ausgeführt, als ob es standardgemäß von der Aktionsmethode zurückgegeben wurde.</span><span class="sxs-lookup"><span data-stu-id="70b32-303">Setting `ActionExecutedContext.Exception` to null effectively 'handles' an exception, and `ActionExectedContext.Result` will then be executed as if it were returned from the action method normally.</span></span>

## <a name="exception-filters"></a><span data-ttu-id="70b32-304">Ausnahmefilter</span><span class="sxs-lookup"><span data-stu-id="70b32-304">Exception filters</span></span>

<span data-ttu-id="70b32-305">*Ausnahmefilter* implementieren entweder die `IExceptionFilter`- oder `IAsyncExceptionFilter`-Schnittstelle.</span><span class="sxs-lookup"><span data-stu-id="70b32-305">*Exception filters* implement either the `IExceptionFilter` or `IAsyncExceptionFilter` interface.</span></span> <span data-ttu-id="70b32-306">Sie können verwendet werden, um gängige Fehlerbehandlungsrichtlinien für eine App zu implementieren.</span><span class="sxs-lookup"><span data-stu-id="70b32-306">They can be used to implement common error handling policies for an app.</span></span> 

<span data-ttu-id="70b32-307">Der folgende Beispielausnahmefilter verwendet eine benutzerdefinierte Fehleransicht für Entwickler, um Details über Ausnahmen anzuzeigen, die auftreten, wenn die Anwendung sich in der Entwicklung befindet:</span><span class="sxs-lookup"><span data-stu-id="70b32-307">The following sample exception filter uses a custom developer error view to display details about exceptions that occur when the application is in development:</span></span>

[!code-csharp[Main](./filters/sample/src/FiltersSample/Filters/CustomExceptionFilterAttribute.cs?name=snippet_ExceptionFilter&highlight=1,14)]

<span data-ttu-id="70b32-308">Ausnahmefilter besitzen keine zwei Ereignisse (für „before“ und „after“) – sie implementieren nur `OnException` (oder `OnExceptionAsync`).</span><span class="sxs-lookup"><span data-stu-id="70b32-308">Exception filters don't have two events (for before and after) - they only implement `OnException` (or `OnExceptionAsync`).</span></span> 

<span data-ttu-id="70b32-309">Ausnahmefilter behandeln unbehandelte Ausnahmen, die bei der Controllererstellung, [Modellbindung](../models/model-binding.md), Aktionsfiltern oder bei Aktionsmethoden auftreten.</span><span class="sxs-lookup"><span data-stu-id="70b32-309">Exception filters handle unhandled exceptions that occur in controller creation, [model binding](../models/model-binding.md), action filters, or action methods.</span></span> <span data-ttu-id="70b32-310">Sie erfassen keine Ausnahmen, die in Ressourcenfiltern, Ergebnisfiltern oder bei der Ausführung von MVC-Ergebnissen auftreten.</span><span class="sxs-lookup"><span data-stu-id="70b32-310">They won't catch exceptions that occur in Resource filters, Result filters, or MVC Result execution.</span></span>

<span data-ttu-id="70b32-311">Legen Sie die Eigenschaft `ExceptionContext.ExceptionHandled` auf TRUE fest, oder schreiben Sie eine Antwort, um eine Ausnahme zu behandeln.</span><span class="sxs-lookup"><span data-stu-id="70b32-311">To handle an exception, set the `ExceptionContext.ExceptionHandled` property to true or write a response.</span></span> <span data-ttu-id="70b32-312">Dadurch wird die Weitergabe der Ausnahme beendet.</span><span class="sxs-lookup"><span data-stu-id="70b32-312">This stops propagation of the exception.</span></span> <span data-ttu-id="70b32-313">Beachten Sie, dass ein Ausnahmefilter eine Ausnahme nicht in einen „Erfolg“ umwandeln kann.</span><span class="sxs-lookup"><span data-stu-id="70b32-313">Note that an Exception filter can't turn an exception into a "success".</span></span> <span data-ttu-id="70b32-314">Nur ein Aktionsfilter kann das.</span><span class="sxs-lookup"><span data-stu-id="70b32-314">Only an Action filter can do that.</span></span>

> [!NOTE]
> <span data-ttu-id="70b32-315">In ASP.NET 1.1 wird die Antwort nicht gesendet, wenn Sie `ExceptionHandled` auf TRUE festlegen **und** eine Antwort schreiben.</span><span class="sxs-lookup"><span data-stu-id="70b32-315">In ASP.NET 1.1, the response isn't sent if you set `ExceptionHandled` to true **and** write a response.</span></span> <span data-ttu-id="70b32-316">In diesem Szenario sendet ASP.NET Core 1.0 die Antwort und ASP.NET Core 1.1.2 kehrt zum Verhalten von 1.0 zurück.</span><span class="sxs-lookup"><span data-stu-id="70b32-316">In that scenario, ASP.NET Core 1.0 does send the response, and ASP.NET Core 1.1.2 will return to the 1.0 behavior.</span></span> <span data-ttu-id="70b32-317">Weitere Informationen finden Sie unter [Problem #5594](https://github.com/aspnet/Mvc/issues/5594) im GitHub-Repository.</span><span class="sxs-lookup"><span data-stu-id="70b32-317">For more information, see [issue #5594](https://github.com/aspnet/Mvc/issues/5594) in the GitHub repository.</span></span> 

<span data-ttu-id="70b32-318">Ausnahmefilter eignen sich zum Auffangen von Ausnahmen, die in MVC-Aktionen auftreten. Sie sind jedoch nicht so flexibel wie Middleware für die Fehlerbehandlung.</span><span class="sxs-lookup"><span data-stu-id="70b32-318">Exception filters are good for trapping exceptions that occur within MVC actions, but they're not as flexible as error handling middleware.</span></span> <span data-ttu-id="70b32-319">Es wird empfohlen, dass Sie Middleware für allgemeine Fälle vorziehen und Filter nur dann verwenden, wenn Sie die Fehlerbehandlung *auf einem anderen Weg* angehen müssen, je nachdem, welche MVC-Aktion gewählt wurde.</span><span class="sxs-lookup"><span data-stu-id="70b32-319">Prefer middleware for the general case, and use filters only where you need to do error handling *differently* based on which MVC action was chosen.</span></span> <span data-ttu-id="70b32-320">Zum Beispiel besitzt Ihre App möglicherweise Aktionsmethoden für beide API-Endpunkte und für Ansichten bzw. HTML.</span><span class="sxs-lookup"><span data-stu-id="70b32-320">For example, your app might have action methods for both API endpoints and for views/HTML.</span></span> <span data-ttu-id="70b32-321">Die API-Endpunkte können Fehlerinformationen als JSON zurückgeben, während ansichtsbasierte Aktionen eine Fehlerseite als HTML zurückgeben können.</span><span class="sxs-lookup"><span data-stu-id="70b32-321">The API endpoints could return error information as JSON, while the view-based actions could return an error page as HTML.</span></span>

<span data-ttu-id="70b32-322">Das Framework stellt ein abstraktes `ExceptionFilterAttribute` bereit, dass Sie als Unterklasse verwenden können.</span><span class="sxs-lookup"><span data-stu-id="70b32-322">The framework provides an abstract `ExceptionFilterAttribute` that you can subclass.</span></span> 

## <a name="result-filters"></a><span data-ttu-id="70b32-323">Ergebnisfilter</span><span class="sxs-lookup"><span data-stu-id="70b32-323">Result filters</span></span>

<span data-ttu-id="70b32-324">*Ergebnisfilter* implementieren entweder die `IResultFilter`- oder `IAsyncResultFilter`-Schnittstelle, und ihre Ausführung umgibt die Ausführung von Aktionsergebnissen.</span><span class="sxs-lookup"><span data-stu-id="70b32-324">*Result filters* implement either the `IResultFilter` or `IAsyncResultFilter` interface, and their execution surrounds the execution of action results.</span></span> 

<span data-ttu-id="70b32-325">Hier ist ein Beispiel für einen Ergebnisfilter, der einen HTTP-Header hinzufügt.</span><span class="sxs-lookup"><span data-stu-id="70b32-325">Here's an example of a Result filter that adds an HTTP header.</span></span>

[!code-csharp[Main](./filters/sample/src/FiltersSample/Filters/LoggingAddHeaderFilter.cs?name=snippet_ResultFilter)]

<span data-ttu-id="70b32-326">Die Art des Ergebnisses, das ausgeführt wird, hängt von der jeweiligen Aktion ab.</span><span class="sxs-lookup"><span data-stu-id="70b32-326">The kind of result being executed depends on the action in question.</span></span> <span data-ttu-id="70b32-327">Eine MVC-Aktion, die eine Ansicht zurückgibt, würde alle Razor-Verarbeitungen als Teil der Ausführung von `ViewResult` beinhalten.</span><span class="sxs-lookup"><span data-stu-id="70b32-327">An MVC action returning a view would include all razor processing as part of the `ViewResult` being executed.</span></span> <span data-ttu-id="70b32-328">Eine API-Methode führt möglicherweise eine Art Serialisierung als Teil der Ausführung des Ergebnisses durch.</span><span class="sxs-lookup"><span data-stu-id="70b32-328">An API method might perform some serialization as part of the execution of the result.</span></span> <span data-ttu-id="70b32-329">Weitere Informationen zu [Aktionsergebnissen](actions.md)</span><span class="sxs-lookup"><span data-stu-id="70b32-329">Learn more about [action results](actions.md)</span></span>

<span data-ttu-id="70b32-330">Ergebnisfilter werden nur für erfolgreiche Ergebnisse ausgeführt, wenn also die Aktion oder Aktionsfilter ein Aktionsergebnis erzeugen.</span><span class="sxs-lookup"><span data-stu-id="70b32-330">Result filters are only executed for successful results - when the action or action filters produce an action result.</span></span> <span data-ttu-id="70b32-331">Ergebnisfilter werden nicht ausgeführt, wenn Ausnahmefilter eine Ausnahme behandeln.</span><span class="sxs-lookup"><span data-stu-id="70b32-331">Result filters are not executed when exception filters handle an exception.</span></span>

<span data-ttu-id="70b32-332">Die Methode `OnResultExecuting` kann die Ausführung des Aktionsergebnisses und nachfolgende Ergebnisfilter durch Festlegen von `ResultExecutingContext.Cancel` auf TRUE kurzschließen.</span><span class="sxs-lookup"><span data-stu-id="70b32-332">The `OnResultExecuting` method can short-circuit execution of the action result and subsequent result filters by setting `ResultExecutingContext.Cancel` to true.</span></span> <span data-ttu-id="70b32-333">Im Allgemeinen sollten Sie beim Kurzschließen an das Antwortobjekt schreiben, um das Erstellen einer leeren Antwort zu vermeiden.</span><span class="sxs-lookup"><span data-stu-id="70b32-333">You should generally write to the response object when short-circuiting to avoid generating an empty response.</span></span> <span data-ttu-id="70b32-334">Eine Ausnahme auszulösen, verhindert auch die Ausführung des Aktionsergebnisses und nachfolgender Filter, wird jedoch wie ein Fehler behandelt, und nicht wie ein erfolgreiches Ergebnis.</span><span class="sxs-lookup"><span data-stu-id="70b32-334">Throwing an exception will also prevent execution of the action result and subsequent filters, but will be treated as a failure instead of a successful result.</span></span>

<span data-ttu-id="70b32-335">Wenn die Methode `OnResultExecuted` ausgeführt wird, wurde die Antwort wahrscheinlich an den Client gesendet und kann nicht weiterhin geändert werden (außer es wurde eine Ausnahme ausgelöst).</span><span class="sxs-lookup"><span data-stu-id="70b32-335">When the `OnResultExecuted` method runs, the response has likely been sent to the client and cannot be changed further (unless an exception was thrown).</span></span> <span data-ttu-id="70b32-336">`ResultExecutedContext.Canceled` wird auf TRUE festgelegt, wenn die Ausführung des Aktionsergebnisses durch einen anderen Filter kurzgeschlossen wurde.</span><span class="sxs-lookup"><span data-stu-id="70b32-336">`ResultExecutedContext.Canceled` will be set to true if the action result execution was short-circuited by another filter.</span></span>

<span data-ttu-id="70b32-337">`ResultExecutedContext.Exception` wird auf einen Wert festgelegt, der ungleich NULL ist, wenn das Aktionsergebnis oder ein nachfolgender Ergebnisfilter eine Ausnahme ausgelöst hat.</span><span class="sxs-lookup"><span data-stu-id="70b32-337">`ResultExecutedContext.Exception` will be set to a non-null value if the action result or a subsequent result filter threw an exception.</span></span> <span data-ttu-id="70b32-338">Das Festlegen von `Exception` auf NULL „behandelt“ eine Ausnahme und verhindert, dass die Ausnahme zu einem späteren Zeitpunkt in der Pipeline ein weiteres Mal von MVC ausgelöst wird.</span><span class="sxs-lookup"><span data-stu-id="70b32-338">Setting `Exception` to null effectively 'handles' an exception and prevents the exception from being rethrown by MVC later in the pipeline.</span></span> <span data-ttu-id="70b32-339">Wenn Sie eine Ausnahme in einem Ergebnisfilter verarbeiten, sind Sie möglicherweise nicht in der Lage, Daten in die Antwort zu schreiben.</span><span class="sxs-lookup"><span data-stu-id="70b32-339">When you're handling an exception in a result filter, you might not be able to write any data to the response.</span></span> <span data-ttu-id="70b32-340">Wenn das Aktionsergebnis während der Ausführung ausgelöst wird und die Header bereits an den Client übergeben wurden, gibt es keinen zuverlässigen Mechanismus zum Senden von Fehlercode.</span><span class="sxs-lookup"><span data-stu-id="70b32-340">If the action result throws partway through its execution, and the headers have already been flushed to the client, there's no reliable mechanism to send a failure code.</span></span>

<span data-ttu-id="70b32-341">Bei einem `IAsyncResultFilter` führt ein Aufruf von `await next()` auf `ResultExecutionDelegate` alle nachfolgenden Ergebnisfilter und das Aktionsergebnis aus.</span><span class="sxs-lookup"><span data-stu-id="70b32-341">For an `IAsyncResultFilter` a call to `await next()` on the `ResultExecutionDelegate` executes any subsequent result filters and the action result.</span></span> <span data-ttu-id="70b32-342">Legen Sie `ResultExecutingContext.Cancel` auf TRUE fest, und rufen Sie nicht `ResultExectionDelegate` auf, um die Pipeline kurzzuschließen.</span><span class="sxs-lookup"><span data-stu-id="70b32-342">To short-circuit, set `ResultExecutingContext.Cancel` to true and don't call the `ResultExectionDelegate`.</span></span>

<span data-ttu-id="70b32-343">Das Framework stellt ein abstraktes `ResultFilterAttribute` bereit, dass Sie als Unterklasse verwenden können.</span><span class="sxs-lookup"><span data-stu-id="70b32-343">The framework provides an abstract `ResultFilterAttribute` that you can subclass.</span></span> <span data-ttu-id="70b32-344">Die weiter oben dargestellte Klasse [AddHeaderAttribute](#add-header-attribute) ist ein Beispiel für ein Ergebnisfilterattribut.</span><span class="sxs-lookup"><span data-stu-id="70b32-344">The [AddHeaderAttribute](#add-header-attribute) class shown earlier is an example of a result filter attribute.</span></span>

## <a name="using-middleware-in-the-filter-pipeline"></a><span data-ttu-id="70b32-345">Verwenden von Middleware in der Filterpipeline</span><span class="sxs-lookup"><span data-stu-id="70b32-345">Using middleware in the filter pipeline</span></span>

<span data-ttu-id="70b32-346">Ressourcenfilter funktionieren wie [Middleware](xref:fundamentals/middleware/index), sie umschließen alle Ausführungen, die später in der Pipeline enthalten sind.</span><span class="sxs-lookup"><span data-stu-id="70b32-346">Resource filters work like [middleware](xref:fundamentals/middleware/index) in that they surround the execution of everything that comes later in the pipeline.</span></span> <span data-ttu-id="70b32-347">Filter unterscheiden sich jedoch insofern von Middleware, dass sie Teil von MVC sind, was heißt, dass sie Zugriff auf MVC-Kontext und Konstrukte haben.</span><span class="sxs-lookup"><span data-stu-id="70b32-347">But filters differ from middleware in that they're part of MVC, which means that they have access to MVC context and constructs.</span></span>

<span data-ttu-id="70b32-348">In ASP.NET Core 1.1 können Sie Middleware in der Filterpipeline verwenden.</span><span class="sxs-lookup"><span data-stu-id="70b32-348">In ASP.NET Core 1.1, you can use middleware in the filter pipeline.</span></span> <span data-ttu-id="70b32-349">Das sollten Sie tun, wenn Sie eine Middlewarekomponente verwenden, die Zugriff auf MVC-Routendaten benötigt bzw. nur für bestimmte Controller oder Aktionen ausgeführt werden soll.</span><span class="sxs-lookup"><span data-stu-id="70b32-349">You might want to do that if you have a middleware component that needs access to MVC route data, or one that should run only for certain controllers or actions.</span></span>

<span data-ttu-id="70b32-350">Erstellen Sie einen Typ mit einer `Configure`-Methode, die die Middleware festlegt, die Sie in die Filterpipeline einfügen möchten, um Middleware als Filter zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="70b32-350">To use middleware as a filter, create a type with a `Configure` method that specifies the middleware that you want to inject into the filter pipeline.</span></span> <span data-ttu-id="70b32-351">Hier ist ein Beispiel, dass die Lokalisierungsmiddleware verwendet, um die aktuelle Kultur einer Anforderung einzurichten:</span><span class="sxs-lookup"><span data-stu-id="70b32-351">Here's an example that uses the localization middleware to establish the current culture for a request:</span></span>

[!code-csharp[Main](./filters/sample/src/FiltersSample/Filters/LocalizationPipeline.cs?name=snippet_MiddlewareFilter&highlight=3,21)]

<span data-ttu-id="70b32-352">Anschließend können Sie ein `MiddlewareFilterAttribute` verwenden, um die Middleware für einen ausgewählten Controller, eine Aktion oder global auszuführen:</span><span class="sxs-lookup"><span data-stu-id="70b32-352">You can then use the `MiddlewareFilterAttribute` to run the middleware for a selected controller or action or globally:</span></span>

[!code-csharp[Main](./filters/sample/src/FiltersSample/Controllers/HomeController.cs?name=snippet_MiddlewareFilter&highlight=2)]

<span data-ttu-id="70b32-353">Middlewarefilter werden zum selben Zeitpunkt in der Filterpipeline wie Ressourcenfilter, vor der Modellbindung und nach dem Rest der Pipeline ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="70b32-353">Middleware filters run at the same stage of the filter pipeline as Resource filters, before model binding and after the rest of the pipeline.</span></span>

## <a name="next-actions"></a><span data-ttu-id="70b32-354">Nächste Schritte</span><span class="sxs-lookup"><span data-stu-id="70b32-354">Next actions</span></span>

<span data-ttu-id="70b32-355">[Laden Sie das Beispiel herunter, testen und bearbeiten Sie es](https://github.com/aspnet/Docs/tree/master/aspnetcore/mvc/controllers/filters/sample), um Filter näher kennenzulernen.</span><span class="sxs-lookup"><span data-stu-id="70b32-355">To experiment with filters, [download, test and modify the sample](https://github.com/aspnet/Docs/tree/master/aspnetcore/mvc/controllers/filters/sample).</span></span>
