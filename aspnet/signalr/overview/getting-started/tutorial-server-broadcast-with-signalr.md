---
uid: signalr/overview/getting-started/tutorial-server-broadcast-with-signalr
title: 'Lernprogramm: Broadcast-Server mit SignalR 2 | Microsoft Docs'
author: tdykstra
description: Dieses Lernprogramm veranschaulicht, wie eine Webanwendung zu erstellen, die ASP.NET SignalR 2 verwendet wird, um broadcast Serverfunktionen bereitzustellen. Server-Broadcast bedeutet, dass diese Commun...
ms.author: aspnetcontent
manager: wpickett
ms.date: 10/13/2014
ms.topic: article
ms.assetid: 1568247f-60b5-4eca-96e0-e661fbb2b273
ms.technology: dotnet-signalr
ms.prod: .net-framework
msc.legacyurl: /signalr/overview/getting-started/tutorial-server-broadcast-with-signalr
msc.type: authoredcontent
ms.openlocfilehash: de4ccb4f0865e250fa0d78a9707fe5129c78e764
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 04/06/2018
---
<a name="tutorial-server-broadcast-with-signalr-2"></a><span data-ttu-id="a1be7-104">Lernprogramm: Broadcast-Server mit SignalR 2</span><span class="sxs-lookup"><span data-stu-id="a1be7-104">Tutorial: Server Broadcast with SignalR 2</span></span>
====================
<span data-ttu-id="a1be7-105">durch [Tom Dykstra](https://github.com/tdykstra), [Tom FitzMacken](https://github.com/tfitzmac)</span><span class="sxs-lookup"><span data-stu-id="a1be7-105">by [Tom Dykstra](https://github.com/tdykstra), [Tom FitzMacken](https://github.com/tfitzmac)</span></span>

> <span data-ttu-id="a1be7-106">Dieses Lernprogramm veranschaulicht, wie eine Webanwendung zu erstellen, die ASP.NET SignalR 2 verwendet wird, um broadcast Serverfunktionen bereitzustellen.</span><span class="sxs-lookup"><span data-stu-id="a1be7-106">This tutorial shows how to create a web application that uses ASP.NET SignalR 2 to provide server broadcast functionality.</span></span> <span data-ttu-id="a1be7-107">Server-Broadcast also an Clients gesendete Kommunikation vom Server initiiert werden.</span><span class="sxs-lookup"><span data-stu-id="a1be7-107">Server broadcast means that communications sent to clients are initiated by the server.</span></span> <span data-ttu-id="a1be7-108">Dieses Szenario erfordert einen anderen Programmieransatz als Peer-zu-Peer-Szenarien, z. B. Chat-Anwendungen, die an Clients gesendete Kommunikation von einer oder mehreren Clients initiiert werden.</span><span class="sxs-lookup"><span data-stu-id="a1be7-108">This scenario requires a different programming approach than peer-to-peer scenarios such as chat applications, in which communications sent to clients are initiated by one or more of the clients.</span></span>
> 
> <span data-ttu-id="a1be7-109">Die Anwendung, die in diesem Lernprogramm Sie erstellen simuliert einen Börsenticker ein typisches Szenario für Broadcast-Serverfunktionen.</span><span class="sxs-lookup"><span data-stu-id="a1be7-109">The application that you'll create in this tutorial simulates a stock ticker, a typical scenario for server broadcast functionality.</span></span>
> 
> <span data-ttu-id="a1be7-110">Dieses Thema wurde ursprünglich von Patrick Fletcher geschrieben.</span><span class="sxs-lookup"><span data-stu-id="a1be7-110">This topic was originally written by Patrick Fletcher.</span></span>
> 
> ## <a name="software-versions-used-in-the-tutorial"></a><span data-ttu-id="a1be7-111">In diesem Lernprogramm verwendeten Versionen der Software</span><span class="sxs-lookup"><span data-stu-id="a1be7-111">Software versions used in the tutorial</span></span>
> 
> 
> - [<span data-ttu-id="a1be7-112">Visual Studio 2013</span><span class="sxs-lookup"><span data-stu-id="a1be7-112">Visual Studio 2013</span></span>](https://www.microsoft.com/visualstudio/eng/2013-downloads)
> - <span data-ttu-id="a1be7-113">.NET 4.5</span><span class="sxs-lookup"><span data-stu-id="a1be7-113">.NET 4.5</span></span>
> - <span data-ttu-id="a1be7-114">SignalR Version 2</span><span class="sxs-lookup"><span data-stu-id="a1be7-114">SignalR version 2</span></span>
>   
> 
> 
> ## <a name="using-visual-studio-2012-with-this-tutorial"></a><span data-ttu-id="a1be7-115">Verwenden von Visual Studio 2012 mit diesem Lernprogramm</span><span class="sxs-lookup"><span data-stu-id="a1be7-115">Using Visual Studio 2012 with this tutorial</span></span>
> 
> 
> <span data-ttu-id="a1be7-116">Um Visual Studio 2012 mit diesem Lernprogramm verwenden, führen Sie folgende Schritte aus:</span><span class="sxs-lookup"><span data-stu-id="a1be7-116">To use Visual Studio 2012 with this tutorial, do the following:</span></span>
> 
> - <span data-ttu-id="a1be7-117">Update der [Package Manager](http://docs.nuget.org/docs/start-here/installing-nuget) auf die neueste Version.</span><span class="sxs-lookup"><span data-stu-id="a1be7-117">Update your [Package Manager](http://docs.nuget.org/docs/start-here/installing-nuget) to the latest version.</span></span>
> - <span data-ttu-id="a1be7-118">Installieren der [Web Platform Installer](https://www.microsoft.com/web/downloads/platform.aspx).</span><span class="sxs-lookup"><span data-stu-id="a1be7-118">Install the [Web Platform Installer](https://www.microsoft.com/web/downloads/platform.aspx).</span></span>
> - <span data-ttu-id="a1be7-119">Suchen Sie in den Webplattform-Installer, und installieren Sie **ASP.NET und 2013.1 von Web Tools für Visual Studio 2012**.</span><span class="sxs-lookup"><span data-stu-id="a1be7-119">In the Web Platform Installer, search for and install **ASP.NET and Web Tools 2013.1 for Visual Studio 2012**.</span></span> <span data-ttu-id="a1be7-120">Hierbei werden z. B. Visual Studio-Vorlagen für SignalR-Klassen installiert **Hub**.</span><span class="sxs-lookup"><span data-stu-id="a1be7-120">This will install Visual Studio templates for SignalR classes such as **Hub**.</span></span>
> - <span data-ttu-id="a1be7-121">Einige Vorlagen (z. B. **OWIN-Startklasse**) ist nicht verfügbar; verwenden Sie für diese stattdessen eine Klassendatei.</span><span class="sxs-lookup"><span data-stu-id="a1be7-121">Some templates (such as **OWIN Startup Class**) will not be available; for these, use a Class file instead.</span></span>
> 
> 
> ## <a name="tutorial-versions"></a><span data-ttu-id="a1be7-122">Lernprogramm-Versionen</span><span class="sxs-lookup"><span data-stu-id="a1be7-122">Tutorial Versions</span></span>
> 
> <span data-ttu-id="a1be7-123">Informationen zu früheren Versionen von SignalR finden Sie unter [ältere Versionen von SignalR](../older-versions/index.md).</span><span class="sxs-lookup"><span data-stu-id="a1be7-123">For information about earlier versions of SignalR, see [SignalR Older Versions](../older-versions/index.md).</span></span>
> 
> ## <a name="questions-and-comments"></a><span data-ttu-id="a1be7-124">Fragen und Kommentare</span><span class="sxs-lookup"><span data-stu-id="a1be7-124">Questions and comments</span></span>
> 
> <span data-ttu-id="a1be7-125">Lassen Sie Sie Feedback auf wie in diesem Lernprogramm mögen und was wir in den Kommentaren am unteren Rand der Seite verbessern können.</span><span class="sxs-lookup"><span data-stu-id="a1be7-125">Please leave feedback on how you liked this tutorial and what we could improve in the comments at the bottom of the page.</span></span> <span data-ttu-id="a1be7-126">Wenn Sie Fragen, die nicht direkt mit dem Lernprogramm verknüpft sind haben, bereitstellen können, die [ASP.NET SignalR-Forum](https://forums.asp.net/1254.aspx/1?ASP+NET+SignalR) oder [StackOverflow.com](http://stackoverflow.com/).</span><span class="sxs-lookup"><span data-stu-id="a1be7-126">If you have questions that are not directly related to the tutorial, you can post them to the [ASP.NET SignalR forum](https://forums.asp.net/1254.aspx/1?ASP+NET+SignalR) or [StackOverflow.com](http://stackoverflow.com/).</span></span>


## <a name="overview"></a><span data-ttu-id="a1be7-127">Übersicht</span><span class="sxs-lookup"><span data-stu-id="a1be7-127">Overview</span></span>

<span data-ttu-id="a1be7-128">Sie müssen in diesem Lernprogramm erstellen Sie eine Börsenticker-Anwendung, die repräsentativ für Echtzeit-Anwendungen werden in der soll in regelmäßigen Abständen "push" oder Benachrichtigungen vom Server für alle verbundenen Clients zu senden.</span><span class="sxs-lookup"><span data-stu-id="a1be7-128">In this tutorial, you'll create a stock ticker application that is representative of real-time applications in which you want to periodically "push," or broadcast, notifications from the server to all connected clients.</span></span> <span data-ttu-id="a1be7-129">Im ersten Teil dieses Lernprogramms erstellen Sie eine vereinfachte Version der Anwendung von Grund auf neu.</span><span class="sxs-lookup"><span data-stu-id="a1be7-129">In the first part of this tutorial, you'll create a simplified version of that application from scratch.</span></span> <span data-ttu-id="a1be7-130">Im weiteren Verlauf des Lernprogramms Sie installieren ein NuGet-Paket, das zusätzliche Funktionen enthält, und überprüfen Sie den Code für diese Funktionen.</span><span class="sxs-lookup"><span data-stu-id="a1be7-130">In the remainder of the tutorial, you'll install a NuGet package that contains additional features, and review the code for those features.</span></span>

<span data-ttu-id="a1be7-131">Die Anwendung, die Sie in den ersten Teil dieses Lernprogramms erstellen zeigt ein Raster mit vordefinierten Daten.</span><span class="sxs-lookup"><span data-stu-id="a1be7-131">The application that you'll build in the first part of this tutorial displays a grid with stock data.</span></span>

![StockTicker Anfangsversion](tutorial-server-broadcast-with-signalr/_static/image1.png)

<span data-ttu-id="a1be7-133">Der Server wird in regelmäßigen Abständen nach dem Zufallsprinzip Aktienkurse aktualisiert, und der legt die Updates für alle verbundenen Clients.</span><span class="sxs-lookup"><span data-stu-id="a1be7-133">Periodically the server randomly updates stock prices and pushes the updates to all connected clients.</span></span> <span data-ttu-id="a1be7-134">Im Browser die Zahlen und Symbole in der **ändern** und **%** Spalten ändern sich dynamisch in Reaktion auf Benachrichtigungen vom Server.</span><span class="sxs-lookup"><span data-stu-id="a1be7-134">In the browser the numbers and symbols in the **Change** and **%** columns dynamically change in response to notifications from the server.</span></span> <span data-ttu-id="a1be7-135">Wenn Sie zusätzliche Browsern auf die gleiche URL öffnen, zeigen sie alle die gleichen Daten und die gleichen Änderungen an den Daten gleichzeitig.</span><span class="sxs-lookup"><span data-stu-id="a1be7-135">If you open additional browsers to the same URL, they all show the same data and the same changes to the data simultaneously.</span></span>

<span data-ttu-id="a1be7-136">Dieses Lernprogramm enthält folgende Abschnitte:</span><span class="sxs-lookup"><span data-stu-id="a1be7-136">This tutorial contains the following sections:</span></span>

- [<span data-ttu-id="a1be7-137">Erforderliche Komponenten</span><span class="sxs-lookup"><span data-stu-id="a1be7-137">Prerequisites</span></span>](#prerequisites)
- [<span data-ttu-id="a1be7-138">Erstellen des Projekts</span><span class="sxs-lookup"><span data-stu-id="a1be7-138">Create the project</span></span>](#createproject)
- [<span data-ttu-id="a1be7-139">Richten Sie den Servercode</span><span class="sxs-lookup"><span data-stu-id="a1be7-139">Set up the server code</span></span>](#server)
- [<span data-ttu-id="a1be7-140">Der Clientcode einrichten</span><span class="sxs-lookup"><span data-stu-id="a1be7-140">Set up the client code</span></span>](#client)
- [<span data-ttu-id="a1be7-141">Testen der Anwendung</span><span class="sxs-lookup"><span data-stu-id="a1be7-141">Test the application</span></span>](#test)
- [<span data-ttu-id="a1be7-142">Aktivieren der Protokollierung</span><span class="sxs-lookup"><span data-stu-id="a1be7-142">Enable logging</span></span>](#enablelogging)
- [<span data-ttu-id="a1be7-143">Installieren Sie und überprüfen Sie die vollständige StockTicker-Beispiel</span><span class="sxs-lookup"><span data-stu-id="a1be7-143">Install and review the full StockTicker sample</span></span>](#fullsample)
- [<span data-ttu-id="a1be7-144">Nächste Schritte</span><span class="sxs-lookup"><span data-stu-id="a1be7-144">Next steps</span></span>](#nextsteps)

<span data-ttu-id="a1be7-145">Die [Microsoft.AspNet.SignalR.Sample](http://nuget.org/packages/microsoft.aspnet.signalr.sample) NuGet-Paket installiert eine Beispiel simuliert Börsenticker-Anwendung in einem Visual Studio-Projekt.</span><span class="sxs-lookup"><span data-stu-id="a1be7-145">The [Microsoft.AspNet.SignalR.Sample](http://nuget.org/packages/microsoft.aspnet.signalr.sample) NuGet package installs a sample simulated stock ticker application in a Visual Studio project.</span></span>

> [!NOTE]
> <span data-ttu-id="a1be7-146">Wenn Sie nicht über die Schritte zum Erstellen der Anwendung arbeiten möchten, können Sie das Paket SignalR.Sample in eine neue leere ASP.NET-Webanwendung Projekt installieren.</span><span class="sxs-lookup"><span data-stu-id="a1be7-146">If you don't want to work through the steps of building the application, you can install the SignalR.Sample package in a new Empty ASP.NET Web Application project.</span></span> <span data-ttu-id="a1be7-147">Wenn Sie das NuGet-Paket installieren, ohne die Schritte in diesem Lernprogramm ausführen **müssen Sie die Anweisungen in der Datei "Readme.txt" befolgen**.</span><span class="sxs-lookup"><span data-stu-id="a1be7-147">If you install the NuGet package without performing the steps in this tutorial, **you must follow the instructions in the readme.txt file**.</span></span> <span data-ttu-id="a1be7-148">Zum Ausführen des Pakets müssen Sie eine OWIN-Startklasse hinzufügen, der die ConfigureSignalR-Methode aufgerufen wird, in dem Paket.</span><span class="sxs-lookup"><span data-stu-id="a1be7-148">To run the package you need to add an OWIN startup class which calls the ConfigureSignalR method in the installed package.</span></span> <span data-ttu-id="a1be7-149">Sie erhalten einen Fehler, wenn Sie nicht die OWIN-Startklasse hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="a1be7-149">You will receive an error if you do not add the OWIN startup class.</span></span>


<a id="prerequisites"></a>

## <a name="prerequisites"></a><span data-ttu-id="a1be7-150">Erforderliche Komponenten</span><span class="sxs-lookup"><span data-stu-id="a1be7-150">Prerequisites</span></span>

<span data-ttu-id="a1be7-151">Bevor Sie beginnen, stellen Sie sicher, dass Sie Visual Studio 2013 auf Ihrem Computer installiert haben.</span><span class="sxs-lookup"><span data-stu-id="a1be7-151">Before you start, make sure that you have Visual Studio 2013 installed on your computer.</span></span> <span data-ttu-id="a1be7-152">Wenn Sie Visual Studio nicht haben, finden Sie unter [ASP.NET Downloads](https://www.asp.net/downloads) zum Abrufen der kostenlose Visual Studio 2013 Express.</span><span class="sxs-lookup"><span data-stu-id="a1be7-152">If you don't have Visual Studio, see [ASP.NET Downloads](https://www.asp.net/downloads) to get the free Visual Studio 2013 Express.</span></span>

<a id="createproject"></a>

## <a name="create-the-project"></a><span data-ttu-id="a1be7-153">Erstellen eines Projekts</span><span class="sxs-lookup"><span data-stu-id="a1be7-153">Create the project</span></span>

1. <span data-ttu-id="a1be7-154">Aus der **Datei** Menü klicken Sie auf **neues Projekt**.</span><span class="sxs-lookup"><span data-stu-id="a1be7-154">From the **File** menu, click **New Project**.</span></span>
2. <span data-ttu-id="a1be7-155">In der **neues Projekt** Dialogfeld erweitern Sie **c#** unter **Vorlagen** , und wählen Sie **Web**.</span><span class="sxs-lookup"><span data-stu-id="a1be7-155">In the **New Project** dialog box, expand **C#** under **Templates** and select **Web**.</span></span>
3. <span data-ttu-id="a1be7-156">Wählen Sie die **leere ASP.NET-Webanwendung** Vorlage, nennen Sie das Projekt *SignalR.StockTicker*, und klicken Sie auf **OK**.</span><span class="sxs-lookup"><span data-stu-id="a1be7-156">Select the **ASP.NET Empty Web Application** template, name the project *SignalR.StockTicker*, and click **OK**.</span></span>

    ![Dialogfeld "Neues Projekt"](tutorial-server-broadcast-with-signalr/_static/image2.png)
4. <span data-ttu-id="a1be7-158">In der **neue ASP.NET** Projektfenster, lassen Sie **leere** ausgewählt, und klicken Sie auf **Projekt erstellen**.</span><span class="sxs-lookup"><span data-stu-id="a1be7-158">In the **New ASP.NET** Project window, leave **Empty** selected and click **Create Project**.</span></span>

    ![Neue ASP-Projekt (Dialogfeld)](tutorial-server-broadcast-with-signalr/_static/image3.png)

<a id="server"></a>

## <a name="set-up-the-server-code"></a><span data-ttu-id="a1be7-160">Richten Sie den Servercode</span><span class="sxs-lookup"><span data-stu-id="a1be7-160">Set up the server code</span></span>

<span data-ttu-id="a1be7-161">In diesem Abschnitt richten Sie den Code, der auf dem Server ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="a1be7-161">In this section you set up the code that runs on the server.</span></span>

### <a name="create-the-stock-class"></a><span data-ttu-id="a1be7-162">Erstellen Sie die Stock-Klasse</span><span class="sxs-lookup"><span data-stu-id="a1be7-162">Create the Stock class</span></span>

<span data-ttu-id="a1be7-163">Sie beginnen mit dem Erstellen von der Stock-Modell-Klasse, die Sie verwenden zum Speichern und Übertragen von Informationen zu einer Aktie.</span><span class="sxs-lookup"><span data-stu-id="a1be7-163">You begin by creating the Stock model class that you'll use to store and transmit information about a stock.</span></span>

1. <span data-ttu-id="a1be7-164">Erstellen Sie eine neue Klassendatei im Projektordner, benennen Sie sie *Stock.cs*, und Ersetzen Sie den Code durch folgenden Code:</span><span class="sxs-lookup"><span data-stu-id="a1be7-164">Create a new class file in the project folder, name it *Stock.cs*, and then replace the template code with the following code:</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample1.cs)]

    <span data-ttu-id="a1be7-165">Die beiden Eigenschaften, die Sie festlegen müssen, bei der Erstellung von Aktien werden das Symbol (z. B. MSFT für Microsoft) und den Preis.</span><span class="sxs-lookup"><span data-stu-id="a1be7-165">The two properties that you'll set when you create stocks are the Symbol (for example, MSFT for Microsoft) and the Price.</span></span> <span data-ttu-id="a1be7-166">Die anderen Eigenschaften hängen davon ab, wie und wann Sie Preis festlegen.</span><span class="sxs-lookup"><span data-stu-id="a1be7-166">The other properties depend on how and when you set Price.</span></span> <span data-ttu-id="a1be7-167">Festlegen der Preis, zum ersten Mal ruft der Wert an DayOpen weitergegeben.</span><span class="sxs-lookup"><span data-stu-id="a1be7-167">The first time you set Price, the value gets propagated to DayOpen.</span></span> <span data-ttu-id="a1be7-168">Nachfolgende Zeiten, wenn Sie festlegen, Preis, die Änderung und Prozent Eigenschaftswerte werden berechnet, basierend auf den Unterschied zwischen Preis- und DayOpen.</span><span class="sxs-lookup"><span data-stu-id="a1be7-168">Subsequent times when you set Price, the Change and PercentChange property values are calculated based on the difference between Price and DayOpen.</span></span>

### <a name="create-the-stockticker-and-stocktickerhub-classes"></a><span data-ttu-id="a1be7-169">Erstellen Sie die StockTicker und StockTickerHub-Klassen</span><span class="sxs-lookup"><span data-stu-id="a1be7-169">Create the StockTicker and StockTickerHub classes</span></span>

<span data-ttu-id="a1be7-170">Die SignalR-Hub-API verwenden, behandeln Server-zu-Client-Aktivität.</span><span class="sxs-lookup"><span data-stu-id="a1be7-170">You'll use the SignalR Hub API to handle server-to-client interaction.</span></span> <span data-ttu-id="a1be7-171">Eine StockTickerHub-Klasse, die von der SignalR-Hub-Klasse abgeleitet wird verarbeitet, Verbindungen und Methodenaufrufe aus Clients empfängt.</span><span class="sxs-lookup"><span data-stu-id="a1be7-171">A StockTickerHub class that derives from the SignalR Hub class will handle receiving connections and method calls from clients.</span></span> <span data-ttu-id="a1be7-172">Sie müssen auch Börsendaten verwalten, und führen ein Timer-Objekt, um regelmäßig Updates der Preis, unabhängig von Clientverbindungen auszulösen.</span><span class="sxs-lookup"><span data-stu-id="a1be7-172">You also need to maintain stock data and run a Timer object to periodically trigger price updates, independently of client connections.</span></span> <span data-ttu-id="a1be7-173">Diese Funktionen können nicht in einer hubklasse hinzugefügt werden, da hubinstanzen vorübergehend sind.</span><span class="sxs-lookup"><span data-stu-id="a1be7-173">You can't put these functions in a Hub class, because Hub instances are transient.</span></span> <span data-ttu-id="a1be7-174">Eine Hub-Klasseninstanz wird für jeden Vorgang auf dem Hub, wie Verbindungen und Aufrufe vom Client an den Server erstellt.</span><span class="sxs-lookup"><span data-stu-id="a1be7-174">A Hub class instance is created for each operation on the hub, such as connections and calls from the client to the server.</span></span> <span data-ttu-id="a1be7-175">Daher muss der Mechanismus, der behält Börsendaten aktualisiert Preise und überträgt die Price-Updates in einer separaten Klasse, führen Sie dies bedeutet, Sie StockTicker müssen.</span><span class="sxs-lookup"><span data-stu-id="a1be7-175">So the mechanism that keeps stock data, updates prices, and broadcasts the price updates has to run in a separate class, which you'll name StockTicker.</span></span>

![Senden von StockTicker](tutorial-server-broadcast-with-signalr/_static/image5.png)

<span data-ttu-id="a1be7-177">Sie möchten nur eine Instanz der Klasse StockTicker auf dem Server ausgeführt wird, daher Sie einen Verweis aus jeder Instanz StockTickerHub auf die Singletoninstanz des StockTicker einrichten müssen.</span><span class="sxs-lookup"><span data-stu-id="a1be7-177">You only want one instance of the StockTicker class to run on the server, so you'll need to set up a reference from each StockTickerHub instance to the singleton StockTicker instance.</span></span> <span data-ttu-id="a1be7-178">Die StockTicker-Klasse hat in der Lage, die an Clients übertragen werden, da die Börsendaten weist auf und löst Aktualisierungen, StockTicker ist jedoch keiner hubklasse.</span><span class="sxs-lookup"><span data-stu-id="a1be7-178">The StockTicker class has to be able to broadcast to clients because it has the stock data and triggers updates, but StockTicker is not a Hub class.</span></span> <span data-ttu-id="a1be7-179">Deshalb hat die StockTicker-Klasse zum Abrufen eines Verweises auf die SignalR-Hubs Verbindung Context-Objekt.</span><span class="sxs-lookup"><span data-stu-id="a1be7-179">Therefore, the StockTicker class has to get a reference to the SignalR Hub connection context object.</span></span> <span data-ttu-id="a1be7-180">Sie können dann das Kontextobjekt für SignalR-Verbindung verwenden, an Clients übertragen.</span><span class="sxs-lookup"><span data-stu-id="a1be7-180">It can then use the SignalR connection context object to broadcast to clients.</span></span>

1. <span data-ttu-id="a1be7-181">In **Projektmappen-Explorer**mit der rechten Maustaste auf das Projekt, und klicken Sie auf **hinzufügen | SignalR-Hub-Klasse (v2)**.</span><span class="sxs-lookup"><span data-stu-id="a1be7-181">In **Solution Explorer**, right-click the project and click **Add | SignalR Hub Class (v2)**.</span></span>
2. <span data-ttu-id="a1be7-182">Name des neuen Hubs *StockTickerHub.cs*, und klicken Sie dann auf **hinzufügen**.</span><span class="sxs-lookup"><span data-stu-id="a1be7-182">Name the new hub *StockTickerHub.cs*, and then click **Add**.</span></span> <span data-ttu-id="a1be7-183">SignalR-NuGet-Pakete werden dem Projekt hinzugefügt werden.</span><span class="sxs-lookup"><span data-stu-id="a1be7-183">SignalR NuGet packages will be added to your project.</span></span>
3. <span data-ttu-id="a1be7-184">Ersetzen Sie den Vorlagencode, durch den folgenden Code:</span><span class="sxs-lookup"><span data-stu-id="a1be7-184">Replace the template code with the following code:</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample2.cs)]

    <span data-ttu-id="a1be7-185">Die [Hub](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.hub(v=vs.111).aspx) Klasse wird verwendet, um Methoden definieren, die Clients auf dem Server aufrufen können.</span><span class="sxs-lookup"><span data-stu-id="a1be7-185">The [Hub](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.hub(v=vs.111).aspx) class is used to define methods the clients can call on the server.</span></span> <span data-ttu-id="a1be7-186">Definieren Sie eine Methode: `GetAllStocks()`.</span><span class="sxs-lookup"><span data-stu-id="a1be7-186">You are defining one method: `GetAllStocks()`.</span></span> <span data-ttu-id="a1be7-187">Wenn ein Client zunächst mit dem Server verbunden ist, wird diese Methode, um eine Liste aller von der Aktien mit ihrer aktuellen Preise abzurufen aufgerufen.</span><span class="sxs-lookup"><span data-stu-id="a1be7-187">When a client initially connects to the server, it will call this method to get a list of all of the stocks with their current prices.</span></span> <span data-ttu-id="a1be7-188">Die Methode synchron ausgeführt und zurückgeben kann `IEnumerable<Stock>` , da er Daten aus dem Arbeitsspeicher zurückgibt.</span><span class="sxs-lookup"><span data-stu-id="a1be7-188">The method can execute synchronously and return `IEnumerable<Stock>` because it is returning data from memory.</span></span> <span data-ttu-id="a1be7-189">Wenn die Methode die Daten abrufen, indem Sie die Aktionen ausgeführt werden, die warten, z. B. einer Datenbanksuche oder einem Webdienstaufruf umfassen würde musste würden Sie angeben `Task<IEnumerable<Stock>>` als den Rückgabewert in die asynchrone Verarbeitung zu ermöglichen.</span><span class="sxs-lookup"><span data-stu-id="a1be7-189">If the method had to get the data by doing something that would involve waiting, such as a database lookup or a web service call, you would specify `Task<IEnumerable<Stock>>` as the return value to enable asynchronous processing.</span></span> <span data-ttu-id="a1be7-190">Weitere Informationen finden Sie unter [Handbuch für ASP.NET SignalR-Hubs-API - Server - beim asynchron ausführen](../guide-to-the-api/hubs-api-guide-server.md#asyncmethods).</span><span class="sxs-lookup"><span data-stu-id="a1be7-190">For more information, see [ASP.NET SignalR Hubs API Guide - Server - When to execute asynchronously](../guide-to-the-api/hubs-api-guide-server.md#asyncmethods).</span></span>

    <span data-ttu-id="a1be7-191">Der HubName-Attribut gibt an, wie der Hub im JavaScript-Code auf dem Client verwiesen wird.</span><span class="sxs-lookup"><span data-stu-id="a1be7-191">The HubName attribute specifies how the Hub will be referenced in JavaScript code on the client.</span></span> <span data-ttu-id="a1be7-192">Auf dem Client, wenn Sie dieses Attribut verwenden, nicht der Standardnamen ist eine Version in Kamel-Schreibweise des Klassennamens, was in diesem Fall StockTickerHub wäre.</span><span class="sxs-lookup"><span data-stu-id="a1be7-192">The default name on the client if you don't use this attribute is a camel-cased version of the class name, which in this case would be stockTickerHub.</span></span>

    <span data-ttu-id="a1be7-193">Wie Sie später sehen, wenn Sie die StockTicker-Klasse erstellen, wird eine Singleton-Instanz dieser Klasse in der statischen Instance-Eigenschaft erstellt.</span><span class="sxs-lookup"><span data-stu-id="a1be7-193">As you'll see later when you create the StockTicker class, a singleton instance of that class is created in its static Instance property.</span></span> <span data-ttu-id="a1be7-194">Singletoninstanz des StockTicker verbleibt im Arbeitsspeicher, unabhängig davon, wie viele Clients eine Verbindung herstellen oder trennen, und diese Instanz wird die GetAllStocks-Methode verwendet wird, die aktuelle Börseninformationen zurückgeben.</span><span class="sxs-lookup"><span data-stu-id="a1be7-194">That singleton instance of StockTicker remains in memory no matter how many clients connect or disconnect, and that instance is what the GetAllStocks method uses to return current stock information.</span></span>
4. <span data-ttu-id="a1be7-195">Erstellen Sie eine neue Klassendatei im Projektordner, benennen Sie sie *StockTicker.cs*, und Ersetzen Sie den Code durch folgenden Code:</span><span class="sxs-lookup"><span data-stu-id="a1be7-195">Create a new class file in the project folder, name it *StockTicker.cs*, and then replace the template code with the following code:</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample3.cs)]

    <span data-ttu-id="a1be7-196">Da mehrere Threads dieselbe Instanz von StockTicker Code ausgeführt werden, muss die Klasse StockTicker hinsichtlich sein.</span><span class="sxs-lookup"><span data-stu-id="a1be7-196">Since multiple threads will be running the same instance of StockTicker code, the StockTicker class has to be threadsafe.</span></span>

    ### <a name="storing-the-singleton-instance-in-a-static-field"></a><span data-ttu-id="a1be7-197">Speichern die Singleton-Instanz in einem statischen Feld</span><span class="sxs-lookup"><span data-stu-id="a1be7-197">Storing the singleton instance in a static field</span></span>

    <span data-ttu-id="a1be7-198">Im Code initialisiert die statische \_Instanzenfeld, die die Instance-Eigenschaft mit einer Instanz der Klasse, und dies sichert ist die einzige Instanz der Klasse, die erstellt werden kann, da der Konstruktor als privat gekennzeichnet ist.</span><span class="sxs-lookup"><span data-stu-id="a1be7-198">The code initializes the static \_instance field that backs the Instance property with an instance of the class, and this is the only instance of the class that can be created, because the constructor is marked as private.</span></span> <span data-ttu-id="a1be7-199">[Verzögerte Initialisierung](https://msdn.microsoft.com/library/dd997286.aspx) wird verwendet, für die \_Instanzenfeld, nicht für aus Leistungsgründen jedoch sicher, dass die instanzerstellung hinsichtlich ist.</span><span class="sxs-lookup"><span data-stu-id="a1be7-199">[Lazy initialization](https://msdn.microsoft.com/library/dd997286.aspx) is used for the \_instance field, not for performance reasons but to ensure that the instance creation is threadsafe.</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample4.cs)]

    <span data-ttu-id="a1be7-200">Jedes Mal, wenn ein Client mit dem Server verbindet Ruft eine neue Instanz der Klasse StockTickerHub in einem separaten Thread ausgeführt StockTicker Singleton-Instanz aus der statischen StockTicker.Instance-Eigenschaft, wie Sie weiter oben in der Klasse StockTickerHub gesehen haben.</span><span class="sxs-lookup"><span data-stu-id="a1be7-200">Each time a client connects to the server, a new instance of the StockTickerHub class running in a separate thread gets the StockTicker singleton instance from the StockTicker.Instance static property, as you saw earlier in the StockTickerHub class.</span></span>

    ### <a name="storing-stock-data-in-a-concurrentdictionary"></a><span data-ttu-id="a1be7-201">Das Speichern von vordefinierten Daten in einem ConcurrentDictionary</span><span class="sxs-lookup"><span data-stu-id="a1be7-201">Storing stock data in a ConcurrentDictionary</span></span>

    <span data-ttu-id="a1be7-202">Der Konstruktor initialisiert die \_Aktien-Auflistung mit einigen vordefinierten Beispieldaten und GetAllStocks zurückgibt, die Aktien.</span><span class="sxs-lookup"><span data-stu-id="a1be7-202">The constructor initializes the \_stocks collection with some sample stock data, and GetAllStocks returns the stocks.</span></span> <span data-ttu-id="a1be7-203">Wie weiter oben gezeigt, wird diese Auflistung Aktien wiederum von StockTickerHub.GetAllStocks zurückgegeben, einer Servermethode in der Hub-Klasse, die Clients aufrufen können.</span><span class="sxs-lookup"><span data-stu-id="a1be7-203">As you saw earlier, this collection of stocks is in turn returned by StockTickerHub.GetAllStocks which is a server method in the Hub class that clients can call.</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample5.cs)]

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample6.cs)]

    <span data-ttu-id="a1be7-204">Die Aktien-Auflistung ist definiert als eine [ConcurrentDictionary](https://msdn.microsoft.com/library/dd287191.aspx) Typ für die Threadsicherheit.</span><span class="sxs-lookup"><span data-stu-id="a1be7-204">The stocks collection is defined as a [ConcurrentDictionary](https://msdn.microsoft.com/library/dd287191.aspx) type for thread safety.</span></span> <span data-ttu-id="a1be7-205">Als Alternative können Sie eine [Wörterbuch](https://msdn.microsoft.com/library/xfhwa508.aspx) -Objekt und das Wörterbuch explizit zu sperren, wenn Sie Änderungen vornehmen.</span><span class="sxs-lookup"><span data-stu-id="a1be7-205">As an alternative, you could use a [Dictionary](https://msdn.microsoft.com/library/xfhwa508.aspx) object and explicitly lock the dictionary when you make changes to it.</span></span>

    <span data-ttu-id="a1be7-206">Diese beispielanwendung ist es OK zum Speichern von Anwendungsdaten im Arbeitsspeicher und Daten zu verlieren, wenn die Instanz StockTicker verworfen wird.</span><span class="sxs-lookup"><span data-stu-id="a1be7-206">For this sample application, it's OK to store application data in memory and to lose the data when the StockTicker instance is disposed.</span></span> <span data-ttu-id="a1be7-207">In einer echten Anwendung würden Sie mit einer Back-End-Datenspeicher, z. B. einer Datenbank arbeiten.</span><span class="sxs-lookup"><span data-stu-id="a1be7-207">In a real application you would work with a back-end data store such as a database.</span></span>

    ### <a name="periodically-updating-stock-prices"></a><span data-ttu-id="a1be7-208">In regelmäßigen Abständen aktualisieren Aktienkurse</span><span class="sxs-lookup"><span data-stu-id="a1be7-208">Periodically updating stock prices</span></span>

    <span data-ttu-id="a1be7-209">Der Konstruktor wird ein Timer-Objekt, das in regelmäßigen Abständen Methoden aufruft, die Aktienkurse werden nach dem Zufallsprinzip aktualisieren gestartet.</span><span class="sxs-lookup"><span data-stu-id="a1be7-209">The constructor starts up a Timer object that periodically calls methods that update stock prices on a random basis.</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample7.cs)]

    <span data-ttu-id="a1be7-210">UpdateStockPrices wird von den Zeitgeber aufgerufen, der auf Null in den Statusparameter übergibt.</span><span class="sxs-lookup"><span data-stu-id="a1be7-210">UpdateStockPrices is called by the Timer, which passes in null in the state parameter.</span></span> <span data-ttu-id="a1be7-211">Vor dem Aktualisieren die Preise, wird eine Sperre auf die \_UpdateStockPricesLock-Objekt.</span><span class="sxs-lookup"><span data-stu-id="a1be7-211">Before updating prices, a lock is taken on the \_updateStockPricesLock object.</span></span> <span data-ttu-id="a1be7-212">Der Code überprüft, ob ein anderer Thread bereits Preise aktualisiert, und dann TryUpdateStockPrice auf jede Aktie in der Liste ruft.</span><span class="sxs-lookup"><span data-stu-id="a1be7-212">The code checks if another thread is already updating prices, and then it calls TryUpdateStockPrice on each stock in the list.</span></span> <span data-ttu-id="a1be7-213">Die Methode TryUpdateStockPrice entscheidet, ob den Aktienkurs ändern und wie viel, um ihn zu ändern.</span><span class="sxs-lookup"><span data-stu-id="a1be7-213">The TryUpdateStockPrice method decides whether to change the stock price, and how much to change it.</span></span> <span data-ttu-id="a1be7-214">Wenn der Aktienkurs geändert wird, wird BroadcastStockPrice aufgerufen, um die Änderung Aktienkurs für alle verbundenen Clients zu senden.</span><span class="sxs-lookup"><span data-stu-id="a1be7-214">If the stock price is changed, BroadcastStockPrice is called to broadcast the stock price change to all connected clients.</span></span>

    <span data-ttu-id="a1be7-215">Die \_UpdatingStockPrices Flag markiert, als [volatile](https://msdn.microsoft.com/library/x13ttww7.aspx) um sicherzustellen, dass der Zugriff darauf hinsichtlich ist.</span><span class="sxs-lookup"><span data-stu-id="a1be7-215">The \_updatingStockPrices flag is marked as [volatile](https://msdn.microsoft.com/library/x13ttww7.aspx) to ensure that access to it is threadsafe.</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample8.cs)]

    <span data-ttu-id="a1be7-216">In einer realen Anwendung würde TryUpdateStockPrice rufen die-Methode einen Webdienst, um den Preis zu suchen. In diesem Code wird durch einen Zufallszahlengenerator nach dem Zufallsprinzip Änderungen vornehmen.</span><span class="sxs-lookup"><span data-stu-id="a1be7-216">In a real application, the TryUpdateStockPrice method would call a web service to look up the price; in this code it uses a random number generator to make changes randomly.</span></span>

    ### <a name="getting-the-signalr-context-so-that-the-stockticker-class-can-broadcast-to-clients"></a><span data-ttu-id="a1be7-217">Abrufen des SignalR-Kontexts, damit die Klasse StockTicker an Clients übertragen werden können</span><span class="sxs-lookup"><span data-stu-id="a1be7-217">Getting the SignalR context so that the StockTicker class can broadcast to clients</span></span>

    <span data-ttu-id="a1be7-218">Da die preisänderungen hier in dem Objekt StockTicker stammen, ist dies das Objekt, das eine UpdateStockPrice-Methode auf alle verbundenen Clients aufrufen muss.</span><span class="sxs-lookup"><span data-stu-id="a1be7-218">Because the price changes originate here in the StockTicker object, this is the object that needs to call an updateStockPrice method on all connected clients.</span></span> <span data-ttu-id="a1be7-219">In einer hubklasse haben Sie eine API für Clientmethoden aufrufen, aber StockTicker ist nicht von der Hub-Klasse abgeleitet und verfügt nicht über einen Verweis auf ein beliebiges Objekt Hub.</span><span class="sxs-lookup"><span data-stu-id="a1be7-219">In a Hub class you have an API for calling client methods, but StockTicker does not derive from the Hub class and does not have a reference to any Hub object.</span></span> <span data-ttu-id="a1be7-220">Aus diesem Grund bietet, um an verbundene Clients gesendet wird, die StockTicker-Klasse die Kontextinstanz SignalR für die Klasse StockTickerHub abrufen und verwenden, die zum Aufrufen von Methoden auf Clients.</span><span class="sxs-lookup"><span data-stu-id="a1be7-220">Therefore, in order to broadcast to connected clients, the StockTicker class has to get the SignalR context instance for the StockTickerHub class and use that to call methods on clients.</span></span>

    <span data-ttu-id="a1be7-221">Der Code Ruft einen Verweis auf den SignalR-Kontext ab, wenn der Singleton-Instanz, übergibt, die auf Verweisen im Konstruktor erstellt, und der Konstruktor speichert sie in der Eigenschaft des Clients.</span><span class="sxs-lookup"><span data-stu-id="a1be7-221">The code gets a reference to the SignalR context when it creates the singleton class instance, passes that reference to the constructor, and the constructor puts it in the Clients property.</span></span>

    <span data-ttu-id="a1be7-222">Es gibt zwei Gründe, warum den Kontext nur einmal abgerufen werden soll: Abrufen des Kontexts ist ein teurer Vorgang, und einmal des Projekts wird sichergestellt, dass die beabsichtigte Reihenfolge der Nachrichten, die an Clients gesendeten beibehalten wird.</span><span class="sxs-lookup"><span data-stu-id="a1be7-222">There are two reasons why you want to get the context just once: getting the context is an expensive operation, and getting it once ensures that the intended order of messages sent to clients is preserved.</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample9.cs)]

    <span data-ttu-id="a1be7-223">Abrufen der Eigenschaft des Kontexts für Clients und zu deren in der Eigenschaft StockTickerClient ermöglicht das Schreiben von Code zum Client Aufrufen von Methoden, die die gleiche aussieht wie in einer hubklasse.</span><span class="sxs-lookup"><span data-stu-id="a1be7-223">Getting the Clients property of the context and putting it in the StockTickerClient property lets you write code to call client methods that looks the same as it would in a Hub class.</span></span> <span data-ttu-id="a1be7-224">Um für alle Clients übertragen können Sie z. B. Clients.All.updateStockPrice(stock) schreiben.</span><span class="sxs-lookup"><span data-stu-id="a1be7-224">For instance, to broadcast to all clients you can write Clients.All.updateStockPrice(stock).</span></span>

    <span data-ttu-id="a1be7-225">Die UpdateStockPrice-Methode, die Sie in BroadcastStockPrice aufrufen vorhanden nicht noch. Sie müssen es später hinzufügen, wenn Sie Code schreiben, der auf dem Client ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="a1be7-225">The updateStockPrice method that you are calling in BroadcastStockPrice doesn't exist yet; you'll add it later when you write code that runs on the client.</span></span> <span data-ttu-id="a1be7-226">Sie können auf UpdateStockPrice hier verweisen, da Clients.All dynamisch "," ist. Dies bedeutet, dass der Ausdruck zur Laufzeit ausgewertet werden soll.</span><span class="sxs-lookup"><span data-stu-id="a1be7-226">You can refer to updateStockPrice here because Clients.All is dynamic, which means the expression will be evaluated at runtime.</span></span> <span data-ttu-id="a1be7-227">Bei der Ausführung dieser Methodenaufruf SignalR wird der Name der Methode und der Wert des Parameters an den Client gesendet, und wenn der Client eine Methode namens UpdateStockPrice verfügt, wird diese Methode aufgerufen werden und der Wert des Parameters wird an sie übergeben werden.</span><span class="sxs-lookup"><span data-stu-id="a1be7-227">When this method call executes, SignalR will send the method name and the parameter value to the client, and if the client has a method named updateStockPrice, that method will be called and the parameter value will be passed to it.</span></span>

    <span data-ttu-id="a1be7-228">Clients.All bedeutet an alle Clients zu senden.</span><span class="sxs-lookup"><span data-stu-id="a1be7-228">Clients.All means send to all clients.</span></span> <span data-ttu-id="a1be7-229">SignalR bietet Ihnen weitere Optionen an, welche Clients oder Gruppen von Clients zum Senden an.</span><span class="sxs-lookup"><span data-stu-id="a1be7-229">SignalR gives you other options to specify which clients or groups of clients to send to.</span></span> <span data-ttu-id="a1be7-230">Weitere Informationen finden Sie unter [HubConnectionContext](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.hubs.hubconnectioncontext(v=vs.111).aspx).</span><span class="sxs-lookup"><span data-stu-id="a1be7-230">For more information, see [HubConnectionContext](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.hubs.hubconnectioncontext(v=vs.111).aspx).</span></span>

### <a name="register-the-signalr-route"></a><span data-ttu-id="a1be7-231">Registrieren Sie die SignalR-route</span><span class="sxs-lookup"><span data-stu-id="a1be7-231">Register the SignalR route</span></span>

<span data-ttu-id="a1be7-232">Der Server muss wissen, welche URL abfangen und Weiterleiten auf SignalR.</span><span class="sxs-lookup"><span data-stu-id="a1be7-232">The server needs to know which URL to intercept and direct to SignalR.</span></span> <span data-ttu-id="a1be7-233">Die Sie hinzufügen möchten und OWIN-Start-Klasse.</span><span class="sxs-lookup"><span data-stu-id="a1be7-233">To do that you'll add and OWIN startup class.</span></span>

1. <span data-ttu-id="a1be7-234">In **Projektmappen-Explorer**mit der rechten Maustaste auf das Projekt, und klicken Sie dann auf **hinzufügen | OWIN-Startklasse**.</span><span class="sxs-lookup"><span data-stu-id="a1be7-234">In **Solution Explorer**, right-click the project, and then click **Add | OWIN Startup Class**.</span></span> <span data-ttu-id="a1be7-235">Benennen Sie die Klasse **Startup.cs**.</span><span class="sxs-lookup"><span data-stu-id="a1be7-235">Name the class **Startup.cs**.</span></span>
2. <span data-ttu-id="a1be7-236">Ersetzen Sie den Code in **Startup.cs** durch Folgendes.</span><span class="sxs-lookup"><span data-stu-id="a1be7-236">Replace the code in **Startup.cs** with the following.</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample10.cs)]

<span data-ttu-id="a1be7-237">Sie haben nun das Einrichten der Servercode abgeschlossen.</span><span class="sxs-lookup"><span data-stu-id="a1be7-237">You have now completed setting up the server code.</span></span> <span data-ttu-id="a1be7-238">Im nächsten Abschnitt richten Sie den Client.</span><span class="sxs-lookup"><span data-stu-id="a1be7-238">In the next section you'll set up the client.</span></span>

<a id="client"></a>

## <a name="set-up-the-client-code"></a><span data-ttu-id="a1be7-239">Der Clientcode einrichten</span><span class="sxs-lookup"><span data-stu-id="a1be7-239">Set up the client code</span></span>

1. <span data-ttu-id="a1be7-240">Erstellen Sie eine neue HTML-Datei im Projektordner, und nennen sie *StockTicker.html*.</span><span class="sxs-lookup"><span data-stu-id="a1be7-240">Create a new HTML file in the project folder, and name it *StockTicker.html*.</span></span>
2. <span data-ttu-id="a1be7-241">Ersetzen Sie den Vorlagencode durch den folgenden Code ein.</span><span class="sxs-lookup"><span data-stu-id="a1be7-241">Replace the template code with the following code.</span></span>

    [!code-html[Main](tutorial-server-broadcast-with-signalr/samples/sample11.html)]

    <span data-ttu-id="a1be7-242">Der HTML-Code erstellt eine Tabelle mit 5 Spalten, eine Kopfzeile und einer Datenzeile mit einer einzigen Zelle, die alle 5 Spalten umfasst.</span><span class="sxs-lookup"><span data-stu-id="a1be7-242">The HTML creates a table with 5 columns, a header row, and a data row with a single cell that spans all 5 columns.</span></span> <span data-ttu-id="a1be7-243">Die Datenzeile zeigt "laden" und wird nur vorübergehend, beim Starten der Anwendung angezeigt werden.</span><span class="sxs-lookup"><span data-stu-id="a1be7-243">The data row displays "loading..." and will only be shown momentarily when the application starts.</span></span> <span data-ttu-id="a1be7-244">JavaScript-Code wird diese Zeile zu entfernen, und fügen in seinen Zeilen vorhanden, mit Börsendaten vom Server abgerufen.</span><span class="sxs-lookup"><span data-stu-id="a1be7-244">JavaScript code will remove that row and add in its place rows with stock data retrieved from the server.</span></span>

    <span data-ttu-id="a1be7-245">Die Skripttags geben die jQuery-Skriptdatei, die SignalR Core-Skriptdatei der Skriptdatei für SignalR-Proxys und einer StockTicker-Skriptdatei, die Sie später erstellen.</span><span class="sxs-lookup"><span data-stu-id="a1be7-245">The script tags specify the jQuery script file, the SignalR core script file, the SignalR proxies script file, and a StockTicker script file that you'll create later.</span></span> <span data-ttu-id="a1be7-246">Der SignalR Proxys-Skriptdatei, die die URL "/ Signalr/Hubs" angegeben wird, wird dynamisch generiert und Proxymethoden für die Methoden in der Hub-Klasse, in diesem Fall für StockTickerHub.GetAllStocks definiert.</span><span class="sxs-lookup"><span data-stu-id="a1be7-246">The SignalR proxies script file, which specifies the "/signalr/hubs" URL, is dynamically generated and defines proxy methods for the methods on the Hub class, in this case for StockTickerHub.GetAllStocks.</span></span> <span data-ttu-id="a1be7-247">Wenn Sie dies bevorzugen, können Sie diese JavaScript-Datei manuell generieren, mit [SignalR-Hilfsprogramme](http://nuget.org/packages/Microsoft.AspNet.SignalR.Utils/) und dynamische Erstellung im Methodenaufruf MapHubs deaktivieren.</span><span class="sxs-lookup"><span data-stu-id="a1be7-247">If you prefer, you can generate this JavaScript file manually by using [SignalR Utilities](http://nuget.org/packages/Microsoft.AspNet.SignalR.Utils/) and disable dynamic file creation in the MapHubs method call.</span></span>
3. > [!IMPORTANT]
   > <span data-ttu-id="a1be7-248">Stellen Sie sicher, dass in die JavaScript-Datei verweist auf *StockTicker.html* richtig sind.</span><span class="sxs-lookup"><span data-stu-id="a1be7-248">Make sure that the JavaScript file references in *StockTicker.html* are correct.</span></span> <span data-ttu-id="a1be7-249">D. h. Stellen Sie sicher, dass die jQuery-Version in Ihr Skripttag (1.10.2 im Beispiel) identisch mit dem jQuery-Version in Ihrem Projekts ist *Skripts* Ordner, und stellen Sie sicher, dass die SignalR-Version in Ihr Skripttag identisch mit SignalR ist die Version in Ihrem Projekts *Skripts* Ordner.</span><span class="sxs-lookup"><span data-stu-id="a1be7-249">That is, make sure that the jQuery version in your script tag (1.10.2 in the example) is the same as the jQuery version in your project's *Scripts* folder, and make sure that the SignalR version in your script tag is the same as the SignalR version in your project's *Scripts* folder.</span></span> <span data-ttu-id="a1be7-250">Ändern Sie die Dateinamen in den Skripttags bei Bedarf.</span><span class="sxs-lookup"><span data-stu-id="a1be7-250">Change the file names in the script tags if necessary.</span></span>
4. <span data-ttu-id="a1be7-251">In **Projektmappen-Explorer**, mit der rechten Maustaste *StockTicker.html*, und klicken Sie dann auf **als Startseite festlegen**.</span><span class="sxs-lookup"><span data-stu-id="a1be7-251">In **Solution Explorer**, right-click *StockTicker.html*, and then click **Set as Start Page**.</span></span>
5. <span data-ttu-id="a1be7-252">Erstellen Sie eine neue JavaScript-Datei im Projektordner, und nennen Sie sie *StockTicker.js*...</span><span class="sxs-lookup"><span data-stu-id="a1be7-252">Create a new JavaScript file in the project folder and name it *StockTicker.js*..</span></span>
6. <span data-ttu-id="a1be7-253">Ersetzen Sie den Vorlagencode, durch den folgenden Code:</span><span class="sxs-lookup"><span data-stu-id="a1be7-253">Replace the template code with the following code:</span></span>

    [!code-javascript[Main](tutorial-server-broadcast-with-signalr/samples/sample12.js)]

    <span data-ttu-id="a1be7-254">$.connection bezieht sich auf die SignalR-Proxys.</span><span class="sxs-lookup"><span data-stu-id="a1be7-254">$.connection refers to the SignalR proxies.</span></span> <span data-ttu-id="a1be7-255">Der Code Ruft einen Verweis auf den Proxy für die Klasse StockTickerHub und fügt sie in die Ticker-Variable.</span><span class="sxs-lookup"><span data-stu-id="a1be7-255">The code gets a reference to the proxy for the StockTickerHub class and puts it in the ticker variable.</span></span> <span data-ttu-id="a1be7-256">Der Proxyname ist der Name, der durch das Attribut [HubName] festgelegt wurde:</span><span class="sxs-lookup"><span data-stu-id="a1be7-256">The proxy name is the name that was set by the [HubName] attribute:</span></span>

    [!code-javascript[Main](tutorial-server-broadcast-with-signalr/samples/sample13.js)]

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample14.cs)]

    <span data-ttu-id="a1be7-257">Nachdem alle Variablen und Funktionen definiert wurden, initialisiert die letzte Codezeile in der Datei die SignalR-Verbindung durch Aufrufen der SignalR-Start-Funktion.</span><span class="sxs-lookup"><span data-stu-id="a1be7-257">After all the variables and functions are defined, the last line of code in the file initializes the SignalR connection by calling the SignalR start function.</span></span> <span data-ttu-id="a1be7-258">Die Startfunktion führt asynchron aus und gibt eine [jQuery zurückgestellt Objekt](http://api.jquery.com/category/deferred-object/), das bedeutet, dass kann rufen Sie die "Fertig" ändert Funktion, um anzugeben, die Funktion, die aufgerufen wird, wenn der asynchrone Vorgang abgeschlossen ist...</span><span class="sxs-lookup"><span data-stu-id="a1be7-258">The start function executes asynchronously and returns a [jQuery Deferred object](http://api.jquery.com/category/deferred-object/), which means you can call the done function to specify the function to call when the asynchronous operation is completed..</span></span>

    [!code-javascript[Main](tutorial-server-broadcast-with-signalr/samples/sample15.js)]

    <span data-ttu-id="a1be7-259">Die Initialisierungsfunktion Ruft die GetAllStocks-Funktion auf dem Server und verwendet die Informationen, die der Server zum Aktualisieren der Lagerbestandstabelle zurückgibt.</span><span class="sxs-lookup"><span data-stu-id="a1be7-259">The init function calls the getAllStocks function on the server and uses the information that the server returns to update the stock table.</span></span> <span data-ttu-id="a1be7-260">Beachten Sie, dass standardmäßig Kamel-Schreibweise auf dem Client, obwohl der Methodenname auf dem Server Pascal-Schreibweise ist verwendet.</span><span class="sxs-lookup"><span data-stu-id="a1be7-260">Notice that by default, you have to use camel casing on the client although the method name is pascal-cased on the server.</span></span> <span data-ttu-id="a1be7-261">Die Regel in Kamel-Schreibweise gilt nur für Methoden, die keine Objekte.</span><span class="sxs-lookup"><span data-stu-id="a1be7-261">The camel-casing rule only applies to methods, not objects.</span></span> <span data-ttu-id="a1be7-262">Beispielsweise finden Sie in den Bestand. Symbol "und" Stock ". Preis, nicht stock.symbol oder stock.price.</span><span class="sxs-lookup"><span data-stu-id="a1be7-262">For example, you refer to stock.Symbol and stock.Price, not stock.symbol or stock.price.</span></span>

    [!code-javascript[Main](tutorial-server-broadcast-with-signalr/samples/sample16.js)]

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample17.cs)]

    <span data-ttu-id="a1be7-263">Wenn auf dem Client wie in Pascal-Schreibweise verwendet, oder wenn Sie einen ganz anderen Methodennamen verwenden möchten, Sie die Hub-Methode mit dem Attribut HubMethodName die gleiche Weise ergänzen konnte ergänzt Sie den Hub-Klasse selbst mit dem Attribut HubName.</span><span class="sxs-lookup"><span data-stu-id="a1be7-263">If you wanted to use pascal casing on the client, or if you wanted to use a completely different method name, you could decorate the Hub method with the HubMethodName attribute the same way you decorated the Hub class itself with the HubName attribute.</span></span>

    <span data-ttu-id="a1be7-264">HTML-Code für eine Tabellenzeile wird erstellt in der Init-Methode für die einzelnen vordefinierten Objekte, die vom aufrufenden FormatStock um Formateigenschaften des vordefinierten Objekts vom Server empfangen, und klicken Sie dann durch den Aufruf bereitgestellt (die am oberen Rand definiert wird *StockTicker.js*) um Platzhalter in der Variablen RowTemplate durch die vordefinierten objekteigenschaftswerte zu ersetzen.</span><span class="sxs-lookup"><span data-stu-id="a1be7-264">In the init method, HTML for a table row is created for each stock object received from the server by calling formatStock to format properties of the stock object, and then by calling supplant (which is defined at the top of *StockTicker.js*) to replace placeholders in the rowTemplate variable with the stock object property values.</span></span> <span data-ttu-id="a1be7-265">Der resultierende HTML-Code wird dann an die Lagerbestandstabelle angefügt.</span><span class="sxs-lookup"><span data-stu-id="a1be7-265">The resulting HTML is then appended to the stock table.</span></span>

    <span data-ttu-id="a1be7-266">Sie rufen Init als eine Rückruffunktion, die ausgeführt wird, nach Abschluss der asynchronen Start '-Funktion übergibt.</span><span class="sxs-lookup"><span data-stu-id="a1be7-266">You call init by passing it in as a callback function that executes after the asynchronous start function completes.</span></span> <span data-ttu-id="a1be7-267">Wenn Sie als separate JavaScript-Anweisung nach dem Aufrufen der Start Init aufgerufen, wird die Funktion fehl, weil er sofort ausgeführt würde, ohne zu warten, für die Startfunktion zum Herstellen der Verbindung abzuschließen.</span><span class="sxs-lookup"><span data-stu-id="a1be7-267">If you called init as a separate JavaScript statement after calling start, the function would fail because it would execute immediately without waiting for the start function to finish establishing the connection.</span></span> <span data-ttu-id="a1be7-268">In diesem Fall versucht die Init-Funktion würde die GetAllStocks-Funktion aufrufen, bevor die Server-Verbindung hergestellt wird.</span><span class="sxs-lookup"><span data-stu-id="a1be7-268">In that case, the init function would try to call the getAllStocks function before the server connection is established.</span></span>

    <span data-ttu-id="a1be7-269">Wenn der Server einen Kurs geändert wird, ruft er die UpdateStockPrice auf verbundenen Clients.</span><span class="sxs-lookup"><span data-stu-id="a1be7-269">When the server changes a stock's price, it calls the updateStockPrice on connected clients.</span></span> <span data-ttu-id="a1be7-270">Die Funktion wird der Client-Eigenschaft des Proxys StockTicker hinzugefügt, damit er auf Aufrufe vom Server zur Verfügung.</span><span class="sxs-lookup"><span data-stu-id="a1be7-270">The function is added to the client property of the stockTicker proxy in order to make it available to calls from the server.</span></span>

    [!code-javascript[Main](tutorial-server-broadcast-with-signalr/samples/sample18.js)]

    <span data-ttu-id="a1be7-271">Die Funktion UpdateStockPrice formatiert ein vordefiniertes Objekt, das vom Server empfangene in einer Zeile einer Tabelle die gleiche Weise wie in der Init-Funktion.</span><span class="sxs-lookup"><span data-stu-id="a1be7-271">The updateStockPrice function formats a stock object received from the server into a table row the same way as in the init function.</span></span> <span data-ttu-id="a1be7-272">Allerdings es anstelle von Anhängen der zeilenupdates der Tabelle, einer Gruppe sucht die Stock aktuelle Zeile in der Tabelle und ersetzt diese Zeile durch die neue Version.</span><span class="sxs-lookup"><span data-stu-id="a1be7-272">However, instead of appending the row to the table, it finds the stock's current row in the table and replaces that row with the new one.</span></span>

<a id="test"></a>

## <a name="test-the-application"></a><span data-ttu-id="a1be7-273">Testen der Anwendung</span><span class="sxs-lookup"><span data-stu-id="a1be7-273">Test the application</span></span>

1. <span data-ttu-id="a1be7-274">Drücken Sie F5, um die Anwendung im Debugmodus auszuführen.</span><span class="sxs-lookup"><span data-stu-id="a1be7-274">Press F5 to run the application in debug mode.</span></span>

    <span data-ttu-id="a1be7-275">Die Lagerbestandstabelle anfänglich zeigt die "wird geladen..." Zeile, klicken Sie dann nach einer kurzen Verzögerung, die die vordefinierten Anfangsdaten angezeigt werden, und starten Sie die Aktienkurse ändern.</span><span class="sxs-lookup"><span data-stu-id="a1be7-275">The stock table initially displays the "loading..." line, then after a short delay the initial stock data is displayed, and then the stock prices start to change.</span></span>

    ![Laden](tutorial-server-broadcast-with-signalr/_static/image6.png)

    ![Anfängliche Lagerbestandstabelle](tutorial-server-broadcast-with-signalr/_static/image7.png)

    ![Lagerbestandstabelle Änderungen vom Server empfangen.](tutorial-server-broadcast-with-signalr/_static/image8.png)
2. <span data-ttu-id="a1be7-279">Kopieren Sie die URL aus der Adressleiste des Browsers ein, und fügen Sie ihn in eine oder mehrere neue Browser die Dauer.</span><span class="sxs-lookup"><span data-stu-id="a1be7-279">Copy the URL from the browser address bar and paste it into one or more new browser window(s).</span></span>

    <span data-ttu-id="a1be7-280">Die erste vordefinierte Anzeige ist identisch mit der ersten Browser aus, und Änderungen gleichzeitig ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="a1be7-280">The initial stock display is the same as the first browser and changes happen simultaneously.</span></span>
3. <span data-ttu-id="a1be7-281">Schließen von allen Browsern, öffnen Sie ein neues Browserfenster, und wechseln Sie zur gleichen URL.</span><span class="sxs-lookup"><span data-stu-id="a1be7-281">Close all browsers and open a new browser, then go to the same URL.</span></span>

    <span data-ttu-id="a1be7-282">StockTicker Singleton-Objekt weiterhin auf dem Server ausgeführt werden, damit der Lagerbestandstabelle zeigt, dass die Aktien weiterhin geändert haben.</span><span class="sxs-lookup"><span data-stu-id="a1be7-282">The StockTicker singleton object has continued to run in the server, so the stock table display shows that the stocks have continued to change.</span></span> <span data-ttu-id="a1be7-283">(Die ersten Tabelle mit 0 (null) Zahlen ändern nicht angezeigt werden.)</span><span class="sxs-lookup"><span data-stu-id="a1be7-283">(You don't see the initial table with zero change figures.)</span></span>
4. <span data-ttu-id="a1be7-284">Schließen Sie den Browser.</span><span class="sxs-lookup"><span data-stu-id="a1be7-284">Close the browser.</span></span>

<a id="enablelogging"></a>

## <a name="enable-logging"></a><span data-ttu-id="a1be7-285">Protokollierung aktivieren</span><span class="sxs-lookup"><span data-stu-id="a1be7-285">Enable logging</span></span>

<span data-ttu-id="a1be7-286">SignalR ist eine integrierte Protokollierungsfunktion, die Sie auf dem Client aktivieren können, um bei der Problembehandlung.</span><span class="sxs-lookup"><span data-stu-id="a1be7-286">SignalR has a built-in logging function that you can enable on the client to aid in troubleshooting.</span></span> <span data-ttu-id="a1be7-287">In diesem Abschnitt werden die Protokollierung aktivieren und finden Sie Beispiele, die zeigen, wie Protokolle Aufschluss darüber, welche der folgenden Transportmethoden SignalR verwendet wird:</span><span class="sxs-lookup"><span data-stu-id="a1be7-287">In this section you enable logging and see examples that show how logs tell you which of the following transport methods SignalR is using:</span></span>

- <span data-ttu-id="a1be7-288">[WebSockets](http://en.wikipedia.org/wiki/WebSocket), wird von IIS 8 und aktuellen Browsern unterstützt.</span><span class="sxs-lookup"><span data-stu-id="a1be7-288">[WebSockets](http://en.wikipedia.org/wiki/WebSocket), supported by IIS 8 and current browsers.</span></span>
- <span data-ttu-id="a1be7-289">[Vom Server gesendeten Ereignisse](http://en.wikipedia.org/wiki/Server-sent_events), wird vom Browser als Internet Explorer unterstützt.</span><span class="sxs-lookup"><span data-stu-id="a1be7-289">[Server-sent events](http://en.wikipedia.org/wiki/Server-sent_events), supported by browsers other than Internet Explorer.</span></span>
- <span data-ttu-id="a1be7-290">[Forever frame](http://en.wikipedia.org/wiki/Comet_(programming)#Hidden_iframe), wird von Internet Explorer unterstützt.</span><span class="sxs-lookup"><span data-stu-id="a1be7-290">[Forever frame](http://en.wikipedia.org/wiki/Comet_(programming)#Hidden_iframe), supported by Internet Explorer.</span></span>
- <span data-ttu-id="a1be7-291">[Lange abrufen AJAX](http://en.wikipedia.org/wiki/Comet_(programming)#Ajax_with_long_polling), wird von allen Browsern unterstützt.</span><span class="sxs-lookup"><span data-stu-id="a1be7-291">[Ajax long polling](http://en.wikipedia.org/wiki/Comet_(programming)#Ajax_with_long_polling), supported by all browsers.</span></span>

<span data-ttu-id="a1be7-292">Für eine bestimmte Verbindung wählt SignalR die beste Transportmethode, die dem Server und dem Client zu unterstützen.</span><span class="sxs-lookup"><span data-stu-id="a1be7-292">For any given connection, SignalR chooses the best transport method that both the server and the client support.</span></span>

1. <span data-ttu-id="a1be7-293">Open *StockTicker.js* und fügen Sie eine Codezeile zum Aktivieren der Protokollierung unmittelbar vor dem Code, der die Verbindung am Ende der Datei initialisiert:</span><span class="sxs-lookup"><span data-stu-id="a1be7-293">Open *StockTicker.js* and add a line of code to enable logging immediately before the code that initializes the connection at the end of the file:</span></span>

    [!code-javascript[Main](tutorial-server-broadcast-with-signalr/samples/sample19.js)]
2. <span data-ttu-id="a1be7-294">Drücken Sie F5, um das Projekt auszuführen.</span><span class="sxs-lookup"><span data-stu-id="a1be7-294">Press F5 to run the project.</span></span>
3. <span data-ttu-id="a1be7-295">Öffnen Sie Ihres Browsers Developer Tools-Fenster zu, und wählen Sie die Konsole, um die Protokolle finden Sie unter.</span><span class="sxs-lookup"><span data-stu-id="a1be7-295">Open your browser's developer tools window, and select the Console to see the logs.</span></span> <span data-ttu-id="a1be7-296">Sie müssen möglicherweise aktualisieren Sie die Seite, um die Protokolle der Transportmethode für eine neue Verbindung aushandeln Signalr finden Sie unter.</span><span class="sxs-lookup"><span data-stu-id="a1be7-296">You might have to refresh the page to see the logs of Signalr negotiating the transport method for a new connection.</span></span>

    <span data-ttu-id="a1be7-297">Wenn Sie Internet Explorer 10 unter Windows 8 (IIS 8) ausgeführt werden, ist die Transportmethode WebSockets.</span><span class="sxs-lookup"><span data-stu-id="a1be7-297">If you are running Internet Explorer 10 on Windows 8 (IIS 8), the transport method is WebSockets.</span></span>

    ![IE 10 IIS 8 Console](tutorial-server-broadcast-with-signalr/_static/image9.png)

    <span data-ttu-id="a1be7-299">Wenn Sie Internet Explorer 10 unter Windows 7 (IIS 7.5) ausgeführt werden, ist die Transportmethode Iframe.</span><span class="sxs-lookup"><span data-stu-id="a1be7-299">If you are running Internet Explorer 10 on Windows 7 (IIS 7.5), the transport method is iframe.</span></span>

    ![IE 10 Console, IIS 7.5](tutorial-server-broadcast-with-signalr/_static/image10.png)

    <span data-ttu-id="a1be7-301">Installieren Sie in Firefox das Firebug-add-in zum Abrufen eines Konsolenfensters.</span><span class="sxs-lookup"><span data-stu-id="a1be7-301">In Firefox, install the Firebug add-in to get a Console window.</span></span> <span data-ttu-id="a1be7-302">Wenn Sie Firefox 19 unter Windows 8 (IIS 8) ausgeführt werden, ist die Transportmethode WebSockets.</span><span class="sxs-lookup"><span data-stu-id="a1be7-302">If you are running Firefox 19 on Windows 8 (IIS 8), the transport method is WebSockets.</span></span>

    ![Firefox 19 IIS 8 Websockets](tutorial-server-broadcast-with-signalr/_static/image11.png)

    <span data-ttu-id="a1be7-304">Wenn Sie Firefox 19 unter Windows 7 (IIS 7.5) ausgeführt werden, ist die Transportmethode Server gesendete Ereignisse.</span><span class="sxs-lookup"><span data-stu-id="a1be7-304">If you are running Firefox 19 on Windows 7 (IIS 7.5), the transport method is server-sent events.</span></span>

    ![Firefox 19 IIS 7.5 Console](tutorial-server-broadcast-with-signalr/_static/image12.png)

<a id="fullsample"></a>

## <a name="install-and-review-the-full-stockticker-sample"></a><span data-ttu-id="a1be7-306">Installieren Sie und überprüfen Sie die vollständige StockTicker-Beispiel</span><span class="sxs-lookup"><span data-stu-id="a1be7-306">Install and review the full StockTicker sample</span></span>

<span data-ttu-id="a1be7-307">Die StockTicker-Anwendung, die installiert ist, indem die [Microsoft.AspNet.SignalR.Sample](http://nuget.org/packages/microsoft.aspnet.signalr.sample) NuGet-Paket bietet mehr Funktionen als die vereinfachte Version, die Sie gerade von Grund auf neu erstellt.</span><span class="sxs-lookup"><span data-stu-id="a1be7-307">The StockTicker application that is installed by the [Microsoft.AspNet.SignalR.Sample](http://nuget.org/packages/microsoft.aspnet.signalr.sample) NuGet package includes more features than the simplified version that you just created from scratch.</span></span> <span data-ttu-id="a1be7-308">In diesem Abschnitt des Lernprogramms müssen Sie das NuGet-Paket installieren und überprüfen Sie die neuen Funktionen und den Code, der sie implementiert.</span><span class="sxs-lookup"><span data-stu-id="a1be7-308">In this section of the tutorial, you install the NuGet package and review the new features and the code that implements them.</span></span> <span data-ttu-id="a1be7-309">Wenn Sie das Paket installieren, ohne den früheren Schritten dieses Lernprogramms auszuführen, müssen Sie eine OWIN-Startklasse zu Ihrem Projekt hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="a1be7-309">If you install the package without performing the earlier steps of this tutorial, you must add an OWIN startup class to your project.</span></span> <span data-ttu-id="a1be7-310">Dieser Schritt wird in der Datei "Readme.txt" des NuGet-Pakets erläutert.</span><span class="sxs-lookup"><span data-stu-id="a1be7-310">This step is explained in the readme.txt file for the NuGet package.</span></span>

### <a name="install-the-signalrsample-nuget-package"></a><span data-ttu-id="a1be7-311">Installieren Sie das SignalR.Sample NuGet-Paket</span><span class="sxs-lookup"><span data-stu-id="a1be7-311">Install the SignalR.Sample NuGet package</span></span>

1. <span data-ttu-id="a1be7-312">In **Projektmappen-Explorer**mit der rechten Maustaste auf das Projekt, und klicken Sie auf **NuGet-Pakete verwalten**.</span><span class="sxs-lookup"><span data-stu-id="a1be7-312">In **Solution Explorer**, right-click the project and click **Manage NuGet Packages**.</span></span>
2. <span data-ttu-id="a1be7-313">In der **NuGet-Pakete verwalten** (Dialogfeld), klicken Sie auf **Online**, geben Sie *SignalR.Sample* in der **Online suchen** Feld, und klicken Sie dann auf  **Installieren Sie** in der **SignalR.Sample** Paket.</span><span class="sxs-lookup"><span data-stu-id="a1be7-313">In the **Manage NuGet Packages** dialog box, click **Online**, enter *SignalR.Sample* in the **Search Online** box, and then click **Install** in the **SignalR.Sample** package.</span></span>

    ![SignalR.Sample-Paket installieren](tutorial-server-broadcast-with-signalr/_static/image13.png)
3. <span data-ttu-id="a1be7-315">In **Projektmappen-Explorer**, erweitern Sie die *SignalR.Sample* Ordner, der durch die Installation des Pakets SignalR.Sample erstellt wurde.</span><span class="sxs-lookup"><span data-stu-id="a1be7-315">In **Solution Explorer**, expand the *SignalR.Sample* folder which was created by installing the SignalR.Sample package.</span></span>
4. <span data-ttu-id="a1be7-316">In der *SignalR.Sample* Ordner mit der rechten Maustaste *StockTicker.html*, und klicken Sie dann auf **als Startseite festlegen**.</span><span class="sxs-lookup"><span data-stu-id="a1be7-316">In the *SignalR.Sample* folder, right-click *StockTicker.html*, and then click **Set As Start Page**.</span></span>

    > [!NOTE]
    > <span data-ttu-id="a1be7-317">Installieren der SignalR.Sample NuGet-Paket möglicherweise ändern Sie die Version von jQuery, die Sie in Ihrem *Skripts* Ordner.</span><span class="sxs-lookup"><span data-stu-id="a1be7-317">Installing The SignalR.Sample NuGet package might change the version of jQuery that you have in your *Scripts* folder.</span></span> <span data-ttu-id="a1be7-318">Die neue *StockTicker.html* Datei zur Installation des Pakets in der *SignalR.Sample* Ordner wird mit der jQuery-Version, die vom Paket wird installiert, aber wenn Sie Ihre ursprüngliche ausführenmöchten,synchronisiertsein*StockTicker.html* Datei erneut, die Sie möglicherweise zuerst aktualisieren den jQuery-Verweis in das Skript-Tag.</span><span class="sxs-lookup"><span data-stu-id="a1be7-318">The new *StockTicker.html* file that the package installs in the *SignalR.Sample* folder will be in sync with the jQuery version that the package installs, but if you want to run your original *StockTicker.html* file again, you might have to update the jQuery reference in the script tag first.</span></span>

### <a name="run-the-application"></a><span data-ttu-id="a1be7-319">Ausführen der Anwendung</span><span class="sxs-lookup"><span data-stu-id="a1be7-319">Run the application</span></span>

1. <span data-ttu-id="a1be7-320">Drücken Sie F5, um die Anwendung auszuführen.</span><span class="sxs-lookup"><span data-stu-id="a1be7-320">Press F5 to run the application.</span></span>

    <span data-ttu-id="a1be7-321">Zusätzlich zu den im Raster, das Sie zuvor gesehen haben, zeigt die vollständige Börsenticker-Anwendung horizontal scrollbaren Fensters, das die gleichen Börsendaten anzeigt.</span><span class="sxs-lookup"><span data-stu-id="a1be7-321">In addition to the grid that you saw earlier, the full stock ticker application shows a horizontally scrolling window that displays the same stock data.</span></span> <span data-ttu-id="a1be7-322">Wenn Sie die Anwendung zum ersten Mal ausführen, der "Markt" ist "geschlossen", und sehen eine statische Raster und ein Börsenticker-Fenster, das Durchführen eines Bildlaufs ist nicht.</span><span class="sxs-lookup"><span data-stu-id="a1be7-322">When you run the application for the first time, the "market" is "closed" and you see a static grid and a ticker window that isn't scrolling.</span></span>

    ![StockTicker Bildschirm starten](tutorial-server-broadcast-with-signalr/_static/image14.png)

    <span data-ttu-id="a1be7-324">Beim Klicken auf **Open Market**, **Börsenticker Live** Feld einen horizontalen Bildlauf durchführen, und der Server startet Aktienkurs Änderungen werden nach dem Zufallsprinzip in regelmäßigen Abständen zu übertragen.</span><span class="sxs-lookup"><span data-stu-id="a1be7-324">When you click **Open Market**, the **Live Stock Ticker** box starts to scroll horizontally, and the server starts to periodically broadcast stock price changes on a random basis.</span></span> <span data-ttu-id="a1be7-325">Jedes Mal, wenn einen Aktienkurs ändert, sowohl die **Live Stock Tabelle** Raster und **Börsenticker Live** Feld aktualisiert werden.</span><span class="sxs-lookup"><span data-stu-id="a1be7-325">Each time a stock price changes, both the **Live Stock Table** grid and the **Live Stock Ticker** box are updated.</span></span> <span data-ttu-id="a1be7-326">Ein Aktienkurs Preisänderung positiv ist, wird die Stock mit einem grünen Hintergrund angezeigt, und wenn die Änderung negativ ist, wird die Stock mit einem roten Hintergrund angezeigt.</span><span class="sxs-lookup"><span data-stu-id="a1be7-326">When a stock's price change is positive, the stock is shown with a green background, and when the change is negative, the stock is shown with a red background.</span></span>

    ![StockTicker-app, um Zugang zum Markt öffnen](tutorial-server-broadcast-with-signalr/_static/image15.png)

    <span data-ttu-id="a1be7-328">Die **schließen Markt** Schaltfläche verhindert die Änderungen und Ticker Bildlauf beendet wird und die **zurücksetzen** Schaltfläche setzt alle vordefinierte Daten an den Ausgangszustand zurück, bevor preisänderungen gestartet.</span><span class="sxs-lookup"><span data-stu-id="a1be7-328">The **Close Market** button stops the changes and stops the ticker scrolling, and the **Reset** button resets all stock data to the initial state before price changes started.</span></span> <span data-ttu-id="a1be7-329">Wenn Sie weitere Browserfenster zu öffnen, und wechseln Sie zur gleichen URL, sehen Sie die gleichen Daten, die gleichzeitig in jedem Browser dynamisch aktualisiert.</span><span class="sxs-lookup"><span data-stu-id="a1be7-329">If you open more browser windows and go to the same URL, you see the same data dynamically updated at the same time in each browser.</span></span> <span data-ttu-id="a1be7-330">Wenn Sie eine der Schaltflächen klicken, Antworten von allen Browsern die gleiche Weise zur gleichen Zeit.</span><span class="sxs-lookup"><span data-stu-id="a1be7-330">When you click one of the buttons, all browsers respond the same way at the same time.</span></span>

### <a name="live-stock-ticker-display"></a><span data-ttu-id="a1be7-331">Live Börsenticker anzeigen</span><span class="sxs-lookup"><span data-stu-id="a1be7-331">Live Stock Ticker display</span></span>

<span data-ttu-id="a1be7-332">Die **Börsenticker Live** Anzeige ist eine ungeordnete Liste in ein Div-Element, das zu einer einzigen Zeile von CSS-Formatvorlagen formatiert ist.</span><span class="sxs-lookup"><span data-stu-id="a1be7-332">The **Live Stock Ticker** display is an unordered list in a div element that is formatted into a single line by CSS styles.</span></span> <span data-ttu-id="a1be7-333">Die Ticker initialisiert und die gleiche Weise wie in der Tabelle aktualisiert: durch Ersetzen der Platzhalter in einer &lt;li&gt; Vorlagenzeichenfolge und dynamisch hinzufügen der &lt;li&gt; Elemente, die die &lt;Ul&gt; Element.</span><span class="sxs-lookup"><span data-stu-id="a1be7-333">The ticker is initialized and updated the same way as the table: by replacing placeholders in a &lt;li&gt; template string and dynamically adding the &lt;li&gt; elements to the &lt;ul&gt; element.</span></span> <span data-ttu-id="a1be7-334">Das Durchführen eines Bildlaufs erfolgt über die animieren jQuery-Funktion die Margin-Left der ungeordnete Liste innerhalb der div variieren</span><span class="sxs-lookup"><span data-stu-id="a1be7-334">The scrolling is performed by using the jQuery animate function to vary the margin-left of the unordered list within the div.</span></span>

<span data-ttu-id="a1be7-335">Die Börsenticker HTML:</span><span class="sxs-lookup"><span data-stu-id="a1be7-335">The stock ticker HTML:</span></span>

[!code-html[Main](tutorial-server-broadcast-with-signalr/samples/sample20.html)]

<span data-ttu-id="a1be7-336">Die Börsenticker CSS:</span><span class="sxs-lookup"><span data-stu-id="a1be7-336">The stock ticker CSS:</span></span>

[!code-html[Main](tutorial-server-broadcast-with-signalr/samples/sample21.html)]

<span data-ttu-id="a1be7-337">Der jQuery-Code, der es macht einen Bildlauf durchführen:</span><span class="sxs-lookup"><span data-stu-id="a1be7-337">The jQuery code that makes it scroll:</span></span>

[!code-javascript[Main](tutorial-server-broadcast-with-signalr/samples/sample22.js)]

### <a name="additional-methods-on-the-server-that-the-client-can-call"></a><span data-ttu-id="a1be7-338">Zusätzliche Methoden auf dem Server, den der Client aufrufen kann.</span><span class="sxs-lookup"><span data-stu-id="a1be7-338">Additional methods on the server that the client can call</span></span>

<span data-ttu-id="a1be7-339">Die Klasse StockTickerHub definiert vier zusätzliche Methoden, die der Client aufrufen kann:</span><span class="sxs-lookup"><span data-stu-id="a1be7-339">The StockTickerHub class defines four additional methods that the client can call:</span></span>

[!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample23.cs)]

<span data-ttu-id="a1be7-340">Als Antwort auf die Schaltflächen am oberen Rand der Seite "heißen OpenMarket CloseMarket und zurücksetzen.</span><span class="sxs-lookup"><span data-stu-id="a1be7-340">OpenMarket, CloseMarket, and Reset are called in response to the buttons at the top of the page.</span></span> <span data-ttu-id="a1be7-341">Sie veranschaulichen das Muster der ein Client Auslösen von Zustandsübergängen, die sofort auf alle Clients weitergegeben wird.</span><span class="sxs-lookup"><span data-stu-id="a1be7-341">They demonstrate the pattern of one client triggering a change in state that is immediately propagated to all clients.</span></span> <span data-ttu-id="a1be7-342">Jede dieser Methoden Ruft eine Methode in der Klasse StockTicker, Effekte, die der Zugang zum Markt Status ändern und anschließend broadcasts Zustand "Neu".</span><span class="sxs-lookup"><span data-stu-id="a1be7-342">Each of these methods calls a method in the StockTicker class that effects the market state change and then broadcasts the new state.</span></span>

<span data-ttu-id="a1be7-343">In der Klasse StockTicker wird der Status der Zugang zum Markt über eine Eigenschaft MarketState verwaltet, die einen MarketState Enum-Wert zurückgibt:</span><span class="sxs-lookup"><span data-stu-id="a1be7-343">In the StockTicker class, the state of the market is maintained by a MarketState property that returns a MarketState enum value:</span></span>

[!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample24.cs)]

<span data-ttu-id="a1be7-344">Jede der Methoden, die dem Markt Statuswechsel dazu innerhalb eines Blocks sperren, da die StockTicker-Klasse verfügt über hinsichtlich sein:</span><span class="sxs-lookup"><span data-stu-id="a1be7-344">Each of the methods that change the market state do so inside a lock block because the StockTicker class has to be threadsafe:</span></span>

[!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample25.cs)]

<span data-ttu-id="a1be7-345">Um sicherzustellen, dass dieser Code hinsichtlich, ist die \_MarketState hinter der MarketState-Eigenschaft liegenden Felds wird als veränderlich, markiert</span><span class="sxs-lookup"><span data-stu-id="a1be7-345">To ensure that this code is threadsafe, the \_marketState field that backs the MarketState property is marked as volatile,</span></span>

[!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample26.cs)]

<span data-ttu-id="a1be7-346">Die Methoden BroadcastMarketStateChange und BroadcastMarketReset ähneln BroadcastStockPrice-Methode, die Sie bereits gesehen haben, außer sie verschiedene Methoden, die auf dem Client definierten aufrufen:</span><span class="sxs-lookup"><span data-stu-id="a1be7-346">The BroadcastMarketStateChange and BroadcastMarketReset methods are similar to the BroadcastStockPrice method that you already saw, except they call different methods defined at the client:</span></span>

[!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample27.cs)]

### <a name="additional-functions-on-the-client-that-the-server-can-call"></a><span data-ttu-id="a1be7-347">Zusätzliche Funktionen auf dem Client, den der Server aufrufen können</span><span class="sxs-lookup"><span data-stu-id="a1be7-347">Additional functions on the client that the server can call</span></span>

<span data-ttu-id="a1be7-348">Die UpdateStockPrice-Funktion verarbeitet jetzt Raster und die Anzeige Ticker und jQuery.Color blinkt, Farben rote und grüne verwendet.</span><span class="sxs-lookup"><span data-stu-id="a1be7-348">The updateStockPrice function now handles both the grid and the ticker display, and it uses jQuery.Color to flash red and green colors.</span></span>

<span data-ttu-id="a1be7-349">Neue Funktionen in *SignalR.StockTicker.js* aktivieren oder deaktivieren Sie die Schaltflächen auf der Grundlage vermarkten Zustand, und sie die horizontale Bildlaufleiste für Ticker Fenster starten oder beenden.</span><span class="sxs-lookup"><span data-stu-id="a1be7-349">New functions in *SignalR.StockTicker.js* enable and disable the buttons based on market state, and they stop or start the ticker window horizontal scrolling.</span></span> <span data-ttu-id="a1be7-350">Da ticker.client, mehrere Funktionen hinzugefügt werden die [jQuery erweitern Funktion](http://api.jquery.com/jQuery.extend/) wird verwendet, um sie hinzuzufügen.</span><span class="sxs-lookup"><span data-stu-id="a1be7-350">Since multiple functions are being added to ticker.client, the [jQuery extend function](http://api.jquery.com/jQuery.extend/) is used to add them.</span></span>

[!code-javascript[Main](tutorial-server-broadcast-with-signalr/samples/sample28.js)]

### <a name="additional-client-setup-after-establishing-the-connection"></a><span data-ttu-id="a1be7-351">Zusätzliche Client-Setup nach dem Herstellen der Verbindung</span><span class="sxs-lookup"><span data-stu-id="a1be7-351">Additional client setup after establishing the connection</span></span>

<span data-ttu-id="a1be7-352">Nachdem der Client die Verbindung herstellt, weist Sie zusätzliche Arbeit leisten, Vorgehensweise: ermitteln, ob der Markt ist offen oder geschlossen ist, um die entsprechenden MarketOpened oder MarketClosed eine Funktion aufrufen, und fügen die Server-Methodenaufrufe, die Schaltflächen.</span><span class="sxs-lookup"><span data-stu-id="a1be7-352">After the client establishes the connection, it has some additional work to do: find out if the market is open or closed in order to call the appropriate marketOpened or marketClosed function, and attach the server method calls to the buttons.</span></span>

[!code-javascript[Main](tutorial-server-broadcast-with-signalr/samples/sample29.js)]

<span data-ttu-id="a1be7-353">Die Servermethoden sind nicht auf die Schaltflächen bis verkabelt. nach dem Herstellen der Verbindung, damit der Code versuchen kann nicht auf die Servermethoden aufrufen, damit sie verfügbar sind.</span><span class="sxs-lookup"><span data-stu-id="a1be7-353">The server methods are not wired up to the buttons until after the connection is established, so that the code can't try to call the server methods before they are available.</span></span>

<a id="nextsteps"></a>

## <a name="next-steps"></a><span data-ttu-id="a1be7-354">Nächste Schritte</span><span class="sxs-lookup"><span data-stu-id="a1be7-354">Next steps</span></span>

<span data-ttu-id="a1be7-355">In diesem Lernprogramm haben Sie gelernt, die eine SignalR-Anwendung zu programmieren, in denen Nachrichten vom Server für alle verbundenen Clients sowohl in regelmäßigen Abständen und Reaktion auf Benachrichtigungen von jedem beliebigen Client überträgt.</span><span class="sxs-lookup"><span data-stu-id="a1be7-355">In this tutorial you've learned how to program a SignalR application that broadcasts messages from the server to all connected clients, both on a periodic basis and in response to notifications from any client.</span></span> <span data-ttu-id="a1be7-356">Das Muster der Verwendung einer Multithread-Singleton-Instanz zur Beibehaltung des Zustands der Server kann auch auch in mehrere Spieler online game-Szenarien verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="a1be7-356">The pattern of using a multi-threaded singleton instance to maintain server state can also be also used in multi-player online game scenarios.</span></span> <span data-ttu-id="a1be7-357">Ein Beispiel finden Sie unter [ShootR-Spiels, die sich auf SignalR basierenden](https://github.com/NTaylorMullen/ShootR).</span><span class="sxs-lookup"><span data-stu-id="a1be7-357">For an example, see [the ShootR game that is based on SignalR](https://github.com/NTaylorMullen/ShootR).</span></span>

<span data-ttu-id="a1be7-358">Lernprogramme, die Peer-zu-Peer-Kommunikationsszenarien zeigen, finden Sie unter [erste Schritte mit SignalR](introduction-to-signalr.md) und [in Echtzeit aktualisiert, mit SignalR](tutorial-high-frequency-realtime-with-signalr.md).</span><span class="sxs-lookup"><span data-stu-id="a1be7-358">For tutorials that show peer-to-peer communication scenarios, see [Getting Started with SignalR](introduction-to-signalr.md) and [Real-Time Updating with SignalR](tutorial-high-frequency-realtime-with-signalr.md).</span></span>

<span data-ttu-id="a1be7-359">Erweiterte Konzepte von SignalR-Entwicklung finden Sie auf den folgenden Websites für SignalR-Quellcode und Ressourcen:</span><span class="sxs-lookup"><span data-stu-id="a1be7-359">To learn more advanced SignalR development concepts, visit the following sites for SignalR source code and resources:</span></span>

- [<span data-ttu-id="a1be7-360">ASP.NET SignalR</span><span class="sxs-lookup"><span data-stu-id="a1be7-360">ASP.NET SignalR</span></span>](../../index.md)
- [<span data-ttu-id="a1be7-361">SignalR-Projekt</span><span class="sxs-lookup"><span data-stu-id="a1be7-361">SignalR Project</span></span>](http://signalr.net/)
- [<span data-ttu-id="a1be7-362">SignalR Github und Beispiele</span><span class="sxs-lookup"><span data-stu-id="a1be7-362">SignalR Github and Samples</span></span>](https://github.com/SignalR/SignalR)
- [<span data-ttu-id="a1be7-363">SignalR Wiki</span><span class="sxs-lookup"><span data-stu-id="a1be7-363">SignalR Wiki</span></span>](https://github.com/SignalR/SignalR/wiki)

<span data-ttu-id="a1be7-364">Eine exemplarische Vorgehensweise zum Bereitstellen einer SignalR-Anwendung in Azure finden Sie unter [SignalR mit Web-Apps in Azure App Service mithilfe von](../deployment/using-signalr-with-azure-web-sites.md).</span><span class="sxs-lookup"><span data-stu-id="a1be7-364">For a walkthrough on how to deploy a SignalR application to Azure, see [Using SignalR with Web Apps in Azure App Service](../deployment/using-signalr-with-azure-web-sites.md).</span></span> <span data-ttu-id="a1be7-365">Ausführliche Informationen dazu, wie Sie ein Visual Studio-Webprojekt auf einer Windows Azure-Website bereitstellen, finden Sie unter [erstellen eine ASP.NET Web-app in Azure App Service](https://azure.microsoft.com/documentation/articles/web-sites-dotnet-get-started/).</span><span class="sxs-lookup"><span data-stu-id="a1be7-365">For detailed information about how to deploy a Visual Studio web project to a Windows Azure Web Site, see [Create an ASP.NET web app in Azure App Service](https://azure.microsoft.com/documentation/articles/web-sites-dotnet-get-started/).</span></span>
