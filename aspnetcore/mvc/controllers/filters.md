---
title: Filter
author: ardalis
description: Erfahren Sie, wie * Filter * funktionieren und wie sie in ASP.NET Core MVC verwenden.
keywords: ASP.NET Core, Filter, Mvc-Filter, Aktionsfilter, Autorisierungsfilter, Ressourcenfilter, Ergebnisfilter, Ausnahmefilter
ms.author: tdykstra
manager: wpickett
ms.date: 12/12/2016
ms.topic: article
ms.assetid: 531bda08-aa5b-4471-8f08-96add22c8683
ms.technology: aspnet
ms.prod: asp.net-core
uid: mvc/controllers/filters
ms.openlocfilehash: 6baeb472770daf1d54b2d9ea894fc710f4f40780
ms.sourcegitcommit: 4693cb02d845adf2efa00e07ad432c81867bfa12
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 09/08/2017
---
# <a name="filters"></a><span data-ttu-id="3d564-104">Filter</span><span class="sxs-lookup"><span data-stu-id="3d564-104">Filters</span></span>

<span data-ttu-id="3d564-105">Durch [Tom Dykstra](https://github.com/tdykstra/) und [Steve Smith](http://ardalis.com)</span><span class="sxs-lookup"><span data-stu-id="3d564-105">By [Tom Dykstra](https://github.com/tdykstra/) and [Steve Smith](http://ardalis.com)</span></span>

<span data-ttu-id="3d564-106">*Filter* in ASP.NET Core MVC ermöglichen es Ihnen, Code vor oder nach bestimmten Stufen in der Verarbeitungspipeline Anforderung auszuführen.</span><span class="sxs-lookup"><span data-stu-id="3d564-106">*Filters* in ASP.NET Core MVC allow you to run code before or after certain stages in the request processing pipeline.</span></span>

 <span data-ttu-id="3d564-107">Integrierte Filter Handle Aufgaben wie die Autorisierung (verhindert den Zugriff auf Ressourcen, denen für ein Benutzer nicht autorisiert ist), wird sichergestellt, dass alle Anforderungen HTTPS- und Antwort zwischenspeichern (verkürzte der Anforderungspipeline zum Zurückgeben einer zwischengespeicherten Antwort) verwenden.</span><span class="sxs-lookup"><span data-stu-id="3d564-107">Built-in filters handle tasks such as authorization (preventing access to resources a user isn't authorized for), ensuring that all requests use HTTPS, and response caching (short-circuiting the request pipeline to return a cached response).</span></span> 

<span data-ttu-id="3d564-108">Sie können benutzerdefinierte Filter zum Behandeln von querschnittliche Sicherheitsrisiken für Ihre Anwendung erstellen.</span><span class="sxs-lookup"><span data-stu-id="3d564-108">You can create custom filters to handle cross-cutting concerns for your application.</span></span> <span data-ttu-id="3d564-109">Jedes Mal, wenn Sie vermeiden, Code über Aktionen duplizieren möchten, die Lösung von Filter angewendet wurden.</span><span class="sxs-lookup"><span data-stu-id="3d564-109">Anytime you want to avoid duplicating code across actions, filters are the solution.</span></span> <span data-ttu-id="3d564-110">Fehler bei der Verarbeitung von Code in einen Ausnahmefilter kann z. B. konsolidiert werden.</span><span class="sxs-lookup"><span data-stu-id="3d564-110">For example, you can consolidate error handling code in a exception filter.</span></span>

<span data-ttu-id="3d564-111">[Anzeigen oder Herunterladen des Beispiels aus GitHub](https://github.com/aspnet/Docs/tree/master/aspnetcore/mvc/controllers/filters/sample).</span><span class="sxs-lookup"><span data-stu-id="3d564-111">[View or download sample from GitHub](https://github.com/aspnet/Docs/tree/master/aspnetcore/mvc/controllers/filters/sample).</span></span>

## <a name="how-do-filters-work"></a><span data-ttu-id="3d564-112">Wie funktionieren Filter?</span><span class="sxs-lookup"><span data-stu-id="3d564-112">How do filters work?</span></span>

<span data-ttu-id="3d564-113">Filter ausgeführt wird, innerhalb der *MVC-Aktion Aufruf Pipeline*, manchmal als gemäß der *Filterpipeline*.</span><span class="sxs-lookup"><span data-stu-id="3d564-113">Filters run within the *MVC action invocation pipeline*, sometimes referred to as the *filter pipeline*.</span></span>  <span data-ttu-id="3d564-114">Die Filterpipeline ausgeführt wird, nachdem MVC wählt die Aktion zum Ausführen aus.</span><span class="sxs-lookup"><span data-stu-id="3d564-114">The filter pipeline runs after MVC selects the action to execute.</span></span>

![Die Anforderung wird durch andere Middleware, Middleware-Routing, Aktionsauswahl und der MVC-Aktion-Aufruf-Pipeline verarbeitet.](filters/_static/filter-pipeline-1.png)

### <a name="filter-types"></a><span data-ttu-id="3d564-117">Filtertypen</span><span class="sxs-lookup"><span data-stu-id="3d564-117">Filter types</span></span>

<span data-ttu-id="3d564-118">Jedes Filtertyps bestimmt, die zu einem anderen Zeitpunkt in der Filterpipeline ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="3d564-118">Each filter type is executed at a different stage in the filter pipeline.</span></span>

* <span data-ttu-id="3d564-119">[Autorisierungsfilter](#authorization-filters) zuerst ausgeführt und werden verwendet, um zu bestimmen, ob der aktuelle Benutzer für die aktuelle Anforderung autorisiert ist.</span><span class="sxs-lookup"><span data-stu-id="3d564-119">[Authorization filters](#authorization-filters) run first and are used to determine whether the current user is authorized for the current request.</span></span> <span data-ttu-id="3d564-120">Sie können die Pipeline Kurzschluss, wenn eine Anforderung nicht autorisiert ist.</span><span class="sxs-lookup"><span data-stu-id="3d564-120">They can short-circuit the pipeline if a request is unauthorized.</span></span> 

* <span data-ttu-id="3d564-121">[Ressourcenfilter](#resource-filters) werden als erste eine Anfrage nach der Autorisierung behandelt.</span><span class="sxs-lookup"><span data-stu-id="3d564-121">[Resource filters](#resource-filters) are the first to handle a request after authorization.</span></span>  <span data-ttu-id="3d564-122">Sie können Code vor dem Rest der Filterpipeline und nach Abschluss der Rest der Pipeline ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="3d564-122">They can run code before the rest of the filter pipeline, and after the rest of the pipeline has completed.</span></span> <span data-ttu-id="3d564-123">Sie sind hilfreich beim Zwischenspeichern der Dienst implementieren oder andernfalls Kurzschluss Filterpipeline zur Verbesserung der Leistung.</span><span class="sxs-lookup"><span data-stu-id="3d564-123">They're useful to implement caching or otherwise short-circuit the filter pipeline for performance reasons.</span></span> <span data-ttu-id="3d564-124">Da sie vor der modellbindung ausgeführt werden, sind sie nützlich für Elemente, die beeinflussen, wurden die modellbindung muss.</span><span class="sxs-lookup"><span data-stu-id="3d564-124">Since they run before model binding, they're useful for anything that needs to influence model binding.</span></span>

* <span data-ttu-id="3d564-125">[Aktionsfilter](#action-filters) Code ausführen können, unmittelbar vor und nach eine einzelnen Aktionsmethode aufgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="3d564-125">[Action filters](#action-filters) can run code immediately before and after an individual action method is called.</span></span> <span data-ttu-id="3d564-126">Sie können zum Bearbeiten von den Argumenten, die an eine Aktion übergeben und von der Aktion zurückgegebenen Ergebnisses verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="3d564-126">They can be used to manipulate the arguments passed into an action and the result returned from the action.</span></span>

* <span data-ttu-id="3d564-127">[Ausnahmefilter](#exception-filters) werden verwendet, um globale Richtlinien auf nicht behandelte Ausnahmen angewendet, die auftreten, bevor alle Elemente in den Antworttext geschrieben wurde.</span><span class="sxs-lookup"><span data-stu-id="3d564-127">[Exception filters](#exception-filters) are used to apply global policies to unhandled exceptions that occur before anything has been written to the response body.</span></span>

* <span data-ttu-id="3d564-128">[Führen Sie die Filter](#result-filters) unmittelbar vor und nach der Ausführung der einzelnen Aktionsergebnisse Code ausführen können.</span><span class="sxs-lookup"><span data-stu-id="3d564-128">[Result filters](#result-filters) can run code immediately before and after the execution of individual action results.</span></span> <span data-ttu-id="3d564-129">Nur ausgeführt, wenn die Aktionsmethode erfolgreich ausgeführt wurde, und eignen sich für eine Logik, die Sicht oder Formatierer Ausführung umgeben muss.</span><span class="sxs-lookup"><span data-stu-id="3d564-129">They run only when the action method has executed successfully and are useful for logic that must surround view or formatter execution.</span></span>

<span data-ttu-id="3d564-130">Das folgende Diagramm zeigt, wie diese Filtertypen in der Filterpipeline interagieren.</span><span class="sxs-lookup"><span data-stu-id="3d564-130">The following diagram shows how these filter types interact in the filter pipeline.</span></span>

![Die Anforderung wird über den Autorisierungsfilter, Ressourcenfilter Modell binden, Aktionsfilter, Ausführen von Aktionen und Aktion Ergebniskonvertierung, Ausnahmefilter, Ergebnisfilter und Ergebnis Ausführung verarbeitet.](filters/_static/filter-pipeline-2.png)

## <a name="implementation"></a><span data-ttu-id="3d564-133">Implementierung</span><span class="sxs-lookup"><span data-stu-id="3d564-133">Implementation</span></span>

<span data-ttu-id="3d564-134">Filter unterstützen die synchrone und asynchrone Implementierungen über verschiedene Schnittstellendefinitionen.</span><span class="sxs-lookup"><span data-stu-id="3d564-134">Filters support both synchronous and asynchronous implementations through different interface definitions.</span></span> <span data-ttu-id="3d564-135">Wählen Sie die Synchronisierung oder die Async-Variante je nach Art der Aufgabe, die Sie ausführen müssen.</span><span class="sxs-lookup"><span data-stu-id="3d564-135">Choose either the sync or async variant depending on the kind of task you need to perform.</span></span> 

<span data-ttu-id="3d564-136">Synchrone Filter, die ausgeführt werden können, code sowohl vor und nach ihren Pipelinestufe für definieren*Phase*ausführen und auf*Phase*Methoden ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="3d564-136">Synchronous filters that can run code both before and after their pipeline stage define On*Stage*Executing and On*Stage*Executed methods.</span></span> <span data-ttu-id="3d564-137">Beispielsweise `OnActionExecuting` wird aufgerufen, bevor die Aktionsmethode aufgerufen wird, und `OnActionExecuted` aufgerufen, nachdem die Aktionsmethode beendet.</span><span class="sxs-lookup"><span data-stu-id="3d564-137">For example, `OnActionExecuting` is called before the action method is called, and `OnActionExecuted` is called after the action method returns.</span></span>

<span data-ttu-id="3d564-138">[!code-csharp[Main](./filters/sample/src/FiltersSample/Filters/SampleActionFilter.cs?highlight=6,8,13)]</span><span class="sxs-lookup"><span data-stu-id="3d564-138">[!code-csharp[Main](./filters/sample/src/FiltersSample/Filters/SampleActionFilter.cs?highlight=6,8,13)]</span></span>

<span data-ttu-id="3d564-139">Asynchrone Filter definieren eine einzelne auf*Phase*ExecutionAsync-Methode.</span><span class="sxs-lookup"><span data-stu-id="3d564-139">Asynchronous filters define a single On*Stage*ExecutionAsync method.</span></span> <span data-ttu-id="3d564-140">Diese Methode nimmt einen *FilterType*ExecutionDelegate-Delegat, der den Filter Pipelinestufe "" ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="3d564-140">This method takes a *FilterType*ExecutionDelegate delegate which executes the filter's pipeline stage.</span></span> <span data-ttu-id="3d564-141">Beispielsweise `ActionExecutionDelegate` Aufrufe, die die Aktionsmethode, und Sie führen können code vor und nach dem Sie aufgerufen werden.</span><span class="sxs-lookup"><span data-stu-id="3d564-141">For example, `ActionExecutionDelegate` calls the action method, and you can execute code before and after you call it.</span></span>

<span data-ttu-id="3d564-142">[!code-csharp[Main](./filters/sample/src/FiltersSample/Filters/SampleAsyncActionFilter.cs?highlight=6,8-10,13)]</span><span class="sxs-lookup"><span data-stu-id="3d564-142">[!code-csharp[Main](./filters/sample/src/FiltersSample/Filters/SampleAsyncActionFilter.cs?highlight=6,8-10,13)]</span></span>

<span data-ttu-id="3d564-143">Sie können für mehrere Filter Stufen in einer einzelnen Klasse Schnittstellen implementieren.</span><span class="sxs-lookup"><span data-stu-id="3d564-143">You can implement interfaces for multiple filter stages in a single class.</span></span> <span data-ttu-id="3d564-144">Z. B. die [ActionFilterAttribute](https://docs.microsoft.com/aspnet/core/api/microsoft.aspnetcore.mvc.filters.actionfilterattribute) abstrakten Klasse implementiert beide `IActionFilter` und `IResultFilter`, sowie deren asynchrone Entsprechungen.</span><span class="sxs-lookup"><span data-stu-id="3d564-144">For example, the [ActionFilterAttribute](https://docs.microsoft.com/aspnet/core/api/microsoft.aspnetcore.mvc.filters.actionfilterattribute) abstract class implements both `IActionFilter` and `IResultFilter`, as well as their async equivalents.</span></span>

> [!NOTE]
> <span data-ttu-id="3d564-145">Implementieren **entweder** synchronen oder asynchronen-Version einer Filter-Schnittstelle, nicht beides.</span><span class="sxs-lookup"><span data-stu-id="3d564-145">Implement **either** the synchronous or the async version of a filter interface, not both.</span></span> <span data-ttu-id="3d564-146">Das Framework überprüft zuerst, um festzustellen, ob der Filter die Async-Schnittstelle implementiert, und wenn dies der Fall ist, wird.</span><span class="sxs-lookup"><span data-stu-id="3d564-146">The framework checks first to see if the filter implements the async interface, and if so, it calls that.</span></span> <span data-ttu-id="3d564-147">Wenn dies nicht der Fall ist, ruft er die synchrone Schnittstelle Methode(n).</span><span class="sxs-lookup"><span data-stu-id="3d564-147">If not, it calls the synchronous interface's method(s).</span></span> <span data-ttu-id="3d564-148">Würden Sie beide Schnittstellen für eine Klasse implementieren, würde die Async-Methode aufgerufen werden.</span><span class="sxs-lookup"><span data-stu-id="3d564-148">If you were to implement both interfaces on one class, only the async method would be called.</span></span> <span data-ttu-id="3d564-149">Bei Verwendung von abstrakten Klassen wie [ActionFilterAttribute](https://docs.microsoft.com/aspnet/core/api/microsoft.aspnetcore.mvc.filters.actionfilterattribute) würden Sie nur die synchronen Methoden oder die asynchrone Methode für jedes Filtertyps bestimmt.</span><span class="sxs-lookup"><span data-stu-id="3d564-149">When using abstract classes like [ActionFilterAttribute](https://docs.microsoft.com/aspnet/core/api/microsoft.aspnetcore.mvc.filters.actionfilterattribute) you would override only the synchronous methods or the async method for each filter type.</span></span>

### <a name="ifilterfactory"></a><span data-ttu-id="3d564-150">IFilterFactory</span><span class="sxs-lookup"><span data-stu-id="3d564-150">IFilterFactory</span></span>

<span data-ttu-id="3d564-151">`IFilterFactory` implementiert `IFilter`.</span><span class="sxs-lookup"><span data-stu-id="3d564-151">`IFilterFactory` implements `IFilter`.</span></span> <span data-ttu-id="3d564-152">Aus diesem Grund eine `IFilterFactory` Instanz kann verwendet werden, als ein `IFilter` Instanz an einer beliebigen Stelle in der Filterpipeline.</span><span class="sxs-lookup"><span data-stu-id="3d564-152">Therefore, an `IFilterFactory` instance can be used as an `IFilter` instance anywhere in the filter pipeline.</span></span> <span data-ttu-id="3d564-153">Wenn das Framework vorbereitet, um den Filter aufzurufen, versucht es,-Typ umzuwandeln ein `IFilterFactory`.</span><span class="sxs-lookup"><span data-stu-id="3d564-153">When the framework prepares to invoke the filter, it attempts to cast it to an `IFilterFactory`.</span></span> <span data-ttu-id="3d564-154">Wenn diese Umwandlung erfolgreich ist, die `CreateInstance` Methode wird aufgerufen, um das Erstellen der `IFilter` -Instanz, die aufgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="3d564-154">If that cast succeeds, the `CreateInstance` method is called to create the `IFilter` instance that will be invoked.</span></span> <span data-ttu-id="3d564-155">Dies bietet ein sehr flexibles Design, da die präzise Filterpipeline nicht beim Starten der Anwendung explizit festgelegt werden muss.</span><span class="sxs-lookup"><span data-stu-id="3d564-155">This provides a very flexible design, since the precise filter pipeline does not need to be set explicitly when the application starts.</span></span>

<span data-ttu-id="3d564-156">Sie können implementieren `IFilterFactory` auf Ihren eigenen Implementierungen Attribut als ein weiteres Verfahren zum Erstellen von Filtern:</span><span class="sxs-lookup"><span data-stu-id="3d564-156">You can implement `IFilterFactory` on your own attribute implementations as another approach to creating filters:</span></span>

<span data-ttu-id="3d564-157">[!code-csharp[Main](./filters/sample/src/FiltersSample/Filters/AddHeaderWithFactoryAttribute.cs?name=snippet_IFilterFactory&highlight=1,4,5,6,7)]</span><span class="sxs-lookup"><span data-stu-id="3d564-157">[!code-csharp[Main](./filters/sample/src/FiltersSample/Filters/AddHeaderWithFactoryAttribute.cs?name=snippet_IFilterFactory&highlight=1,4,5,6,7)]</span></span>

### <a name="built-in-filter-attributes"></a><span data-ttu-id="3d564-158">Integrierter Filter-Attribute</span><span class="sxs-lookup"><span data-stu-id="3d564-158">Built-in filter attributes</span></span>

<span data-ttu-id="3d564-159">Das Framework beinhaltet integrierte attributbasierte Filter, können Sie die Unterklasse und anpassen.</span><span class="sxs-lookup"><span data-stu-id="3d564-159">The framework includes built-in attribute-based filters that you can subclass and customize.</span></span> <span data-ttu-id="3d564-160">Die folgenden Ergebnisfilter fügt z. B. einen Header in die Antwort an.</span><span class="sxs-lookup"><span data-stu-id="3d564-160">For example, the following Result filter adds a header to the response.</span></span>

<a name=add-header-attribute></a>

<span data-ttu-id="3d564-161">[!code-csharp[Main](./filters/sample/src/FiltersSample/Filters/AddHeaderAttribute.cs?highlight=5,16)]</span><span class="sxs-lookup"><span data-stu-id="3d564-161">[!code-csharp[Main](./filters/sample/src/FiltersSample/Filters/AddHeaderAttribute.cs?highlight=5,16)]</span></span>

<span data-ttu-id="3d564-162">Attribute können Filter aus, die Argumente akzeptieren, wie im obigen Beispiel gezeigt.</span><span class="sxs-lookup"><span data-stu-id="3d564-162">Attributes allow filters to accept arguments, as shown in the example above.</span></span> <span data-ttu-id="3d564-163">Sie fügen Sie dieses Attribut auf einen Controller oder Aktion, und geben Sie den Namen und Wert des HTTP-Headers:</span><span class="sxs-lookup"><span data-stu-id="3d564-163">You would add this attribute to a controller or action method and specify the name and value of the HTTP header:</span></span>

<span data-ttu-id="3d564-164">[!code-csharp[Main](./filters/sample/src/FiltersSample/Controllers/SampleController.cs?name=snippet_AddHeader&highlight=1)]</span><span class="sxs-lookup"><span data-stu-id="3d564-164">[!code-csharp[Main](./filters/sample/src/FiltersSample/Controllers/SampleController.cs?name=snippet_AddHeader&highlight=1)]</span></span>

<span data-ttu-id="3d564-165">Das Ergebnis der `Index` Aktion wird unten gezeigt – die Antwortheader werden auf der unteren rechten Ecke angezeigt.</span><span class="sxs-lookup"><span data-stu-id="3d564-165">The result of the `Index` action is shown below - the response headers are displayed on the bottom right.</span></span>

![Developer Tools von Microsoft Edge mit Antwortheadern, einschließlich der Autor Steve Smith@ardalis](filters/_static/add-header.png)

<span data-ttu-id="3d564-167">Bei einigen filterschnittstellen können die entsprechenden Attribute, die als Basisklassen für benutzerdefinierte Implementierungen verwendet werden können.</span><span class="sxs-lookup"><span data-stu-id="3d564-167">Several of the filter interfaces have corresponding attributes that can be used as base classes for custom implementations.</span></span>

<span data-ttu-id="3d564-168">Filtern Sie Attribute:</span><span class="sxs-lookup"><span data-stu-id="3d564-168">Filter attributes:</span></span>

* `ActionFilterAttribute`
* `ExceptionFilterAttribute`
* `ResultFilterAttribute`
* `FormatFilterAttribute`
* `ServiceFilterAttribute`
* `TypeFilterAttribute`

<span data-ttu-id="3d564-169">`TypeFilterAttribute`und `ServiceFilterAttribute` werden erläutert [weiter unten in diesem Artikel](#dependency-injection).</span><span class="sxs-lookup"><span data-stu-id="3d564-169">`TypeFilterAttribute` and `ServiceFilterAttribute` are explained [later in this article](#dependency-injection).</span></span>

## <a name="filter-scopes-and-order-of-execution"></a><span data-ttu-id="3d564-170">Filtern Sie Bereiche und Reihenfolge der Ausführung</span><span class="sxs-lookup"><span data-stu-id="3d564-170">Filter scopes and order of execution</span></span>

<span data-ttu-id="3d564-171">Filter kann hinzugefügt werden, an die Pipeline an einem von drei *Bereiche*.</span><span class="sxs-lookup"><span data-stu-id="3d564-171">A filter can be added to the pipeline at one of three *scopes*.</span></span> <span data-ttu-id="3d564-172">Sie können einen Filter auf eine bestimmte Aktion-Methode oder zu einer Controllerklasse mit einem Attribut hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="3d564-172">You can add a filter to a particular action method or to a controller class by using an attribute.</span></span> <span data-ttu-id="3d564-173">Oder Sie können einen Filter Global (für alle Controller und Aktionen) registrieren, durch Hinzufügen zu den `MvcOptions.Filters` Sammlung in der `ConfigureServices` Methode in der `Startup` Klasse:</span><span class="sxs-lookup"><span data-stu-id="3d564-173">Or you can register a filter globally (for all controllers and actions) by adding it to the `MvcOptions.Filters` collection in the `ConfigureServices` method in the `Startup` class:</span></span>

<span data-ttu-id="3d564-174">[!code-csharp[Main](./filters/sample/src/FiltersSample/Startup.cs?name=snippet_ConfigureServices&highlight=5-8)]</span><span class="sxs-lookup"><span data-stu-id="3d564-174">[!code-csharp[Main](./filters/sample/src/FiltersSample/Startup.cs?name=snippet_ConfigureServices&highlight=5-8)]</span></span>

### <a name="default-order-of-execution"></a><span data-ttu-id="3d564-175">Standardreihenfolge der Ausführung</span><span class="sxs-lookup"><span data-stu-id="3d564-175">Default order of execution</span></span>

<span data-ttu-id="3d564-176">Wenn mehrere Filter für eine bestimmte Phase der Pipeline sind, bestimmt der Bereich die Standardreihenfolge der filterausführung.</span><span class="sxs-lookup"><span data-stu-id="3d564-176">When there are multiple filters for a particular stage of the pipeline, scope determines the default order of filter execution.</span></span>  <span data-ttu-id="3d564-177">Globale Filter umschließen Klasse Filter, mit die-Methode filtert wiederum zu umschließen.</span><span class="sxs-lookup"><span data-stu-id="3d564-177">Global filters surround class filters, which in turn surround method filters.</span></span> <span data-ttu-id="3d564-178">Dies wird manchmal als bezeichnet "Russisch Puppe" Verschachteln, wie jede Erweiterung des Bereichs z. B. den vorherigen Bereich umbrochen wird eine [schachteln Puppe](https://en.wikipedia.org/wiki/Matryoshka_doll).</span><span class="sxs-lookup"><span data-stu-id="3d564-178">This is sometimes referred to as "Russian doll" nesting, as each increase in scope is wrapped around the previous scope, like a [nesting doll](https://en.wikipedia.org/wiki/Matryoshka_doll).</span></span> <span data-ttu-id="3d564-179">Sie erhalten im Allgemeinen das gewünschte Verhalten für die überschreibende ohne explizit Reihenfolge zu bestimmen.</span><span class="sxs-lookup"><span data-stu-id="3d564-179">You generally get the desired overriding behavior without having to explicitly determine ordering.</span></span>

<span data-ttu-id="3d564-180">Als Ergebnis dieser Schachtelung der *nach* Code Filter wird in umgekehrter Reihenfolge ausgeführt der *vor* Code.</span><span class="sxs-lookup"><span data-stu-id="3d564-180">As a result of this nesting, the *after* code of filters runs in the reverse order of the *before* code.</span></span> <span data-ttu-id="3d564-181">Die Abfolge sieht wie folgt:</span><span class="sxs-lookup"><span data-stu-id="3d564-181">The sequence looks like this:</span></span>

* <span data-ttu-id="3d564-182">Die *vor* Code Global angewendeten Filter</span><span class="sxs-lookup"><span data-stu-id="3d564-182">The *before* code of filters applied globally</span></span>
  * <span data-ttu-id="3d564-183">Die *vor* Code auf Domänencontrollern angewendeten Filter</span><span class="sxs-lookup"><span data-stu-id="3d564-183">The *before* code of filters applied to controllers</span></span>
    * <span data-ttu-id="3d564-184">Die *vor* Code auf Aktionsmethoden angewendeten Filter</span><span class="sxs-lookup"><span data-stu-id="3d564-184">The *before* code of filters applied to action methods</span></span>
    * <span data-ttu-id="3d564-185">Die *nach* Code auf Aktionsmethoden angewendeten Filter</span><span class="sxs-lookup"><span data-stu-id="3d564-185">The *after* code of filters applied to action methods</span></span>
  * <span data-ttu-id="3d564-186">Die *nach* Code auf Domänencontrollern angewendeten Filter</span><span class="sxs-lookup"><span data-stu-id="3d564-186">The *after* code of filters applied to controllers</span></span>
* <span data-ttu-id="3d564-187">Die *nach* Code Global angewendeten Filter</span><span class="sxs-lookup"><span data-stu-id="3d564-187">The *after* code of filters applied globally</span></span>
  
<span data-ttu-id="3d564-188">Hier ist ein Beispiel zur Veranschaulichung die Reihenfolge in den richtigen, die Filter Methoden für synchrone Aktionsfilter aufgerufen werden.</span><span class="sxs-lookup"><span data-stu-id="3d564-188">Here's an example that illustrates the order in which filter methods are called for synchronous Action filters.</span></span>

| <span data-ttu-id="3d564-189">Sequenz</span><span class="sxs-lookup"><span data-stu-id="3d564-189">Sequence</span></span> | <span data-ttu-id="3d564-190">Filterbereich</span><span class="sxs-lookup"><span data-stu-id="3d564-190">Filter scope</span></span> | <span data-ttu-id="3d564-191">Filter-Methode</span><span class="sxs-lookup"><span data-stu-id="3d564-191">Filter method</span></span> |
|:--------:|:------------:|:-------------:|
| <span data-ttu-id="3d564-192">1</span><span class="sxs-lookup"><span data-stu-id="3d564-192">1</span></span> | <span data-ttu-id="3d564-193">Global</span><span class="sxs-lookup"><span data-stu-id="3d564-193">Global</span></span> | `OnActionExecuting` |
| <span data-ttu-id="3d564-194">2</span><span class="sxs-lookup"><span data-stu-id="3d564-194">2</span></span> | <span data-ttu-id="3d564-195">Controller</span><span class="sxs-lookup"><span data-stu-id="3d564-195">Controller</span></span> | `OnActionExecuting` |
| <span data-ttu-id="3d564-196">3</span><span class="sxs-lookup"><span data-stu-id="3d564-196">3</span></span> | <span data-ttu-id="3d564-197">Methode</span><span class="sxs-lookup"><span data-stu-id="3d564-197">Method</span></span> | `OnActionExecuting` |
| <span data-ttu-id="3d564-198">4</span><span class="sxs-lookup"><span data-stu-id="3d564-198">4</span></span> | <span data-ttu-id="3d564-199">Methode</span><span class="sxs-lookup"><span data-stu-id="3d564-199">Method</span></span> | `OnActionExecuted` |
| <span data-ttu-id="3d564-200">5</span><span class="sxs-lookup"><span data-stu-id="3d564-200">5</span></span> | <span data-ttu-id="3d564-201">Controller</span><span class="sxs-lookup"><span data-stu-id="3d564-201">Controller</span></span> | `OnActionExecuted` |
| <span data-ttu-id="3d564-202">6</span><span class="sxs-lookup"><span data-stu-id="3d564-202">6</span></span> | <span data-ttu-id="3d564-203">Global</span><span class="sxs-lookup"><span data-stu-id="3d564-203">Global</span></span> | `OnActionExecuted` |

<span data-ttu-id="3d564-204">Diese Sequenz zeigt, dass der Filter für die Methode innerhalb des Filters Controller geschachtelt ist und der Controller-Filter in der globalen Filter geschachtelt ist.</span><span class="sxs-lookup"><span data-stu-id="3d564-204">This sequence shows that the method filter is nested within the controller filter, and the controller filter is nested within the global filter.</span></span> <span data-ttu-id="3d564-205">Versetzen sie eine andere Weise, wenn Sie innerhalb einer Async-Filter sind des auf*Phase*ExecutionAsync-Methode, alle Filter mit einem engeren Bereich ausführen, während der Code auf dem Stapel ist.</span><span class="sxs-lookup"><span data-stu-id="3d564-205">To put it another way, if you're inside an async filter's On*Stage*ExecutionAsync method, all of the filters with a tighter scope run while your code is on the stack.</span></span>

> [!NOTE]
> <span data-ttu-id="3d564-206">Jeder Controller, die von erben die `Controller` Basisklasse enthält `OnActionExecuting` und `OnActionExecuted` Methoden.</span><span class="sxs-lookup"><span data-stu-id="3d564-206">Every controller that inherits from the `Controller` base class includes `OnActionExecuting` and `OnActionExecuted` methods.</span></span> <span data-ttu-id="3d564-207">Diese Methoden umschließen die Filter für eine bestimmte Aktion ausführen: `OnActionExecuting` wird aufgerufen, bevor die Filter und `OnActionExecuted` wird aufgerufen, nachdem alle Filter.</span><span class="sxs-lookup"><span data-stu-id="3d564-207">These methods wrap the filters that run for a given action:  `OnActionExecuting` is called before any of the filters, and `OnActionExecuted` is called after all of the filters.</span></span>

### <a name="overriding-the-default-order"></a><span data-ttu-id="3d564-208">Die Standardreihenfolge überschreiben</span><span class="sxs-lookup"><span data-stu-id="3d564-208">Overriding the default order</span></span>

<span data-ttu-id="3d564-209">Sie können die Standardabfolge der Ausführung durch die Implementierung überschreiben `IOrderedFilter`.</span><span class="sxs-lookup"><span data-stu-id="3d564-209">You can override the default sequence of execution by implementing `IOrderedFilter`.</span></span> <span data-ttu-id="3d564-210">Diese Schnittstelle legt eine `Order` -Eigenschaft, die Vorrang vor Bereich, um die Reihenfolge der Ausführung zu ermitteln.</span><span class="sxs-lookup"><span data-stu-id="3d564-210">This interface exposes an `Order` property that takes precedence over scope to determine the order of execution.</span></span> <span data-ttu-id="3d564-211">Ein Filter mit einem niedrigeren `Order` liefern, dessen *vor* vor, einen Filter mit einem höheren Wert der ausgeführte Code `Order`.</span><span class="sxs-lookup"><span data-stu-id="3d564-211">A filter with a lower `Order` value will have its *before* code executed before that of a filter with a higher value of `Order`.</span></span> <span data-ttu-id="3d564-212">Ein Filter mit einem niedrigeren `Order` liefern, dessen *nach* Code ausgeführt, nachdem der Filter mit einer höheren `Order` Wert.</span><span class="sxs-lookup"><span data-stu-id="3d564-212">A filter with a lower `Order` value will have its *after* code executed after that of a filter with a higher `Order` value.</span></span> <span data-ttu-id="3d564-213">Sie können festlegen, die `Order` Eigenschaft mit einem Konstruktorparameter:</span><span class="sxs-lookup"><span data-stu-id="3d564-213">You can set the `Order` property by using a constructor parameter:</span></span>

```csharp
[MyFilter(Name = "Controller Level Attribute", Order=1)]
```

<span data-ttu-id="3d564-214">Ist gleich 3 gezeigt, in dem vorhergehenden Beispiel, aber Satz Aktionsfilter der `Order` -Eigenschaft des Controllers und globalen Filter auf 1 und 2, die Reihenfolge der Ausführung würde rückgängig gemacht werden kann.</span><span class="sxs-lookup"><span data-stu-id="3d564-214">If you have the same 3 Action filters shown in the preceding example but set the `Order` property of the controller and global filters to 1 and 2 respectively, the order of execution would be reversed.</span></span>

| <span data-ttu-id="3d564-215">Sequenz</span><span class="sxs-lookup"><span data-stu-id="3d564-215">Sequence</span></span> | <span data-ttu-id="3d564-216">Filterbereich</span><span class="sxs-lookup"><span data-stu-id="3d564-216">Filter scope</span></span> | <span data-ttu-id="3d564-217">`Order`-Eigenschaft</span><span class="sxs-lookup"><span data-stu-id="3d564-217">`Order` property</span></span> | <span data-ttu-id="3d564-218">Filter-Methode</span><span class="sxs-lookup"><span data-stu-id="3d564-218">Filter method</span></span> |
|:--------:|:------------:|:-----------------:|:-------------:|
| <span data-ttu-id="3d564-219">1</span><span class="sxs-lookup"><span data-stu-id="3d564-219">1</span></span> | <span data-ttu-id="3d564-220">Methode</span><span class="sxs-lookup"><span data-stu-id="3d564-220">Method</span></span> | <span data-ttu-id="3d564-221">0</span><span class="sxs-lookup"><span data-stu-id="3d564-221">0</span></span> | `OnActionExecuting` |
| <span data-ttu-id="3d564-222">2</span><span class="sxs-lookup"><span data-stu-id="3d564-222">2</span></span> | <span data-ttu-id="3d564-223">Controller</span><span class="sxs-lookup"><span data-stu-id="3d564-223">Controller</span></span> | <span data-ttu-id="3d564-224">1</span><span class="sxs-lookup"><span data-stu-id="3d564-224">1</span></span>  | `OnActionExecuting` |
| <span data-ttu-id="3d564-225">3</span><span class="sxs-lookup"><span data-stu-id="3d564-225">3</span></span> | <span data-ttu-id="3d564-226">Global</span><span class="sxs-lookup"><span data-stu-id="3d564-226">Global</span></span> | <span data-ttu-id="3d564-227">2</span><span class="sxs-lookup"><span data-stu-id="3d564-227">2</span></span>  | `OnActionExecuting` |
| <span data-ttu-id="3d564-228">4</span><span class="sxs-lookup"><span data-stu-id="3d564-228">4</span></span> | <span data-ttu-id="3d564-229">Global</span><span class="sxs-lookup"><span data-stu-id="3d564-229">Global</span></span> | <span data-ttu-id="3d564-230">2</span><span class="sxs-lookup"><span data-stu-id="3d564-230">2</span></span>  | `OnActionExecuted` |
| <span data-ttu-id="3d564-231">5</span><span class="sxs-lookup"><span data-stu-id="3d564-231">5</span></span> | <span data-ttu-id="3d564-232">Controller</span><span class="sxs-lookup"><span data-stu-id="3d564-232">Controller</span></span> | <span data-ttu-id="3d564-233">1</span><span class="sxs-lookup"><span data-stu-id="3d564-233">1</span></span>  | `OnActionExecuted` |
| <span data-ttu-id="3d564-234">6</span><span class="sxs-lookup"><span data-stu-id="3d564-234">6</span></span> | <span data-ttu-id="3d564-235">Methode</span><span class="sxs-lookup"><span data-stu-id="3d564-235">Method</span></span> | <span data-ttu-id="3d564-236">0</span><span class="sxs-lookup"><span data-stu-id="3d564-236">0</span></span>  | `OnActionExecuted` |

<span data-ttu-id="3d564-237">Die `Order` Eigenschaft sticht Bereich aus, wenn die Reihenfolge bestimmt, in dem Filter ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="3d564-237">The `Order` property trumps scope when determining the order in which filters will run.</span></span> <span data-ttu-id="3d564-238">Filter werden zuerst nach Reihenfolge sortiert, und Bereich wird verwendet, um Ties zu unterbrechen.</span><span class="sxs-lookup"><span data-stu-id="3d564-238">Filters are sorted first by order, then scope is used to break ties.</span></span> <span data-ttu-id="3d564-239">Alle integrierten Filter implementieren `IOrderedFilter` und Festlegen der `Order` Wert auf 0, damit Bereich Reihenfolge bestimmt, es sei denn, Sie legen `Order` auf einen Wert ungleich 0 (null).</span><span class="sxs-lookup"><span data-stu-id="3d564-239">All of the built-in filters implement `IOrderedFilter` and set the default `Order` value to 0, so scope determines order unless you set `Order` to a non-zero value.</span></span>

## <a name="cancellation-and-short-circuiting"></a><span data-ttu-id="3d564-240">Abbruch und Kurzschlussoperationen</span><span class="sxs-lookup"><span data-stu-id="3d564-240">Cancellation and short circuiting</span></span>

<span data-ttu-id="3d564-241">Sie können die Filterpipeline zu einem beliebigen Zeitpunkt Kurzschluss, durch Festlegen der `Result` Eigenschaft auf die `context` Parameter bereitgestellt, um die Filtermethode.</span><span class="sxs-lookup"><span data-stu-id="3d564-241">You can short-circuit the filter pipeline at any point by setting the `Result` property on the `context` parameter provided to the filter method.</span></span> <span data-ttu-id="3d564-242">Beispielsweise verhindert, dass die folgende Filter für die Ressource den Rest der Pipeline ausführen.</span><span class="sxs-lookup"><span data-stu-id="3d564-242">For instance, the following Resource filter prevents the rest of the pipeline from executing.</span></span>

<a name=short-circuiting-resource-filter></a>

<span data-ttu-id="3d564-243">[!code-csharp[Main](./filters/sample/src/FiltersSample/Filters/ShortCircuitingResourceFilterAttribute.cs?highlight=12,13,14,15)]</span><span class="sxs-lookup"><span data-stu-id="3d564-243">[!code-csharp[Main](./filters/sample/src/FiltersSample/Filters/ShortCircuitingResourceFilterAttribute.cs?highlight=12,13,14,15)]</span></span>

<span data-ttu-id="3d564-244">Im folgenden Code wird sowohl die `ShortCircuitingResourceFilter` und `AddHeader` Filterziel der `SomeResource` Aktionsmethode.</span><span class="sxs-lookup"><span data-stu-id="3d564-244">In the following code, both the `ShortCircuitingResourceFilter` and the `AddHeader` filter target the `SomeResource` action method.</span></span> <span data-ttu-id="3d564-245">Allerdings da der `ShortCircuitingResourceFilter` zuerst ausgeführt (da es sich um einen Filter für die Ressource ist und `AddHeader` ist ein Aktionsfilter) und kurzgeschlossen wird der Rest der Pipeline an, der `AddHeader` Filter nie ausgeführt wird, für die `SomeResource` Aktion.</span><span class="sxs-lookup"><span data-stu-id="3d564-245">However, because the `ShortCircuitingResourceFilter` runs first (because it is a Resource Filter and `AddHeader` is an Action Filter) and short-circuits the rest of the pipeline, the `AddHeader` filter never runs for the `SomeResource` action.</span></span> <span data-ttu-id="3d564-246">Dieses Verhalten wäre identisch, wenn beide Filter auf Methodenebene Aktion bereitgestellten angewendet wurden die `ShortCircuitingResourceFilter` zuerst ausgeführt (aufgrund seines Filtertyps für oder explizite Verwendung von `Order` -Eigenschaft, für die Instanz).</span><span class="sxs-lookup"><span data-stu-id="3d564-246">This behavior would be the same if both filters were applied at the action method level, provided the `ShortCircuitingResourceFilter` ran first (because of its filter type, or explicit use of `Order` property, for instance).</span></span>

<span data-ttu-id="3d564-247">[!code-csharp[Main](./filters/sample/src/FiltersSample/Controllers/SampleController.cs?name=snippet_AddHeader&highlight=1,9)]</span><span class="sxs-lookup"><span data-stu-id="3d564-247">[!code-csharp[Main](./filters/sample/src/FiltersSample/Controllers/SampleController.cs?name=snippet_AddHeader&highlight=1,9)]</span></span>

## <a name="dependency-injection"></a><span data-ttu-id="3d564-248">Abhängigkeitsinjektion</span><span class="sxs-lookup"><span data-stu-id="3d564-248">Dependency injection</span></span>

<span data-ttu-id="3d564-249">Filter können nach Typ oder nach Instanz hinzugefügt werden.</span><span class="sxs-lookup"><span data-stu-id="3d564-249">Filters can be added by type or by instance.</span></span> <span data-ttu-id="3d564-250">Wenn Sie eine Instanz hinzufügen, wird diese Instanz für jede Anforderung verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="3d564-250">If you add an instance, that instance will be used for every request.</span></span> <span data-ttu-id="3d564-251">Wenn Sie einen Typ hinzufügen, werden sie Typ aktiviert, d. h. für jede Anforderung eine Instanz erstellt werden, und alle Abhängigkeiten Konstruktor werden von aufgefüllt [Abhängigkeitsinjektion](../../fundamentals/dependency-injection.md) (DI).</span><span class="sxs-lookup"><span data-stu-id="3d564-251">If you add a type, it will be type-activated, meaning an instance will be created for each request and any constructor dependencies will be populated by [dependency injection](../../fundamentals/dependency-injection.md) (DI).</span></span> <span data-ttu-id="3d564-252">Hinzufügen eines Filters nach Typ entspricht dem `filters.Add(new TypeFilterAttribute(typeof(MyFilter)))`.</span><span class="sxs-lookup"><span data-stu-id="3d564-252">Adding a filter by type is equivalent to `filters.Add(new TypeFilterAttribute(typeof(MyFilter)))`.</span></span>

<span data-ttu-id="3d564-253">Filter, die als Attribute implementiert und direkt zu Controllerklassen oder Aktionsmethoden hinzugefügt sind keine Konstruktor Abhängigkeiten gebotenen [Abhängigkeitsinjektion](../../fundamentals/dependency-injection.md) (DI).</span><span class="sxs-lookup"><span data-stu-id="3d564-253">Filters that are implemented as attributes and added directly to controller classes or action methods cannot have constructor dependencies provided by [dependency injection](../../fundamentals/dependency-injection.md) (DI).</span></span> <span data-ttu-id="3d564-254">Dies ist die Schreibberechtigung Attribute müssen ihre Konstruktorparameter bereitgestellt, in dem sie angewendet werden.</span><span class="sxs-lookup"><span data-stu-id="3d564-254">This is because attributes must have their constructor parameters supplied where they are applied.</span></span> <span data-ttu-id="3d564-255">Dies ist eine Einschränkung der Funktionsweise der Attribute.</span><span class="sxs-lookup"><span data-stu-id="3d564-255">This is a limitation of how attributes work.</span></span>

<span data-ttu-id="3d564-256">Wenn die Filter Abhängigkeiten, die Sie von DI zugreifen müssen haben, sind mehrere Ansätze.</span><span class="sxs-lookup"><span data-stu-id="3d564-256">If your filters have dependencies that you need to access from DI, there are several supported approaches.</span></span> <span data-ttu-id="3d564-257">Sie können den Filter auf eine Klasse oder eine Aktion-Methode, die mit einer der folgenden anwenden:</span><span class="sxs-lookup"><span data-stu-id="3d564-257">You can apply your filter to a class or action method using one of the following:</span></span>

* `ServiceFilterAttribute`
* `TypeFilterAttribute`
* <span data-ttu-id="3d564-258">`IFilterFactory`auf Ihrem Attribut implementiert</span><span class="sxs-lookup"><span data-stu-id="3d564-258">`IFilterFactory` implemented on your attribute</span></span>

> [!NOTE]
> <span data-ttu-id="3d564-259">Eine Abhängigkeit, die Sie möglicherweise aus DI abrufen möchten, ist eine Protokollierung.</span><span class="sxs-lookup"><span data-stu-id="3d564-259">One dependency you might want to get from DI is a logger.</span></span> <span data-ttu-id="3d564-260">Allerdings zu vermeiden, erstellen und verwenden Filter ausschließlich für die Protokollierung, da der [integriertes Framework Protokollierungsfunktionen](../../fundamentals/logging.md) müssen Sie möglicherweise bereits bereitstellen.</span><span class="sxs-lookup"><span data-stu-id="3d564-260">However, avoid creating and using filters purely for logging purposes, since the [built-in framework logging features](../../fundamentals/logging.md) may already provide what you need.</span></span> <span data-ttu-id="3d564-261">Wenn Sie Protokollierung Ihre Filter hinzufügen möchten, sollten diese auf Geschäftsprobleme Domäne oder Verhalten, die spezifisch für Ihren Filter statt MVC-Aktionen oder andere Framework-Ereignisse konzentrieren.</span><span class="sxs-lookup"><span data-stu-id="3d564-261">If you're going to add logging to your filters, it should focus on business domain concerns or behavior specific to your filter, rather than MVC actions or other framework events.</span></span>

### <a name="servicefilterattribute"></a><span data-ttu-id="3d564-262">ServiceFilterAttribute</span><span class="sxs-lookup"><span data-stu-id="3d564-262">ServiceFilterAttribute</span></span>

<span data-ttu-id="3d564-263">Ein `ServiceFilter` Ruft eine Instanz des Filters aus DI ab.</span><span class="sxs-lookup"><span data-stu-id="3d564-263">A `ServiceFilter` retrieves an instance of the filter from DI.</span></span> <span data-ttu-id="3d564-264">Sie den Filter hinzufügen, auf den Container in `ConfigureServices`, und verweisen sie in einem `ServiceFilter` Attribut</span><span class="sxs-lookup"><span data-stu-id="3d564-264">You add the filter to the container in `ConfigureServices`, and reference it in a `ServiceFilter` attribute</span></span>

<span data-ttu-id="3d564-265">[!code-csharp[Main](./filters/sample/src/FiltersSample/Startup.cs?name=snippet_ConfigureServices&highlight=11)]</span><span class="sxs-lookup"><span data-stu-id="3d564-265">[!code-csharp[Main](./filters/sample/src/FiltersSample/Startup.cs?name=snippet_ConfigureServices&highlight=11)]</span></span>

<span data-ttu-id="3d564-266">[!code-csharp[Main](../../mvc/controllers/filters/sample/src/FiltersSample/Controllers/HomeController.cs?name=snippet_ServiceFilter&highlight=1)]</span><span class="sxs-lookup"><span data-stu-id="3d564-266">[!code-csharp[Main](../../mvc/controllers/filters/sample/src/FiltersSample/Controllers/HomeController.cs?name=snippet_ServiceFilter&highlight=1)]</span></span>

<span data-ttu-id="3d564-267">Mithilfe von `ServiceFilter` ohne Registrierung die Filterergebnisse des Typs eine Ausnahme ausgelöst:</span><span class="sxs-lookup"><span data-stu-id="3d564-267">Using `ServiceFilter` without registering the filter type results in an exception:</span></span>

```
System.InvalidOperationException: No service for type
'FiltersSample.Filters.AddHeaderFilterWithDI' has been registered.
```

<span data-ttu-id="3d564-268">`ServiceFilterAttribute`implementiert `IFilterFactory`, das verfügbar macht einer einzelnen Methode zum Erstellen einer `IFilter` Instanz.</span><span class="sxs-lookup"><span data-stu-id="3d564-268">`ServiceFilterAttribute` implements `IFilterFactory`, which exposes a single method for creating an `IFilter` instance.</span></span> <span data-ttu-id="3d564-269">Im Fall von `ServiceFilterAttribute`, `IFilterFactory` Schnittstelle `CreateInstance` Methode wird implementiert, um den angegebenen Typ aus der Dienstecontainer (DI) zu laden.</span><span class="sxs-lookup"><span data-stu-id="3d564-269">In the case of `ServiceFilterAttribute`, the `IFilterFactory` interface's `CreateInstance` method is implemented to load the specified type from the services container (DI).</span></span>

### <a name="typefilterattribute"></a><span data-ttu-id="3d564-270">TypeFilterAttribute</span><span class="sxs-lookup"><span data-stu-id="3d564-270">TypeFilterAttribute</span></span>

<span data-ttu-id="3d564-271">`TypeFilterAttribute`vergleichbar mit `ServiceFilterAttribute` (und implementiert außerdem `IFilterFactory`), aber sein Typ nicht direkt aus dem Container DI aufgelöst wird.</span><span class="sxs-lookup"><span data-stu-id="3d564-271">`TypeFilterAttribute` is very similar to `ServiceFilterAttribute` (and also implements `IFilterFactory`), but its type is not resolved directly from the DI container.</span></span> <span data-ttu-id="3d564-272">Stattdessen den Typ instanziiert, mithilfe von `Microsoft.Extensions.DependencyInjection.ObjectFactory`.</span><span class="sxs-lookup"><span data-stu-id="3d564-272">Instead, it instantiates the type by using `Microsoft.Extensions.DependencyInjection.ObjectFactory`.</span></span>

<span data-ttu-id="3d564-273">Wegen dieses Unterschieds, Typen, auf die verwiesen werden mithilfe der `TypeFilterAttribute` müssen nicht mit dem Container erstmals registriert werden (aber dennoch haben Sie ihre Abhängigkeiten, die vom Container erfüllt).</span><span class="sxs-lookup"><span data-stu-id="3d564-273">Because of this difference, types that are referenced using the `TypeFilterAttribute` do not need to be registered with the container first (but they will still have their dependencies fulfilled by the container).</span></span> <span data-ttu-id="3d564-274">Darüber hinaus `TypeFilterAttribute` Konstruktorargumente für den betreffenden Typ kann optional akzeptieren.</span><span class="sxs-lookup"><span data-stu-id="3d564-274">Also, `TypeFilterAttribute` can optionally accept constructor arguments for the type in question.</span></span> <span data-ttu-id="3d564-275">Im folgenden Beispiel wird veranschaulicht, wie Argumente übergeben werden, in einen Typ mit `TypeFilterAttribute`:</span><span class="sxs-lookup"><span data-stu-id="3d564-275">The following example demonstrates how to pass arguments to a type using `TypeFilterAttribute`:</span></span>

<span data-ttu-id="3d564-276">[!code-csharp[Main](../../mvc/controllers/filters/sample/src/FiltersSample/Controllers/HomeController.cs?name=snippet_TypeFilter&highlight=1,2)]</span><span class="sxs-lookup"><span data-stu-id="3d564-276">[!code-csharp[Main](../../mvc/controllers/filters/sample/src/FiltersSample/Controllers/HomeController.cs?name=snippet_TypeFilter&highlight=1,2)]</span></span>

<span data-ttu-id="3d564-277">Wenn Sie einen Filter, die keine Argumente erfordert, aber dem Konstruktor Abhängigkeiten aufweist, die mit DI ausgefüllt werden müssen, Sie Ihr eigenes benannten Attribut zu Klassen und Methoden anstelle der können `[TypeFilter(typeof(FilterType))]`).</span><span class="sxs-lookup"><span data-stu-id="3d564-277">If you have a filter that doesn't require any arguments, but which has constructor dependencies that need to be filled by DI, you can use your own named attribute on classes and methods instead of `[TypeFilter(typeof(FilterType))]`).</span></span> <span data-ttu-id="3d564-278">Die folgende Filter wird gezeigt, wie dies implementiert werden kann:</span><span class="sxs-lookup"><span data-stu-id="3d564-278">The following filter shows how this can be implemented:</span></span>

<span data-ttu-id="3d564-279">[!code-csharp[Main](./filters/sample/src/FiltersSample/Filters/SampleActionFilterAttribute.cs?name=snippet_TypeFilterAttribute&highlight=1,3,7)]</span><span class="sxs-lookup"><span data-stu-id="3d564-279">[!code-csharp[Main](./filters/sample/src/FiltersSample/Filters/SampleActionFilterAttribute.cs?name=snippet_TypeFilterAttribute&highlight=1,3,7)]</span></span>

<span data-ttu-id="3d564-280">Dieser Filter kann auf Klassen oder Methoden angewendet werden die `[SampleActionFilter]` -Syntax zu verwenden, anstatt `[TypeFilter]` oder `[ServiceFilter]`.</span><span class="sxs-lookup"><span data-stu-id="3d564-280">This filter can be applied to classes or methods using the `[SampleActionFilter]` syntax, instead of having to use `[TypeFilter]` or `[ServiceFilter]`.</span></span>

## <a name="authorization-filters"></a><span data-ttu-id="3d564-281">Autorisierungsfilter</span><span class="sxs-lookup"><span data-stu-id="3d564-281">Authorization filters</span></span>

<span data-ttu-id="3d564-282">*Autorisierungsfilter* steuern den Zugriff auf Aktionsmethoden und sind von den ersten Filter in der Filterpipeline ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="3d564-282">*Authorization filters* control access to action methods and are the first filters to be executed within the filter pipeline.</span></span> <span data-ttu-id="3d564-283">Sie müssen nur eine vor der Methode, im Gegensatz zu den meisten Filter, die vor und nach Methoden unterstützen.</span><span class="sxs-lookup"><span data-stu-id="3d564-283">They have only a before method, unlike most filters that support before and after methods.</span></span> <span data-ttu-id="3d564-284">Wenn Sie eine eigene Autorisierungsframework schreiben, sollten Sie nur einem benutzerdefinierten Autorisierungs-Filter schreiben.</span><span class="sxs-lookup"><span data-stu-id="3d564-284">You should only write a custom authorization filter if you are writing your own authorization framework.</span></span> <span data-ttu-id="3d564-285">Bevorzugen Sie Ihre Autorisierungsrichtlinien konfigurieren, oder schreiben eine benutzerdefinierte Autorisierungsrichtlinie über das Schreiben eines benutzerdefinierten Filters.</span><span class="sxs-lookup"><span data-stu-id="3d564-285">Prefer configuring your authorization policies or writing a custom authorization policy over writing a custom filter.</span></span> <span data-ttu-id="3d564-286">Die integrierten filterimplementierung ist nur für das Aufrufen der Autorisierungssystem zuständig.</span><span class="sxs-lookup"><span data-stu-id="3d564-286">The built-in filter implementation is just responsible for calling the authorization system.</span></span>

<span data-ttu-id="3d564-287">Beachten Sie, dass Sie nicht Ausnahmen im Autorisierungsfilter, auslösen sollen da nichts wird die Ausnahme zu behandeln (Ausnahmefilter wird nicht behandelt werden).</span><span class="sxs-lookup"><span data-stu-id="3d564-287">Note that you should not throw exceptions within authorization filters, since nothing will handle the exception (exception filters won't handle them).</span></span> <span data-ttu-id="3d564-288">Stattdessen geben Sie eine neue Herausforderung dar oder finden Sie eine andere Möglichkeit.</span><span class="sxs-lookup"><span data-stu-id="3d564-288">Instead, issue a challenge or find another way.</span></span>

<span data-ttu-id="3d564-289">Erfahren Sie mehr über [Autorisierung](../../security/authorization/index.md).</span><span class="sxs-lookup"><span data-stu-id="3d564-289">Learn more about [Authorization](../../security/authorization/index.md).</span></span>

## <a name="resource-filters"></a><span data-ttu-id="3d564-290">Ressource filtern</span><span class="sxs-lookup"><span data-stu-id="3d564-290">Resource filters</span></span>

<span data-ttu-id="3d564-291">*Ressourcenfilter* implementieren entweder die `IResourceFilter` oder `IAsyncResourceFilter` -Schnittstelle, und ihre Ausführung dient als Wrapper für die meisten der Filterpipeline.</span><span class="sxs-lookup"><span data-stu-id="3d564-291">*Resource filters* implement either the `IResourceFilter` or `IAsyncResourceFilter` interface, and their execution wraps most of the filter pipeline.</span></span> <span data-ttu-id="3d564-292">(Nur [Autorisierungsfilter](#authorization-filters) vorgestellten ausführen.) Ressourcenfilter sind besonders hilfreich, wenn müssen Sie die meiste Arbeit Kurzschluss, die eine Anforderung ausführt.</span><span class="sxs-lookup"><span data-stu-id="3d564-292">(Only [Authorization filters](#authorization-filters) run before them.) Resource filters are especially useful if you need to short-circuit most of the work a request is doing.</span></span> <span data-ttu-id="3d564-293">Beispielsweise kann ein Zwischenspeichern Filter den Rest der Pipeline vermeiden, wenn die Antwort bereits im Cache befindet.</span><span class="sxs-lookup"><span data-stu-id="3d564-293">For example, a caching filter can avoid the rest of the pipeline if the response is already in the cache.</span></span>

<span data-ttu-id="3d564-294">Die [kurze circuiting Ressourcenfilter](#short-circuiting-resource-filter) weiter oben dargestellten ist ein Beispiel für einen Ressourcenfilter.</span><span class="sxs-lookup"><span data-stu-id="3d564-294">The [short circuiting resource filter](#short-circuiting-resource-filter) shown earlier is one example of a resource filter.</span></span> <span data-ttu-id="3d564-295">Ein weiteres Beispiel ist [DisableFormValueModelBindingAttribute](https://github.com/aspnet/Entropy/blob/rel/1.1.1/samples/Mvc.FileUpload/Filters/DisableFormValueModelBindingAttribute.cs), was verhindert wurden die modellbindung Zugriff auf die Daten des Formulars.</span><span class="sxs-lookup"><span data-stu-id="3d564-295">Another example is [DisableFormValueModelBindingAttribute](https://github.com/aspnet/Entropy/blob/rel/1.1.1/samples/Mvc.FileUpload/Filters/DisableFormValueModelBindingAttribute.cs), which prevents model binding from accessing the form data.</span></span> <span data-ttu-id="3d564-296">Es eignet sich für Fälle, in dem Sie wissen, dass Sie die offensichtlichen große Dateiuploads erhalten und um zu verhindern, dass das Formular in den Arbeitsspeicher gelesen werden sollen.</span><span class="sxs-lookup"><span data-stu-id="3d564-296">It's useful for cases where you know that you're going to receive large file uploads and want to prevent the form from being read into memory.</span></span>

## <a name="action-filters"></a><span data-ttu-id="3d564-297">Aktionsfilter</span><span class="sxs-lookup"><span data-stu-id="3d564-297">Action filters</span></span>

<span data-ttu-id="3d564-298">*Aktionsfilter* implementieren entweder die `IActionFilter` oder `IAsyncActionFilter` -Schnittstelle, und ihre Ausführung schließt die Ausführung von Aktionsmethoden.</span><span class="sxs-lookup"><span data-stu-id="3d564-298">*Action filters* implement either the `IActionFilter` or `IAsyncActionFilter` interface, and their execution surrounds the execution of action methods.</span></span>

<span data-ttu-id="3d564-299">So sieht ein Aktionsfilter Beispiel aus:</span><span class="sxs-lookup"><span data-stu-id="3d564-299">Here's a sample action filter:</span></span>

<span data-ttu-id="3d564-300">[!code-csharp[Main](./filters/sample/src/FiltersSample/Filters/SampleActionFilter.cs?name=snippet_ActionFilter)]</span><span class="sxs-lookup"><span data-stu-id="3d564-300">[!code-csharp[Main](./filters/sample/src/FiltersSample/Filters/SampleActionFilter.cs?name=snippet_ActionFilter)]</span></span>

<span data-ttu-id="3d564-301">Die [ActionExecutingContext](https://docs.microsoft.com/aspnet/core/api/microsoft.aspnetcore.mvc.filters.actionexecutingcontext) stellt die folgenden Eigenschaften:</span><span class="sxs-lookup"><span data-stu-id="3d564-301">The [ActionExecutingContext](https://docs.microsoft.com/aspnet/core/api/microsoft.aspnetcore.mvc.filters.actionexecutingcontext) provides the following properties:</span></span>

* <span data-ttu-id="3d564-302">`ActionArguments`-können Sie die Eingaben für die Aktion zu bearbeiten.</span><span class="sxs-lookup"><span data-stu-id="3d564-302">`ActionArguments` - lets you manipulate the inputs to the action.</span></span>
* <span data-ttu-id="3d564-303">`Controller`-können Sie die Controller-Instanz zu bearbeiten.</span><span class="sxs-lookup"><span data-stu-id="3d564-303">`Controller` - lets you manipulate the controller instance.</span></span> 
* <span data-ttu-id="3d564-304">`Result`-Einstellung kurzgeschlossen Ausführung der Aktionsmethode und den nachfolgenden Aktionsfilter verwendet werden wird.</span><span class="sxs-lookup"><span data-stu-id="3d564-304">`Result` - setting this short-circuits execution of the action method and subsequent action filters.</span></span> <span data-ttu-id="3d564-305">Eine Ausnahme verhindert die Ausführung der Aktionsmethode und den nachfolgenden Filter auch wird als Fehler anstatt ein erfolgreiches Ergebnis behandelt.</span><span class="sxs-lookup"><span data-stu-id="3d564-305">Throwing an exception also prevents execution of the action method and subsequent filters, but is treated as a failure instead of a successful result.</span></span>

<span data-ttu-id="3d564-306">Die [ActionExecutedContext](https://docs.microsoft.com/aspnet/core/api/microsoft.aspnetcore.mvc.filters.actionexecutedcontext) bietet `Controller` und `Result` plus die folgenden Eigenschaften:</span><span class="sxs-lookup"><span data-stu-id="3d564-306">The [ActionExecutedContext](https://docs.microsoft.com/aspnet/core/api/microsoft.aspnetcore.mvc.filters.actionexecutedcontext) provides `Controller` and `Result` plus the following properties:</span></span>

* <span data-ttu-id="3d564-307">`Canceled`-"true", wenn die aktionsausführung durch einen anderen Filter kurzgeschlossen wurde.</span><span class="sxs-lookup"><span data-stu-id="3d564-307">`Canceled` - will be true if the action execution was short-circuited by another filter.</span></span>
* <span data-ttu-id="3d564-308">`Exception`-ungleich Null ist, werden, wenn die Aktion oder einen Aktionsfilter für die nachfolgende eine Ausnahme ausgelöst hat.</span><span class="sxs-lookup"><span data-stu-id="3d564-308">`Exception` - will be non-null if the action or a subsequent action filter threw an exception.</span></span> <span data-ttu-id="3d564-309">Durch Festlegen dieser Eigenschaft auf null effektiv eine Ausnahme "handles", und `Result` wird ausgeführt, als hätte es normalerweise von der Aktionsmethode zurückgegeben wurden.</span><span class="sxs-lookup"><span data-stu-id="3d564-309">Setting this property to null effectively 'handles' an exception, and `Result` will be executed as if it were returned from the action method normally.</span></span>

<span data-ttu-id="3d564-310">Für eine `IAsyncActionFilter`, einen Aufruf der `ActionExecutionDelegate` führt alle nachfolgenden Aktionsfilter verwendet werden und die Aktionsmethode Zurückgeben einer `ActionExecutedContext`.</span><span class="sxs-lookup"><span data-stu-id="3d564-310">For an `IAsyncActionFilter`, a call to the `ActionExecutionDelegate` executes any subsequent action filters and the action method, returning an `ActionExecutedContext`.</span></span> <span data-ttu-id="3d564-311">Weisen Sie zum Circuit `ActionExecutingContext.Result` auf einige Ergebnis-Instanz und rufen Sie nicht die `ActionExecutionDelegate`.</span><span class="sxs-lookup"><span data-stu-id="3d564-311">To short-circuit, assign `ActionExecutingContext.Result` to some result instance and do not call the `ActionExecutionDelegate`.</span></span>

<span data-ttu-id="3d564-312">Das Framework bietet eine abstrakte `ActionFilterAttribute` , können Sie die Unterklasse.</span><span class="sxs-lookup"><span data-stu-id="3d564-312">The framework provides an abstract `ActionFilterAttribute` that you can subclass.</span></span> 

<span data-ttu-id="3d564-313">Einen Aktionsfilter können Sie automatisch Modellstatus überprüfen und alle Fehler zurück, wenn der Status ungültig ist:</span><span class="sxs-lookup"><span data-stu-id="3d564-313">You can use an action filter to automatically validate model state and return any errors if the state is invalid:</span></span>

<span data-ttu-id="3d564-314">[!code-csharp[Main](./filters/sample/src/FiltersSample/Filters/ValidateModelAttribute.cs)]</span><span class="sxs-lookup"><span data-stu-id="3d564-314">[!code-csharp[Main](./filters/sample/src/FiltersSample/Filters/ValidateModelAttribute.cs)]</span></span>

<span data-ttu-id="3d564-315">Die `OnActionExecuted` Methode ausgeführt wird, nachdem die Aktionsmethode und kann anzeigen und bearbeiten Sie die Ergebnisse der Aktion durch die `ActionExecutedContext.Result` Eigenschaft.</span><span class="sxs-lookup"><span data-stu-id="3d564-315">The `OnActionExecuted` method runs after the action method and can see and manipulate the results of the action through the `ActionExecutedContext.Result` property.</span></span> <span data-ttu-id="3d564-316">`ActionExecutedContext.Canceled`wird auf "true", wenn die aktionsausführung durch einen anderen Filter kurzgeschlossen wurde festgelegt.</span><span class="sxs-lookup"><span data-stu-id="3d564-316">`ActionExecutedContext.Canceled` will be set to true if the action execution was short-circuited by another filter.</span></span> <span data-ttu-id="3d564-317">`ActionExecutedContext.Exception`wird auf einen Wert ungleich Null festgelegt werden, wenn die Aktion oder einen Aktionsfilter für die nachfolgende eine Ausnahme ausgelöst hat.</span><span class="sxs-lookup"><span data-stu-id="3d564-317">`ActionExecutedContext.Exception` will be set to a non-null value if the action or a subsequent action filter threw an exception.</span></span> <span data-ttu-id="3d564-318">Festlegen von `ActionExecutedContext.Exception` effektiv NULL ' "eine Ausnahme behandelt, und `ActionExectedContext.Result` wird dann ausgeführt werden, als wäre es normalerweise von der Aktionsmethode zurückgegeben wurden.</span><span class="sxs-lookup"><span data-stu-id="3d564-318">Setting `ActionExecutedContext.Exception` to null effectively 'handles' an exception, and `ActionExectedContext.Result` will then be executed as if it were returned from the action method normally.</span></span>

## <a name="exception-filters"></a><span data-ttu-id="3d564-319">Ausnahmefilter</span><span class="sxs-lookup"><span data-stu-id="3d564-319">Exception filters</span></span>

<span data-ttu-id="3d564-320">*Ausnahmefilter* implementieren entweder die `IExceptionFilter` oder `IAsyncExceptionFilter` Schnittstelle.</span><span class="sxs-lookup"><span data-stu-id="3d564-320">*Exception filters* implement either the `IExceptionFilter` or `IAsyncExceptionFilter` interface.</span></span> <span data-ttu-id="3d564-321">Sie können verwendet werden, um häufige Fehler bei der Verarbeitung von Richtlinien für eine app zu implementieren.</span><span class="sxs-lookup"><span data-stu-id="3d564-321">They can be used to implement common error handling policies for an app.</span></span> 

<span data-ttu-id="3d564-322">Das folgende Beispiel Ausnahmefilter verwendet eine benutzerdefinierte Developer Fehleransicht zum Anzeigen von Details über Ausnahmen, die auftreten, wenn die Anwendung in der Entwicklung befindet:</span><span class="sxs-lookup"><span data-stu-id="3d564-322">The following sample exception filter uses a custom developer error view to display details about exceptions that occur when the application is in development:</span></span>

<span data-ttu-id="3d564-323">[!code-csharp[Main](./filters/sample/src/FiltersSample/Filters/CustomExceptionFilterAttribute.cs?name=snippet_ExceptionFilter&highlight=1,14)]</span><span class="sxs-lookup"><span data-stu-id="3d564-323">[!code-csharp[Main](./filters/sample/src/FiltersSample/Filters/CustomExceptionFilterAttribute.cs?name=snippet_ExceptionFilter&highlight=1,14)]</span></span>

<span data-ttu-id="3d564-324">Ausnahmefilter keine zwei Ereignisse (vor und nach) – nur implementierten hierarchieentwurfs `OnException` (oder `OnExceptionAsync`).</span><span class="sxs-lookup"><span data-stu-id="3d564-324">Exception filters do not have two events (for before and after) - they only implement `OnException` (or `OnExceptionAsync`).</span></span> 

<span data-ttu-id="3d564-325">Ausnahmefilter nicht behandelte Ausnahmen behandelt, die auftreten, im Controller-Erstellung [modellbindung](../models/model-binding.md), Aktionsfilter oder Aktionsmethoden.</span><span class="sxs-lookup"><span data-stu-id="3d564-325">Exception filters handle unhandled exceptions that occur in controller creation, [model binding](../models/model-binding.md), action filters, or action methods.</span></span> <span data-ttu-id="3d564-326">Sie wird nicht Abfangen von Ausnahmen, die in der Ressourcenfilter, Ergebnisfilter oder Ausführung von MVC-Ergebnis auftreten.</span><span class="sxs-lookup"><span data-stu-id="3d564-326">They won't catch exceptions that occur in Resource filters, Result filters, or MVC Result execution.</span></span>

<span data-ttu-id="3d564-327">Um eine Ausnahme zu behandeln, legen Sie die `ExceptionContext.ExceptionHandled` Eigenschaft auf "true" oder eine Antwort zu schreiben.</span><span class="sxs-lookup"><span data-stu-id="3d564-327">To handle an exception, set the `ExceptionContext.ExceptionHandled` property to true or write a response.</span></span> <span data-ttu-id="3d564-328">Dadurch wird die Weitergabe der Ausnahme beendet.</span><span class="sxs-lookup"><span data-stu-id="3d564-328">This stops propagation of the exception.</span></span> <span data-ttu-id="3d564-329">Beachten Sie, dass ein Ausnahmefilter eine Ausnahme in "Erfolg" nicht aktivieren können.</span><span class="sxs-lookup"><span data-stu-id="3d564-329">Note that an Exception filter can't turn an exception into a "success".</span></span> <span data-ttu-id="3d564-330">Nur ein Aktionsfilter kann dies tun.</span><span class="sxs-lookup"><span data-stu-id="3d564-330">Only an Action filter can do that.</span></span>

> [!NOTE]
> <span data-ttu-id="3d564-331">In ASP.NET Version 1.1, die Antwort nicht gesendet, wenn Sie festlegen, `ExceptionHandled` auf "true" **und** eine Antwort zu schreiben.</span><span class="sxs-lookup"><span data-stu-id="3d564-331">In ASP.NET 1.1, the response is not sent if you set `ExceptionHandled` to true **and** write a response.</span></span> <span data-ttu-id="3d564-332">In diesem Szenario ASP.NET Core 1.0 sendet die Antwort und ASP.NET Core 1.1.2 1.0 Verhalten zurück.</span><span class="sxs-lookup"><span data-stu-id="3d564-332">In that scenario, ASP.NET Core 1.0 does send the response, and ASP.NET Core 1.1.2 will return to the 1.0 behavior.</span></span> <span data-ttu-id="3d564-333">Weitere Informationen finden Sie unter [ausstellen #5594](https://github.com/aspnet/Mvc/issues/5594) im GitHub-Repository.</span><span class="sxs-lookup"><span data-stu-id="3d564-333">For more information, see [issue #5594](https://github.com/aspnet/Mvc/issues/5594) in the GitHub repository.</span></span> 

<span data-ttu-id="3d564-334">Ausnahmefilter eignen sich für Auffangen von Ausnahmen, die in MVC Aktionen auftreten, aber sie sind nicht so flexibel wie Middleware für die Fehlerbehandlung.</span><span class="sxs-lookup"><span data-stu-id="3d564-334">Exception filters are good for trapping exceptions that occur within MVC actions, but they're not as flexible as error handling middleware.</span></span> <span data-ttu-id="3d564-335">Middleware für die allgemeine Groß-/Kleinschreibung vorziehen, und verwenden Sie Filter, in denen Sie nur müssen Vorgehensweise Fehlerbehandlung *anders* basierend auf die MVC-Aktion ausgewählt wurde.</span><span class="sxs-lookup"><span data-stu-id="3d564-335">Prefer middleware for the general case, and use filters only where you need to do error handling *differently* based on which MVC action was chosen.</span></span> <span data-ttu-id="3d564-336">Z. B. möglicherweise die app Aktionsmethoden für beide-API-Endpunkte und Ansichten/HTML.</span><span class="sxs-lookup"><span data-stu-id="3d564-336">For example, your app might have action methods for both API endpoints and for views/HTML.</span></span> <span data-ttu-id="3d564-337">Die API-Endpunkte können Fehlerinformationen als JSON, zurückgeben, während die Ansicht basierende Aktionen als HTML-Fehlerseite zurückgeben können.</span><span class="sxs-lookup"><span data-stu-id="3d564-337">The API endpoints could return error information as JSON, while the view-based actions could return an error page as HTML.</span></span>

<span data-ttu-id="3d564-338">Das Framework bietet eine abstrakte `ExceptionFilterAttribute` , können Sie die Unterklasse.</span><span class="sxs-lookup"><span data-stu-id="3d564-338">The framework provides an abstract `ExceptionFilterAttribute` that you can subclass.</span></span> 

## <a name="result-filters"></a><span data-ttu-id="3d564-339">Ergebnisfilter</span><span class="sxs-lookup"><span data-stu-id="3d564-339">Result filters</span></span>

<span data-ttu-id="3d564-340">*Führen Sie die Filter* implementieren entweder die `IResultFilter` oder `IAsyncResultFilter` -Schnittstelle, und ihre Ausführung schließt die Ausführung von Aktionsergebnisse.</span><span class="sxs-lookup"><span data-stu-id="3d564-340">*Result filters* implement either the `IResultFilter` or `IAsyncResultFilter` interface, and their execution surrounds the execution of action results.</span></span> 

<span data-ttu-id="3d564-341">Hier ist ein Beispiel für einen Ergebnisfilter, der einen HTTP-Header hinzufügt.</span><span class="sxs-lookup"><span data-stu-id="3d564-341">Here's an example of a Result filter that adds an HTTP header.</span></span>

<span data-ttu-id="3d564-342">[!code-csharp[Main](./filters/sample/src/FiltersSample/Filters/LoggingAddHeaderFilter.cs?name=snippet_ResultFilter)]</span><span class="sxs-lookup"><span data-stu-id="3d564-342">[!code-csharp[Main](./filters/sample/src/FiltersSample/Filters/LoggingAddHeaderFilter.cs?name=snippet_ResultFilter)]</span></span>

<span data-ttu-id="3d564-343">Die Art von Ergebnis, die gerade ausgeführt wird, hängt von der betreffenden Aktion ab.</span><span class="sxs-lookup"><span data-stu-id="3d564-343">The kind of result being executed depends on the action in question.</span></span> <span data-ttu-id="3d564-344">Eine MVC-Aktion, die eine Sicht zurückgeben zählen alle Razor, die im Rahmen der Verarbeitung der `ViewResult` ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="3d564-344">An MVC action returning a view would include all razor processing as part of the `ViewResult` being executed.</span></span> <span data-ttu-id="3d564-345">Eine API-Methode möglicherweise einige Serialisierung als Teil der Ausführung des Ergebnisses ausführen.</span><span class="sxs-lookup"><span data-stu-id="3d564-345">An API method might perform some serialization as part of the execution of the result.</span></span> <span data-ttu-id="3d564-346">Erfahren Sie mehr über [Aktionsergebnisse](actions.md)</span><span class="sxs-lookup"><span data-stu-id="3d564-346">Learn more about [action results](actions.md)</span></span>

<span data-ttu-id="3d564-347">Ergebnisfilter sind nur für erfolgreiche Ergebnisse - ausgeführt, wenn die Aktion oder ein Aktionsfilter ein Aktionsergebnis erzeugen.</span><span class="sxs-lookup"><span data-stu-id="3d564-347">Result filters are only executed for successful results - when the action or action filters produce an action result.</span></span> <span data-ttu-id="3d564-348">Ergebnisfilter werden nicht ausgeführt, wenn Ausnahmefilter eine Ausnahme zu behandeln.</span><span class="sxs-lookup"><span data-stu-id="3d564-348">Result filters are not executed when exception filters handle an exception.</span></span>

<span data-ttu-id="3d564-349">Die `OnResultExecuting` Methode kann Ausführung der Aktionsergebnis und die nachfolgenden Ergebnisfilter durch Festlegen von Kurzschluss `ResultExecutingContext.Cancel` auf "true".</span><span class="sxs-lookup"><span data-stu-id="3d564-349">The `OnResultExecuting` method can short-circuit execution of the action result and subsequent result filters by setting `ResultExecutingContext.Cancel` to true.</span></span> <span data-ttu-id="3d564-350">Sie sollten im Allgemeinen auf dem Antwortobjekt schreiben, wenn Kurzschlussverhalten, um zu vermeiden, Erstellen einer leeren Antwort.</span><span class="sxs-lookup"><span data-stu-id="3d564-350">You should generally write to the response object when short-circuiting to avoid generating an empty response.</span></span> <span data-ttu-id="3d564-351">Auslösen einer Ausnahme wird außerdem verhindert, dass Ausführung der Aktionsergebnis und die nachfolgenden Filter, jedoch wird als Fehler anstatt ein erfolgreiches Ergebnis behandelt werden.</span><span class="sxs-lookup"><span data-stu-id="3d564-351">Throwing an exception will also prevent execution of the action result and subsequent filters, but will be treated as a failure instead of a successful result.</span></span>

<span data-ttu-id="3d564-352">Wenn die `OnResultExecuted` Methode ausgeführt wird, die Antwort wahrscheinlich an den Client gesendet wurde und nicht weiter geändert werden kann (es sei denn, eine Ausnahme ausgelöst wurde).</span><span class="sxs-lookup"><span data-stu-id="3d564-352">When the `OnResultExecuted` method runs, the response has likely been sent to the client and cannot be changed further (unless an exception was thrown).</span></span> <span data-ttu-id="3d564-353">`ResultExecutedContext.Canceled`wird auf "true", wenn die Ausführung der Aktion Ergebnis durch eine andere Filter kurzgeschlossen wurde festgelegt.</span><span class="sxs-lookup"><span data-stu-id="3d564-353">`ResultExecutedContext.Canceled` will be set to true if the action result execution was short-circuited by another filter.</span></span>

<span data-ttu-id="3d564-354">`ResultExecutedContext.Exception`wird auf einen Wert ungleich Null festgelegt werden, wenn das Aktionsergebnis oder einen nachfolgenden Ergebnisfilter eine Ausnahme ausgelöst hat.</span><span class="sxs-lookup"><span data-stu-id="3d564-354">`ResultExecutedContext.Exception` will be set to a non-null value if the action result or a subsequent result filter threw an exception.</span></span> <span data-ttu-id="3d564-355">Festlegen von `Exception` auf Null effektiv "handles" eine Ausnahme und verhindert, dass die Ausnahme wird erneut ausgelöst von MVC weiter unten in der Pipeline.</span><span class="sxs-lookup"><span data-stu-id="3d564-355">Setting `Exception` to null effectively 'handles' an exception and prevents the exception from being rethrown by MVC later in the pipeline.</span></span> <span data-ttu-id="3d564-356">Wenn Sie eine Ausnahme in einen Ergebnisfilter verarbeiten, können Sie keine Daten in die Antwort geschrieben sein.</span><span class="sxs-lookup"><span data-stu-id="3d564-356">When you're handling an exception in a result filter, you might not be able to write any data to the response.</span></span> <span data-ttu-id="3d564-357">Wenn das Aktionsergebnis wird durch die Ausführung eines ausgelöst und die Header an den Client bereits gelöscht wurden, ist keine zuverlässige Mechanismus zum Senden eines Fehlercode.</span><span class="sxs-lookup"><span data-stu-id="3d564-357">If the action result throws partway through its execution, and the headers have already been flushed to the client, there's no reliable mechanism to send a failure code.</span></span>

<span data-ttu-id="3d564-358">Für eine `IAsyncResultFilter` einen Aufruf von `await next()` auf die `ResultExecutionDelegate` führt alle nachfolgenden Ergebnisfilter und das Aktionsergebnis.</span><span class="sxs-lookup"><span data-stu-id="3d564-358">For an `IAsyncResultFilter` a call to `await next()` on the `ResultExecutionDelegate` executes any subsequent result filters and the action result.</span></span> <span data-ttu-id="3d564-359">Zu umgehen, legen Sie `ResultExecutingContext.Cancel` auf "true", und rufen Sie nicht die `ResultExectionDelegate`.</span><span class="sxs-lookup"><span data-stu-id="3d564-359">To short-circuit, set `ResultExecutingContext.Cancel` to true and do not call the `ResultExectionDelegate`.</span></span>

<span data-ttu-id="3d564-360">Das Framework bietet eine abstrakte `ResultFilterAttribute` , können Sie die Unterklasse.</span><span class="sxs-lookup"><span data-stu-id="3d564-360">The framework provides an abstract `ResultFilterAttribute` that you can subclass.</span></span> <span data-ttu-id="3d564-361">Die [AddHeaderAttribute](#add-header-attribute) weiter oben dargestellten Klasse ist ein Beispiel für ein Filterattribut Ergebnis.</span><span class="sxs-lookup"><span data-stu-id="3d564-361">The [AddHeaderAttribute](#add-header-attribute) class shown earlier is an example of a result filter attribute.</span></span>

## <a name="using-middleware-in-the-filter-pipeline"></a><span data-ttu-id="3d564-362">Mithilfe der Middleware in der Filterpipeline</span><span class="sxs-lookup"><span data-stu-id="3d564-362">Using middleware in the filter pipeline</span></span>

<span data-ttu-id="3d564-363">Ressourcenfilter funktionieren wie [Middleware](../../fundamentals/middleware.md) dahingehend, dass sie die Ausführung aller Elemente umschließen, der weiter unten in der Pipeline enthalten ist.</span><span class="sxs-lookup"><span data-stu-id="3d564-363">Resource filters work like [middleware](../../fundamentals/middleware.md) in that they surround the execution of everything that comes later in the pipeline.</span></span> <span data-ttu-id="3d564-364">Filter weichen jedoch von Middleware Teil MVC, sind dies bedeutet, dass sie Zugriff auf die MVC-Kontext und Konstrukte haben.</span><span class="sxs-lookup"><span data-stu-id="3d564-364">But filters differ from middleware in that they are part of MVC, which means that they have access to MVC context and constructs.</span></span>

<span data-ttu-id="3d564-365">In ASP.NET Core 1.1 können Sie die Middleware in der Filterpipeline verwenden.</span><span class="sxs-lookup"><span data-stu-id="3d564-365">In ASP.NET Core 1.1, you can use middleware in the filter pipeline.</span></span> <span data-ttu-id="3d564-366">Sie möchten nicht, wenn Sie eine middlewarekomponente verfügen, die benötigt Zugriff auf die MVC-Routendaten oder eine, die nur für bestimmte Domänencontroller oder Aktionen ausgeführt werden soll.</span><span class="sxs-lookup"><span data-stu-id="3d564-366">You might want to do that if you have a middleware component that needs access to MVC route data, or one that should run only for certain controllers or actions.</span></span>

<span data-ttu-id="3d564-367">Um Middleware als Filter verwenden, erstellen Sie einen Typ mit einer `Configure` Methode, die die Middleware angibt, die Sie in der Filterpipeline einfügen möchten.</span><span class="sxs-lookup"><span data-stu-id="3d564-367">To use middleware as a filter, create a type with a `Configure` method that specifies the middleware that you want to inject into the filter pipeline.</span></span> <span data-ttu-id="3d564-368">Hier ist ein Beispiel, das die Middleware für die Lokalisierung verwendet wird, um die aktuelle Kultur für eine Anforderung einzurichten:</span><span class="sxs-lookup"><span data-stu-id="3d564-368">Here's an example that uses the localization middleware to establish the current culture for a request:</span></span>

<span data-ttu-id="3d564-369">[!code-csharp[Main](./filters/sample/src/FiltersSample/Filters/LocalizationPipeline.cs?name=snippet_MiddlewareFilter&highlight=3,21)]</span><span class="sxs-lookup"><span data-stu-id="3d564-369">[!code-csharp[Main](./filters/sample/src/FiltersSample/Filters/LocalizationPipeline.cs?name=snippet_MiddlewareFilter&highlight=3,21)]</span></span>

<span data-ttu-id="3d564-370">Anschließend können Sie die `MiddlewareFilterAttribute` die Middleware für einen ausgewählten Controller bzw. die Aktionsmethode ausgeführt oder global:</span><span class="sxs-lookup"><span data-stu-id="3d564-370">You can then use the `MiddlewareFilterAttribute` to run the middleware for a selected controller or action or globally:</span></span>

<span data-ttu-id="3d564-371">[!code-csharp[Main](./filters/sample/src/FiltersSample/Controllers/HomeController.cs?name=snippet_MiddlewareFilter&highlight=2)]</span><span class="sxs-lookup"><span data-stu-id="3d564-371">[!code-csharp[Main](./filters/sample/src/FiltersSample/Controllers/HomeController.cs?name=snippet_MiddlewareFilter&highlight=2)]</span></span>

<span data-ttu-id="3d564-372">Führen Sie auf der gleichen Stufe der Filterpipeline als Ressourcenfilter vor der modellbindung und nach den Rest der Pipeline Middleware-Filter.</span><span class="sxs-lookup"><span data-stu-id="3d564-372">Middleware filters run at the same stage of the filter pipeline as Resource filters, before model binding and after the rest of the pipeline.</span></span>

## <a name="next-actions"></a><span data-ttu-id="3d564-373">Nächste Schritte</span><span class="sxs-lookup"><span data-stu-id="3d564-373">Next actions</span></span>

<span data-ttu-id="3d564-374">Experimentieren Sie mit Filtern, [herunterladen, testen und ändern Sie das Beispiel](https://github.com/aspnet/Docs/tree/master/aspnetcore/mvc/controllers/filters/sample).</span><span class="sxs-lookup"><span data-stu-id="3d564-374">To experiment with filters, [download, test and modify the sample](https://github.com/aspnet/Docs/tree/master/aspnetcore/mvc/controllers/filters/sample).</span></span>
